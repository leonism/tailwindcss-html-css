'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[23],{1251:function(t,D,a){t=a(0);var c=a(15),b=a(80),d=a(815),f=a(84),e=a(184),k=a(8),l=a(211),m=a(64),v=a(42),n=a(510),w=a(170),r=a(109),u=a(281),x=a(1),z=a(11),B=a(100),y=a(14),A=a(280);a(97);var K=a(21),G=a(338);class T{constructor(J,R,M){this.NEa=J;this.Bk=R;this.NAc=M}}Object(t.a)(T,"UserActivityLocation",null,[]);var W=a(978),P=a(62);const E=(J,R,M,L,U,X=null)=>{X=J.Na(1,X);return P.g(J,"GetVersionHistoryHighlightActivitiesData",
X,R,M,L,U,4)};var H=a(758),F=a(55);a.d(D,"a",function(){return N});class N{constructor(J,R,M,L){this.authorColor=this.q1=this.Wda=null;this.B6a=!1;this.m0a=-1;this.m3c=0;this.yHa=100;this.gka=-1;this.KYd=null;this.Lnb=k.a.rVj;this.YEe=k.a.sVj;this.ki=U=>{(U=u.a(U)?null:U.Result)?U.OperationWaitingForFileDownload?20>this.m3c?(this.yHa*=2,F.Task.delay(this.yHa).continueWith(()=>{this.XVd()})):(this.eAc(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):
U.ActivityList?(this.initialize(U.ActivityList,U.VersionAuthors),x.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.eOa():this.gwc(!0),this.KYd.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.KYd.tc.toString()}`)):(this.eAc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.yHa*=2,F.Task.delay(this.yHa).continueWith(()=>
{this.XVd()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.gya=()=>{this.eAc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.kqd=U=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${U.MessageId}`);switch(U.MessageId){case W.a.iterateNext:this.iterateNext();this.gka=(this.gka+1)%this.MR.length;
this.nJb(W.a.setCurrentChangeCount,this.gka+1);break;case W.a.Hwa:this.Hwa();this.gka=0>this.gka?0:this.gka;this.gka=(this.gka+this.MR.length-1)%this.MR.length;this.nJb(W.a.setCurrentChangeCount,this.gka+1);break;case W.a.AMb:this.gwc(U.Values.ToggleValue)}};this.x_g=(U,X)=>this.A1b(U.Bk,X.Bk);this.w_g=(U,X)=>this.A1b(U.Bk,X);this.Uc=()=>{this.z4b()};this.rn=()=>{this.z4b()};this.Lh=()=>{this.z4b()};c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=J;this.ariaLiveNotifier=
L;this.gridView=K.g(this.$);this.gridView.ha.LG(this.Uc);this.gridView.iC(this.rn);this.gridView.Wb.Mk(this.Lh);this.mRj();R&&(this.KYd=J.Hb.xc("UserAction","VersionHistoryDiffManagerStopWatch"),this.XVd());if(this.Vr=M)J=b.a.gaa(this.$.ya.VersionHistoryActionUrl)||H.a.f9,J!==H.a.f9&&this.Vr.QEa(J),this.Vr.fo(W.a.iterateNext),this.Vr.fo(W.a.Hwa),this.Vr.fo(W.a.AMb),this.Vr.Vl(W.a.iterateNext,this.kqd),this.Vr.Vl(W.a.Hwa,this.kqd),this.Vr.Vl(W.a.AMb,this.kqd)}get Yeb(){return this.q1}get hJb(){return-1===
this.m0a?null:this.MR[this.m0a]}get MR(){this.B6a||(this.Wda.sort(this.x_g),this.B6a=!0);return this.Wda}dispose(){this.aza();this.Wda=this.q1=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.RF(this.Uc),this.gridView.BD(this.rn),this.gridView.Wb&&this.gridView.Wb.Gk(this.Lh),this.Vr&&(this.Vr.Pna(W.a.Hwa),this.Vr.Pna(W.a.iterateNext),this.Vr.Pna(W.a.AMb)))}initialize(J,R){J?(this.aza(),this.m0a=-1,this.Wda=[],this.B6a=!1,this.q1={},this.authorColor={},this.Bxi(R),this.V2c(J)):c.ULS.shipAssertTag(537150410,
0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}XVd(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.m3c.toString()} --${this.yHa.toString()}`);this.m3c++;const J=(R,M,L)=>E(this.$.pa.va,A.b(R,this.ki),A.a(M,this.gya),L,null);x.EwaSettings.fc()?this.$.userOperationManager.Ub(new w.a(537,0,J,80),null):this.$.userOperationManager.Ub(new n.a(537,0,J,16),null)}gwc(J){const R=this.q1;for(let L in R){var M=
L;const U=R[L];U?U.YKb(J):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+M+"view was Null")}}aza(){const J=this.q1;for(let M in J){var R=M;const L=J[M];L?L.gHd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+R+"view was Null")}this.Wda=this.q1=null}RVf(J){let R;if(({J8e:R,Ndg:J}=this.JRh(J,this.m0a)).returnValue)if(c.ULS.shipAssertTag(537150402,0,!!J,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null"),
this.z4b(),J.NEa.toString()in this.q1){this.q1[J.NEa.toString()].glj(J.Bk);var M=v.D(J.Bk);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(y.a.instance.mb(158),R+1,this.MR.length,M.jz(!1),J.NAc.DisplayName));this.m0a=R}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${J.NEa.toString()} view not present in views dictionary`)}nJb(J,R){if(x.EwaSettings.ma(319))if(this.Vr){var M=
{};M.count=R;J=new d.a(J);J.Values=M;this.Vr.send(J)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}JRh(J,R){let M,L=!1;M=null;let U=0;for(;!L&&U<this.MR.length;){R=J?this.ARh(R):this.uTh(R);M=this.MR[R];const X=Object(f.a)(B.a,this.$.xa.getItemByName(M.Bk.SheetName));if(!X)return c.ULS.shipAssertTag(537150369,
0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,J8e:R,Ndg:M};X.visible&&(L=!0);U++}return{returnValue:L,J8e:R,Ndg:M}}ARh(J){return-1===J?this.IZe():(J+1)%this.MR.length}uTh(J){-1===J&&(J=this.IZe());return J=(J+this.MR.length-1)%this.MR.length}V2c(J){this.h$g(J);this.B2c()}hZh(J,R){const M=[];if(!J.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),
M;for(const L of J.RangeList)L&&this.$.xa.qk(L.SheetName)?(J=new T(0,L,R),M.push(J)):c.ULS.shipAssertTag(537150367,0,!1," Inavlid sheet name"+L.SheetName);return M}h$g(J){for(const R of J)if(!R||r.e(R.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const M of R.LocationList)if(M)switch(M.Type){case 0:this.Wda.push(...this.hZh(M,R.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,
0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}B2c(){var J={};const R=new e.a,M=[];for(const L of this.Wda){R.contains(L.NAc)||R.add(L.NAc);if(0!==L.NEa)continue;const U=new G.a(v.D(L.Bk),m.d(this.$.xa.getItemByName(L.Bk.SheetName))),X=N.hvc(U);X in J||M.push(U);J[X]=this.FJh(L.NAc)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.Wda.length}, Highlightable activities: ${M.length},Total userlist in activities : ${this.Wda.length}, Total userlist from pane: ${M.length} `);
this.eAc();0<M.length&&(J=new (a(1354).RangeVersionHistoryHighlightView)(this.$,M,J,this.Lnb),this.q1["0"]=J)}eAc(){const J=this.Wda?this.MR.length:0;this.nJb(W.a.setCurrentChangeCount,0);this.nJb(W.a.setTotalChangesCount,J)}eOa(){this.nJb(W.a.eOa,0)}Bxi(J){if(J)for(let U=0;U<J.length;++U)if(x.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!J[U].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");
else{var R=J[U].EmailAddress;var M=J[U].UserName;var L=null;if(J[U].LoginName){const X=J[U].LoginName.split("|");3===X.length&&(L=X[2])}L?this.authorColor[L]=J[U].InitialsColor:R?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[R]=J[U].InitialsColor):M?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[M]=J[U].InitialsColor):c.ULS.sendTraceTag(537150359,
0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}mRj(){if(this.$.ya.VersionHistoryHighlightsSettings){var J=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings):null;for(let M=0;M<J.length;M++){var R=J[M];const L=
R.key?R.key:R.Key?R.Key:"";R=R.value?R.value:R.Value?R.Value:"";"DefaultColor"===L?this.YEe=R:"InitialTint"===L?this.Lnb=R:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}FJh(J){if(J.Email in this.authorColor)return this.authorColor[J.Email];if(J.DisplayName in this.authorColor)return this.authorColor[J.DisplayName];
c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.YEe}A1b(J,R){var M=Object(f.a)(B.a,this.$.xa.getItemByName(J.SheetName));const L=Object(f.a)(B.a,this.$.xa.getItemByName(R.SheetName));return M&&L?(M=(M=z.HelperMethods.iD(M.index,L.index))||z.HelperMethods.iD(J.FirstRow,R.FirstRow))||z.HelperMethods.iD(J.FirstColumn,R.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),
0)}IZe(){var J=v.m(this.gridView.ha.sa.activeRange,this.$.xa.oa);if(!J)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;J=z.HelperMethods.qx(new l.a(this.MR),0,this.MR.length,J,this.w_g);0>J&&(J=~J);return J%this.MR.length}z4b(){if(this.hJb){if(!(this.hJb.NEa.toString()in this.q1)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.hJb.NEa.toString()} view not present in views dictionary`);
return}this.q1[this.hJb.NEa.toString()].Wch(this.hJb.Bk)}this.m0a=-1}iterateNext(){this.RVf(!0)}Hwa(){this.RVf(!1)}static hvc(J){return`${J.range}${J.sheetId}`}}Object(t.a)(N,"VersionHistoryHighlightManager",null,[735,3])},1354:function(t,D,a){a.r(D);t=a(0);var c=a(15),b=a(8);class d{}d.srh="ewa-vhr-rectinnerborder";Object(t.a)(d,"CssClassNames",null,[]);var f=a(64),e=a(42),k=a(196),l=a(97),m=a(21),v=a(338),n=a(1251);a.d(D,"RangeVersionHistoryHighlightView",function(){return w});class w{constructor(r,
u,x,z){this.Ihb=null;this.$=r;this.evg=u;this.gRa=x;this.hRa={};this.Lnb=z;this.aai()}get hF(){return[w.N3]}get ob(){return this.Ihb||(this.Ihb=m.g(this.$).ob)}YKb(r){r?this.ob.Bn(this.hF):this.ob.Tg(this.hF)}gHd(){this.YKb(!1);this.ob.PQa(new v.a(null,f.d(this.$.oa)),this.hF)}glj(r){if(this.gRa){var u=new v.a(e.D(r),f.d(this.$.xa.getItemByName(r.SheetName))),x=n.a.hvc(u);if(x in this.gRa)if(x in this.hRa){u=k.a.Zo(this.gRa[x]);x=this.hRa[x];for(let z in x)x[z].style.backgroundColor=`rgba(${u.r},${u.g},${u.b},${b.a.tVj})`;
m.g(this.$).ha.Oa.$G(null);m.g(this.$).k3e(r,60,!0,l.a.J3i)}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+x);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+x)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}Wch(r){r=new v.a(e.D(r),f.d(this.$.xa.getItemByName(r.SheetName)));
var u=n.a.hvc(r);if(u in this.hRa)if(u in this.gRa){r=k.a.Zo(this.gRa[u]);u=this.hRa[u];for(let x in u)u[x].style.backgroundColor=`rgba(${r.r},${r.g},${r.b},${this.Lnb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+u);else c.ULS.sendTraceTag(537150425,0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+u)}aai(){this.ob.yv(this.evg,[w.N3],!1,(r,u)=>{if(r&&r.range&&
r.sheetId&&u){var x=new v.a(r.range,r.sheetId);x=n.a.hvc(x);x in this.hRa||(this.hRa[x]={});this.hRa[x][r.paneType.toString()]=u;x in this.gRa?(r=this.gRa[x],x=k.a.Zo(r),u.style.borderColor=r,u.style.backgroundColor=`rgba(${x.r},${x.g},${x.b},${this.Lnb})`,r=document.createElement("div"),r.className=d.srh,u.appendChild(r)):c.ULS.sendTraceTag(537150419,0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+x)}else c.ULS.shipAssertTag(537150423,
0,!!r,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!r||!!r.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!r||!!r.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,0,!!u,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}w.N3=23;Object(t.a)(w,"RangeVersionHistoryHighlightView",null,[760])},1418:function(t,
D,a){a.r(D);var c=a(10),b=a(0),d=a(4),f=a(220),e=a(15),k=a(114),l=a(182),m=a(41);class v extends k.a{constructor(ja,hb,oa,fb,Eb){super(ja,hb);this.executionContext=null;this.retryCount=0;this.GPi=jc=>{({hKd:jc}=this.CMj(jc)).returnValue?jc.Success?(l.c(2138207060,!0),e.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(l.c(2138207060,!1),e.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${jc.Output}`),
this.dh(this.MJ)):(l.c(2138207060,!1),this.dh(this.MJ));(jc=this.executionContext.activityState[v.atd])&&jc();this.pp();this.executionContext.nM()};this.FPi=()=>{if(0<this.retryCount)e.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.JSf();else{e.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");l.c(2138207060,!1);this.dh(this.MJ);
var jc=this.executionContext.activityState[v.atd];jc&&jc();this.pp();this.executionContext.nM()}};this.MJ=oa;this.j2=fb;this.baseUrl=Eb}execute(ja){this.executionContext=ja;this.retryCount=3;this.JSf();return 1}JSf(){var ja=this.executionContext.activityState[v.kpc];const hb=`${this.baseUrl}${"restoreversion.ashx"}`,oa={};oa.VersionId=this.executionContext.activityState[v.Meg];oa.QuerySignature=ja;ja=m.c(oa);this.j2.hm(hb,2,ja,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.GPi,this.FPi,
null)}CMj(ja){let hb;hb=null;ja=ja?ja.data?ja.data.Td:null:null;return ja&&ja.length?({Vt:hb}=m.d(ja)).returnValue?{returnValue:!0,hKd:hb}:(e.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,hKd:hb}):(e.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),{returnValue:!1,hKd:hb})}}v.Meg="RVAvi";v.kpc="RVAqs";v.atd=
"RVlvrt";Object(b.a)(v,"RestoreVersionActivity",k.a,[]);var n=a(6);class w extends f.a{constructor(ja,hb,oa){super();this.activityName=ja;this.DJ=hb;this.MJ=oa;this.Fb()}create(){this.qb(new v(this.activityName,this.DJ,this.MJ,d.AFrameworkApplication.rd,d.AFrameworkApplication.ta.Pa.gV))}static ka(ja){ja.da.Ga(320,new w(n.a.kKd,n.a.Xi,n.a.lKd))}}Object(b.a)(w,"RestoreVersionActivityFactory",f.a,[]);class r extends k.a{constructor(ja,hb){super(ja,hb)}execute(ja){(0,ja.activityState[r.a3f])(()=>{this.pp();
ja.nM()});return 1}}r.a3f="RVEAssea";Object(b.a)(r,"RestoreVersionErrorActivity",k.a,[]);class u extends f.a{constructor(ja,hb){super();this.activityName=ja;this.DJ=hb;this.Fb()}create(){this.qb(new r(this.activityName,this.DJ))}static ka(ja){ja.da.Ga(321,new u(n.a.lKd,n.a.Xi))}}Object(b.a)(u,"RestoreVersionErrorActivityFactory",f.a,[]);var x=a(80),z=a(690),B=a(50),y=a(37),A=a(181),K=a(369),G=a(55);class T{constructor(ja,hb){this.$=ja;this.wVj=hb}Qc(){return d.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(e.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(ja,hb){e.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");ja=!1;switch(hb.command){case -1112508866:K.a(this.$)&&this.$.da.za(423).hwc(!1),ja=this.wVj.aBj()}e.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${ja}.`);return ja?G.Task.Ua(ja):A.a(hb.command)}Ec(ja,hb){return-1112508866===hb.command&&this.$.isVersionHistoryEnabled()}Vc(){return!1}}
Object(b.a)(T,"VersionHistoryCommandHandler",null,[188]);var W=a(7),P=a(251),E=a(163),H=a(382);class F{static addAppPLTEventToLog(ja){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(ja)}catch(hb){}}static setIsPageLoadForFirstTime(ja){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(ja)}catch(hb){}}}Object(b.a)(F,"VersionHistoryLogConnector",null,[]);var N=a(27),J=a(815),R=a(1230),M=a(153),L=a(90),U=a(31),X=a(1),da=a(43),fa=a(249),S=a(978),ka=
a(258),V=a(245),wa=a(12);class ma{constructor(ja){this.Dw=ja}Xh(){ka.a(this.Dw.$).hB(this.Zd)||ka.a(this.Dw.$).Xh(this)}g7(){ka.a(this.Dw.$).hB(this.Zd)&&ka.a(this.Dw.$).Nz(this)}get Zd(){return V.a.Jeg}get lc(){return document.querySelector('[id="vhHeader"]')}get jf(){return!0}hh(ja){return wa.DOMElementExtensions.uf(this.lc,ja)}kj(){this.Dw.$.frame.Ee.Rj(this.Dw.$.frame.Ee.RE)}Mj(){}gg(ja,hb){hb||this.Dw.WMb.then(oa=>{oa.enterHeaderFocusTrapZone();return null});return!hb}}Object(b.a)(ma,"VersionHistoryHeader",
null,[110]);class ab{constructor(ja){this.Dw=ja}Xh(){ka.a(this.Dw.$).hB(this.Zd)||ka.a(this.Dw.$).Xh(this)}g7(){ka.a(this.Dw.$).hB(this.Zd)&&ka.a(this.Dw.$).Nz(this)}get Zd(){return V.a.Keg}get lc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get jf(){return!0}hh(ja){return wa.DOMElementExtensions.uf(this.lc,ja)}kj(){this.Dw.$.frame.Ee.Rj(this.Dw.$.frame.Ee.RE)}Mj(){}gg(ja,hb){hb||this.Dw.WMb.then(oa=>{oa.enterFocusTrapZone();return null});return!hb}}Object(b.a)(ab,"VersionHistoryPane",
null,[110]);class ba{constructor(ja){this.Dw=ja}Xh(){ka.a(this.Dw.$).hB(this.Zd)||ka.a(this.Dw.$).Xh(this)}g7(){ka.a(this.Dw.$).hB(this.Zd)&&ka.a(this.Dw.$).Nz(this)}get Zd(){return V.a.Leg}get lc(){return document.querySelector('[id="vhViewer"]')}get jf(){return!0}hh(ja){return wa.DOMElementExtensions.uf(this.lc,ja)}kj(){this.Dw.$.frame.Ee.Rj(this.Dw.$.frame.Ee.RE)}Mj(){}gg(ja,hb){hb||this.Dw.WMb.then(oa=>{oa.enterViewerFocusTrapZone();return null});return!hb}}Object(b.a)(ba,"VersionHistoryViewer",
null,[110]);var Ca=a(140),Na=a(252),za=a(68),la=a(417),aa=a(758);class sa{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(sa,"AppBootSettings",null,[]);class ea{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(ea,"AppVersionControllerFactoryParameters",null,[]);class Z{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=null}}Object(b.a)(Z,"OnVersionSelectedParams",null,[]);class ua{constructor(){this.appName=
0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=!1;this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}
Object(b.a)(ua,"AppSettings",null,[]);class ya{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(ya,"ControllerFactoryParameters",null,[]);var ha=a(298);class Da{constructor(ja){this.baseVersionInfo=this.B2=this.coa=this.um=this.ewaAccessibilityManager=this.WMb=null;this.OGd=this.Tqf=!1;this.oEe=!0;this.dialog=this.PB=this.oSe=this.ED=this.NYd=this.LYd=this.MYd=null;this.uAf=hb=>{e.ULS.sendTraceTag(42553885,
0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.Oxj()){var oa=Eb=>{l.c(2138207060,!1);this.um.setRestoreFailedAtServer(Eb)};this.ED&&this.ED.startTimer(Da.w8f);var fb=()=>{this.ED.endTimer(Da.w8f);this.Gve(this.ED)};this.um.setRestoreInProgress();da.a(this.$).ks(new fa.a(n.a.Ox,5,()=>{const Eb=za.a(this.$).fd.activityState;Eb[Na.a.lq]=n.a.tye;Eb[Ca.a.yX]=!0;Eb[Ca.a.WS]=0;Eb[v.Meg]=hb;Eb[v.kpc]=d.AFrameworkApplication.gj;Eb[v.atd]=fb;Eb[r.a3f]=oa;X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",
!1)&&(Eb[ha.a.KAd]=!0)}))}else l.c(2138207060,!1)};this.eDf=hb=>{this.WMb.then(oa=>{oa.enterFocusTrapZone();return null});e.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.ED.endTimer(Da.oUd);this.ED.incrementCounter(Da.c3g);e.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.ED.getTimerDuration(Da.oUd)}`);this.Rej(hb.containerDiv);hb.versions&&0<hb.versions.length&&(this.oSe=Da.eF(hb.versions[hb.versions.length-
1]));this.B2&&this.coa&&this.SLd(this.B2);e.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=hb=>{e.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${Da.eF(hb.currentVersion)}, LastSelected:${Da.eF(this.B2)}`);this.ED.incrementCounter(Da.b3g);this.B2=hb.currentVersion;this.baseVersionInfo=hb.baseVersion;this.Tqf=hb.noBaseToCompareTo;this.coa&&this.RUj()&&(this.SLd(hb.currentVersion),e.ULS.sendTraceTag(537150344,
0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.fvf=hb=>{e.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===hb||void 0===hb?0:hb.versionSelected)?Da.eF(hb.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===hb||void 0===hb?0:hb.updatedVersions)?hb.updatedVersions.length:0}, LastSelected:${Da.eF(this.B2)}`);this.ED.incrementCounter(Da.a3g);if(this.baseVersionInfo){if((null===hb||void 0===hb?0:hb.updatedVersions)&&
2<=hb.updatedVersions.length){let oa=null,fb=null;const Eb=Da.eF(this.B2),jc=Da.eF(this.baseVersionInfo);for(const Hc of hb.updatedVersions)if(hb=Da.eF(Hc),Eb===hb?oa=Hc:jc===hb&&(fb=Hc),oa&&fb)break;oa&&fb?(this.B2=oa,this.baseVersionInfo=fb,e.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${Da.eF(this.B2)}, RevisionID[N-1]: ${Da.eF(this.baseVersionInfo)}.`),this.SLd(this.B2)):e.ULS.sendTraceTag(537150306,
0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${Eb}, RevisionID[N-1]: ${jc}.`)}else e.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");e.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else e.ULS.sendTraceTag(537150336,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};
this.guf=()=>{e.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.FYg();const hb=new L.a(1470556788,0,this.$.Mc,0,null);this.$.Ka.Lb(hb)};this.MAf=hb=>{e.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let oa=new L.a(-1244760097,0,this.$.Mc,0,null);this.$.me.get(51)&&(e.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),oa=new L.a(-309686558,0,this.$.Mc,0,null));l.c(1604651619,!0);
this.$.Ka.Lb(oa,{["FileDownloadUrl"]:hb})};this.gvf=hb=>{e.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!X.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.Nxj())hb=new P.QueryStringBuilder(hb),hb.Oi("fn",d.AFrameworkApplication.fileName),e.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+hb.toString().length),8===this.$.frame.p8a(hb.toString(),!0)?(e.ULS.sendTraceTag(587830283,0,10,
"VersionHistoryPaneActor:OnDownloadVersion failed"),l.c(1316171850,!1)):l.c(1316171850,!0)};this.Msf=hb=>{this.um.setFullAppErrorCode(hb)};this.owf=hb=>{switch(hb){case 101:hb="VHFailedToGetDownloadToken";break;case 100:hb="VHFailedToLoadVersionList";break;case 104:hb="VHVersioningNotEnabled";break;case 105:hb="VHFileNotFound";break;case 106:hb="VHVersionTooOld";break;default:hb="None"}this.ED.addEvent("OnFullAppError",hb);e.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${hb}`)};this.lAd=
hb=>{this.oEe=hb;e.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${hb.toString()}`);this.nMd(S.a.AMb,{["ToggleValue"]:hb})};this.Hxf=hb=>{e.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${hb}`);l.c(1488635506,!0);const oa={};hb?this.nMd(S.a.iterateNext,oa):this.nMd(S.a.Hwa,oa)};this.wGb=hb=>{switch(hb.MessageId){case E.a.tTa:e.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");
X.EwaSettings.ma(420)&&this.um.setVersionLoadComplete();break;case E.a.uTa:e.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case S.a.setCurrentChangeCount:hb=hb.Values.count;e.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${hb}`);this.um.setCurrentChangeCount(hb);break;case S.a.setTotalChangesCount:hb=hb.Values.count;e.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${hb}`);
this.um.setTotalChangesCount(hb);break;case S.a.eOa:this.lAd(this.oEe);break;default:e.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${hb.MessageId}`)}};this.$=ja;this.h7b=this.$.Bb+Da.Qvh;this.NGd=!1;X.EwaSettings.ma(386)&&this.l$g();this.uAb="";this.Zqd=0;this.perfTelemetryInfos=[]}dispose(){this.gxe()}AYi(){this.$.da.Za(15,ja=>{this.ewaAccessibilityManager=ja;this.ewaAccessibilityManager.mode=2})}l$g(){this.MYd=new ab(this);this.LYd=new ma(this);
this.NYd=new ba(this)}aBj(){e.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");d.AFrameworkApplication.dN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");d.AFrameworkApplication.dN("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");d.AFrameworkApplication.dN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");d.AFrameworkApplication.zF("8492a557;72ff4572");
this.ED=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.ED.startTimer(Da.v8f);if(!this.um&&(la.a(()=>{this.um=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(W.a)(new ya,{ulsLogger:new H.a,docId:d.AFrameworkApplication.gj,appSettings:Object(W.a)(new ua,{appName:120,userSessionId:d.AFrameworkApplication.userSessionId,wdEnableSaveACopy:X.EwaSettings.ma(355),wdEnableDownloadTokens:X.EwaSettings.ma(350),wacCluster:d.AFrameworkApplication.rd.BO,
uiLocale:d.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:X.EwaSettings.ma(321)&&this.$.isEditMode,wdEnableIterator:X.EwaSettings.ma(318)&&X.EwaSettings.ma(319),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:X.EwaSettings.ma(420),disableSaveACopy:this.vPd(),wdEnableShowVersionChanges:X.EwaSettings.ma(318)&&X.EwaSettings.ma(320),disabledChangeGates:this.$.ya.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:X.EwaSettings.ma(537),isRtl:d.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",
!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),!this.um))return e.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),l.c(429638140,!1),!1;this.bBj();this.ED.endTimer(Da.v8f);this.ED.startTimer(Da.y8f);e.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");l.c(429638140,!0);return!0}bBj(){var ja;this.Bj();if(!document.getElementById(this.h7b)){const hb=document.createElement("div");
hb.id=this.h7b;hb.style.width="100%";hb.style.zIndex="998";hb.style.display="block";hb.style.position="absolute";if(d.AFrameworkApplication.ta.Pa.Ef){const oa=(null===(ja=document.getElementById("HeaderRegion"))||void 0===ja?void 0:ja.offsetHeight)||0;hb.style.top=oa+"px";hb.style.bottom="0px";hb.style.height=`calc(100vh - ${oa}px)`}else hb.style.height="100%";this.$.$q.insertBefore(hb,this.$.$q.firstChild);this.WMb=this.um.createVersionHistoryDialog(hb)}document.getElementById(this.h7b).style.display=
"block";this.CGd();this.ED.startTimer(Da.oUd);this.um.getVersions("")}CGd(){X.EwaSettings.ma(386)&&(this.MYd.Xh(),this.LYd.Xh(),this.NYd.Xh(),this.AYi())}IWd(){X.EwaSettings.ma(386)&&(this.MYd.g7(),this.LYd.g7(),this.NYd.g7(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0))}Bj(){this.um.getVersionsReadyEvent().addListener(this.eDf);this.um.getVersionSelectedEvent().addListener(this.onVersionSelected);this.um.getCloseSelectedEvent().addListener(this.guf);this.um.getFullAppErrorEvent().addListener(this.owf);
this.um.getIteratorSelectedEvent().addListener(this.Hxf);this.um.getShowVersionChangesToggledEvent().addListener(this.lAd);X.EwaSettings.ma(350)&&(this.um.getDownloadTokenReadyEvent().addListener(this.fvf),this.NGd=!0);X.EwaSettings.ma(355)&&(this.um.getSaveACopySelectedEvent().addListener(this.MAf),this.um.getDownloadVersionSelectedEvent().addListener(this.gvf));X.EwaSettings.ma(321)&&this.$.isEditMode&&(this.um.getRestoreVersionSelectedEvent().addListener(this.uAf),this.OGd=!0);this.coa&&this.coa.getAppErrorEvent().addListener(this.Msf)}ek(){this.um.getVersionsReadyEvent().removeListener(this.eDf);
this.um.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.um.getCloseSelectedEvent().removeListener(this.guf);this.um.getFullAppErrorEvent().removeListener(this.owf);this.um.getIteratorSelectedEvent().removeListener(this.Hxf);this.um.getShowVersionChangesToggledEvent().removeListener(this.lAd);X.EwaSettings.ma(355)&&(this.um.getSaveACopySelectedEvent().removeListener(this.MAf),this.um.getDownloadVersionSelectedEvent().removeListener(this.gvf));this.NGd&&(this.um.getDownloadTokenReadyEvent().removeListener(this.fvf),
this.NGd=!1);this.OGd&&(this.um.getRestoreVersionSelectedEvent().removeListener(this.uAf),this.OGd=!1);this.coa&&this.coa.getAppErrorEvent().removeListener(this.Msf)}Ivj(){return this.vPd()||!d.AFrameworkApplication.rY}Nxj(){return this.Ivj()?(e.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),l.c(1316171850,!1),!1):!0}Oxj(){let ja=!0;if(X.EwaSettings.ma(599)&&!this.$.SM)return e.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+
this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&!X.EwaSettings.ma(317)){this.bti();this.um.setCoauthRestoreError();ja=!1;const hb=new L.a(-729359593,0,this.$.Mc,0,null);this.$.Ka.Lb(hb)}this.$.SM&&(e.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),ja&&(ja=!1,this.$Aj()));return ja}$Aj(){var ja=U.a.Yc(1,0,1895,1894,0,-1603358883,"RestoreVersionUnsavedChangesError");ja=this.dialog||new M.ErrorDialog(this.$,ja);ja.initialize();
ja.xf()}RUj(){e.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?Da.eF(this.baseVersionInfo):""}`);if(Da.eF(this.B2)===this.oSe)return e.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(X.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.Tqf)return e.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),
!0;if(!this.baseVersionInfo)return e.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const ja=Da.cMh(this.baseVersionInfo);e.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${ja?ja.length:0}`);return ja?!0:(e.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}vPd(){return!this.$.Ija}FYg(){document.getElementById(this.h7b).style.display="none";const ja=new L.a(-1423792966,0,
this.$.Mc,0,null);this.$.Ka.Lb(ja);this.gxe()}gxe(){this.ED&&(this.ED.endTimer(Da.y8f),this.Gve(this.ED),this.ED=null);this.ek();this.IWd();this.perfTelemetryInfos&&(e.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.toString()),this.perfTelemetryInfos=null);this.PB&&(this.PB.Pna(E.a.tTa),this.PB.Pna(E.a.uTa),this.PB.Pna(S.a.setCurrentChangeCount),this.PB.Pna(S.a.setTotalChangesCount),X.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.PB.Pna(S.a.eOa),
this.PB.dispose(),this.PB=null)}Rej(ja){try{this.coa?F.setIsPageLoadForFirstTime(!1):(F.setIsPageLoadForFirstTime(!0),la.a(()=>{const hb=new sa;hb.ulsLogger=new H.a;hb.actionUrl=this.$.ya.VersionHistoryActionUrl;hb.hideEmbedFooter=!0;hb.useFetch=X.EwaSettings.ma(415)&&!N.a.lv;this.coa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(W.a)(new ea,{appBootSettings:hb,rootDiv:ja}))}))}catch(hb){e.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${hb}`)}}SLd(ja){e.ULS.sendTraceTag(537150298,
0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${Da.eF(ja)}, LastSelected:${this.uAb}`);if(ja)if(Da.eF(ja).length){var hb=(new Date).getTime();if(Da.eF(ja)===this.uAb&&1E3>hb-this.Zqd)e.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");else{Da.eF(ja)!==this.uAb&&(e.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.um.setTotalChangesCount(-1),this.um.setCurrentChangeCount(-1));
var oa=excelVersionHistory.FactoryGlobal.getTelemetryCollector();oa.addEvent("SelectVersion",Da.eF(ja));try{this.qXj(oa);this.Zqd=hb;this.uAb=Da.eF(ja);const fb=new Z;fb.selectedVersionInfo=this.B2;fb.baseVersionInfo=this.baseVersionInfo;fb.telemetryCollector=oa;this.coa.onVersionSelectedWithParams(fb);this.um&&X.EwaSettings.ma(355)&&this.um.setDisableSaveACopy(this.vPd());const Eb=document.getElementById(Da.Pvh);Eb&&!this.PB&&(e.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),
this.PB=new S.a(Eb.contentWindow,x.a.gaa(this.$.ya.VersionHistoryActionUrl)||aa.a.f9),this.PB.Vl(E.a.tTa,this.wGb),this.PB.Vl(E.a.uTa,this.wGb),this.PB.fo(S.a.setCurrentChangeCount),this.PB.fo(S.a.setTotalChangesCount),X.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.PB.fo(S.a.eOa),this.PB.Vl(S.a.setCurrentChangeCount,this.wGb),this.PB.Vl(S.a.setTotalChangesCount,this.wGb),X.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.PB.Vl(S.a.eOa,this.wGb))}catch(fb){this.Zqd=0,this.uAb="",oa.addEvent("Exception",fb.toString()),e.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${fb}`)}finally{e.ULS.sendTraceTag(537150292,0,50,oa?oa.getJsonForLogging():"")}}}else e.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else e.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}qXj(ja){for(const hb of this.perfTelemetryInfos){const oa=
hb.TelemetryEventKey?hb.TelemetryEventKey:hb.telemetryEventKey?hb.telemetryEventKey:"",fb=hb.TelemetryEventData?hb.TelemetryEventData:hb.telemetryEventData?hb.telemetryEventData:"";oa&&fb&&ja.addEvent(oa,fb)}this.perfTelemetryInfos.length=0}Gve(ja){e.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${ja?ja.getJsonForLogging():""} `)}bti(){const ja=this.$.ea.Jm,hb={};let oa=null;for(const fb of ja)fb.UserEmail&&(hb[fb.UserEmail]=fb.UserEmail in hb?hb[fb.UserEmail]+
1:1),fb.User.UserID===this.$.ea.clientId&&(oa=fb.UserEmail);e.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${ja.length}, TotalAuthorsAsYourself ${oa?hb[oa]:-1}`)}nMd(ja,hb){e.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${ja}`);if(this.PB){ja=new J.a(ja);ja.Values[R.a.i3c]=this.$.ya.UserSessionId;if(hb)for(let oa in hb)ja.Values[oa]=hb[oa];this.PB.send(ja)}else e.ULS.sendTraceTag(537150284,
0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static eF(ja){return ja?ja.RevisionID?ja.RevisionID:ja.revisionID?ja.revisionID:"":""}static cMh(ja){return ja?ja.DownloadUrl?ja.DownloadUrl:ja.downloadUrl?ja.downloadUrl:"":""}}Da.Qvh="_excelVersionHistoryOverlay";Da.Pvh="vhs_frame";Da.v8f="TimeTakenShowVersionHistoryDialogAction";Da.y8f="TimeTillVersionHistoryDialogWasOpenMs";Da.oUd="TimeTakenGetVersionsToOnVersionsReady";Da.b3g="CountOnVersionSelectedCalledinOneVHSession";
Da.c3g="CountOnVersionsReadyCalledinOneVHSession";Da.a3g="CountOnDownloadTokenReadyCalledinOneVHSession";Da.w8f="TimeTakenVersionRestore";Object(b.a)(Da,"VersionHistoryPaneActor",null,[3]);var nb=a(195);class qa extends z.a{constructor(ja){super(ja)}Dd(){const ja=this.lsi(),hb=B.GetServiceTaskFactory.Ta(this.$.da,21,137,this.ib);y.TaskExtensions.Aa(y.TaskExtensions.Xd([ja,hb],this.la,3),()=>{var oa=hb.result;const fb=x.a.gaa(this.$.ya.VersionHistoryActionUrl);fb!==aa.a.f9&&oa.QEa(fb);oa=new Da(this.$);
this.ld([new T(this.$,oa)])},this.la,3)}lsi(){const ja=B.GetServiceTaskFactory.Qia(this.$.da,283,284,this.ib).then(hb=>hb.$n.loadScript("excelVersionHistory"),hb=>{e.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${hb}`);return Promise.reject(hb)});return nb.c(ja)}static ka(ja){z.a.Rd(304,new qa(ja))}}Object(b.a)(qa,"VersionHistoryCommandHandlerFactory",z.a,[]);var pa=a(1251),Ja=a(695);class $a extends f.a{constructor(ja){super();this.$=
ja;this.Fb()}create(){const ja=B.GetServiceTaskFactory.Ta(this.$.da,211,212,this.ib),hb=B.GetServiceTaskFactory.Ta(this.$.da,21,137,this.ib);y.TaskExtensions.Aa(y.TaskExtensions.Xd([ja,hb],this.$.la),()=>{const oa=Object(Ja.a)(this.$.da,305,()=>new pa.a(this.$,!0,hb.result,ja.result));this.qb(oa)},this.$.la,3)}static ka(ja){ja.da.Ga(306,new $a(ja))}}Object(b.a)($a,"VersionHistoryHighlightManagerFactory",f.a,[]);var rb=a(505),Pa=a(5),eb=a(161),Ob=a(14);class tb extends k.a{constructor(ja,hb,oa){super(ja,
hb);this.lineageManager=oa}execute(ja){this.lineageManager.lineageHidePreviousHistory();return super.execute(ja)}}Object(b.a)(tb,"LineageClearHistoryConfirmedActivity",k.a,[]);var cc=a(16),Ib=a(139);class Mb{constructor(ja,hb){this.$=ja;this.lineageManager=hb;ja=[new cc.a(n.a.Krd,1038647878,0,0,2236),new cc.a(n.a.idle,1038647878,0,1)];za.a(this.$).oGd(new Ib.a(n.a.Jrd,n.a.idle,ja),new tb(n.a.Krd,n.a.idle,hb))}Qc(){return!1}executeCommand(ja,hb,oa){ja=!1;switch(hb.command){case 1834994092:9===hb.Re&&
this.sGj();this.Dyj(hb,oa);ja=!0;break;case -409942531:this.Fyj(),ja=!0}return ja?G.Task.Ua(!0):A.a(hb.command)}Ec(ja,hb){return 1834994092===hb.command||-409942531===hb.command}Vc(){return!1}Dyj(ja,hb){e.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${hb.MenuItemId||ja.Re}`);this.lineageManager.x2f(19===ja.Re&&!!hb.MenuItemId,hb.MenuItemId,ja.Re)}sGj(){const ja=Pa.a.Bpc;ja!==eb.a(this.$).Xl.Tz&&eb.a(this.$).Xl.activateRibbonTab(ja)}Fyj(){da.a(this.$).ks(new fa.a(n.a.Jrd,
5,()=>{const ja=za.a(this.$).fd,hb=U.a.Yc(3,1,2233,2234,2235,1038647878,"LineageConfirmClearHistory");hb.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";hb.HelpDescription=Ob.a.instance.ga(1317);ja.Kt([hb])}))}}Object(b.a)(Mb,"LineageActivityCommandHandler",null,[188]);class Oa extends z.a{constructor(ja){super(ja)}Dd(){y.TaskExtensions.Aa(B.GetServiceTaskFactory.Ta(this.$.da,366,367,this.ib),ja=>{this.ld([new Mb(this.$,ja.result)])},this.la,3)}static ka(ja){z.a.Rd(363,new Oa(ja))}}Object(b.a)(Oa,
"LineageActivityCommandHandlerFactory",z.a,[]);class Aa{constructor(ja){this.Qcb=!0;Aa.Daf()?Aa.Maf()?(e.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!ja}`),this.Qcb=ja):this.Qcb=!1:this.Qcb=!0}M5a(){return!this.Qcb}static Maf(){return Aa.Daf()&&X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",!1)}static Daf(){return X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",
!1)}}Object(b.a)(Aa,"LineageCatchUpExperimentManager",null,[565]);class Ba extends f.a{constructor(ja){super();this.$=ja;this.Fb()}create(){Aa.Maf()?y.TaskExtensions.Aa(B.GetServiceTaskFactory.Ta(this.$.da,456,457,this.ib),ja=>{y.TaskExtensions.Aa(ja.result.axj(),hb=>{this.fCe(hb.result)},this.$.la,3)},this.$.la,3):this.fCe(!0)}fCe(ja){this.qb(this.$.da.za(458)||this.$.da.Ga(458,new Aa(ja)))}static ka(ja){ja.da.Ga(459,new Ba(ja))}}Object(b.a)(Ba,"LineageCatchUpExperimentManagerFactory",f.a,[]);var ob=
a(413),xb=a(36),Va=a(186),bb=a(82),ra=a(146),Qa=a(124);class qb{}Object(b.a)(qb,"LineageClientParams",null,[]);class Wa{}Object(b.a)(Wa,"LineageFilter",null,[]);var ta=a(64),ib=a(77),Bb=a(131),Ub=a(42),Ta=a(510),mb=a(170),Qb=a(121),Lb=a(109),Jb=a(281),Ab=a(280),pb=a(97),va=a(21),db=a(132),Ya=a(62);const gb=(ja,hb,oa,fb,Eb,jc,Hc,qd=null)=>{qd=ja.Na(1,qd);qd.clientParams=hb;qd.lineageFilter=oa;return Ya.g(ja,"LineageOpenPaneOrChangeFilter",qd,fb,Eb,jc,Hc,0)},Ka=(ja,hb,oa,fb,Eb,jc,Hc=null)=>{Hc=ja.Na(1,
Hc);Hc.fetchFromBelow=hb;return Ya.g(ja,"LineageLoadMore",Hc,oa,fb,Eb,jc,0)},ub=(ja,hb,oa,fb,Eb,jc=null)=>{jc=ja.Na(1,jc);return Ya.g(ja,"LineageRefreshView",jc,hb,oa,fb,Eb,0)},ac=(ja,hb,oa,fb,Eb,jc=null)=>{jc=ja.Na(1,jc);return Ya.g(ja,"LineageUpdateView",jc,hb,oa,fb,Eb,0)},Ra=(ja,hb,oa,fb,Eb,jc=null)=>{jc=ja.Na(1,jc);return Ya.g(ja,"LineageClosePane",jc,hb,oa,fb,Eb,0)},na=(ja,hb,oa,fb,Eb,jc=null)=>{jc=ja.Na(1,jc);return Ya.g(ja,"LineageHidePreviousHistory",jc,hb,oa,fb,Eb,0)},lb=(ja,hb,oa,fb,Eb,
jc=null)=>{jc=ja.Na(1,jc);return Ya.g(ja,"LineageLoadInGridBlueDots",jc,hb,oa,fb,Eb,0)};var jb=a(51),Yb=a(339);class Gb{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(Gb,"LineageActivitiesResponseDTO",null,[]);class wb extends Gb{constructor(){super();
this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)(wb,"LineageActivitiesUpdateResponseDTO",Gb,[]);class dc{constructor(){this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(dc,"LineageAppCallbacks",null,[]);class Jc{constructor(){this.imageUrl=
this.email=this.displayName=this.provider=this.id=null}}Object(b.a)(Jc,"LineageAuthorDTO",null,[]);class Qc{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(Qc,"LineageControllerFactoryParams",null,[]);class fd{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(fd,"LineageSharedRangeDTO",null,[]);class Wc{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(Wc,
"LineageSheetMultiRangeDTO",null,[]);class Rb{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(b.a)(Rb,"LineageUserActivityDTO",null,[]);class Sb{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(Sb,"LineageValueChangeDTO",
null,[]);class mc{constructor(ja,hb,oa,fb){this.Qsb=this.yF=null;this.gE=this.Nrd=0;this.LDb=()=>{this.H6&&(this.H6.stop(),this.H6=null);this.OKb.start();this.yF.createLineagePane(this.Ird,this.Qsb)};this.lineageOpenPaneOrChangeFilterRequest=(Eb,jc)=>{this.OKb.stop();db.b(this.$).Cd(Bb.a.aNi,{});this.QAj();const Hc=Object(W.a)(new qb,{ClientViewCapacity:Eb.clientViewCapacity});let qd=null;jc&&(qd=Object(W.a)(new Wa,{FilterSheetMultiRange:this.iLj(jc.filterSheetMultiRange)}));const zd=Hd=>{Hd=Qb.a.kf(Hd.data);
e.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${U.a.zc(Hd)}]`)};Eb=(Hd,Yd,se)=>gb(this.$.pa.va,Hc,qd,Ab.b(Hd,this.tdd("LineageOpenPaneOrChangeFilter")),Ab.a(Yd,zd),se,null);X.EwaSettings.fc()?this.$.userOperationManager.Ub(new mb.a(1010,0,Eb,80),null):this.$.userOperationManager.Ub(new Ta.a(1010,0,Eb,16),null)};this.lineageLoadMoreRequest=Eb=>{db.b(this.$).Cd(Bb.a.$Mi,{});const jc=qd=>{qd=Qb.a.kf(qd.data);e.ULS.sendTraceTag(537155480,
0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${U.a.zc(qd)}]`)},Hc=(qd,zd,Hd)=>Ka(this.$.pa.va,Eb,Ab.b(qd,this.tdd("LineageLoadMore")),Ab.a(zd,jc),Hd,null);X.EwaSettings.fc()?this.$.userOperationManager.Ub(new mb.a(1011,0,Hc,80),null):this.$.userOperationManager.Ub(new Ta.a(1011,0,Hc,16),null)};this.lineageRefreshViewRequest=()=>{db.b(this.$).Cd(Bb.a.bNi,{});const Eb=Hc=>{Hc=Qb.a.kf(Hc.data);e.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${U.a.zc(Hc)}]`)},
jc=(Hc,qd,zd)=>ub(this.$.pa.va,Ab.b(Hc,this.tdd("LineageRefreshView")),Ab.a(qd,Eb),zd,null);X.EwaSettings.fc()?this.$.userOperationManager.Ub(new mb.a(1012,0,jc,80),null):this.$.userOperationManager.Ub(new Ta.a(1012,0,jc,16),null)};this.lineageUpdateViewRequest=()=>{ac(this.$.pa.va,Eb=>{if(Eb=Jb.a(Eb)?null:Eb.Result){var jc={["CountOfUpdatedActivities"]:Eb.LineageActivitiesResponse.ActivityList.length};db.b(this.$).Cd(Bb.a.cNi,jc);Eb=Object(W.a)(new wb,{activityList:this.$oc(Eb.LineageActivitiesResponse.ActivityList),
latestActivityId:Eb.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Eb.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:Eb.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Eb.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:Eb.HasNewActivities,filterSheetMultiRange:this.ZKj(Eb.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Eb.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:Eb.LineageActivitiesResponse.ServerLastActivityId,
showLoadPrevious:Eb.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Eb.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(Eb.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.Wub(Eb.LineageActivitiesResponse.EolPersonHideHistory)});this.yF.onLineageActivitiesUpdateResponse(Eb)}else e.ULS.shipAssertTag(537155475,0,!!Eb,"LineageManager.LineageUpdateView returned null response.")},Eb=>{Eb=Qb.a.kf(Eb.data);e.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${U.a.zc(Eb)}]`)},
null,null)};this.onCardSelected=(Eb,jc)=>{if(Eb=Eb.rangeHighlightLocation){if(jc){let Hc;if(({range:Hc}=Ub.Z(jc,null)).returnValue){this.$6e(Eb.sheetName,this.dvb([Ub.j(Hc)]));return}e.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+jc+" is not valid.")}Eb.rangeList.length?this.$6e(Eb.sheetName,Eb.rangeList):this.S5h(Eb.sheetName)}};this.onLearnMoreLinkClicked=()=>{if(X.EwaSettings.isChangeGateEnabled("OfficeVSO:4597686_LineageLearnMoreLinkEnabled")){const Eb=new L.a(-859308420,
ib.a.Eb,this.$.Mc,12,null);this.$.Ka.Lb(Eb,{[ib.a.Zf]:"HelpID=XLO_LineageTS",["InputMethod"]:ib.a.Eb,[ib.a.Oc]:Pa.a.pQ,["ShouldCanvasTakeFocus"]:!0})}};this.onVersionHistoryButtonClicked=Eb=>{this.$.Ka.Lb(new L.a(-1112508866,Eb,this.$.Mc,12,null))};this.isFeatureEnabled=()=>!1;this.Uf=()=>{const Eb=this.$.ea.to.LineageVersion;Eb!==this.Nrd&&(e.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Eb}, this.lineageVersion: ${this.Nrd}`),this.Nrd=Eb,this.w6i())};
this.Xc=(Eb,jc)=>{this.yF&&!this.lineageTaskPane.efc&&jc.zH&&(e.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.Ao=()=>{this.yF&&!this.lineageTaskPane.efc&&(e.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.nD=()=>{const Eb=this.G3a();this.yF.onFilterableSheetListChange(Eb)};this.dya=()=>{const Eb=this.G3a();this.yF.onFilterableSheetListChange(Eb)};this.Nmc=
()=>{const Eb=this.G3a();this.yF.onFilterableSheetListChange(Eb)};this.onPaneClosed=()=>{this.yF.onPaneClosed();Ra(this.$.pa.va,null,Eb=>{Eb=Qb.a.kf(Eb.data);e.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${U.a.zc(Eb)}]`)},null,null)};this.onRangeFilterInputEnabled=Eb=>{Eb?this.gridView.ha.cT(this.Uc):this.gridView.ha.qR(this.Uc)};this.Uc=()=>{var Eb=Ub.q(this.gridView.ha.sa.activeRange,this.$);Eb=Object(W.a)(new Wc,{rangeList:this.dvb(Eb.Ranges),
sheetName:Eb.SheetName});this.yF.onSelectedRangeUpdated(Eb)};this.tryParseRangeInfo=Eb=>{let jc;if(({sheetName:jc,range:Eb}=Ub.Z(Eb,this.$.xa)).returnValue){jc||(jc=this.$.xa.oa.sheetName);const Hc=[];Hc.push(Eb);Eb=Ub.u(jc,null,Hc);return Object(W.a)(new Wc,{rangeList:this.dvb(Eb.Ranges),sheetName:Eb.SheetName})}return null};this.Gz=()=>{const Eb=this.gE!==this.$.ea.Le;this.yF&&this.lineageTaskPane.isVisible&&Eb&&(this.gE=this.$.ea.Le,this.yF.onRefreshRequired())};this.$=ja;hb.Ga(366,this);hb.Ga(501,
this);this.gridView=va.g(this.$);this.lineageTaskPane=oa;this.Ird=this.lineageTaskPane.qM();this.batchSize=50;this.H6=fb;this.OKb=this.$.Hb.Ng("UserAction","LineagePaneLoadingShimmerStopWatch");this.cpc=bb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.w$h();this.nAg()}dispose(){this.A9i();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.ON(this.onPaneClosed),this.lineageTaskPane.SF(this.Gz),this.lineageTaskPane=null);this.OKb=this.cpc=this.Qsb=this.Ird=this.yF=null}Czj(){return Object(Va.a)(this,
void 0,void 0,function*(){return new Promise(ja=>{e.ULS.sendTraceTag(520717857,0,50,"LineageManager::showInGridBlueDots");db.b(this.$).Cd(Bb.a.lineageLoadInGridBlueDots,{});const hb=Eb=>{Eb=Qb.a.kf(Eb.data);e.ULS.sendTraceTag(520717856,0,50,`LineageManager::LineageLoadInGridBlueDots service call failed. Errors: [${U.a.zc(Eb)}]`)},oa=Eb=>{if(Eb=Jb.a(Eb)?null:Eb.Result){var jc={["CountOfActivities"]:Eb.ActivityList.length};db.b(this.$).Cd(Bb.a.lri,jc);Eb=this.$oc(Eb.ActivityList);ja(Eb)}else e.ULS.shipAssertTag(520717854,
0,!!Eb,"LineageManager LineageLoadInGridBlueDots returned null response.")},fb=(Eb,jc,Hc)=>lb(this.$.pa.va,Ab.b(Eb,oa),Ab.a(jc,hb),Hc,null);X.EwaSettings.fc()?this.$.userOperationManager.Ub(new mb.a(1024,0,fb,80),null):this.$.userOperationManager.Ub(new Ta.a(1024,0,fb,16),null)})})}x2f(ja,hb,oa){if(this.lineageTaskPane.isVisible){if(9===oa){e.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!ja&&16!==oa&&18!==oa){this.lineageTaskPane.s_c();
return}}xb.a.zd(this.$)||(this.OKb.start(),this.H6&&(jb.b().FA(this.OKb.id,this.H6.id,"actions","actions"),this.H6.stop(),this.H6=null));this.lineageTaskPane.efc||e.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${ja?hb:oa}`);this.gE=this.$.ea.Le;this.Qsb=null;ja&&(ja=Ub.r(this.gridView.ha.sa.selectedRanges,this.$),this.Qsb=Object(W.a)(new Wc,{rangeList:hb.toString()===Pa.a.S1f?this.dvb(ja.Ranges):null,sheetName:ja.SheetName}));xb.a.zd(this.$)&&this.lineageTaskPane.efc?
this.lineageTaskPane.Bqj(this.LDb):this.yF.createLineagePane(this.Ird,this.Qsb);this.lineageTaskPane.hg(!0);this.$.xd(-71295319,-1,0,null)}lineageHidePreviousHistory(){var ja={["paneVisible"]:this.lineageTaskPane.isVisible};ra.a.sendTelemetryEvent(Object(W.a)(new Yb.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:Qa.a.Tj(ja)}));ja=(hb,oa,fb)=>na(this.$.pa.va,hb,oa,fb,null);X.EwaSettings.fc()?this.$.userOperationManager.Ub(new mb.a(1018,0,ja,64),null):this.$.userOperationManager.Ub(new Ta.a(1018,
0,ja,0),null);this.lineageTaskPane.isVisible||this.x2f(!1,null,4)}w$h(){const ja=Object(W.a)(new dc,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,
lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest});la.a(()=>{this.yF=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(W.a)(new Qc,{clientBatchSize:this.batchSize,filterableSheetList:this.G3a(),uiCulture:this.$.ya.UICultureTag,dataCulture:this.$.ya.DataCultureTag,logger:new H.a,lineageAppCallbacks:ja}))})}tdd(ja){return hb=>{if(hb=Jb.a(hb)?null:hb.Result){var oa={["CountOfActivities"]:hb.ActivityList.length};
oa.WebRequestName=ja;db.b(this.$).Cd(Bb.a.yKi,oa);hb=Object(W.a)(new Gb,{activityList:this.$oc(hb.ActivityList),latestActivityId:hb.LastSearchedActivityId,oldestActivityId:hb.FirstSearchedActivityId,serverMessageCode:hb.LineageResponseCode,lastSearchedActivityTimestamp:new Date(hb.EcmaLastSearchedDate),serverFirstActivityId:hb.ServerFirstActivityId,serverLastActivityId:hb.ServerLastActivityId,showLoadPrevious:hb.ShowLoadPrevious,eolCorrelationId:hb.EolCorrelationId,eolDateHideHistory:new Date(hb.EolDateHideHistory),
eolPersonHideHistory:this.Wub(hb.EolPersonHideHistory)});this.yF.onLineageActivitiesResponse(hb)}else e.ULS.shipAssertTag(537155477,0,!!hb,"LineageManager."+ja+" returned null response.")}}ZKj(ja){return Lb.e(ja.Ranges)&&!ja.SheetName?null:Object(W.a)(new Wc,{rangeList:this.dvb(ja.Ranges),sheetName:ja.SheetName})}dvb(ja){const hb=[];for(const oa of ja)ja=Object(W.a)(new fd,{firstCol:oa.FirstColumn,firstRow:oa.FirstRow,lastRow:oa.LastRow,lastCol:oa.LastColumn}),hb.push(ja);return hb}iLj(ja){if(!ja)return null;
const hb={};hb.Ranges=this.sed(ja.rangeList);hb.SheetName=ja.sheetName;return hb}sed(ja){const hb=[];if(Lb.e(ja))return hb;for(const oa of ja)ja={},ja.FirstColumn=oa.firstCol,ja.FirstRow=oa.firstRow,ja.LastRow=oa.lastRow,ja.LastColumn=oa.lastCol,hb.push(ja);return hb}S5h(ja){(ja=this.$.xa.getItemByName(ja))&&ja.visible&&ja.activate(!0)}$6e(ja,hb){const oa=[];for(var fb of hb)hb={},hb.FirstColumn=fb.firstCol,hb.FirstRow=fb.firstRow,hb.LastRow=fb.lastRow,hb.LastColumn=fb.lastCol,oa.push(Ub.D(hb));fb=
oa.length-1;hb=oa[fb].topLeft;va.g(this.$).HU(oa,fb,ja,null,hb,null,null,3,pb.a.mri,void 0,void 0,void 0,!0)}w6i(){this.yF&&this.lineageTaskPane.isVisible&&(this.gE=this.$.ea.Le,this.yF.onRefreshRequired())}nAg(){this.lineageTaskPane.$L(this.onPaneClosed);this.lineageTaskPane.mE(this.Gz);this.$.ea.Ou(this.Uf);this.$.ea.hk(this.Xc);this.$.ea.ZL(this.Ao);const ja=this.$.xa;ja.DX(this.nD);ja.dga(this.Nmc);ja.XEa(this.dya);ja.RXa(this.Nmc)}A9i(){this.$.ea.Mw(this.Uf);this.gridView.ha.qR(this.Uc);this.$.ea.Hk(this.Xc);
this.$.ea.oR(this.Ao);const ja=this.$.xa;ja.h6(this.nD);ja.gma(this.Nmc);ja.wPa(this.dya);ja.uHb(this.Nmc)}onStaleActivitiesDetected(){this.yF.onStaleActivitiesDetected()}G3a(){const ja=this.$.xa.items,hb=[];for(const oa of ja)oa.visible&&!ta.e(oa)&&hb.push(oa.sheetName);return hb}QAj(){if(X.EwaSettings.ma(605)){var ja=this.$.da.za(403);ja&&ja.disable();ja=new L.a(-847286761,ib.a.Eb,this.$.Mc,0,Pa.a.IV);this.$.Ka.Lb(ja,{["InputMethod"]:ib.a.Eb,CalloutName:5})}}$oc(ja){const hb=[];for(const oa of ja)ja=
Object(W.a)(new Rb,{activityId:Number.parseLocale(oa.UserActivity.Id),activityGuid:oa.Uid,activityType:oa.UserActivity.Type,author:this.Wub(oa.UserActivity.Person),sheetName:oa.SheetName,displayTimestamp:new Date(oa.UserActivity.DisplayTimestamp),gridLocation:oa.DisplayLocation,valueChanges:this.G0i(oa.LineageValueChangeList),isBulkEditOverflow:oa.IsBulkEditOverFlow,rangeHighlightLocation:this.v0i(oa.UserActivity.LocationList,oa.UserActivity.Type),nestedActivityList:this.o0i(oa.NestedActivityList),
degradedCardTypeBits:oa.DegradedCardTypeBits}),hb.push(ja);return hb}v0i(ja,hb){if(!ja)return e.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!ja.length)return e.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const oa=[];var fb=[];let Eb="";21===hb?fb.push(ja[0]):fb=ja;for(const jc of fb)switch(jc.Type){case 1:break;case 2:Eb=jc.SheetName;break;case 0:ja=jc;if(!ja.RangeList){e.ULS.sendTraceTag(537155465,
0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}Eb=ja.RangeList[0].SheetName;fb=[];21===hb?fb.push(ja.RangeList[0]):fb=ja.RangeList;for(const Hc of fb)ja=Object(W.a)(new fd,{firstCol:Hc.FirstColumn,firstRow:Hc.FirstRow,lastRow:Hc.LastRow,lastCol:Hc.LastColumn}),oa.push(ja);break;default:e.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(W.a)(new Wc,{sheetName:Eb,rangeList:oa})}G0i(ja){const hb=
[];for(const oa of ja)ja=Object(W.a)(new Sb,{hasNewValue:oa.HasNewValue,hasOldValue:oa.HasOldValue,newValue:oa.HasNewValue?oa.NewValue:null,oldValue:oa.HasOldValue?oa.OldValue:null,cellLocation:oa.CellLocation}),hb.push(ja);return hb}o0i(ja){return ja?this.$oc(ja):null}Wub(ja){if(!ja)return null;let hb=null;X.EwaSettings.isChangeGateEnabled("OfficeVSO:4947893_ShowChangesUserProfilePictureSupportEnabled")&&d.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(hb=this.cpc.cHa(ja.Email,
ja.Provider,d.AFrameworkApplication.gj,0));return Object(W.a)(new Jc,{id:ja.Id,provider:ja.Provider,displayName:ja.DisplayName,email:ja.Email,imageUrl:hb})}}Object(b.a)(mc,"LineageManager",null,[869,870,3]);class ec extends f.a{constructor(ja){super();this.H6=this.lineageTaskPane=null;this.$=ja;this.Fb()}Sri(ja){y.TaskExtensions.Aa(ja,()=>{this.qb(this.$.da.za(366)||new mc(this.$,this.$.da,this.lineageTaskPane,this.H6))},this.$.la,3)}create(){this.H6=this.$.Hb.xc("UserAction","LineagePaneSeenStopwatch");
this.H6.start();const ja=B.GetServiceTaskFactory.Ta(this.$.da,365,364,this.ib),hb=ob.a(this.$),oa=B.GetServiceTaskFactory.Ta(this.$.da,283,284,this.ib);y.TaskExtensions.Aa(y.TaskExtensions.Xd([ja,hb,oa],this.$.la),()=>{this.lineageTaskPane=ja.result;xb.a.zd(this.$)||hb.result.tQ(this.lineageTaskPane);this.Sri(nb.c(oa.result.$n.loadScript("cellLineage")))},this.$.la,3)}static ka(ja){ja.da.Ga(367,new ec(ja))}}Object(b.a)(ec,"LineageManagerFactory",f.a,[]);var Rc=a(785),Mc=a(221),bc=a(13),ic=a(108),
Yc=a(259),md=a(85),id=a(234),xd=a(19),Lc=a(699);const Pb=Pa.a.Zxc+"LineageActivityPaneTitle",Gc=Pa.a.sdb+"LineageActivityCloseButton";class Nb extends id.a{constructor(ja,hb,oa){super(ja);this.LDb=this.jye=this.fe=null;this.Mnd=!0;this.vu=0;this.yp=!1;this.Dc=(fb,Eb)=>{Eb.eg||this.s_c()};this.$j=()=>{this.s_c();return!0};this.$=hb;this.taskPaneManager=oa;this.$.ik(this.Dc);ka.a(this.$).Xh(this);xb.a.zd(this.$)&&(this.isVisible=!1)}bP(ja){this.get_events().addHandler("LineageTaskPaneRemove",ja)}pR(ja){this.get_events().removeHandler("LineageTaskPaneRemove",
ja)}mE(ja){this.addHandler("LineageTaskPaneVisibilityChanged",ja)}SF(ja){this.removeHandler("LineageTaskPaneVisibilityChanged",ja)}$L(ja){this.get_events().addHandler("LineageTaskPaneClose",ja)}ON(ja){this.get_events().removeHandler("LineageTaskPaneClose",ja)}get isVisible(){return super.isVisible}set isVisible(ja){super.isVisible!==ja&&(super.isVisible=ja,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get efc(){return this.Mnd}get jf(){return this.isVisible}get Wg(){return 15}get Zd(){return V.a.nri}get Sk(){return xd.a.Vsh}get QM(){return Ob.a.instance.ga(1071)}get wo(){return 300}get isResizable(){return!1}get lc(){return this.domElement}get height(){return this.taskPaneManager.mO.offsetHeight}get titleText(){return Ob.a.instance.ga(1292)}get LB(){return this.taskPaneManager.iua(this.lc,
this.titleText,this.wo,this.isResizable,()=>{this.isVisible=!0;this.LDb?this.LDb():e.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.wo)}xH(){}hp(){return this.yp}Yr(){return this.yp}cR(){}nQ(){return!1}kj(){}Mj(){}dispose(){this.$&&(this.$.Bl(this.Dc),ka.a(this.$).Nz(this));this.fe&&(Mc.a.instance.Ba(bc.a.click,this.fe,this.$j),ic.KeyInputManager.instance.Ev(this.fe,this.jye));this.fe=this.taskPaneManager=
this.$=null;super.dispose()}gg(ja,hb){if(!hb){ja=wa.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!ja)return!1;wa.DOMElementExtensions.setFocus(ja)}return!hb}hh(ja){return wa.DOMElementExtensions.uf(this.lc,ja)}hg(ja){this.yp=ja;const hb=this.taskPaneManager;if(this.isVisible=ja)this.$.frame.Ee.Qj("LineagePane"),this.Mnd=!1;if(xb.a.zd(this.$))ja?hb.K5("LineageTaskPane",this.LB):hb.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.Vw();const oa=!!this.taskPaneManager.Bg&&
15===this.taskPaneManager.Bg.taskPane.Wg;ja&&0<hb.aA.length&&(!oa||hb.isCollapsed)&&hb.WF(this,!0)}this.$.pf()}qM(){var ja=this.$.Bb;ja=xb.a.zd(this.$)?this.domElement:document.getElementById(ja+Pa.a.Mrd);var hb=this.VG();ja.appendChild(hb);hb=Lc.b("div","LineagePaneBodyId","LineageActivityBody");ja.appendChild(hb);this.Cqj();return hb}s_c(){this.$.frame.Ee.Qj(this.$.frame.Ee.RE||Yc.AFrame.hT);this.Mnd=!0;this.hg(!1);this.raiseEvent("LineageTaskPaneClose")}Bqj(ja){this.LDb=ja}Cqj(){this.$.frame.Ee.Rj("LineagePane");
const ja=this.$.frame.Ee.ti("LineagePane");ja.parent=Yc.AFrame.hT;ja.bN=!0}VG(){const ja=Lc.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),hb=Lc.b("h1","LineagePaneTitleId",Pb);hb.innerText=this.titleText;this.fe=Rc.a.pb("LineagePaneCloseButtonId",Gc,Ob.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.fe.classList.add(d.AFrameworkApplication.isRtl?Pa.a.O$:Pa.a.P$);Mc.a.instance.ra(bc.a.click,this.fe,this.$j);this.jye=ic.KeyInputManager.instance.ls(this.fe,this.$j,md.a.Zh);ja.appendChild(hb);
ja.appendChild(this.fe);return ja}static ka(ja,hb){const oa=ja.Bb;let fb=document.getElementById(oa+Pa.a.Mrd);fb||(fb=document.createElement("div"),fb.id=ja.Bb+Pa.a.Mrd,fb.classList.add("LineageActivityPane"),xb.a.zd(ja)||document.getElementById(oa+Pa.a.VQ).appendChild(fb));return ja.da.za(365)||ja.da.Ga(365,new Nb(fb,ja,hb))}}Object(b.a)(Nb,"LineageTaskPane",id.a,[868,3,247,110]);class yc extends f.a{constructor(ja){super();this.$g=this.mi=null;this.$=ja;this.Fb()}get qD(){this.mi||(this.mi=y.TaskExtensions.Aa(ob.a(this.$),
ja=>{this.$g=Nb.ka(this.$,ja.result)},this.la,3));return this.mi}create(){const ja=B.GetServiceTaskFactory.create(this.$.da,203,this.la,this.ib),hb=B.GetServiceTaskFactory.create(this.$.da,155,this.la,this.ib);y.TaskExtensions.Aa(y.TaskExtensions.ts(y.TaskExtensions.Xd([ja,hb],this.la),()=>this.qD,this.la),()=>{this.qb(this.$g)},this.la,3)}dispose(){this.$g=this.mi=this.$=null;super.dispose()}static ka(ja){ja.da.Ga(364,new yc(ja))}}Object(b.a)(yc,"LineageTaskPaneFactory",f.a,[]);class Tc{constructor(ja,
hb){this.rod=!1;this.Uf=()=>{this.Q9f()};this.$=ja;X.EwaSettings.ma(605)&&this.$.ea.v7a&&!Tc.awb&&(hb&&!hb.Qcb||this.jVj(),Tc.l5e?e.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):hb&&!hb.Qcb||this.pVj());e.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.nHd();this.$=null;e.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){Tc.awb||
(Tc.awb=!0,e.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));this.nHd()}pVj(){X.EwaSettings.ma(601)&&!this.$.isAnonymousUser()&&Ya.i(this.$.pa.va,ja=>{this.$?(ja=ja.Result,e.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${ja}.`),Tc.l5e=!0,ja&&this.F9f(0)):e.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},
()=>{e.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}jVj(){X.EwaSettings.ma(600)&&!this.Q9f()&&(this.$.ea.Ou(this.Uf),this.rod=!0)}Q9f(){return this.$.ea&&this.$.ea.to&&this.$.ea.to.ShouldTriggerLineageCalloutOnMerge?(e.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.F9f(1),!0):!1}F9f(ja){Tc.awb?e.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):
(Tc.awb=!0,e.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${ja}.`),this.nHd(),X.EwaSettings.ma(480)&&(ja=new L.a(-847286761,ib.a.Eb,this.$.Mc,0,Pa.a.IV),this.$.Ka.Lb(ja,{["CalloutName"]:4})))}nHd(){this.rod&&(this.rod=!1,this.$.ea.Mw(this.Uf))}}Tc.awb=!1;Tc.l5e=!1;Object(b.a)(Tc,"LineageTeachingCalloutTriggerManager",null,[564,3]);class gd extends f.a{constructor(ja){super();this.$=ja;this.Fb()}create(){y.TaskExtensions.Aa(B.GetServiceTaskFactory.Ta(this.$.da,
458,459,this.ib),ja=>{const hb=ja.result;ja=Object(Ja.b)(this.$.da,403,()=>new Tc(this.$,hb));this.qb(ja)},this.$.la,3)}static ka(ja){ja.da.Ga(402,new gd(ja))}}Object(b.a)(gd,"LineageTeachingCalloutTriggerManagerFactory",f.a,[]);class Ad extends f.a{constructor(ja){super();this.$=ja;this.Fb()}create(){y.TaskExtensions.Aa(B.GetServiceTaskFactory.Ta(this.$.da,366,367,0),ja=>{this.qb(ja.result)},this.$.la,3)}static ka(ja){ja.da.Ga(500,new Ad(ja))}}Object(b.a)(Ad,"LineageBlueDotManagerFactory",f.a,[]);
var Od=a(871),Pd=a(79);class Md{constructor(ja,hb){this.Xg=ja;this.Ju=hb}gW(ja,hb,oa,fb=null){return this.sgh(ja,fb,Eb=>this.Xg.emb(Eb,2,oa,hb,void 0,void 0,void 0,void 0,void 0,"2"))}sgh(ja,hb,oa){const fb=!!hb&&""!==hb;let Eb=ja;fb&&(Eb=x.a.ZS(ja,"perfTag",hb));const jc=new Date;return Od.a.then(oa(Eb),Hc=>{const qd=+new Date-+jc;if(!Hc||!Hc.Ig||!Hc.Ig.data)return Hc;fb&&Hc.Ig.data.request&&this.qmj(Hc.Ig.data.request.getResolvedUrl(),hb,qd);return Hc})}qmj(ja,hb,oa){ja=this.Ju.WUh(ja);if(ja.count&&
(ja=Pd.last(ja))){const fb={Message:"Request durations for activities calls."};fb.PerfTag=hb;fb.CustomDuration=oa;fb.PerformanceDuration=ja.duration;e.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(fb))}}}Object(b.a)(Md,"CatchUpNetworkingWrapper",null,[865]);var ge=a(241);class pe extends ge.a{constructor(ja,hb){super(ja,hb)}W$(){return 6}}Object(b.a)(pe,"GetActivityFeedRequest",ge.a,[]);class Qd extends ge.a{constructor(ja,hb,oa,fb,Eb,jc){super(ja,hb);this.ItemIds=null;this.ActivityStatesToReset=
this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=oa;this.ActivityStatesToSet=fb;this.ActivityStatesToReset=Eb;this.ResetUnseenCount=jc}W$(){return 7}}Object(b.a)(Qd,"UpdateActivityFeedStateRequest",ge.a,[]);var he=a(383);class ue{constructor(ja,hb,oa){this.rae=ja;this.MBa=hb;this.cCa=oa}getActivityFeed(ja){return Od.a.then(this.cCa.execute(new pe(this.MBa(),null),(hb,oa,fb)=>this.rae.gW(hb,oa,fb,"ActivityFeed"),ja),hb=>{if(!hb)return e.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),
null;if(!hb.Ig)return e.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!hb.Ig.data)return e.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!hb.Ig.data.Td)return e.ULS.sendTraceTag(572846940,3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;hb=he.a.zHa(hb.Ig.data.Td);return hb?hb:(e.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}rPj(ja,hb,oa,fb){return Od.a.then(this.cCa.execute(new Qd(this.MBa(),
null,ja,hb,oa,fb),(Eb,jc,Hc)=>this.rae.gW(Eb,jc,Hc,"UpdateActivityFeedState"),null),Eb=>{try{return Eb.succeeded}catch(jc){return e.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+jc.message),!1}})}}Object(b.a)(ue,"CatchUpRequestHandler",null,[866]);var je=a(462);class Ge{constructor(ja){this.zfa=ja;this.g$d=new je.a}$si(){this.Nti()}Nti(){if(this.zfa){var ja=hb=>{this.g$d.contains("CatchUpChangesFeedback")||(this.g$d.add("CatchUpChangesFeedback"),hb.logActivity("CatchUpChangesFeedback",
null))};this.zfa.execute(hb=>{window.setTimeout(()=>{ja(hb)},2E4)})}else e.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(Ge,"FloodgateEventLogger",null,[]);var Ce=a(184);class pc{constructor(ja){this.btg=ja}get duration(){return this.btg.duration}}Object(b.a)(pc,"PerformanceResourceTimingWrapper",null,[]);class Uc{constructor(ja){this.Ju=ja}WUh(ja){const hb=new Ce.a;if(!this.Ju)return hb;ja=this.Ju.getEntriesByName(ja,"resource");
if(!ja)return hb;for(const oa of ja)hb.add(new pc(oa));return hb}}Object(b.a)(Uc,"PerformanceWrapper",null,[]);var hd=a(246);class yd{constructor(){this.gb=null}get name(){return"Common.App.CatchUpActivity"}ai(ja){this.gb=ja;this.gb.register(Md,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").uc().Gc(()=>new Md(d.AFrameworkApplication.rd,new Uc(window.performance)));this.gb.register(ue,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").uc().Gc(()=>
new ue(this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>d.AFrameworkApplication.gj,new he.a));this.gb.register(Ge,"Common.App.CatchUpActivity.FloodgateEventLogger").uc().Gc(()=>new Ge(this.gb.Vb("Common.ISystemInitiatedFeedback")))}init(){this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.gb.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){hd.a.instance.Ii(new yd)}}Object(b.a)(yd,"CatchUpActivityPackage",null,
[4,5]);class wd{constructor(ja,hb){this.$=ja;this.catchUpActivityManager=hb}Qc(ja,hb){return this.catchUpActivityManager?-876699925===hb?!this.catchUpActivityManager.Caf:!1:!0}executeCommand(ja,hb){ja=!1;switch(hb.command){case -876699925:ja=this.catchUpActivityManager.qSi()}return ja?G.Task.Ua(!0):A.a(hb.command)}Ec(ja,hb){return X.EwaSettings.ma(435)&&-876699925===hb.command?!0:!1}Vc(){return!1}}Object(b.a)(wd,"CatchUpActivityCommandHandler",null,[188]);class I extends z.a{constructor(ja){super(ja)}Dd(){this.$.da.Za(286,
ja=>{this.ld([new wd(this.$,ja)])})}static ka(ja){z.a.Rd(285,new I(ja))}}Object(b.a)(I,"CatchUpActivityCommandHandlerFactory",z.a,[]);var xa=a(262),Ua=a(513),vb=a(86),cb=a(84),Xb=a(25);class rc{constructor(ja){this.$h=ja}doesContentExist(ja){if(!ja)return e.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(ja.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!ja.navigationId)return e.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),
!1;const hb={};hb.NavigationId=atob(ja.navigationId);return 32===this.$h.ae(Xb.a.OHa,2,hb);default:return!1}}}Object(b.a)(rc,"CatchUpActivityContentManager",null,[729]);var Ec=a(816),ed=a(1227);class ud{constructor(ja){this.HDb=()=>{switch(this.gv.model.state){case 1:this.J2f(!0);break;case 0:this.YKb(!1);break;case 2:case 3:this.YKb(!0);break;default:e.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.gv.model.state)}};
this.mpg=ja;this.gv.xle(this.HDb);this.nz=[]}get gv(){return this.mpg}dispose(){this.gv.POf(this.HDb);this.nz=null}$pj(ja){this.nz.push(ja)}HXg(){this.nz.length=0}J2f(ja){for(const hb of this.nz){hb.className=Ec.a.CUg;const oa=document.getElementById(`${hb.id}-${Pa.a.Lve}`);wa.DOMElementExtensions.setVisible(oa,ja)}}YKb(ja){for(const hb of this.nz)hb&&(ja?hb.className=2===this.gv.model.state?Ec.a.z3i:Ec.a.A3i:this.J2f(!1))}}Object(b.a)(ud,"RangeCatchUpActivityView",null,[836,3]);var Kd=a(22);class Zd extends ed.a{constructor(ja,
hb,oa){super(ja,hb,oa);this.gridView=va.g(ja);this.Vla=hb}dispose(){this.gridView=null;super.dispose()}QCg(ja){const hb=this.Yeb[0];hb?hb.$pj(ja):e.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.Vla.activityId)}Dfj(){const ja=this.Yeb[0];ja&&ja.HXg()}$Ag(ja){this.Vla.addRange(ja)}WJh(){if(3!==this.Vla.activityType)return null;e.ULS.shipAssertTag(537168003,0,1===this.Vla.uLb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");
return Ub.D(this.Vla.uLb[0])}dJb(ja){if(ja){if(!this.Vla)return;this.Pvd(this.Mgj())}super.dJb(ja)}V2c(){const ja=this.B2c();this.Yeb.push(ja)}B2c(){return new ud(this)}Pvd(ja){ja?ja.SheetName?(this.gridView.ha.Oa.$G(null),this.gridView.focus(),this.gridView.k3e(ja,3,!1,pb.a.y3i)):e.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):e.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}Mgj(){if(Lb.e(this.Vla.uLb))return e.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var ja=this.$.xa.oa;e.ULS.shipAssertTag(537167970,0,!!ja,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");ja=this.kMj(ja.sheetName,this.Vla.uLb);if(!ja&&(ja=this.MZh(this.Vla.uLb),!ja))return null;const hb={};hb.SheetName=ja.SheetName;hb.FirstColumn=ja.FirstColumn;hb.FirstRow=ja.FirstRow;hb.LastColumn=ja.FirstColumn;
hb.LastRow=ja.FirstRow;return hb}MZh(ja){if(Lb.e(ja))return null;let hb=null;for(let fb=0;fb<ja.length;fb++){var oa=ja[fb].SheetName;if(!Kd.a.equals(oa,hb,!1)&&(hb=oa,oa=this.$.xa.getItemByName(oa),null===oa||void 0===oa?0:oa.visible))return ja[fb]}return null}kMj(ja,hb){if(hb)for(const oa of hb)if(Kd.a.equals(oa.SheetName,ja,!1))return oa;return null}}Object(b.a)(Zd,"RangeCatchUpActivityHighlightController",ed.a,[]);var Xd=a(78);class Je extends Xd.a{constructor(ja,hb,oa,fb){super();this.$=ja;this.b0d=
hb;this.sjg=oa;this.fC=fb;this.state=0}get type(){return this.fC}get activityId(){return this.b0d}get activityType(){return this.sjg}dispose(){this.b0d=null;super.dispose()}}Object(b.a)(Je,"CatchUpActivityHighlightModelBase",Xd.a,[]);class Xe extends Je{constructor(ja,hb,oa,fb,Eb){super(ja,hb,oa,fb);this.ranges=Eb;this.B6a=!1}get uLb(){this.B6a||(this.ranges.sort(Xe.A1b),this.B6a=!0);return this.ranges}addRange(ja){for(const hb of ja)this.ranges.push(hb)}dispose(){this.ranges=null;super.dispose()}static A1b(ja,
hb){if(!ja.SheetName||!hb.SheetName)return e.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const oa=ja.SheetName.localeCompare(hb.SheetName);return oa?oa:ja.FirstColumn<hb.FirstColumn||ja.FirstColumn===hb.FirstColumn&&ja.FirstRow<hb.FirstRow?-1:ja.FirstColumn===hb.FirstColumn&&ja.FirstRow===hb.FirstRow?0:1}}Object(b.a)(Xe,"RangeCatchUpActivityHighlightModel",Je,[]);var Ke=a(338);class Qe{constructor(){this.p0c=[];this.sKb={};
this.dje={}}dispose(){this.dje=this.sKb=this.p0c=null}Gcj(ja){va.g(ja).ob.Bn([24])}M4g(ja,hb,oa){const fb={};for(const jc of hb){if(!jc||Lb.e(jc.LocationList))continue;hb=[];const Hc={},qd=[];for(const zd of jc.LocationList){if(!zd){e.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+jc.Id);break}switch(zd.Type){case 0:var Eb=zd;let Hd;"0"in Hc?(Hd=Hc["0"],Hd.$Ag(Eb.RangeList)):(Hd=new Zd(ja,new Xe(ja,jc.Id,
jc.Type,0,Eb.RangeList),oa),hb.push(Hd),Hc["0"]=Hd);for(const Yd of Eb.RangeList){Eb=new Ke.a(Ub.D(Yd),ta.d(ja.xa.getItemByName(Yd.SheetName)));if(this.gvc(Eb)in this.sKb)this.sKb[this.gvc(Eb)].push(Hd);else{let se=[];se.push(Hd);this.sKb[this.gvc(Eb)]=se}qd.push(Eb);this.p0c.push(Eb)}break;default:e.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}e.ULS.shipAssertTag(537168011,0,!(jc.Id in fb),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+
jc.Id);this.dje[jc.Id]=qd;fb[jc.Id]=hb}this.h6g(ja,this.p0c,this.sKb);return fb}zXg(ja){for(let hb in ja){const oa=ja[hb];for(const fb of oa)fb.Dfj()}}gvc(ja){return`${ja.range}-${ja.sheetId}`}h6g(ja,hb,oa){this.zXg(oa);va.g(ja).ob.yv(hb,[24],!0,(fb,Eb)=>{var jc=new Ke.a(fb.range,fb.sheetId);jc=this.gvc(jc);const Hc=oa[jc];if(Hc)for(const qd of Hc)qd.QCg(Eb),fb.metadata=qd;else e.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+
jc)})}}Object(b.a)(Qe,"CatchUpHighlightControllersCreator",null,[]);class df{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0}}Object(b.a)(df,"CreateIndicatorTooltipParameters",null,[]);class Ne{constructor(){this.clearSticky=!1}}Object(b.a)(Ne,"DismissIndicatorTooltipParameters",null,[]);class jf{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(jf,"UpdateIndicatorTooltipParameters",null,[]);class Le{constructor(ja){this.qQa=this.m2b=this.iea=
null;this.L3={};this.ACa=null;this.Vhd=!1;this.HDb=(hb,oa)=>{switch(oa.state){case 0:case 1:3===oa.HDd&&(this.h5h(),this.qQa=null);break;case 2:break;case 3:this.B4c();this.qQa=oa.activityId;this.Gyj();break;default:e.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+oa.state)}};this.Sl=()=>{this.irb()};this.Uc=()=>{this.irb()};this.rn=()=>{this.irb()};this.Lh=()=>{this.irb()};this.K1f=(hb,oa)=>{this.iea&&oa.vH!==this.oja&&
(oa.isSticky&&this.W4b(!0),(hb=this.zMj(oa.vH))?(this.iea.createActivityIndicatorTooltip(Object(W.a)(new df,{target:oa.vH,container:hb,activityIds:[oa.activityId],isSticky:oa.isSticky,dirHint:this.gridView.rtl?12:9})),oa.isSticky?(this.oja=oa.vH,e.ULS.sendTraceTag(51172352,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Selected/Unselected Event.")):(this.lcc=oa.vH,e.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event.")),
this.Hec||(this.gridView.view.Ns(this.Ezc),this.gridView.Nu(this.Ezc),this.Hec=!0)):e.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null."))};this.MGe=(hb,oa)=>{this.W4b(oa.bfh)};this.Ezc=()=>{this.iea?(this.oja&&this.iea.updateActivityIndicatorTooltip(Object(W.a)(new jf,{target:this.oja,isSticky:!0})),this.lcc&&this.iea.updateActivityIndicatorTooltip(Object(W.a)(new jf,{target:this.oja,isSticky:!1}))):e.ULS.shipAssertTag(537168024,
0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=ja;this.gridView=va.g(this.$);this.ha=this.gridView.ha;this.Ya=this.gridView.Wb;this.ha.EXb(this.Sl);this.ha.LG(this.Uc);this.gridView.iC(this.rn);this.Ya.Mk(this.Lh);this.oja=this.lcc=null;this.Hec=!1;this.v$c={}}get eje(){return this.iea}set eje(ja){this.iea=ja}get excelCommentManager(){this.ACa||(this.ACa=this.$.da.za(65));return this.ACa}get Wpb(){this.m2b||(this.m2b=new Qe);return this.m2b}set Wpb(ja){this.m2b=
ja}dispose(){this.ha.Kqc(this.Sl);this.ha.RF(this.Uc);this.gridView.BD(this.rn);this.Ya.Gk(this.Lh);this.VFe();this.v$c=this.oja=this.lcc=this.qQa=this.Ya=this.ha=this.gridView=null}Fnj(ja){this.VFe();if(!Lb.e(ja)){e.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");if(this.L3=this.Wpb.M4g(this.$,ja,this)){ja=this.L3;for(let hb in ja){const oa=ja[hb];for(const fb of oa)this.kLg(fb)}}this.Wpb.Gcj(this.$)}}gwc(ja){if(ja&&this.Vhd)e.ULS.shipAssertTag(537168034,
0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read");else if(ja||this.irb(),this.L3){const hb=this.L3;for(let oa in hb){const fb=hb[oa];for(const Eb of fb)Eb.aAj(ja)}}}R5h(ja){this.oja&&this.W4b(!0);this.B4c();if(ja=this.L3[ja.activityId])for(const hb of ja)hb.dJb(!0);else e.ULS.sendTraceTag(537168032,0,50,"CatchUpActivityHighlightManager.OnSelectHighlight - Controllers not found during select")}VFe(){if(this.L3){const ja=this.L3;for(let hb in ja){const oa=
ja[hb];for(const fb of oa)this.B9i(fb),fb.dispose()}}this.L3={};this.Wpb.dispose();this.Wpb=null}Gyj(){if(this.excelCommentManager){var ja=this.L3[this.qQa];ja&&0<ja.length&&3===ja[0].model.activityType&&((ja=ja[0])?this.excelCommentManager.izj(ja.WJh()):e.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}h5h(){this.excelCommentManager&&this.excelCommentManager.dsb()}B4c(){if(this.qQa){const ja=this.L3[this.qQa];
if(ja){for(const hb of ja)hb.dJb(!1);this.qQa=null}else e.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}irb(){this.B4c();this.W4b(!0)}zMj(ja){if(!ja)return e.ULS.shipAssertTag(537168026,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;ja=`${ja.id}-${Pa.a.AUg}`;let hb=this.v$c[ja];if(!hb){if(!this.gridView.domElement)return e.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),
null;hb=document.createElement("Div");hb.className=Ec.a.BUg;hb.id=ja;this.gridView.domElement.appendChild(hb);this.v$c[ja]=hb}return hb}W4b(ja){this.iea&&(this.iea.dismissActivityIndicatorTooltips(Object(W.a)(new Ne,{clearSticky:ja})),this.lcc=null,ja&&(this.oja=null),this.Hec&&!this.oja&&(this.gridView.view.Oq(this.Ezc),this.gridView.qy(this.Ezc),this.Hec=!1))}kLg(ja){ja.xle(this.HDb);ja.sDg(this.K1f);ja.rDg(this.MGe)}B9i(ja){ja.POf(this.HDb);ja.I$i(this.K1f);ja.H$i(this.MGe)}}Object(b.a)(Le,"CatchUpActivityHighlightManager",
null,[778,3]);class me{constructor(ja,hb){this.$=ja;this.$h=hb}navigateToActivity(ja){if(ja.fromSummaryString){var hb=new L.a(1834994092,ib.a.Eb,this.$.Mc,18,null);this.$.Ka.Lb(hb);return this.CTa(1)}ja=ja.activity;if(!this.hdi(ja))return this.CTa(4);if(!this.kmi(ja))return this.CTa(7);const oa={};try{hb=window.self.atob(ja.navigationId);if(!hb)return this.CTa(5);oa.NavigationId=hb}catch(fb){return e.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${fb}`),
this.CTa(5)}if(8===this.$h.ae(Xb.a.OHa,2,oa))return this.$h.processAction(Xb.a.z8a,2),this.CTa(2);hb=32===this.$h.ae(Xb.a.x_a,2,oa)?1:6;return this.CTa(hb)}hdi(ja){return ja&&ja.navigationId?!0:!1}kmi(ja){switch(ja.type){case 3:case 4:case 6:case 7:case 9:case 8:return!0;default:return!1}}CTa(ja){return Promise.resolve(ja)}}Object(b.a)(me,"CatchUpActivityNavigationManager",null,[730]);var Za=a(439);class Tb{}Object(b.a)(Tb,"GetRelevantActivitiesDataRequest",null,[]);class uc{constructor(){this.activityFeedItemId=
this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(uc,"Activity",null,[]);class Oc{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(Oc,"ActivityFeedItem",null,[]);class sb{constructor(){this.activityFeedItems=null}}Object(b.a)(sb,"ActivityFeedPayload",null,[]);class $b{constructor(){this.lowWaterline=
this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)($b,"ActivityRequestPayload",null,[]);class xc{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(xc,"Person",null,[]);class ad extends uc{constructor(){super();this.relationship=0}}Object(b.a)(ad,"TaskActivity",uc,[]);const Dd=(ja,hb,oa,fb,Eb,jc=null)=>{jc=ja.Na(1,jc);return Ya.g(ja,"GetLineageWywaAuthors",
jc,hb,oa,fb,Eb,4)},ie=(ja,hb,oa,fb,Eb,jc,Hc=null)=>{Hc=ja.Na(1,Hc);Hc.getRelevantActivitiesDataRequest=hb;return Ya.g(ja,"GetRelevantActivitiesData",Hc,oa,fb,Eb,jc,0)};class $d{constructor(ja,hb,oa=!1){this.Mdg=null;this.$=ja;this.d0b=hb;this.lFb=bb.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.cpc=bb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.M5a=oa}requestWYWAActivities(){return this.M5a?new Promise((ja,hb)=>{Dd(this.$.pa.va,oa=>{var fb;const Eb=Jb.a(oa)?
null:oa.Result;X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?(oa=null===(fb=null===Eb||void 0===Eb?void 0:Eb.WywaAuthors)||void 0===fb?void 0:fb.length,null!=oa&&0<oa&&y.TaskExtensions.Aa(B.GetServiceTaskFactory.Ta(this.$.da,501,500,0),jc=>{jc.result.Czj().then(Hc=>{const qd=Hc.map(zd=>({activityId:zd.activityGuid,activityFeedItemId:null,type:1,actors:[{id:zd.author.id,provider:zd.author.provider,displayName:zd.author.displayName,givenName:null,email:zd.author.email,imageUrl:zd.author.imageUrl,
color:null}],location:null,displayTimestamp:zd.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.Mdg=Hc.map(zd=>{const Hd=zd.rangeHighlightLocation.rangeList.map(Yd=>({Type:0,RangeList:[{SheetName:zd.sheetName,FirstRow:Yd.firstRow,LastRow:Yd.lastRow,FirstColumn:Yd.firstCol,LastColumn:Yd.lastCol}]}));return{Id:zd.activityGuid,Type:null,Person:null,DisplayTimestamp:null,LocationList:Hd}});Hc={activities:qd,actors:Eb?this.aac(Eb.WywaAuthors):null,hasMore:!1,highWaterline:$d.uha,
lowWaterline:$d.uha,wywaWaterline:$d.uha};ja(Hc)},()=>{})},this.$.la,3)):(fb=Object(W.a)(new $b,{activities:[],actors:Eb?this.aac(Eb.WywaAuthors):null,hasMore:!1,highWaterline:$d.uha,lowWaterline:$d.uha,wywaWaterline:$d.uha}),ja(fb))},()=>{e.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");hb(null)},null,null)}):Promise.resolve($d.n4b)}requestActivities(){return Promise.resolve($d.n4b)}requestRelevantActivities(){if(!this.$.ea.hc||this.$.ea.m4a)return e.ULS.sendTraceTag(537168021,
3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.hc}, HasRaisedSessionEnded: ${this.$.ea.m4a}]`),Promise.resolve($d.n4b);const ja=Object(W.a)(new Tb,{SetDaysBack:d.AFrameworkApplication.fa.nd("AppWaterlineOverrideDaysValue",0),SetTimestamp:d.AFrameworkApplication.fa.nd("AppWaterlineOverrideTimestampValue",0)});return new Promise((hb,oa)=>{ie(this.$.pa.va,ja,fb=>{let Eb=$d.n4b;fb?Jb.a(fb)?(fb=U.a.zc(fb.Errors),e.ULS.sendTraceTag(578353159,
3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${fb}`)):Eb=this.BUh(fb.Result):e.ULS.sendTraceTag(537168020,3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");hb(Eb)},fb=>{fb=Qb.a.kf(fb.data);fb=U.a.zc(fb);e.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${fb}]`);oa(null)},null,null)})}requestActivityFeed(){return nb.b(this.getActivityFeed()).then(ja=>
Object(W.a)(new sb,{activityFeedItems:this.XKj(ja)}))}updateActivityState(ja){return X.EwaSettings.ma(451)?Promise.resolve(!0):this.d0b?nb.b(this.d0b).then(hb=>{var oa,fb;return nb.b(hb.rPj(ja.itemIds,null!==(oa=ja.activityStatesToSet)&&void 0!==oa?oa:0,null!==(fb=ja.activityStatesToReset)&&void 0!==fb?fb:0,ja.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.d0b?Od.a.jUd(this.d0b,ja=>ja.getActivityFeed(null)):G.Task.Ua([])}BUh(ja){if(!ja)return e.ULS.sendTraceTag(537168018,3012,
10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(W.a)(new $b,{activities:[]});const hb=this.A9f(ja.NewActivities,2);ja=this.A9f(ja.OutstandingActivities,3);for(const oa of ja)hb.push(oa);return Object(W.a)(new $b,{activities:hb})}A9f(ja,hb=1){const oa=[];if(!ja||!ja.length)return oa;for(const fb of ja)fb?(ja=$d.dLj(fb.Type),6===ja||7===ja||9===ja||8===ja?oa.push(Object(W.a)(new ad,{activityId:fb.Id,type:ja,displayTimestamp:new Date(fb.DisplayTimestamp),
navigationId:fb.NavigationId,actors:this.aac(fb.People),relevancy:hb,relationship:this.cLj(fb.Relationship)})):oa.push(Object(W.a)(new uc,{activityId:fb.Id,type:ja,displayTimestamp:new Date(fb.DisplayTimestamp),navigationId:fb.NavigationId,actors:this.aac(fb.People),relevancy:hb}))):e.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return oa}cLj(ja){switch(ja){case 1:return 1;case 2:return 2;case 3:return 3}e.ULS.sendTraceTag(537168016,
0,10,"Unexpected Relationship.");return 1}XKj(ja){const hb=[];for(const oa of ja)ja=Object(W.a)(new Oc,{id:oa.id,type:oa.type,collectionId:oa.collectionId,activityState:oa.activityState,activityFeedItemPayload:oa.activityFeedItemPayload,timestamp:oa.timestamp}),hb.push(ja);return hb}aac(ja){const hb=[];if(!ja||!ja.length)return hb;for(const oa of ja)oa&&hb.push(this.Wub(oa));return hb}Wub(ja){return Object(W.a)(new xc,{id:ja.Id,provider:ja.Provider,displayName:ja.DisplayName,email:ja.Email,imageUrl:this.cpc.cHa(ja.Email,
ja.Provider,d.AFrameworkApplication.gj,0),color:this.lFb.wfd(new Za.a(null,void 0,ja.DisplayName),6)})}static dLj(ja){switch(ja){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return e.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}}$d.uha="<WywaWaterline>DefaultWaterline</WywaWaterline>";$d.n4b=Object(W.a)(new $b,{activities:[],
actors:[],hasMore:!1,highWaterline:$d.uha,lowWaterline:$d.uha,wywaWaterline:$d.uha});Object(b.a)($d,"CatchUpActivityRequestManager",null,[731]);class ne{constructor(ja){this.$=ja}shouldShowEmptyExperienceButton(){return this.$.ea.v7a?!0:!1}onButtonClick(){const ja={["InputMethod"]:ib.a.Eb};this.$.Ka.Lb(new L.a(1834994092,ib.a.Eb,this.$.Mc,16,null),ja)}getExplanationText(){const ja=this.$.da.za(365);return Ob.a.instance.Xa(ja&&ja.isVisible?648:647)}getCommandName(){return Ob.a.instance.ga(448)}}Object(b.a)(ne,
"CatchUpEmptyExperienceBehaviorManager",null,[732]);const ye=ja=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+ja)};class te{constructor(ja,hb=null){this.$=ja;this.flyoutRibbonButton=hb;ka.a(this.$).Xh(this);this.hasFocus=!1}dispose(){ka.a(this.$).Nz(this)}get lc(){return document.getElementById("catchUpFlyoutContainer")}get jf(){return this.flyoutRibbonButton.ncf&&!this.hasFocus}get Zd(){return V.a.LYc}gg(ja,hb){if(hb)return!1;ja=document.getElementById("flyoutItem0");
if(!ja)return e.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;ja.focus();this.gfh(ja);return!0}hh(ja){return this.lc?wa.DOMElementExtensions.uf(this.lc,ja):!1}kj(){this.hasFocus=!0}Mj(){this.hasFocus=!1}gfh(ja){if(Sys.Browser.agent===Sys.Browser.Firefox){var hb=document.createEvent("KeyboardEvent");hb.initKeyEvent(bc.a.Mb,!0,!0,window.self,!1,!1,!1,!1,md.a.VAc,0);ja.dispatchEvent(hb)}else hb=document.createEvent("Events"),hb.initEvent(bc.a.Mb,!0,
!0),hb.keyCode=md.a.VAc,hb.which=md.a.VAc,ja.dispatchEvent(hb)}}Object(b.a)(te,"FlyoutFocus",null,[110,3]);var Ze=a(373);class re{constructor(ja){this.buttonClickedCallback=null;this.eib=this.hyb=!1;this.rBh=new Date;this.zSe=ja}dispose(){this.eib=this.hyb=!1}registerButtonClickedEvent(ja){this.buttonClickedCallback&&e.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=ja.buttonClickedCallback}onFlyoutInitialized(){this.hyb&&
e.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const ja=(new Date).getTime()-this.rBh.getTime();e.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${ja}`);l.c(Xb.a.EUg,!0,l.e,0,0,ja);this.hyb=!0;Ze.a.EA&&Ze.a.EA.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.hyb?this.buttonClickedCallback?this.buttonClickedCallback():e.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):
e.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get ncf(){return this.eib}onFlyoutVisibilityChanged(ja){this.eib!==ja.flyoutIsVisible&&(this.eib=ja.flyoutIsVisible,Ze.a.EA&&Ze.a.EA.updateCommandUI(!0),this.eib||this.zSe&&this.zSe.$si())}}Object(b.a)(re,"FlyoutRibbonButton",null,[777]);var tc=a(517);class $c{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=
this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=null}}Object(b.a)($c,"CatchUpConfiguration",null,[]);class Ed{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=
null}}Object(b.a)(Ed,"SharedControllerFactoryParameters",null,[]);class Id{constructor(ja,hb,oa=null,fb=null){this.gGa=null;this.j5e=!1;this.wDf=Eb=>{X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!xa.a.kh(Eb.wywaActivities)&&2!==Eb.wywaActivities[0].type&&(this.NZa.Fnj(this.KYc.Mdg),this.NZa.gwc(!0),this.NZa.R5h(Eb.wywaActivities[0]))};this.$=ja;this.NZa=new Le(this.$);this.K1d=new rc(d.AFrameworkApplication.wb,X.EwaSettings.ma(451));ja=Ua.a.CJj(bb.a.instance.Vb("Common.App.CatchUpActivity.ICatchUpRequestHandler"));
this.tjf=fb;this.KYc=new $d(this.$,ja,this.M5a());this.Mve=new me(this.$,d.AFrameworkApplication.wb);this.emptyCatchUpBehaviorManager=new ne(this.$);this.Fri(Eb=>{this.aGi(Eb)},hb);this.Gti();hb=null;oa||(hb=bb.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));this.flyoutRibbonButton=oa||new re(hb);this.flyoutFocus=new te(this.$,this.flyoutRibbonButton)}get Caf(){const ja=this.flyoutRibbonButton.hyb;ja&&!this.j5e&&(e.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),
this.j5e=!0);return ja}get tei(){return this.flyoutRibbonButton.ncf}dispose(){this.gGa&&this.gGa.getWywaEvent().removeListener(this.wDf);this.gGa=this.$=null;vb.a.Ia(this.NZa);this.flyoutRibbonButton=this.flyoutFocus=this.K1d=this.Mve=this.KYc=this.NZa=null}qSi(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}Gti(){e.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.X$e()&&e.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}Fri(ja,
hb){ye("ScriptDownload");y.TaskExtensions.Aa(B.GetServiceTaskFactory.Ta(this.$.da,283,284,hb),oa=>{ja(nb.c(oa.result.$n.loadScript("catchUpActivity")))},this.$.da.la,3)}M5a(){return!!this.tjf&&this.tjf.M5a()&&this.$.ea.v7a}X$e(){return X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}aGi(ja){y.TaskExtensions.Aa(ja,()=>{la.a(()=>{this.gGa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(W.a)(new Ed,{activityContentManager:Object(cb.a)(729,
this.K1d),activityNavigationManager:Object(cb.a)(730,this.Mve),activityRequestManager:Object(cb.a)(731,this.KYc),dataCulture:this.$.ya.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(cb.a)(re,this.flyoutRibbonButton),uiCulture:this.$.ya.UICultureTag,ulsLogger:new H.a,emptyCatchUpBehaviorManager:Object(cb.a)(732,this.emptyCatchUpBehaviorManager)}))});this.NZa.eje=this.gGa.getActivityIndicatorTooltipManager();tc.a(this.$);this.gGa.getWywaEvent().addListener(this.wDf);ye("InitializeCatchUpApp");
this.gGa.initialize(Object(W.a)(new $c,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.M5a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.X$e()}))},this.$.la,3)}}Object(b.a)(Id,"CatchUpActivityManager",null,[733,3]);class ae extends f.a{constructor(ja){super();this.$=ja;this.Fb()}create(){y.TaskExtensions.Aa(B.GetServiceTaskFactory.Ta(this.$.da,458,459,this.ib),ja=>{const hb=ja.result;ja=Object(Ja.a)(this.$.da,286,()=>new Id(this.$,this.ib,
null,hb));this.qb(ja)},this.$.la,3)}static ka(ja){ja.da.Ga(287,new ae(ja))}}Object(b.a)(ae,"CatchUpActivityManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");Type.registerNamespace("_Ewa");c.a.Fa(qa.ka);c.a.Fa($a.ka);c.a.Fa(u.ka);c.a.Fa(w.ka);rb.a.Di('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(ja=>{yc.ka(ja);ec.ka(ja);Ba.ka(ja);gd.ka(ja);X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&Ad.ka(ja);Oa.ka(ja)})})();Type.registerNamespace("Common.App.CatchUpActivity");yd.main();(()=>{c.a.Fa(ja=>{ye("Begin");ae.ka(ja);I.ka(ja)})})()},978:function(t,D,a){a.d(D,"a",function(){return d});t=a(0);var c=a(163);D=a(1230);var b=a(758);class d extends D.a{constructor(f,e){super(f,e);e!==b.a.f9&&this.QEa(e);this.Wfa(d.iterateNext);this.Wfa(d.Hwa);this.sSc(c.a.tTa);
this.sSc(c.a.uTa)}}d.iterateNext="IterateNext";d.Hwa="IteratePrevious";d.AMb="ToggleShowChanges";d.setCurrentChangeCount="SetCurrentChangeCount";d.setTotalChangesCount="SetTotalChangesCount";d.eOa="OnVHDiffReady";Object(t.a)(d,"VersionHistoryMessenger",D.a,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/278154eb34afbc52cfca5bfeba873137/EwaDSEsNext.catchup.js.map