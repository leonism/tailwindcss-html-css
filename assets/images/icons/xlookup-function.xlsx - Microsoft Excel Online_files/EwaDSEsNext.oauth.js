'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1219:function(t,D,a){t=a(0);var c=a(942),b=a(4);class d{}Object(t.a)(d,"LokiTokenResult",null,[]);class f{constructor(n){this.eTb=n}vdd(){const n=this.yQh();return n?f.Dnd?new Promise((w,r)=>{this.eTb.continueWith(()=>{this.eTb.Bh||this.eTb.Sf?r(Error.create("Error downloading auth library")):this.eTb.result.uO("Loki",n).then(u=>{u=b.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?this.BQh():
u.IsSuccess&&u.Token?Object.assign(new d,{isSuccess:!0,token:u.Token,errorMessage:null}):Object.assign(new d,{isSuccess:!1,token:null,errorMessage:JSON.stringify(u)});w(u);return u})})}):Promise.resolve(Object.assign(new d,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new d,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.lVe())}))}BQh(){const n=
b.AFrameworkApplication.fa.Va("LokiUserDataSignature")||"";return Object.assign(new d,{isSuccess:!0,token:n,errorMessage:null})}yQh(){let n=null;const w=c.a.s9b();2===w?n=b.AFrameworkApplication.fa.Va("LokiAADAppId"):1===w&&(n=b.AFrameworkApplication.fa.Va("LokiMSAAppId"));return n}static get Dnd(){return b.AFrameworkApplication.fa.qa("IsO365CommercialHost")||b.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}Object(t.a)(f,"LokiTokenManager",null,[434]);var e=a(246),k=a(82),l=a(513);class m{get name(){return"Common.App.LivePersonaUtils"}init(){k.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}ai(n){n.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").uc().Gc(()=>new f(l.a.Sq(n.Vb("Common.App.OAuth.IOAuthManager"))))}static main(){e.a.instance.Ii(new m)}}Object(t.a)(m,"LivePersonaUtilsPackage",null,[4,5]);a.d(D,"a",function(){return v});const v=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");m.main()}},1242:function(t,D,a){var c=a(10);t=a(0);var b=a(82),d=a(220),f=a(7),e=a(15),k=a(809);class l{constructor(w){this.oAuthManager=w}uO(w,r){return this.oAuthManager?
this.oAuthManager.uO(w,r).then(u=>{u.IsSuccess||e.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+u.ErrorMessage+" Error code: "+u.ErrorCode+" App name: "+w);return Object(f.a)(new k.a,{IsSuccess:u.IsSuccess,Token:u.Token,ErrorCode:u.ErrorCode,ErrorMessage:u.ErrorMessage})}):(e.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new k.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}f5a(){return this.oAuthManager?
this.oAuthManager.f5a():null}}Object(t.a)(l,"OAuthManagerWrapper",null,[428]);var m=a(695);class v extends d.a{constructor(w){super();this.$=w;this.Fb()}create(){this.qb(Object(m.a)(this.$.da,349,()=>new l(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static ka(w){w.da.Ga(350,new v(w))}}Object(t.a)(v,"OAuthManagerFactory",d.a,[]);a.d(D,"a",function(){return n});const n=()=>{c.a.Fa(w=>{v.ka(w)})}},1267:function(t,D,a){t=a(0);var c=a(15),b=a(838),d=a(917),f=a(4),e=a(98),k=a(728),l=a(246),
m=a(41),v=a(39),n=a(27),w=a(112),r=a(82),u=a(185);class x{get name(){return"Common.App.OAuth.OAuthPackage"}ai(B){B.register(395,"Common.App.OAuth.IOAuthManager").uc().Gc(()=>new b.OAuthManager)}init(){const B=r.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.sNj(B)}sNj(B){const y=f.AFrameworkApplication.fa.Va("FileSource");if(f.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===y){var A=k.a.S2g;if(A&&A.IsEnabled){var K=
A.Application,G=k.a.authority;if(void 0!==K&&null!==K&&K.length&&void 0!==G&&null!==G&&G.length){var T=d.a[B.gS],W=n.a.NFa,P=B.av();try{var E=new Map;void 0!==E&&null!==E?(E.set("SupportStatus",T),E.set("Browser",W),E.set("AuthStrategy",P)):E=null}catch(F){E=null}e.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",E);var H=v.a.Sd();B.uO("Core",K).then(F=>{const N=Math.floor(v.a.Sd()-H);T=d.a[B.gS];W=n.a.NFa;P=B.av();c.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
N,F.IsSuccess,T,F.ErrorCode,y,W,P);E&&(E.set("SupportStatus",T),E.set("Browser",W),E.set("AuthStrategy",P));var J=Object.assign(new u.a,{durationMs:N,extendedProperties:E});if(F.IsSuccess){if(e.Health.instance.recordKpiSuccess("WacCorePFT",J),J=A.Endpoint){var R=v.a.Sd();f.AFrameworkApplication.rd.emb(J,1,null,{["Authorization"]:"Bearer "+F.Token},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(M=>{var L=Math.floor(v.a.Sd()-R),U=null;M.Bh?M="Canceled":M.Sf?M="Faulted":(U=M.result,
M=U.succeeded?"Completed":"Failed");L={["TaskResult"]:M,["BrowserTokenDurationMS"]:N,["BrowserValidationDurationMS"]:L};U&&(L.HttpStatus=U.Ig.data.httpStatus,U.succeeded&&(U=m.a(U.Ig.data.Td),L.ServerValidationDurationMS=U.ElapsedMilliseconds,L.ServerValidationResult=U.ValidatedToken,L.KMSI=U.KMSI,L.Scopes=U.Scopes,L.TokenExpirationS=Math.floor(parseInt(U.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===M?50:15,w.a.toJSON(L))})}}else e.Health.instance.recordKpiFailure("WacCorePFT",
F.ErrorCode,!1,!1,J)}).catch(F=>{var N=Math.floor(v.a.Sd()-H);N=Object.assign(new u.a,{durationMs:N,extendedProperties:E});e.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+F.toString(),!1,!1,N)})}}}}dispose(){}static main(){l.a.instance.Ii(new x)}static W7i(){l.a.instance.Ii(new x,0,!0)}}Object(t.a)(x,"OAuthPackage",null,[4,5]);a.d(D,"a",function(){return z});const z=B=>{Type.registerNamespace("Common.App.OAuth");B?x.W7i():x.main()}},1453:function(t,D,a){a.r(D);t=a(1267);D=a(1219);
a=a(1242);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(t.a)();Object(D.a)();Object(a.a)()},838:function(t,D,a){a.r(D);t=a(0);var c=a(15);const b=(S,ka)=>{var V=S.ojg;if(!V){V=[];for(var wa in S)"string"===typeof wa&&V.push({key:wa,value:S[wa]});V.sort((ma,ab)=>ma.value-ab.value);S.ojg=V}V=[];for(wa=1;0<ka;)ka&1&&S[wa]&&V.push(S[wa]),wa<<=1,ka>>=1;if(V.length&&0===ka)return V.reverse().join(", ")};var d=a(917),f;(function(S){S[S.external=0]="external";
S[S.msa=1]="msa";S[S.aad=2]="aad"})(f||(f={}));Object(t.b)("AuthorityType",f);class e{}Object(t.a)(e,"OAuthResult",null,[]);class k{constructor(S){this.Yrg=S}initialize(){return Promise.resolve(0)}fic(){return Promise.resolve(0)}uO(){c.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new e,{IsSuccess:!0,Token:this.Yrg}))}dzc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}Ixc(){return!1}mvb(){return"MockAuthTokenStrategy"}}Object(t.a)(k,"MockAuthTokenStrategy",null,[464]);var l=a(942);class m{static get(S,ka,V){if(!V)return S;let wa=0;return Promise.race([S,new Promise(ma=>{wa=window.setTimeout(()=>{ma(ka)},V)})]).then(ma=>{window.clearTimeout(wa);return Promise.resolve(ma)}).catch(()=>{window.clearTimeout(wa);return Promise.resolve(ka)})}}Object(t.a)(m,"PromiseWithTimeout",
null,[]);var v=a(4),n=a(728);class w{constructor(S,ka,V,wa,ma){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=S;this.scope=ka;this.silentLogin=V;this.options=wa;this.correlationId=ma}}Object(t.a)(w,"TokenRequestParameters",null,[539]);var r=a(27),u=a(82);class x{constructor(){this.bie=null;let S=v.AFrameworkApplication.fa.Va(v.AFrameworkApplication.Mda),ka=v.AFrameworkApplication.fa.Va(v.AFrameworkApplication.$$f);this.LWa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",
S&&""!==S?S:"Unspecified",ka&&""!==ka?ka:"Unspecified")}initialize(){return new Promise(S=>{u.a.instance.Vb("Common.App.WopiIdentity.IWopiIdentity").execute(ka=>{this.bie=ka;S(0)})})}ti(S){const ka=["HTTPS:","API:"];let V=!1;const wa=S.toLocaleUpperCase();for(const ma of ka)if(wa.startsWith(ma)){V=!0;break}return V||this.shi(S)?S+"/.default":S}shi(S){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(S)}fic(){return Promise.resolve(0)}uO(S,ka,V,wa,ma,
ab,ba){if(r.a.Bwa){ma=n.a.dWj;if(!ma)return ka=Object.assign(new e,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(ka);if(!Array.contains(ma,S))return ka=Object.assign(new e,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+S}),Promise.resolve(ka)}S=this.ti(V);V=new w(V,S,!wa,null,v.AFrameworkApplication.userSessionId);return this.bie.getAccessToken(V,ka,ba).then(Ca=>Object.assign(new e,{IsSuccess:!0,Token:Ca.accessToken}),
Ca=>Object.assign(new e,{IsSuccess:!1,ErrorCode:Ca}))}dzc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}Ixc(){return!1}mvb(){return this.LWa}}Object(t.a)(x,"ParentFrameTokenStrategy",null,[464]);var z=a(83),B=a(847),y=a(184);class A{constructor(){this.reject=this.resolve=null;this.startTime=0;this.IIf=this.Wre=null}}Object(t.a)(A,"PromiseWrapper",
null,[]);class K{constructor(S=0){this.TB=0;this.Djb=!1;this.Cm=new y.a;this._timeout=S}enqueue(S){return new Promise((ka,V)=>{this.Cm.add(Object.assign(new A,{IIf:S,resolve:ka,reject:V}));this.process()})}process(){if(this.Djb||this.TB===this.Cm.count)return!1;const S=this.Cm.na(this.TB++);try{this.Djb=!0,S.IIf().then(ka=>{this.Djb=!1;this.n0c(S,ka,null,!0)}).catch(ka=>{this.Djb=!1;this.n0c(S,null,ka,!1)})}catch(ka){this.Djb=!1,this.n0c(S,null,ka,!1)}return!0}n0c(S,ka,V,wa){if(wa){const ma=()=>{S.resolve(ka);
this.process()};0<this._timeout?window.setTimeout(()=>{ma()},this._timeout):ma()}else{const ma=()=>{S.reject(V);this.process()};0<this._timeout?window.setTimeout(()=>{ma()},this._timeout):ma()}}}Object(t.a)(K,"PromiseQueue",null,[]);class G{constructor(){this.correlationId=this.resolve=null}}Object(t.a)(G,"ResolveWithCorrelation",null,[]);var T=a(84),W=a(144),P=a(815),E=a(163);class H extends W.a{constructor(S,ka,V,wa,ma,ab,ba){super(!1,!1,!0);this.J3d=this.J0=null;this.pX=S;this.Atg=V;this.Jv=wa;
this.mxg=ma;this.XCa=ab;this.Hs=document.createElement("iframe");this.Hs.id="SharedAuthInteractiveFrame";this.Hs.setAttribute("name","SharedAuthInteractiveFrame");this.Hs.setAttribute("title","SharedAuthInteractiveFrame");this.Hs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Hs.style.border="0";this.Hs.style.height="48px";this.Hs.style.width="190px";$addHandler(this.Hs,"error",Object(z.a)(this,this.TQi,"onSharedAuthFrameError"));S=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",
this.pX,ka,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",v.AFrameworkApplication.userType);ba&&(S+="&vnext=1");this.Hs.src=S;this.Qmg=new Promise(Ca=>{this.J3d=Ca});this.K3d=!1}Tvc(){this.J0={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.Atg,["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:v.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(z.a)(this,this.M5g,"createFrame"),["resolveDialogStyles"]:this.J3d}};
this.Sb=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(z.a)(this,this.vuj,"sharedAuthConsentDialogHandler"),this.J0)}tAc(S=!1,ka=!1,V=5){this.J0&&this.J0.bodyControls&&(S!==Object(T.a)(Object,this.J0.bodyControls).frameLoaded&&(Object(T.a)(Object,this.J0.bodyControls).frameLoaded=S),ka!==Object(T.a)(Object,this.J0.bodyControls).frameLoadSuccess&&(Object(T.a)(Object,this.J0.bodyControls).frameLoadSuccess=ka),V!==this.J0.dialogButtonsOption&&(this.J0.dialogButtonsOption=null,this.Sb=V),this.update(this.J0))}KAj(S,
ka){const V=new P.a(E.a.zuj);V.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,["rtl"]:v.AFrameworkApplication.isRtl,["messageCorrelationId"]:S,["dialogStyles"]:ka};this.Jv.zQa(V,this.Hs.contentWindow,this.pX)}dTe(){this.tAc(!0,!1,6)}get X_f(){return this.Hs}get meh(){return this.Qmg.then(S=>{this.K3d=!0;return S})}get neh(){return this.K3d}TQi(){this.dTe()}M5g(){return this.Hs}vuj(S){0===S&&(this.mxg.reject(Object.assign(new e,{ErrorCode:"UserCancelled",
ErrorMessage:"The interactive flow was cancelled by the user"})),this.XCa(null))}}Object(t.a)(H,"SharedAuthConsentDialog",W.a,[540]);var F=a(1230),N=a(98),J=a(134),R=a(39),M=a(171),L=a(185);class U{constructor(){this.Hs=null;this.ARb=0;this.Oib=this.$Wa=this.rDc=this.XCa=this.TL=this.bhe=null;this.Jv=new F.a(null,null);this.$Vb=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.LWa="SharedAuthTokenStrategy "+(this.$Vb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":
"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.pX=n.a.xuj;this.cfe=n.a.wuj;this.u4d=n.a.enableConsoleLogging;this.gng=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Ovg=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.$Vb);this.kqa={};this.Rpg=new K(1500)}mvb(){return this.LWa}initialize(){var {OAuthManager:S}=a(838);if("loadFrame"in this.kqa)return this.kqa.loadFrame.Wre;
if(!this.pX)return N.Health.instance.recordKpiFailure(S.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);S=this.oxc("loadFrame");this.ARb=R.a.Sd();var ka=this.pX+this.cfe+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+v.AFrameworkApplication.userSessionId+"&WacUserType="+v.AFrameworkApplication.userType;this.$Vb&&(ka+="&vnext=1");this.Hs=document.createElement("iframe");
this.L9h(this.Hs);this.Hs.style.cssText="height:0;width:0;display:none;";this.Hs.id="SharedAuthFrame";this.Hs.setAttribute("name","SharedAuthFrame");this.Hs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Hs.setAttribute("title","SharedAuthFrame");this.Hs.src=ka;document.body.appendChild(this.Hs);ka=R.a.Sd()-this.ARb;c.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",ka,this.Hs.src);
return S}fic(S){this.rDc=S;const ka=new P.a(E.a.$_f);ka.Values=this.xre(S);S=this.oxc("initFrame");this.Jv.zQa(ka,this.Hs.contentWindow,this.pX);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return S}uO(S,ka,V,wa,ma,ab){const ba=new P.a(E.a.Auj),Ca=this.m0e();ba.Values=this.u$f(S,ka,V,wa,ma,ab,Ca);S=this.oxc(Ca);wa&&v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.Rpg.enqueue(()=>
new Promise(Na=>{this.IMj(ab,ba,Na,Ca)})):(this.Jv.zQa(ba,this.Hs.contentWindow,this.pX),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",ka));return S}IMj(S,ka,V,wa){const ma=this.kqa[wa];ma&&(this.$Wa=ka,this.XCa=Object.assign(new G,{resolve:V,correlationId:wa}),this.TL=new H(this.pX,this.cfe,S,this.Jv,ma,V,this.$Vb),this.TL.Tvc())}m0e(){return M.a.create().toString()}u$f(S,ka,V,wa,ma,ab,ba){const Ca={};Ca.appName=S;Ca.appId=ka;Ca.target=
V;Ca.withPopup=wa;Ca.claims=ma;Ca.promptMessage=ab;Ca.messageCorrelationId=ba;return Ca}L9h(S){$addHandler(S,"load",Object(z.a)(this,this.ULi,"onIFrameLoaded"));$addHandler(S,"error",Object(z.a)(this,this.Klc,"onIFrameError"));this.Jv.QEa(this.pX);this.Jv.fo(E.a.c0f);this.Jv.Vl(E.a.c0f,Object(z.a)(this,this.kQi,"onScriptLoaded"));this.Jv.fo(E.a.b0f);this.Jv.Vl(E.a.b0f,Object(z.a)(this,this.jQi,"onScriptInitialized"));this.Jv.fo(E.a.Y_f);this.Jv.Vl(E.a.Y_f,Object(z.a)(this,this.uLi,"onGetTokenResponse"));
this.Jv.fo(E.a.d0f);this.Jv.Vl(E.a.d0f,Object(z.a)(this,this.mNi,"onLoginResponse"));this.Jv.fo(E.a.a0f);this.Jv.Vl(E.a.a0f,Object(z.a)(this,this.oMi,"onInteractiveFlowReady"));this.Jv.fo(E.a.Z_f);this.Jv.Vl(E.a.Z_f,Object(z.a)(this,this.MLi,"onHideDialog"));this.Jv.fo(E.a.W_f);this.Jv.Vl(E.a.W_f,Object(z.a)(this,this.PGi,"onCloseDialog"))}oxc(S){const ka=new A;ka.startTime=R.a.Sd();const V=new Promise((wa,ma)=>{ka.resolve=wa;ka.reject=ma});ka.Wre=V;this.kqa[S]=ka;return V}ULi(){const S=R.a.Sd()-
this.ARb;c.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",S)}Klc(S){const {OAuthManager:ka}=a(838),V=R.a.Sd()-this.ARb,wa=Object.assign(new L.a,{durationMs:V});N.Health.instance.recordKpiFailure(ka.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,wa);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",V,this.u4d?JSON.stringify(S):"")}kQi(S){const {OAuthManager:ka}=a(838),V=this.kqa.loadFrame;var wa=R.a.Sd()-V.startTime,
ma=S.Values.AuthLibrary.toString();S=S.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",S,ma,wa);ma&&(this.LWa="SharedAuthTokenStrategy "+ma);ma=Boolean.parse(S);ma||(S=J.a.Kr(),void 0!==S&&null!==S&&(S.set("AuthLibrary",this.mvb()),wa=Object.assign(new L.a,{durationMs:wa,extendedProperties:S}),N.Health.instance.recordKpiFailure(ka.kpiName,"SharedAuthStrategyInitFailed",!1,!0,wa)));V.resolve(ma?0:1)}jQi(S){if(S.Values.interactive&&
this.$Wa&&this.$Wa.Values.messageCorrelationId){const V=this.$Wa.Values.messageCorrelationId.toString();if(S.Values.interactive&&this.TL){this.TL.meh.then(wa=>{this.Jv.zQa(this.$Wa,this.TL.X_f.contentWindow,this.pX);this.TL.KAj(V,wa);this.TL.tAc(!0,!0);this.$Wa=null});return}}S=this.kqa.initFrame;const ka=R.a.Sd()-S.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ka);S.resolve(0)}uLi(S){if(S.Values.messageCorrelationId&&S.Values.messageCorrelationId.toString()){var ka=
S.Values.messageCorrelationId.toString(),V=this.kqa[ka];if(V){var wa=R.a.Sd()-V.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",wa);S.Values.isSuccess&&S.Values.isSuccess?V.resolve(S.Values.response):V.reject(S.Values.response);this.J$f(ka)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}oMi(){if(this.TL.neh)this.TL.dTe();
else if(this.rDc&&this.TL){const S=new P.a(E.a.$_f);S.Values=this.xre(this.rDc,!0);this.Jv.zQa(S,this.TL.X_f.contentWindow,this.pX)}}MLi(){this.TL&&this.TL.xwb()}PGi(S){S.Values.cancelled&&S.Values.cancelled&&S.Values.messageCorrelationId&&this.J$f(S.Values.messageCorrelationId.toString());this.TL&&this.TL.hide()}xre(S,ka=!1){const V={};V.appIds=this.bHh();V.upn=S.loginHint;V.authority=S.authority;V.authorityType=b(f,S.authorityType);V.tenantId=S.tenantId;V.correlationId=v.AFrameworkApplication.userSessionId;
V.enableConsoleLogging=this.u4d;V.enablePopupFlash=this.gng;V.skipUpnCheck=this.Ovg;V.interactive=ka;return V}bHh(){const S=[],ka=n.a.KUc;for(let V in ka)Array.add(S,ka[V]);return S}dzc(S,ka,V,wa,ma,ab){const ba=new P.a(E.a.yuj),Ca=this.m0e();ba.Values=this.u$f(S,ka,V,wa,ma,ab,Ca);this.bhe=ba;S=this.oxc(Ca);c.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",ka);this.uyj();return S}Ixc(){return!0}uyj(){this.Oib||(this.Oib=new B.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,
CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Oib.id=16,this.Oib.snd=!1,this.Oib.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Jv.zQa(this.bhe,this.Hs.contentWindow,this.pX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}mNi(S){if(S.Values.messageCorrelationId&&
S.Values.messageCorrelationId.toString()){var ka=this.kqa[S.Values.messageCorrelationId.toString()];if(ka){var V=R.a.Sd()-ka.startTime;c.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",V);S.Values.isSuccess&&S.Values.isSuccess?ka.resolve(S.Values.response):ka.reject(S.Values.response)}else c.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}J$f(S){this.XCa&&
this.XCa.correlationId===S&&(this.XCa.resolve(null),this.XCa=null)}}Object(t.a)(U,"SharedAuthTokenStrategy",null,[464]);class X{constructor(S){this.LNc=S;this.LWa="UnsupportedAuthTokenStrategy Reason="+d.a[this.LNc]}initialize(){return Promise.resolve(0)}fic(){return Promise.resolve(0)}uO(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:d.a[this.LNc],ErrorMessage:"Unable to get a token. Reason: ["+d.a[this.LNc]+"]"}))}dzc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,
ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}Ixc(){return!1}mvb(){return this.LWa}}Object(t.a)(X,"UnsupportedAuthTokenStrategy",null,[464]);var da=a(716);a.d(D,"OAuthManager",function(){return fa});class fa{constructor(S=null){this.gS=0;this.HO=null;this.jug=0;const ka=R.a.Sd();this.Gpg=this.zdh(S).then(V=>V?this.c8h():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",
this.av(),Math.floor(R.a.Sd()-ka)),V=J.a.Kr(),void 0!==V&&null!==V&&(V.set("AuthLibrary",this.av()),V=Object.assign(new L.a,{durationMs:Math.floor(R.a.Sd()-ka),extendedProperties:V}),N.Health.instance.recordKpiFailure(fa.kpiName,"StrategyPickFailed",!1,!0,V)),Promise.resolve(1))).then(V=>0!==V?Promise.resolve(V):this.Dri())}Adh(){var S=n.a.Xzi;S&&0<S.length?(this.gS=1,this.HO=new k(S)):v.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||v.AFrameworkApplication.fa.qa("IsO365CommercialHost")?v.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(this.gS=2,this.HO=new X(this.gS)):(S=l.a.getAuthContext().loginHint)&&S.length?n.a.Bwb?(this.gS=1,this.HO=new x):(this.gS=1,this.HO=new U):(this.gS=3,this.HO=new X(this.gS)):(this.gS=4,this.HO=new X(this.gS))}av(){return this.HO?this.HO.mvb()||"Unknown":"None"}zdh(S=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const ka=R.a.Sd();return v.AFrameworkApplication.fa.Mcd().then(V=>{V?(this.Adh(),S&&(this.HO=S),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
n.a.clientVersion,n.a.appVersion,n.a.wgh,this.av(),Math.floor(R.a.Sd()-ka))):c.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(R.a.Sd()-ka));return Promise.resolve(V)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(R.a.Sd()-ka));return Promise.resolve(!1)})}c8h(){c.ULS.sendTraceTag(573390991,
3E3,50,"Initializing {0}",this.av());const S=R.a.Sd();return m.get(this.HO.initialize(),2,n.a.mEd).then(ka=>{if(0===ka)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.av(),Math.floor(R.a.Sd()-S));else if(1===ka){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.av(),Math.floor(R.a.Sd()-S));var V=J.a.Kr();void 0!==V&&null!==V&&(V.set("AuthLibrary",this.av()),V=Object.assign(new L.a,{durationMs:Math.floor(R.a.Sd()-
S),extendedProperties:V}),N.Health.instance.recordKpiFailure(fa.kpiName,"StrategyInitFailed",!1,!0,V))}else 2===ka&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.av(),Math.floor(R.a.Sd()-S)),V=J.a.Kr(),void 0!==V&&null!==V&&(V.set("AuthLibrary",this.av()),V=Object.assign(new L.a,{durationMs:Math.floor(R.a.Sd()-S),extendedProperties:V}),N.Health.instance.recordKpiFailure(fa.kpiName,"StrategyInitTimedOut",!1,!0,V)));
return Promise.resolve(ka)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.av(),Math.floor(R.a.Sd()-S));return Promise.resolve(1)})}Dri(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.av());const S=R.a.Sd();return m.get(this.HO.fic(l.a.getAuthContext()),2,n.a.mEd).then(ka=>{if(0===ka)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.av(),Math.floor(R.a.Sd()-S));else if(1===ka){c.ULS.sendTraceTag(562128583,
3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.av(),Math.floor(R.a.Sd()-S));var V=J.a.Kr();void 0!==V&&null!==V&&(V.set("AuthLibrary",this.av()),V=Object.assign(new L.a,{durationMs:Math.floor(R.a.Sd()-S),extendedProperties:V}),N.Health.instance.recordKpiFailure(fa.kpiName,"StrategyLoadFailed",!1,!0,V))}else 2===ka&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.av(),Math.floor(R.a.Sd()-
S)),V=J.a.Kr(),void 0!==V&&null!==V&&(V.set("AuthLibrary",this.av()),V=Object.assign(new L.a,{durationMs:Math.floor(R.a.Sd()-S),extendedProperties:V}),N.Health.instance.recordKpiFailure(fa.kpiName,"StrategyLoadTimedOut",!1,!0,V)));return Promise.resolve(ka)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.av(),Math.floor(R.a.Sd()-S));return Promise.resolve(1)})}uO(S,ka,V=null){return this.bzc(S,ka,!1,null,"",V)}v$f(S,ka,
V,wa,ma=null){return this.bzc(S,ka,!0,V,wa,ma)}bzc(S,ka,V,wa,ma,ab,ba=0){ba+=1;c.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",S,this.gQa(S,ka),this.av(),ba);var Ca=J.a.Kr();void 0!==Ca&&null!==Ca&&(Ca.set("AuthLibrary",this.av()),Ca.set("AppName",S),Ca.set("Target",this.gQa(S,ka)),N.Health.instance.recordKpiUsage(fa.kpiName,0,"WacOAuthFC",Ca));if(!n.a.isEnabled){var Na;return this.xsd((Na=new e,Na.IsSuccess=!1,Na.Token=
null,Na.ErrorCode="NotEnabled",Na.ErrorMessage="OAuthManager is disabled.",Na),S)}const za=n.a.KUc[S];if(void 0===za||null===za){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",S);var la;return this.xsd((la=new e,la.IsSuccess=!1,la.Token=null,la.ErrorCode="DisallowedApp",la.ErrorMessage="Disallowed appName: "+S,la),S)}const aa=R.a.Sd(),sa=this;Ca=this.Gpg.then(ya=>sa.Qci(S,za,ka,V,wa,ma,ab,ya));Na=V?0:n.a.mEd;
let ea;la=(ea=new e,ea.IsSuccess=!1,ea.Token=null,ea.ErrorCode="authTokenStrategy_timeout",ea.ErrorMessage="Auth Strategy timed out after ["+Na+"] ms when fetching token",ea);let Z=this,ua=this;return m.get(Ca,la,Na).then(ya=>ba<=fa.Fyi&&(ya.ErrorCode===fa.D8f||ya.ErrorCode===fa.lFj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",ba,Math.floor(R.a.Sd()-aa)),Z.bzc(S,ka,V,wa,ma,ab,ba)):ya.ErrorCode===fa.lhf&&!V&&(c.ULS.sendTraceTag(561517645,3E3,50,
"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",ba,fa.wJe),fa.Djh&&Z.HO.Ixc()&&Z.HO.dzc(S,za,ka,V,wa,ma).then(ha=>Promise.resolve(Z.xic(ha,S,ka,za,aa))).catch(()=>{let ha;const Da=(ha=new e,ha.IsSuccess=!1,ha.Token=null,ha.ErrorCode="authTokenStrategy_failure",ha.ErrorMessage="LoginPopup failed, GetToken could not be called",ha);return Promise.resolve(Z.xic(Da,S,ka,za,aa))}),fa.wJe)?Z.bzc(S,ka,!0,wa,ma,ab,ba):Promise.resolve(Z.xic(ya,S,ka,za,aa))).catch(()=>{let ya;
const ha=(ya=new e,ya.IsSuccess=!1,ya.Token=null,ya.ErrorCode="authTokenStrategy_failure",ya.ErrorMessage="Auth Strategy failed with an unknown error",ya);return Promise.resolve(ua.xic(ha,S,ka,za,aa))})}Qci(S,ka,V,wa,ma,ab,ba,Ca){return 1===Ca||2===Ca?this.xsd(Object.assign(new e,{IsSuccess:!1,Token:null,ErrorCode:1===Ca?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),S):this.HO.uO(S,ka,V,wa,ma,ab,ba).then(Na=>Promise.resolve(this.Yqf(Na,!0,S))).catch(Na=>Promise.resolve(this.Yqf(Na,
!1,S)))}xic(S,ka,V,wa,ma){const ab={};ma=R.a.Sd()-ma;ab.IsSuccess=S.IsSuccess;ab.ErrorCode=S.IsSuccess?"Success":S.ErrorCode||"";ab.ErrorMessage=S.IsSuccess?"Success":this.gQa(ka,S.ErrorMessage||"");ab.Target=this.gQa(ka,V||"");ab.TimeInMS=Math.floor(ma);ab.AuthLibrary=this.av();ab.AppName=ka;ab.AuthorityType=b(f,l.a.s9b());ab.UserType=this.tZh(l.a.getAuthContext());ab.IsAuthSupportedInSession=d.a[this.gS];ab.RequestCount=++this.jug;ab.AppId=wa;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(ab));
S.IsSuccess||(V=J.a.Kr(),void 0!==V&&null!==V&&(V.set("AppName",ka),V.set("AuthLibrary",this.av()),V.set("ErrorCode",S.ErrorCode),V.set("ErrorMessage",this.gQa(ka,S.ErrorMessage)),ka=Object.assign(new L.a,{durationMs:ma,extendedProperties:V}),N.Health.instance.recordKpiFailure(fa.kpiName,"TryGetTokenFailure",!1,!0,ka)));return S}xsd(S,ka){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",ka,this.gQa(ka,S.ErrorMessage));const V=J.a.Kr();
void 0!==V&&null!==V&&(V.set("AppName",ka),V.set("AuthLibrary",this.av()),V.set("ErrorCode",S.ErrorCode),V.set("ErrorMessage",this.gQa(ka,S.ErrorMessage)),ka=Object.assign(new L.a,{extendedProperties:V}),N.Health.instance.recordKpiFailure(fa.kpiName,"FailureBeforeGetToken",!1,!0,ka));return Promise.resolve(S)}rcf(S){return S===da.a.qyc}gQa(S,ka){return this.rcf(S)&&ka?"REDACTED":ka}tZh(S){return v.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!S.loginHint||1>S.loginHint.length?"empty":
-1<S.loginHint.indexOf("guest#")?"guest":-1<S.loginHint.indexOf("ext#")?"external":0>S.upn.indexOf("@")?"no-at":"supported"}f5a(){return 1===this.gS}Yqf(S,ka,V){let wa=null,ma=null,ab=null,ba=null;S?S.ErrorCode||S.ErrorMessage?(ma=S.ErrorCode?S.ErrorCode:fa.CPe,ab=S.ErrorMessage?S.ErrorMessage:"No message"):S.Token?ka?wa=S.Token:(ma=fa.M8i,ab="A rejected promise returned a token."):(ma=fa.CPe,ab=JSON.stringify(S)):(ma=fa.wCi,ab="No result came from Auth Token Strategy");S&&S.Telemetry&&!this.rcf(V)&&
(ba=S.Telemetry,c.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(ba)));if(ma===fa.hAi||ma===fa.XJj)ma=fa.D8f,ab="Auth Library Timed Out";ma===fa.aMg&&-1<ab.indexOf(fa.fyg)&&(ma=fa.lhf);if(ma||ab)wa=null;return Object.assign(new e,{IsSuccess:!!wa,Token:wa,ErrorCode:ma,ErrorMessage:ab,Telemetry:ba})}static get wJe(){return v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get Djh(){return v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}fa.XJj="token_renewal_error";fa.CPe="Exception";fa.wCi="NoResult";fa.M8i="RejectToken";fa.hAi="monitor_window_timeout";fa.D8f="Timeout";fa.lFj="authTokenStrategy_timeout";fa.aMg="login_required";fa.fyg="AADSTS50058";fa.lhf="Cookies Disabled";fa.kpiName="OAuthManager";fa.Fyi=2;Object(t.a)(fa,"OAuthManager",null,[395])},917:function(t,D,a){a.d(D,"a",function(){return c});t=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";
b[b.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(t.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/595132875c5a863132059e9d9479f4aa/EwaDSEsNext.oauth.js.map