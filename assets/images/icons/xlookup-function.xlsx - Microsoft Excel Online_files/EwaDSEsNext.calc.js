'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[14],{1152:function(t,D,a){t=a(0);var c=a(15),b=a(220),d=a(8),f=a(112);a(199);var e=a(184),k=a(84),l=a(164),m=a(195),v=a(64);class n{}n.local="Local";n.eIj="Thread";Object(t.a)(n,"RecalcServiceCreateMode",null,[]);var w=a(162);class r{constructor(ea){this.k2d=null;this.init(ea)}get P9(){return this.k2d}init(ea){this.k2d=new l.a;if(void 0!==ea&&null!==ea&&void 0!==ea.HeadersList&&null!==ea.HeadersList&&0<ea.HeadersList.length)for(const Z of ea.HeadersList)this.P9.ia(Z.Index,
Z.Name)}}Object(t.a)(r,"ColHeadersListData",null,[]);var u=a(1),x=a(36),z=a(100),B=a(22),y=a(21),A=a(200);class K{constructor(ea,Z){this.gue=ea;this.sheetName=Z;this.Otc=!1}}Object(t.a)(K,"CalcBlockInformation",null,[]);class G{constructor(ea,Z,ua,ya,ha){this.type=ea;this.fullName=Z;this.range=ua;this.sheetId=ya;this.attributes=ha;this.AE=null}}Object(t.a)(G,"CalcNamedObject",null,[]);class T{constructor(ea){this.Idg=ea;this.mfe=[];this.fbg=[];this.DZa={};this.$Od=new Map}get Gj(){return this.mfe}SZf(ea,
Z){this.mfe[ea]=Z;this.Idg&&Z.E6&&this.$Od.set(Z.E6.sheetName,ea)}getSheetIndex(ea){if(this.Idg){if(this.$Od.has(ea))return this.$Od.get(ea)}else for(let Z=1;Z<this.Gj.length;Z++)if(B.a.equals(this.Gj[Z].E6.sheetName,ea,!1))return Z;return-1}}Object(t.a)(T,"GridCache",null,[]);var W=a(680),P=a(548);class E{constructor(ea){this.E6=ea;this.f5=new W.a(P.a.Rk());this.Zjc=!1}}Object(t.a)(E,"SheetInformation",null,[]);var H=a(933),F;(function(ea){ea[ea.initialization=0]="initialization";ea[ea.contentReady=
1]="contentReady";ea[ea.cellEdit=2]="cellEdit"})(F||(F={}));Object(t.b)("UpdateDataTrigger",F);class N{constructor(ea){this.HFd=null;this.gsd=this.GFd=this.cEb=!1;this.ADd=0;this.rDd=this.tDd=this.uDd=this.sDd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Xn=this.errorTypeNames=null;this.nr=this.currentStateId=-1;this.Esa="";this.g$=null;this.getNameLoc=(Z,ua)=>this.qfc()?this.Ue.na(this.currentStateId).Gj[0].f5.lb(ua)?(Z=excelOnlineCalc.location.nameLoc(Z,
ua),excelOnlineCalc.util.success(Z)):excelOnlineCalc.util.success(null):(Z=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Z));this.getContainingTable=Z=>{if(!this.qfc())return Z=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Z);const ua=Z.range.col,ya=Z.range.row;var ha=this.Ue.na(this.currentStateId).Gj[0].f5,Da=null;for(let nb of ha)if(ha=nb.value,2===ha.type&&B.a.equals(Z.sheet.index.toString(),ha.sheetId,!0)){const qa=ha.range;ua>=qa.left-1&&ua<=qa.right-
1&&ya<=qa.bottom-1&&ya>=qa.top-1&&(Da=excelOnlineCalc.location.nameScope(this.documentLoc,ha.sheetId),Da=excelOnlineCalc.location.nameLoc(Da,ha.fullName))}return Da?excelOnlineCalc.util.success(Da):excelOnlineCalc.util.success(null)};this.getStructRefColumn=(Z,ua)=>{if(!this.qfc()){var ya=excelOnlineCalc.util.unavailable([2]);return excelOnlineCalc.util.failure(ya)}ya=Z.name;var ha=this.Ue.na(this.currentStateId).Gj[0].f5;if(ha.lb(ya)){ha=ha.na(ya);const nb=ha.range;if(2!==ha.type)return excelOnlineCalc.util.failure(this.l2c(5));
const qa=ha.AE?ha.AE.P9:null;if(!qa)return excelOnlineCalc.util.success(null);for(var Da of qa)if(B.a.equals(Da.value,ua,!0))return Z=excelOnlineCalc.location.documentLoc(Z.scope.document.path,Z.scope.document.name),Z=excelOnlineCalc.location.sheetIndex(Z,ha.sheetId),Da=excelOnlineCalc.location.gridRange(nb.top-1,Da.key,nb.bottom-nb.top+1,1),Da=excelOnlineCalc.location.sheetGridRange(Z,Da),ya=excelOnlineCalc.location.structRefColumnLoc(ya,Da,!!(ha.attributes&16),!!(ha.attributes&8)),excelOnlineCalc.util.success(ya);
return nb.right-nb.left+1!==qa.count?(ya=excelOnlineCalc.util.unavailable([17,Z,ua]),excelOnlineCalc.util.failure(ya)):excelOnlineCalc.util.failure(this.l2c(0))}return excelOnlineCalc.util.success(null)};this.getStructRefSpecialRef=(Z,ua)=>{if(!this.qfc())return ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua);var ya=this.Ue.na(this.currentStateId).Gj[0].f5;if(ya.lb(Z.name)){var ha=ya.na(Z.name);if(2!==ha.type)return excelOnlineCalc.util.failure(this.l2c(5));ya=!!(ha.attributes&
16);const Da=!!(ha.attributes&8),nb=ya?1:0,qa=Da?1:0;Z=excelOnlineCalc.location.documentLoc(Z.scope.document.path,Z.scope.document.name);Z=excelOnlineCalc.location.sheetIndex(Z,ha.sheetId);ha=ha.range;let pa={};if(1===ua)pa=excelOnlineCalc.location.gridRange(ha.top-nb-1,ha.left-1,ha.bottom+qa-ha.top+nb+1,ha.right-ha.left+1);else if(2===ua)pa=excelOnlineCalc.location.gridRange(ha.top-1,ha.left-1,ha.bottom-ha.top+1,ha.right-ha.left+1);else if(3===ua)if(ya)pa=excelOnlineCalc.location.gridRange(ha.top-
2,ha.left-1,1,ha.right-ha.left+1);else return excelOnlineCalc.util.success(null);else if(4===ua)if(Da)pa=excelOnlineCalc.location.gridRange(ha.bottom,ha.left-1,1,ha.right-ha.left+1);else return excelOnlineCalc.util.success(null);ua=excelOnlineCalc.location.sheetGridRange(Z,pa);return excelOnlineCalc.util.success(ua)}return excelOnlineCalc.util.success(null)};this.getDocumentLoc=(Z,ua)=>{if((B.a.equals(Z,this.documentLoc.path,!0)||!Z)&&B.a.equals(ua,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);
Z=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(Z,ua)]);return excelOnlineCalc.util.failure(Z)};this.getSheetIndex=(Z,ua)=>{if(!this.Ue.lb(this.currentStateId)||!this.Ue.na(this.currentStateId).Gj)return ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua);Z=this.Ue.na(this.currentStateId).Gj;for(let ya=1;ya<Z.length;ya++)if(B.a.equals(Z[ya].E6.sheetName,ua,!0))return excelOnlineCalc.util.success(Z[ya].E6.sheetId);return excelOnlineCalc.util.success(null)};
this.getSheetName=(Z,ua)=>{if(!this.Ue.lb(this.currentStateId)||!this.Ue.na(this.currentStateId).Gj)return ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua);Z=this.Ue.na(this.currentStateId).Gj;for(let ya=1;ya<Z.length;ya++)if(B.a.equals(Z[ya].E6.sheetId,ua,!0))return excelOnlineCalc.util.success(Z[ya].E6.sheetName);return excelOnlineCalc.util.success(null)};this.getUserDefinedFuncLoc=()=>excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"]);
this.getSheetRangeIndexes=()=>excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"]);this.dzf=()=>{this.setNumberFormats()};this.Zc=()=>{c.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");this.Ue=new l.a;this.currentStateId=this.nr=-1;this.Esa="";this.Mqb=null;this.GFd=!1;this.Xn&&this.clearCache()};this.c4f=(this.Hc=ea)?ea.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.c4f;this.Ue=new l.a;this.Mqb=null;this.documentLoc=
excelOnlineCalc.location.documentLoc("",this.Hc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Lna();this.Amd=x.a.Amd()}dispose(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.aId(this.dzf);this.Hc&&this.Hc.Cl(this.Zc);this.close()}qeb(ea){if(!this.Xn)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Hc.da.za(268),!this.instantaneousSupportInformationManager))return c.ULS.sendTraceTag(537170198,
0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==ea&&(this.currentStateId=this.Hc.ea.r7a,this.currentStateId===d.a.ze&&(this.currentStateId=this.Hc.ea.Le));if(1===ea&&this.currentStateId<this.nr)return c.ULS.sendTraceTag(537170197,0,50,`CalcAsyncEngine::UpdateData() currentStateId:${this.currentStateId} < lastUpdatedStateId:${this.nr} - ignoring update`),!1;this.Ooj();0!==ea&&this.GFd||(this.etj(),this.nqj(),this.Yqj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.sme(this.dzf),
this.Hc.el(this.Zc),this.GFd=!0);this.m5i();let Z=!1;0===ea&&(Z=this.d$h());if(0!==ea||Z)this.rsj()?(this.Usj(ea),this.Tsj(),this.nr=this.currentStateId,this.QWg()):c.ULS.sendTraceTag(537170196,0,15,`CalcAsyncEngine::UpdateData() for StateId:${this.currentStateId} failed - no Sheets information`);2!==ea&&this.resumeRecalc();return!0}evalFormula(ea,Z,ua,ya){if(!this.Xn)return c.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});Z=excelOnlineCalc.calc.sheetCellLocation(null!==
ua&&void 0!==ua?ua:v.d(this.Hc.xa.oa),Z.top-1,Z.left-1);ea=this.Xn.evalFormula(this.Hc.ea.Le,ea,Z,ya);this.resumeRecalc();return ea}MSg(ea,Z,ua,ya=null){if(this.Xn&&ea){var ha=v.d(this.Hc.xa.oa),Da=ea.cell.eK-1,nb=ea.cell.dK-1,qa=Da,pa=nb,Ja=null;ya&&(Ja=excelOnlineCalc.calc.cellLocation(Da,nb),Da=ya.top-1,nb=ya.left-1,qa=ya.bottom-1,pa=ya.right-1);if(ea.cell.cu)if(ya=ea.cell.cu.HWc,ya===d.a.ze)c.ULS.sendTraceTag(537170187,0,15,`CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:${ea.cell.cu.Nd}`);
else if(ya<this.nr)c.ULS.sendTraceTag(537170185,0,50,`CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:(${Da},${nb}) - blockRevision:${ya} < lastUpdatedStateId:${this.nr}`);else if(ya<this.currentStateId)c.ULS.sendTraceTag(537170184,0,50,`CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:(${Da},${nb}) - blockRevision:${ya} < currentStateId:${this.currentStateId}`);else if(this.cEb||(this.Xn.setOnRecalcResults(ua),this.cEb=!0),this.Sag()&&!this.qeb(2))c.ULS.sendTraceTag(537170183,
0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{pa=N.gY("CalculateFormula.cell",ha,Da,nb,qa,pa);ua=[];var $a=y.g(this.Hc);qa=$a.lh;y.g(this.Hc).hb.Ti&&(qa=$a.Lf(1).lh,qa.Jma(1,1),qa.Jma(3,1));$a=null;qa?$a=N.gY("CalculateFormula.viewport",ha,qa.top-1,qa.left-1,qa.bottom-1,qa.right-1):c.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");Z=excelOnlineCalc.calc.inferredRangeFormulaEdit(pa,Z,Ja,$a);ua.push(Z);ea=
qa?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ha,Da,nb,B.a.KYb(ea.cell.text),ya,qa.top-1,qa.left-1,qa.bottom-1,qa.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ha,Da,nb,B.a.KYb(ea.cell.text),ya,"","","","");c.ULS.sendTraceTag(537170181,0,50,ea);this.Xn.editRangeFormulas(ya,ua);this.resumeRecalc()}else c.ULS.sendTraceTag(537170186,
0,15,`CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:(${ea.cell.eK},${ea.cell.dK})`)}else c.ULS.sendTraceTag(537170188,0,15,`CalcAsyncEngine::CalculateFormula() recalc engine is null:${!this.Xn}, modifiedCell is null:${!ea}`)}KSg(ea,Z,ua,ya=null){const ha=v.d(this.Hc.xa.oa);let Da=ea.cell.eK-1,nb=ea.cell.dK-1;var qa=Da,pa=nb;let Ja=null;ya&&(Ja=excelOnlineCalc.calc.cellLocation(Da,nb),Da=ya.top-1,nb=ya.left-1,qa=ya.bottom-1,pa=ya.right-1);ua=this.xYd(ea,ua,"SetCell");0>ua||(pa=
N.gY("CalculateFormula.cell",ha,Da,nb,qa,pa),qa=[],ya=this.Efd(ha),Z=excelOnlineCalc.calc.inferredRangeFormulaEdit(pa,Z,Ja,ya),qa.push(Z),ea=(Z=this.y2e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ha,Da,nb,B.a.KYb(ea.cell.text),ua,Z.top-1,Z.left-1,Z.bottom-1,Z.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ha,Da,nb,
B.a.KYb(ea.cell.text),ua,"","","",""),c.ULS.sendTraceTag(537170180,0,50,ea),this.Xn.editRangeFormulas(ua,qa),this.resumeRecalc())}msb(ea,Z,ua,ya){if(!this.Xn)return c.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");if(!ua||!Z)return c.ULS.sendTraceTag(524120779,0,15,`CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: ${!ua}, outputColumnRange null: ${!Z}`),Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");
c.ULS.shipAssertTag(537170178,0,ua.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");const ha=v.d(this.Hc.xa.oa),Da=this.Efd(ha);var nb=null;if(ea){nb=[];for(const pa of ea)if(pa.column!==ua.left){ea=pa.row-1;var qa=pa.column-1;ea=N.gY("EvalFormulaRangeOnClone.cell",ha,ea,qa,ea,qa);qa=pa.text;nb.push(excelOnlineCalc.calc.rangeWrite(ea,excelOnlineCalc.calc.valueCellData(qa,qa,pa.Ek,null)))}}ua=excelOnlineCalc.calc.cellLocation(ua.top-1,ua.left-1);Z=N.gY("EvalFormulaRangeOnClone.outputColumnRange",
ha,Z.top-1,Z.left-1,Z.bottom-1,Z.right-1);ya=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(Z,ya,ua,Da)];nb=this.Xn.evalOnClonedModel(nb,ya);this.resumeRecalc();return nb}PDe(ea){let Z=null;try{if(ea)if(this.Esa=y.g(this.Hc).Ea.nua(ea),this.currentStateId=ea.fSa,this.currentStateId<this.nr||this.currentStateId===d.a.ze)c.ULS.sendTraceTag(537170176,0,50,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:${this.Esa} blockRevision:${this.currentStateId} < lastUpdatedStateId:${this.nr}`);else{if(this.i$h(),
!this.NNg())if(Z=this.Hc.Hb.xc("ModelUpdate",`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:${this.Esa} StateId:${this.currentStateId}`),this.Mqb=this.lvb(ea.oa.sheetName),!this.Mqb){const Da=!!(this.Hc.Bd&32),nb=this.Ue.lb(this.currentStateId)&&this.Ue.na(this.currentStateId).Gj?this.Ue.na(this.currentStateId).Gj.length:0;c.ULS.sendTraceTag(537170147,0,15,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets ${nb}, scratchPad:${Da}, sheetNameLength:${ea.oa.sheetName?
ea.oa.sheetName.length:-1} Hash:${ea.oa.hash}`)}else if(y.g(this.Hc).Ea.sm.Q0a(ea.Nd)){var ua=ea.sf;if(ua){var ya=ua.getCalcBlockModel();if(!ya)c.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.FNg(ya)){this.Ue.na(this.currentStateId).DZa[this.Esa]=new K(ya,ea.oa.sheetName);var ha=ea.he;ha?this.dBg(ha.NamedObjects):c.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else c.ULS.sendTraceTag(537170146,
0,15,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:${this.Esa}`)}}else c.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{Z&&Z.stop()}}I3a(ea){if(!this.Ue.na(this.currentStateId).Gj||!this.Ue.na(this.currentStateId).Gj[0])return null;var Z=this.Ue.na(this.currentStateId).Gj[0].f5;if(!Z||!Z.lb(ea.name))return null;ea=Z.na(ea.name);if(!ea||!ea.AE)return null;Z=new e.a;for(let ua of ea.AE.P9)Z.add(ua.value);
return Z}LSg(ea,Z,ua){var ya=y.g(this.Hc),ha=ya.Xb(Z);ha=this.xYd(ha,null,"CopyPaste");ua=this.xYd(ya.Xb(ea),ua,"CopyPaste");if(0>ha||0>ua||ha!==ua)c.ULS.sendTraceTag(537170143,0,15,`CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:${ua}, targetRevision:${ha}.`);else{ua=[];ya=v.d(this.Hc.xa.oa);var Da=this.Efd(ya);ea=N.gY("CalculateFormulaForCopyPaste.srcRange",ya,ea.top-1,ea.left-1,ea.bottom-1,ea.right-1);Z=N.gY("CalculateFormulaForCopyPaste.targetRange",ya,Z.top-
1,Z.left-1,Z.bottom-1,Z.right-1);Z=excelOnlineCalc.calc.copyPasteRangePasteEdit(Z,ea,Da);ua.push(Z);Z=Da?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",ya,ha,Da.row,Da.column,Da.lastRow,Da.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",ya,ha,"","","","");c.ULS.sendTraceTag(537170142,0,50,Z);this.Xn.editRangePaste(ha,ua);this.resumeRecalc()}}Efd(ea){const Z=
this.y2e();let ua=null;Z?ua=N.gY("GetViewport.viewport",ea,Z.top-1,Z.left-1,Z.bottom-1,Z.right-1):c.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return ua}y2e(){const ea=y.g(this.Hc);let Z=ea.lh;if(y.g(this.Hc).hb.Ti){Z=ea.Lf(1).lh;if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!Z)return c.ULS.sendTraceTag(537170140,0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),
null;Z.Jma(1,1);Z.Jma(3,1)}return Z}xYd(ea,Z,ua){let ya;if(!this.Xn||!ea)return c.ULS.sendTraceTag(537170139,0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:${!this.Xn}, modifiedCell is null:${!ea}, operation:${ua}`),-1;const ha=ea.cell.eK-1,Da=ea.cell.dK-1;if(ea.cell.cu){if(ya=ea.cell.cu.HWc,ya===d.a.ze)return c.ULS.sendTraceTag(537170138,0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:${ea.cell.cu.Nd}, operation:${ua}`),-1}else return c.ULS.sendTraceTag(537170137,
0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:(${ea.cell.eK},${ea.cell.dK}), operation:${ua}`),-1;if(ya<this.nr)return c.ULS.sendTraceTag(537170136,0,50,`CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:(${ha},${Da}) - blockRevision:${ya} < lastUpdatedStateId:${this.nr}, operation:${ua}`),-1;if(ya<this.currentStateId)return c.ULS.sendTraceTag(537170135,0,50,`CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:(${ha},${Da}) - blockRevision:${ya} < currentStateId:${this.currentStateId}, operation:${ua}`),
-1;Z&&!this.cEb&&(this.Xn.setOnRecalcResults(Z),this.cEb=!0);return this.Sag()&&!this.qeb(2)?(c.ULS.sendTraceTag(537170134,0,15,`CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:${ua}`),-1):ya}getFormulaBarText(ea,Z,ua){return Z&&Z.startsWith("'")?Z:ea.cell.formulaBarText||ua.toString()}p8g(ea,Z,ua){let ya=null;if(this.Rue()&&this.Ue.na(this.nr).DZa){const ha=this.Ue.na(this.nr).DZa[ea];if(null===ha||void 0===ha?0:ha.Otc)ya=ha.gue}ua=this.Ydi(ya,Z,ua);Z=this.o_g(ya,Z,ua);
c.ULS.sendTraceTag(50671754,0,50,`CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:${ea} StateId:${this.currentStateId} number of formulas ${Z}`)}Ydi(ea,Z,ua){let ya=!1;const ha=N.DVe(Z);if(ea){const Da=N.DVe(ea);B.a.equals(Da,ha,!1)&&(ya=!0)}ya?this.IBg(ea,this.nr,ua):this.KBg(Z,ua);return ya}Rue(){let ea=!1;this.Xn&&-1!==this.nr&&(ea=this.Xn.stateIdAvailable(this.nr));return ea&&this.Ue.lb(this.nr)&&this.nr<this.currentStateId}o_g(ea,Z,ua){let ya;ya=0;let ha,Da;for(Z.reset();ha=
Z.getNextCell();)A.f(ha.formula)&&ya++,(Da=ua?ea.getCell(ha.row,ha.col):null)?this.k_g(Z,ha,Da):this.JBg(Z,ha);if(ua)for(ea.reset();Da=ea.getNextCell();)(ha=Z.getCell(Da.row,Da.col))||this.Ike(ea,Da);return ya}Yqj(){this.Xn.setOnUpdateRequest(()=>{})}Xqj(){this.Xn.setOnUnresponsive((ea,Z,ua,ya)=>{this.CSi(ea,Z,ua,ya)})}CSi(ea,Z,ua,ya){c.ULS.sendTraceTag(537170126,0,15,`CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:${ea}, waitTime:${Z}, timeoutCount:${ua}, hasBeenClosed:${ya}.`);
ya&&(this.Efj(),this.Lna())}Efj(){this.Zc(null,null);this.gsd=this.cEb=!1;this.ADd=0;this.rDd=this.tDd=this.uDd=this.sDd=-1}close(){this.Xn.close()}clearCache(){this.Xn.clearCache()}resumeRecalc(){this.Xn.resumeRecalc()}nqj(){this.Xn.setA1ReferenceStyle(!0)}m5i(){if(this.instantaneousSupportInformationManager){var ea=this.instantaneousSupportInformationManager.obi;const ua=this.instantaneousSupportInformationManager.rbi,ya=this.instantaneousSupportInformationManager.qbi,ha=this.instantaneousSupportInformationManager.pbi;
var Z=!1;ea!==this.sDd&&(Z=!0,this.sDd=ea);ua!==this.uDd&&(Z=!0,this.uDd=ua);ya!==this.tDd&&(Z=!0,this.tDd=ya);ha!==this.rDd&&(Z=!0,this.rDd=ha);const Da=[];u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(Z=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),Da.push(Z),Z=!0);u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Z=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),Da.push(Z),Z=!0);u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",
!1)&&(Z=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),Da.push(Z),Z=!0);Z&&(ea=excelOnlineCalc.calc.recalcServiceConfig(null,ea,null,ua,null,null,null,ya,Da,ha),this.Xn.reconfigure(ea))}}Usj(ea){let Z=null;if(this.Ue.lb(this.currentStateId))try{this.g$=[],Z=this.Hc.Hb.xc("ModelUpdate",`CalcAsyncEngine::SetUpdatedRanges() StateId:${this.currentStateId} UpdateTriggerData:${F[ea]}`),f.a.forEach(this.Ue.na(this.currentStateId).DZa,(ua,ya)=>{ya.Otc||(this.p8g(ua,ya.gue,ya.sheetName),
ya.Otc=!0)},null),this.Xn.updateRanges(this.currentStateId,this.g$)}finally{Z&&Z.stop()}else c.ULS.sendTraceTag(537170122,0,15,`CalcAsyncEngine::SetUpdatedRanges StateId:${this.currentStateId} does not exist in GridCache`)}Tsj(){const ea=[],Z=this.Rue();var ua=Z&&this.Ue.na(this.nr).Gj&&this.Ue.na(this.nr).Gj[0]&&this.Ue.na(this.nr).Gj[0].Zjc?this.Ue.na(this.nr).Gj[0].f5:null;this.Aze(ua,this.Ue.na(this.currentStateId).Gj[0].f5,null,this.nr,ea);this.Ue.na(this.currentStateId).Gj[0].Zjc=!0;for(let ya=
1;ya<this.Ue.na(this.currentStateId).Gj.length;ya++)ua=-1,Z&&this.Ue.na(this.nr).Gj&&(ua=this.Oed(this.Ue.na(this.currentStateId).Gj[ya].E6.sheetName,this.nr)),ua=-1!==ua&&this.Ue.na(this.nr).Gj[ua].Zjc?this.Ue.na(this.nr).Gj[ua].f5:null,this.Aze(ua,this.Ue.na(this.currentStateId).Gj[ya].f5,this.Ue.na(this.currentStateId).Gj[ya].E6.sheetId,this.nr,ea),this.Ue.na(this.currentStateId).Gj[ya].Zjc=!0;this.Xn.updateNamedObjects(this.currentStateId,ea)}Aze(ea,Z,ua,ya,ha){if(void 0!==ua&&null!==ua){var Da=
excelOnlineCalc.calc.undefinedNamesWrite(ua);ha.push(Da)}if(ea){var nb=!1;Da=[];var qa=[];if(Z)for(let Ja of Z){const $a=Ja.value;if(ea.lb(Ja.key)){var pa=ea.na(Ja.key);N.sCi(pa,$a)?nb=!0:(pa=excelOnlineCalc.calc.namedObject(Ja.key,null),Da.push(pa),N.MSc(Ja.key,$a,qa))}else N.MSc(Ja.key,$a,qa)}for(let Ja of ea)Z&&Z.lb(Ja.key)||(ea=excelOnlineCalc.calc.namedObject(Ja.key,null),Da.push(ea));nb&&(Z=excelOnlineCalc.calc.namedObjectsPromote(ua,ya),ha.push(Z));0<Da.length&&(Z=excelOnlineCalc.calc.namedObjectsWrite(ua,
Da),ha.push(Z));0<qa.length&&(ua=excelOnlineCalc.calc.namedObjectsWrite(ua,qa),ha.push(ua))}else if(Z){ya=[];for(qa of Z)N.MSc(qa.key,qa.value,ya);0<ya.length&&(ua=excelOnlineCalc.calc.namedObjectsWrite(ua,ya),ha.push(ua))}}NNg(){return this.Ue.na(this.currentStateId).DZa[this.Esa]?(c.ULS.sendTraceTag(537170121,0,50,`CalcAsyncEngine::BlockPreviouslyHandled Block Hash:${this.Esa} StateId:${this.currentStateId} previously handled`),!0):!1}FNg(ea){return 1===ea.getColumnNumbers().length&&ea.getColumnNumbers()[0]===
N.Aud+1?!1:!0}d$h(){let ea=!1;y.g(this.Hc).Ea.L$c(Z=>{Z.state&1&&this.Hc.ea.Le===Z.se.Revision&&(this.PDe(Z),ea=!0)});return ea}JBe(ea,Z){var ua=ea.getRowNumbers(),ya=ea.getColumnNumbers();ea=ua[0]-1;ua=ua[ua.length-1]-1;const ha=ya[0]-1;ya=ya[ya.length-1]-1;Z=this.lvb(Z);if(!Z){const Da=this.Ue.lb(this.currentStateId)&&this.Ue.na(this.currentStateId).Gj?this.Ue.na(this.currentStateId).Gj.length:0;c.ULS.sendTraceTag(537170120,0,15,`CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets ${Da}`)}return N.gY("CreateBlockRangeLocation",
Z,ea,ha,ua,ya)}IBg(ea,Z,ua){if(ua=this.JBe(ea,ua)){var ya=N.Q2b(ea.getRowNumbers());ea=N.Q2b(ea.getColumnNumbers());Z=excelOnlineCalc.calc.rangePromote(ua,Z,ya,ea);this.g$[this.g$.length]=Z}}KBg(ea,Z){if(Z=this.JBe(ea,Z)){var ua=N.Q2b(ea.getRowNumbers());ea=N.Q2b(ea.getColumnNumbers());ea=excelOnlineCalc.calc.rangeWrite(Z,null,ua,ea);this.g$[this.g$.length]=ea}}k_g(ea,Z,ua){let ya=null,ha=0,Da=0;switch(Z.valueType){case 2:ya=this.Bfd(Z);var nb=this.Bfd(ua);nb=B.a.equals(nb,ya,!1);break;case 1:null===
Z.value&&null===ua.value?nb=!0:(ha=parseFloat(Z.value),nb=parseFloat(ua.value)===ha);break;default:null===Z.value&&null===ua.value?nb=!0:(Da=parseFloat(Z.value),nb=Da===parseFloat(ua.value))}nb&&Z.valueType===ua.valueType&&Z.ifmt===ua.ifmt&&Z.formulaType===ua.formulaType&&B.a.equals(ua.formula,Z.formula,!1)||(void 0!==Z.formula&&null!==Z.formula||void 0!==Z.value&&null!==Z.value||void 0!==Z.text&&null!==Z.text?this.sXb(ea,Z,ya,ha,Da):this.Ike(ea,Z))}dBg(ea){if(this.Hc.yb&&this.Hc.yb.items)for(let Da=
0;Da<this.Hc.yb.count;Da++){var Z=this.Hc.yb.items[Da];if(2!==Z.type&&3!==Z.type)continue;var ua=0,ya=Z.name,ha=ya.lastIndexOf("!");if(0<ha){ua=ya.substr(0,ha);"'"===ua.charAt(0)&&(ua=ua.substr(1,ua.length-2));ua=this.Oed(ua,this.currentStateId);if(-1===ua){Z=this.Ue.lb(this.currentStateId)&&this.Ue.na(this.currentStateId).Gj?this.Ue.na(this.currentStateId).Gj.length:0;c.ULS.sendTraceTag(595096334,0,50,`CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets ${Z}`);
continue}ya=ya.substr(ha+1)}ua=this.Ue.na(this.currentStateId).Gj[ua].f5;let nb=Z.usedRange;2===Z.type&&(nb=w.a(Z));if(ua.lb(ya)){if(ha=ua.na(ya),ha.range=nb,ha.attributes=Z.attributes,2===ha.type&&(ya=N.HRe(Z.name,ea),Z=(ua=u.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?Z.kO:null===ya||void 0===ya?void 0:ya.ColHeadersList,ya||ua))if(!ha.AE)ha.AE=new r(Z);else if(Z)for(const qa of Z.HeadersList)ha.AE.P9.ia(qa.Index,qa.Name)}else if(ha=this.lvb(Z.sheetName)){ha=
new G(Z.type,Z.name,nb,ha,Z.attributes);if(2===ha.type)if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&Z.kO)ha.AE=new r(Z.kO);else if(Z=N.HRe(Z.name,ea))ha.AE=new r(Z.ColHeadersList);ua.ia(ya,ha)}else Z=this.Ue.lb(this.currentStateId)&&this.Ue.na(this.currentStateId).Gj?this.Ue.na(this.currentStateId).Gj.length:0,c.ULS.sendTraceTag(537170117,0,50,`CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets ${Z}`)}}sXb(ea,Z,ua,ya,ha){var Da=
ea.getRowNumbers()[Z.row]-1;ea=ea.getColumnNumbers()[Z.col]-1;Da=N.gY("AddRangeUpdateCommand",this.Mqb,Da,ea,Da,ea);ea=null;let nb=Z.formula||Z.text;const qa=excelOnlineCalc.calc.blankValue;let pa=null;void 0!==Z.text&&null!==Z.text||void 0!==Z.value&&null!==Z.value||(ua="",pa="This cell contains blanks only",0===Z.formulaType&&(nb=""));switch(Z.valueType){case 2:null!==ua&&(0===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData(nb,ua,Z.ifmt,pa)),1===Z.formulaType&&(ea=excelOnlineCalc.calc.cellFormulaCellData(nb,
ua,Z.ifmt,pa)),2===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData("",qa,0,"This cell is a part of an array")));break;case 1:isNaN(ya)?c.ULS.sendTraceTag(537170116,0,50,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${Z.row},${Z.col}) invalid numeric value`):(0===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData(nb,ya,Z.ifmt,null)),1===Z.formulaType&&(ea=excelOnlineCalc.calc.cellFormulaCellData(nb,ya,Z.ifmt,null)),2===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData("",qa,0,"This cell is a part of an array")));
break;case 3:isNaN(ha)?c.ULS.sendTraceTag(537170115,0,15,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${Z.row},${Z.col}) invalid boolean value`):(ua=1===ha?!0:!1,0===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData(nb,ua,Z.ifmt,null)),1===Z.formulaType&&(ea=excelOnlineCalc.calc.cellFormulaCellData(nb,ua,Z.ifmt,null)),2===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData("",qa,0,"This cell is a part of an array")));break;case 4:isNaN(ha)?c.ULS.sendTraceTag(537170114,0,15,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${Z.row},${Z.col}) invalid error value`):
(ua=excelOnlineCalc.calc.errorValue(ha),0===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData(nb,ua,Z.ifmt,null)),1===Z.formulaType&&(ea=excelOnlineCalc.calc.cellFormulaCellData(nb,ua,Z.ifmt,null)),2===Z.formulaType&&(ea=excelOnlineCalc.calc.valueCellData("",qa,0,"This cell is a part of an array")));break;default:ea=excelOnlineCalc.calc.valueCellData("",qa,Z.ifmt,null)}ea&&(Z=excelOnlineCalc.calc.rangeWrite(Da,ea,null,null),this.g$[this.g$.length]=Z)}JBg(ea,Z){switch(Z.valueType){case 2:this.sXb(ea,
Z,this.Bfd(Z),null,0);break;case 1:this.sXb(ea,Z,null,parseFloat(Z.value),0);break;default:this.sXb(ea,Z,null,null,parseFloat(Z.value))}}Ike(ea,Z){var ua=ea.getRowNumbers()[Z.row]-1;ea=ea.getColumnNumbers()[Z.col]-1;ua=N.gY("AddRangeUpdateCommandEmptyCell",this.Mqb,ua,ea,ua,ea);Z=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,Z.ifmt,null);Z=excelOnlineCalc.calc.rangeWrite(ua,Z,null,null);this.g$[this.g$.length]=Z}lvb(ea){ea=this.Oed(ea,this.currentStateId);return 0<ea?this.Ue.na(this.currentStateId).Gj[ea].E6.sheetId:
null}Oed(ea,Z){if(!this.Ue.lb(Z))return c.ULS.sendTraceTag(537170113,0,15,`CalcAsyncEngine.GetSheetInternalIndex StateId:${Z} does not exist in GridCache`),-1;const ua=this.Ue.na(Z);return ua.Gj?ua.getSheetIndex(ea):(c.ULS.sendTraceTag(537170112,0,15,`CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:${Z}`),-1)}rsj(){if(!this.Ue.lb(this.currentStateId)||!this.Ue.na(this.currentStateId).Gj.length)return c.ULS.sendTraceTag(537170083,0,15,`CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:${this.currentStateId} or StateId does not exist in GridCache`),
!1;const ea=[];for(let Z=1;Z<this.Ue.na(this.currentStateId).Gj.length;Z++){const ua=this.Ue.na(this.currentStateId).Gj[Z];ua&&ea.push(ua.E6)}this.Xn.updateSheetNames(this.currentStateId,ea);this.Xn.updateUnusedCells(this.currentStateId,this.Ue.na(this.currentStateId).fbg);return!0}setNumberFormats(){if(this.instantaneousSupportInformationManager){var ea=[];for(const Z of this.instantaneousSupportInformationManager.Gxa){const ua=excelOnlineCalc.calc.numberFormat(Z.IfmtIndex,Z.FormatString,Z.Builtin);
ea.push(ua)}this.Xn.setNumberFormats(ea,!0)}}Ooj(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.De){var ea=this.g$h();if(!this.gsd||ea)this.P2b(),this.instantaneousSupportInformationManager.De.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.De.TrueValueString),this.instantaneousSupportInformationManager.De.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.De.FalseValueString),ea=H.CalcHelper.FCe(this.instantaneousSupportInformationManager,
ea),this.Xn.setLocale(ea),this.gsd=!0}}etj(){var ea=null;if(void 0!==this.Hc.workbookContext.TimeZoneInformation&&null!==this.Hc.workbookContext.TimeZoneInformation){ea=null;this.Hc.workbookContext.TimeZoneInformation.StandardDate.Month&&(ea=excelOnlineCalc.date.dateTime(this.Hc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Hc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Hc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Hc.workbookContext.TimeZoneInformation.StandardDate.Hour,
this.Hc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Hc.workbookContext.TimeZoneInformation.StandardDate.Second,this.Hc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Hc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));let Z=null;this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(Z=excelOnlineCalc.date.dateTime(this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Month,
this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Hour,this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Hc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Hc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));ea=excelOnlineCalc.date.tzData(this.Hc.workbookContext.TimeZoneInformation.Bias,ea,this.Hc.workbookContext.TimeZoneInformation.StandardBias,
Z,this.Hc.workbookContext.TimeZoneInformation.DaylightBias)}else c.ULS.sendTraceTag(537170082,0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");ea=excelOnlineCalc.calc.workbookProps(this.Hc.workbookContext.F1904,this.Hc.workbookContext.FDateCompatibility,ea);this.Xn.setWorkbookProps(ea)}Lna(){u.EwaSettings.ma(305)&&m.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.c4f,!0)).continueWith(ya=>{ya.exception?c.ULS.sendTraceTag(537170079,0,15,`CalcAsyncEngine.TryInitialize: calc smoke test failed: ${ya.exception.toString()}`):
c.ULS.sendTraceTag(537170080,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});const ea=u.EwaSettings.ma(651)?n.local:n.eIj,[Z,ua]=x.a.TU()?[excelOnlineCalc.x10.PluginSchedulerSingleton.instance(),excelOnlineCalc.x10.GridImportManagerSingleton.instance()]:[void 0,void 0];this.HFd=m.c(excelOnlineCalc.calc.createRecalcService(ea,Z,ua));this.HFd.continueWith(ya=>{ya.exception?c.ULS.sendTraceTag(537170075,0,50,`CalcAsyncEngine.TryInitialize: Calc web worker failed: ${ya.exception.toString()}`):
(c.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),(this.Xn=this.HFd.result)?this.qeb(0)?this.Xqj():c.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):c.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})}g$h(){const ea=this.instantaneousSupportInformationManager.xia;if(!ea||this.ADd===ea.length)return null;this.ADd=ea.length;return H.CalcHelper.qCe(ea)}P2b(){this.errorTypeNames=
H.CalcHelper.P2b()}i$h(){if(!(this.Ue.lb(this.currentStateId)&&0<this.Ue.na(this.currentStateId).Gj.length)){this.Ue.ia(this.currentStateId,new T(this.Amd));this.Ue.na(this.currentStateId).SZf(0,new E(null));var ea=this.Hc.xa;for(let ya=0;ya<ea.count;ya++){var Z=Object(k.a)(z.a,ea.getItem(ya));if(Z){void 0!==Z.sheetId&&null!==Z.sheetId&&void 0!==Z.name&&null!==Z.name&&Z.sheetId.length&&Z.sheetName.length||c.ULS.sendTraceTag(537170074,0,15,`CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:${ya} Id:${Z.sheetId} Hash:${Z.hash} NameLength:${Z.name?
Z.name.length:-1}`);var ua=void 0;ua=excelOnlineCalc.calc.sheetName(Z.sheetId,Z.name);this.Ue.na(this.currentStateId).SZf(ya+1,new E(ua));ua=Z.usedRange.VR();ua=excelOnlineCalc.calc.rangeLocation(0,0,ua.LastRow,ua.LastColumn);Z=excelOnlineCalc.calc.unusedCellsUpdate(Z.sheetId,ua);this.Ue.na(this.currentStateId).fbg.push(Z)}else c.ULS.sendTraceTag(537170073,0,15,`CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:${this.currentStateId} sheet-index:${ya}`)}}}QWg(){for(let ea of this.Ue)ea.key<
this.nr&&this.Ue.remove(ea.key)}Bfd(ea){ea=ea.value||ea.text;if(void 0===ea||null===ea)ea="";return ea}Sag(){if(!this.Ue.lb(this.currentStateId))return!1;let ea=!1;f.a.forEach(this.Ue.na(this.currentStateId).DZa,(Z,ua)=>{ua.Otc||(ea=!0)},null);return ea}l2c(ea){const Z={};Z.reason=ea;Z.kind=1;return Z}qfc(){return this.Ue.lb(this.currentStateId)&&this.Ue.na(this.currentStateId).Gj&&this.Ue.na(this.currentStateId).Gj[0]&&this.Ue.na(this.currentStateId).Gj[0].f5?!0:!1}static s4g(ea){const Z=[];if(null===
ea||void 0===ea?0:ea.P9)for(let ua of ea.P9)ea=excelOnlineCalc.calc.columnData(ua.key,ua.value),Z.push(ea);return Z}static sCi(ea,Z){if(ea.type!==Z.type||ea.attributes!==Z.attributes||!B.a.equals(ea.fullName,Z.fullName,!1)||!ea.range.equals(Z.range))return!1;if(!ea.AE&&!Z.AE)return!0;if(!ea.AE||!Z.AE||ea.AE.P9.count!==Z.AE.P9.count)return!1;for(let ua of ea.AE.P9){let ya;if(!(ua.value&&({value:ya}=Z.AE.P9.Cc(ua.key)).returnValue&&ya&&B.a.equals(ua.value,ya,!1)))return!1}return!0}static MSc(ea,Z,ua){var ya=
N.gY("NamedObject",Z.sheetId,Z.range.top-1,Z.range.left-1,Z.range.bottom-1,Z.range.right-1);if(2===Z.type){const ha=!!(Z.attributes&16),Da=!!(Z.attributes&8);Z=N.s4g(Z.AE);ya=excelOnlineCalc.calc.namedTableData(ya,ha,Da,Z);ea=excelOnlineCalc.calc.namedObject(ea,ya)}else ya=excelOnlineCalc.calc.namedRangeData(ya),ea=excelOnlineCalc.calc.namedObject(ea,ya);ua.push(ea)}static DVe(ea){const Z=Sys.Serialization.JavaScriptSerializer.serialize(ea.getRowNumbers());ea=Sys.Serialization.JavaScriptSerializer.serialize(ea.getColumnNumbers());
return Z+ea}static Q2b(ea){let Z=null;if(1<ea.length)for(let ua=1;ua<ea.length;ua++){let ya=0;for(;ea[ua-1]+1+ya<ea[ua];)Z=Z||[],Z.push(ea[ua-1]+ya),ya++}return Z}static HRe(ea,Z){if(!Z)return null;for(let ua=0,ya=Z.length;ua<ya;++ua)if(B.a.equals(ea,Z[ua].Name,!1))return Z[ua];return null}static gY(ea,Z,ua,ya,ha,Da){const nb=(qa,pa,Ja,$a)=>{(0>Ja||Ja>=$a)&&c.ULS.sendTraceTag(537170072,0,15,`CalcAsyncEngine::CreateSheetRangeLocation() callerId:${qa} invalid ${pa}:${Ja}`)};void 0!==Z&&null!==Z||c.ULS.sendTraceTag(537170071,
0,15,`CalcAsyncEngine::CreateSheetRangeLocation() callerId:${ea} sheetId is null`);nb(ea,"top",ua,N.vof);nb(ea,"left",ya,N.Aud);nb(ea,"bottom",ha,N.vof);nb(ea,"right",Da,N.Aud);return excelOnlineCalc.calc.sheetRangeLocation(Z,ua,ya,ha,Da)}}N.vof=1048576;N.Aud=16384;Object(t.a)(N,"CalcAsyncEngine",null,[3]);class J{constructor(){this.fK=this.gK=this.oF=this.pF=this.uZ=!1}}Object(t.a)(J,"AbsoluteRelativeReferenceInfo",null,[]);var R=a(974),M=a(24);class L{}L.FGf="#";Object(t.a)(L,"Operators",null,[]);
var U=a(975);class X{}X.sheet="Sheet";X.sheetRange="SheetRange";X.document="Document";X.R6h="Ident";Object(t.a)(X,"TraverseFormulaQualifierTypes",null,[]);var da=a(976),fa=a(869),S=a(786),ka=a(42),V=a(55),wa=a(63),ma=a(454),ab=a(38);class ba extends Sys.EventArgs{constructor(ea){super();this.Bk=ea}}Object(t.a)(ba,"EditedCellRecalcCompleteEventArgs",Sys.EventArgs,[]);class Ca extends ab.a{constructor(ea){super();this.Rs=null;this.rfg=!1;this.dKd=this.instantaneousSupportInformationManager=this.$Eb=
null;this.exd=new Map;this.Iae=null;this.Xlc=Z=>{c.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");Z.aId(this.Xlc);Z.xia.length?this.Dlc(Z,Sys.EventArgs.Empty):(c.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),Z.Xle(this.Dlc))};this.Dlc=Z=>{c.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");Z.SHd(this.Dlc);this.KMj(Z)};this.onContentReady=()=>{this.Rs&&(this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.okd||V.Task.delay(0).continueWith(()=>{this.Rs.qeb(1)},0,null,wa.a.current))};this.qtf=(Z,ua)=>{this.Rs&&(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.okd||this.Rs.PDe(ua.gd.block))};c.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.Tdc=!1;this.jb=ea;this.$p=y.g(ea);this.eEc=null;this.gridView.Nu(this.onContentReady);this.gridView.Ea.lTc(this.qtf);this.$.da.Za(268,Z=>{Z.De?(c.ULS.sendTraceTag(537170066,
0,50,"CalcManager.ctor: LocaleInformation already available..."),this.Xlc(Z,Sys.EventArgs.Empty)):(c.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),Z.sme(this.Xlc))})}WDg(ea){this.addHandler(Ca.f6c,ea)}jaj(ea){this.removeHandler(Ca.f6c,ea)}jrf(ea){this.raiseEvent(Ca.f6c,new ba(ea))}get Jr(){return this.eEc}get gridView(){return this.$p}get $(){return this.jb}get jD(){return this.Iae}get localeInfo(){return this.Jr?this.Jr.config.localeInfo:null}get config(){return this.Jr.config}dispose(){c.ULS.sendTraceTag(537170064,
0,50,"CalcManager.Dispose called");this.$.da.Za(268,ea=>{ea.aId(this.Xlc);ea.SHd(this.Dlc)});this.gridView&&(this.gridView.qy(this.onContentReady),this.gridView.Ea&&this.gridView.Ea.MOf(this.qtf),this.$p=null);this.eEc=null}NSg(ea,Z,ua,ya=null){this.Rs&&(u.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.Rs.KSg(ea,Z,ua,ya):this.Rs.MSg(ea,Z,ua,ya))}evalFormula(ea,Z,ua,ya){return this.Rs?this.Rs.evalFormula(ea,Z,ua,ya):Promise.reject("calc engine not initialized")}msb(ea,
Z,ua,ya){return this.Rs?this.Rs.msb(ea,Z,ua,ya):Promise.reject("CalcEngine is null")}I3a(ea){return this.Rs?(c.ULS.shipAssertTag(537170059,0,2===ea.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.Rs.I3a(ea)):null}gIg(ea,Z){if(!Z||2!==ea.type)return!1;ea=w.a(ea);return ea.right-ea.left+1===Z.count}qQe(ea){if(!this.$Eb)return this.rfg||c.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var Z=this.ssa(M.Range.Tc(1,1));Z=this.$Eb.parseFormula(excelOnlineCalc.parse.parseLocals(1,
Z.range),ea);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(Z))return c.ULS.sendTraceTag(537170056,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{let ua;if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:6518739_FlightRemovalStructuredReferencesHighlighting")){const ya=this.gridView.ha.sa.activeCell,ha=excelOnlineCalc.location.gridCell(ya.top-1,ya.left-1),Da=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),nb=excelOnlineCalc.location.sheetIndex(Da,
this.$.xa.oa.sheetId),qa=this.L8g(ha,nb);this.dKd||(this.dKd=excelOnlineCalc.util.createResolver(this.K8g()));ua=excelOnlineCalc.parse.parseResultHelper.extractReferences(Z,this.Jr.config.localeInfo,u.EwaSettings.ma(588),qa,this.dKd)}else ua=excelOnlineCalc.parse.parseResultHelper.extractReferences(Z,this.Jr.config.localeInfo,u.EwaSettings.ma(588));u.EwaSettings.ma(102)&&this.mSj(ua,ea);return ua}catch(ua){return c.ULS.sendTraceTag(537170055,0,10,`CalcManager.ExtractReferenceWrappers - exception: ${ua.message}`),
null}}extractLetVariables(ea,Z){if(!this.$Eb)return this.rfg||c.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;const ua=this.ssa(M.Range.Tc(1,1));ea=this.$Eb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ua.range),ea);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ea))return c.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(ea,
Z,this.Jr.config.localeInfo)}catch(ya){return c.ULS.sendTraceTag(537170052,0,10,`CalcManager.ExtractLetVariables - exception: ${ya.message}`),null}}extractReferences(ea,Z,ua,ya){if(!Z)return c.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!ua)return c.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;const ha=this.qQe(ea);if(!ha)return c.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),
null;try{return this.J7g(ha,Z,ua,ea,ya)}catch(Da){return c.ULS.sendTraceTag(537170048,0,10,`CalcManager.ExtractReferences - exception: ${Da.message}`),null}}lXh(ea,Z,ua,ya){if(!ea)return c.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!Z||0>=Z.length)return c.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;ea=this.ssa(ea);if(!this.Jr||!ea)return null;
const ha=this.Stb(ea).returnValue;if(!ha||ha.u5a)return null;ua=excelOnline.utils.getCharIndexInTextFromPoint(ua,ya,u.EwaSettings.ma(588));return 0>ua?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Jr.config,ua,Z,ea)}ASg(ea,Z,ua,ya){if(!ea)return c.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;let ha=null;return this.evalFormula(Z,ea,void 0,excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(Da=>{let nb;const qa=({kind:nb}=
this.Jr.plh(Da,ua)).returnValue;8!==nb||qa.length&&qa!==H.CalcHelper.unknownError?Da=0:(c.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),Da=excelOnlineCalc.calc.getEvalFailureReason(Da),void 0!==Da&&null!==Da||c.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),Da=1);return ha=ya?new R.a(qa,ya.start,ya.end,Da):new R.a(qa,-1,-1,Da)},Da=>{c.ULS.sendTraceTag(537170014,
0,10,`EvalSession.GetPartialResultValueForFormula - exception: ${Da}`);return Promise.resolve(ha)})}getSubExpressionSpan(ea){return this.Jr&&ea?excelOnlineCalc.runtime.getSubExpressionSpan(ea):null}getFormulaSubExpressionObject(ea,Z,ua){return this.Jr&&ea&&Z&&ua?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Jr.config,Z,ua,this.ssa(ea)):null}oXh(ea,Z,ua){return this.Jr&&ea&&Z?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Jr.config,Z,ua,this.ssa(ea)):null}mXh(ea,Z,ua){return this.Jr&&
ea&&Z?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Jr.config.localeInfo,Z,ua):null}qQh(){return this.Jr?this.Jr.config.localeInfo.listSeparator:null}isFormulaSubExpressionVolatile(ea){return this.Jr?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Jr.config.localeInfo,ea):!1}ssa(ea,Z=!0){return ea&&this.Jr?this.Jr.i9g(this.Jr.Z$g(),ea.top-1,ea.left-1,Z):null}ahi(ea,Z){ea=this.T$b(ea);if(void 0===ea||null===ea)return null;ea=this.jD.createFormat(ea.FormatString,ea.Builtin);if(!excelOnlineCalc.util.isSuccess(ea))return null;
Z=this.jD.parseEdit(Z,ea.value);return excelOnlineCalc.util.isSuccess(Z)?Z.value.kind===fa.a.formula:null}R$b(ea){if(null==this.jD)return Object(ma.a)("Number formatter is null");if(null==this.instantaneousSupportInformationManager)return Object(ma.a)("Instantaneous manager is null");if(this.exd.has(ea))return Object(ma.d)(this.exd.get(ea));if("number"===typeof ea){var Z=this.T$b(ea);if(null==Z)return Object(ma.a)(`Invalid ifmt=${ea}`);var ua=Z.FormatString;Z=Z.Builtin}else ua=ea,Z=!1;ua=this.jD.createFormat(ua,
Z);return excelOnlineCalc.util.isSuccess(ua)?(this.exd.set(ea,ua.value),Object(ma.d)(ua.value)):Object(ma.a)("Could not create number format")}getWorksheetFuncId(ea){return this.localeInfo.getWorksheetFuncId(ea)}J7g(ea,Z,ua,ya,ha){const Da={Items:[]};for(let Ja=0;Ja<ea.length;Ja++){var nb=ea[Ja];const $a={};$a.Start=nb.span.start;$a.End=nb.span.end;if(ha||nb.kind!==U.a.func)if(ha||nb.kind!==U.a.yri){if(!this.Igh(nb,Z,ua))continue;var qa=new J;const rb=this.eUh(nb,Z,qa,ya);if(u.EwaSettings.ma(588)){var pa=
this.hQh(nb);const Pa=this.gQh(nb);if(rb||Pa&&0<=pa){let eb={};eb.Span=$a;eb.LetNumber=pa;eb.LetName=Pa;eb.Range=rb;eb.IsRangeRef=qa.uZ;eb.IsAbsoluteFirstRow=qa.pF;eb.IsAbsoluteFirstColumn=qa.oF;eb.IsAbsoluteSecondRow=qa.gK;eb.IsAbsoluteSecondColumn=qa.fK;eb.IsStructRef=nb.kind===U.a.USd;Da.Items.push(eb)}}else rb&&(pa={},pa.Span=$a,pa.Range=rb,pa.IsRangeRef=qa.uZ,pa.IsAbsoluteFirstRow=qa.pF,pa.IsAbsoluteFirstColumn=qa.oF,pa.IsAbsoluteSecondRow=qa.gK,pa.IsAbsoluteSecondColumn=qa.fK,pa.IsStructRef=
nb.kind===U.a.USd,Da.Items.push(pa))}else nb=nb.ref.value.oper.kind,qa={},qa.Span=$a,qa.IsString=2===nb,qa.IsBoolean=4===nb,qa.IsNumber=1===nb,Da.Items.push(qa);else $a.End=nb.span.start+nb.ref.name.length,nb={},nb.Span=$a,nb.IsFunction=!0,nb.FunctionId=this.getWorksheetFuncId(ya.substring($a.Start,$a.End)),Da.Items.push(nb)}Da.Items.sort((Ja,$a)=>Ja.Span.Start-$a.Span.Start);return Da}hQh(ea){return ea.kind===U.a.ljf?ea.ref.number:-1}gQh(ea){return ea.kind===U.a.ljf?ea.ref.name:null}eUh(ea,Z,ua,
ya){if(ea.kind===U.a.range)return ua.uZ=!0,this.IAe(ea,Z,ua,ya);if(ea.kind===U.a.namedRange){ua=ea.ref;(ea=this.$.yb.getItemByName(ua.name))||(ea=this.$.yb.getItemByName(Z+"!"+ua.name));if(!(ea&&ea.sheetName&&ea.usedRange&&B.a.equals(ea.sheetName,Z,!0)))return null;Z=2===ea.type?w.a(ea):ea.usedRange;return ka.m(Z,ea)}if(ea.kind===U.a.USd){let ha=ea.ref,Da;ha.name?(Da=this.$.yb.getItemByName(ha.name))||(Da=this.$.yb.getItemByName(Z+"!"+ha.name)):Da=this.gridView.Db.Xj(this.gridView.ha.sa.activeCell);
if(!(Da&&Da.sheetName&&Da.usedRange&&B.a.equals(Da.sheetName,Z,!0)))return null;ua.uZ=!1;return this.IAe(ea,Z,ua,ya)}return null}IAe(ea,Z,ua,ya){ea=ea.ref;if(ea.type){if(ea.type===da.a.column){var ha=ea.startIndex;ea=ea.endIndex;ua.oF=ha.kind===S.a.abs;ua.fK=ea.kind===S.a.abs;return this.createRange(0,ha.index,d.a.mh,ea.index,Z)}if(ea.type===da.a.row)return ha=ea.endIndex,ua.pF=ea.startIndex.kind===S.a.abs,ua.gK=ha.kind===S.a.abs,this.createRange(ea.startIndex.index,0,ea.endIndex.index,d.a.Ch,Z);
if(ea.type===da.a.cell){ha=ea.row;var Da=ea.col;ua.pF=ua.gK=ha.kind===S.a.abs;ua.oF=ua.fK=Da.kind===S.a.abs;return this.m0b(ea.span.end,ya)&&(ua=M.Range.Tc(ha.index+1,Da.index+1),ua=this.gridView.Db.m1e(ua))?ka.n(ua,Z):this.createRange(ha.index,Da.index,ha.index,Da.index,Z)}if(ea.type===da.a.range){ha=ea.top;Da=ea.left;ya=ea.bottom;ea=ea.right;const nb=Math.min(ha.index,ya.index),qa=Math.min(Da.index,ea.index),pa=Math.max(ha.index,ya.index),Ja=Math.max(Da.index,ea.index);ua.pF=ha.kind===S.a.abs;ua.gK=
ya.kind===S.a.abs;ua.oF=Da.kind===S.a.abs;ua.fK=ea.kind===S.a.abs;return this.createRange(nb,qa,pa,Ja,Z)}c.ULS.sendTraceTag(537170010,0,10,`CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '${ea.type}'`);return null}c.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null}m0b(ea,Z){return Z.length>=ea&&0<ea&&Z.charAt(ea-1)===L.FGf}HSg(ea,Z,ua){this.Rs&&this.Rs.LSg(ea,Z,ua)}T$b(ea){return this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.Gxa&&this.instantaneousSupportInformationManager.Gxa[ea]&&this.jD?this.instantaneousSupportInformationManager.Gxa[ea]:null}toXLNumber(ea){if(!this.jD)return null;ea=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.jD,ea);return excelOnlineCalc.util.isSuccess(ea)?ea.value:null}mSj(ea,Z){if(ea)for(const ua of ea)ua.ref.type&&ua.ref.type===da.a.cell&&(ea=ua.ref,Ca.cZi(ea,Z)&&(ea.span.end+=1,ua.span.end+=1))}createRange(ea,Z,ua,ya,ha){const Da={};
Da.FirstRow=ea;Da.FirstColumn=Z;Da.LastRow=ua;Da.LastColumn=ya;Da.SheetName=ha;return Da}Igh(ea,Z,ua){var ya=ea.ref.qualifier;if(!ya)return!0;switch(ea.ref.qualifier.type){case X.sheet:return ea=ya.document,B.a.equals(ya.sheet,Z,!0)&&(!ea||B.a.equals(ea.document,ua,!0));case X.sheetRange:return Z=this.$.xa.getItemByName(Z),ua=this.$.xa.getItemByName(ya.sheet1),ya=this.$.xa.getItemByName(ya.sheet2),!!Z&&!!ua&&!!ya&&(ua.index<=Z.index&&Z.index<=ya.index||ya.index<=Z.index&&Z.index<=ua.index);case X.document:return B.a.equals(ya.document,
ua,!0);case X.R6h:return ya=ya.name,B.a.equals(ya,Z,!0)||B.a.equals(ya,ua,!0);default:return c.ULS.sendTraceTag(537170009,0,10,`CalcManager.GetQualifierData: Unsupported formula qualifier type '${ya.type}'`),!1}}KMj(ea){this.instantaneousSupportInformationManager=ea;ea.Gxa.length&&ea.xia.length?(this.eEc=new H.CalcHelper(this.gridView.$),this.$Eb=this.Jr.createParser(),this.Iae=this.Jr.createNumberFormatter(),this.Tdc=!0,c.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.Rs||(c.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.Rs=new N(this.$))):c.ULS.sendTraceTag(537170008,0,15,`CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = ${ea.Gxa.length}, functions info count = ${ea.xia.length}`)}Stb(ea){if(!ea)return{returnValue:null,emptyCell:!1};var Z=this.getSheetName(ea.sheet.index);if(!Z)return c.ULS.sendTraceTag(537169998,0,50,`CalcManager.GetCellFromBlockCache: No sheet index ${ea.sheet.index}`),
{returnValue:null,emptyCell:!1};const ua=Ca.convertToRange(ea);Z=this.gridView.Stb(Z,ua.top,ua.left);return Z?Z.Cgh?{returnValue:Z,emptyCell:!1}:(c.ULS.sendTraceTag(537169996,0,50,`CalcManager.GetCellFromBlockCache: cell ${ea.range.row} ${ea.range.col} is empty`),{returnValue:null,emptyCell:!0}):(c.ULS.sendTraceTag(537169997,0,50,`CalcManager.GetCellFromBlockCache: cellProxy is null for cell ${ea.range.row} ${ea.range.col}`),{returnValue:null,emptyCell:!1})}getSheetName(ea){const Z=this.gridView.$.xa.getItem(ea);
return Z?Z.sheetName:(c.ULS.sendTraceTag(537169995,0,50,`CalcManager.GetSheetName - no sheet in index ${ea}`),null)}L8g(ea,Z){const ua={allowUnqualifiedCell:!0,wrapCellReferences:!0};ua.config=this.Jr.config;ua.originGridCell=excelOnlineCalc.util.success(ea);ua.originSheet=excelOnlineCalc.util.success(Z);return ua}K8g(){const ea={};ea.config=this.Jr.config;ea.getNameLoc=this.Rs.getNameLoc;ea.getContainingTable=this.Rs.getContainingTable;ea.getStructRefColumn=this.Rs.getStructRefColumn;ea.getStructRefSpecialRef=
this.Rs.getStructRefSpecialRef;ea.getDocumentLoc=this.Rs.getDocumentLoc;ea.getSheetIndex=this.Rs.getSheetIndex;ea.getSheetName=this.Rs.getSheetName;ea.getUserDefinedFuncLoc=this.Rs.getUserDefinedFuncLoc;ea.getSheetRangeIndexes=this.Rs.getSheetRangeIndexes;return ea}static cZi(ea,Z){return Z.length>ea.span.end&&Z.charAt(ea.span.end)===L.FGf}static convertToRange(ea){return M.Range.Tc(ea.range.row+1,ea.range.col+1)}}Ca.f6c="ECRC";Object(t.a)(Ca,"CalcManager",ab.a,[442,3]);var Na=a(37),za=a(54);class la extends b.a{constructor(ea){super();
this.$=ea;this.Fb()}create(){if(this.$){c.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var ea=75;var Z="Current"}else ea=78,Z="Stable";c.ULS.sendTraceTag(537169992,0,50,`CalcManagerFactory.Create: Calc ${Z} JS was loaded`);Na.TaskExtensions.Aa(za.a.loadScript(ea,4,this.ib,void 0,void 0,265),()=>{c.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");
let ua=this.$.da.za(266,!1);ua||(c.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),ua=new Ca(this.$),u.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")&&this.$.da.Ga(266,ua));this.qb(ua)},this.la,3)}else c.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")}static ka(ea){ea&&ea.da&&ea.da.Ga(265,new la(ea))}}Object(t.a)(la,"CalcManagerFactory",
b.a,[]);var aa=a(10);a.d(D,"a",function(){return sa});const sa=()=>{aa.a.Fa(la.ka)}},1198:function(t,D,a){var c=a(10);t=a(0);var b=a(15),d=a(220),f=a(86),e=a(4),k=a(184),l=a(8),m=a(38),v=a(868),n=a(223),w=a(62),r=a(867);class u extends Sys.EventArgs{constructor(){super()}}Object(t.a)(u,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var x=a(47),z=a(45);a(34);var B=a(31),y=a(1),A=a(609);a(22);var K=a(280),G=a(21);a(200);class T{constructor(N){this.data=N}}Object(t.a)(T,"NumberFormatDataHolder",null,
[]);var W=a(164);class P extends m.a{constructor(N,J){super();this.Fhc=l.a.ze;this.KXc=null;this.afb=this.qhc=!1;this.wsf=(R,M)=>{var L;(R=G.g(this.$))&&(M=null!==(L=null===M||void 0===M?void 0:M.cell)&&void 0!==L?L:R.Xb(null))&&this.PAa(M.cell.Ek,!0)};this.PJi=R=>{this.isActive()&&(B.a.ar(R.Errors)||!R.Result?b.ULS.sendTraceTag(537155726,0,50,`GetCategoryFromServer failed, ignoring - server errors: ${R.Errors?R.Errors.join(","):"None"}`):(R=R.Result,b.ULS.sendTraceTag(537155725,0,50,`Updating number format category cache, format index = ${R.Index}, category = ${R.Category}`),
this.Tqj(R.Index,R.Category),this.raiseEvent(P.MYc,new v.a(R.Index,R.Category),this)))};this.refresh=()=>{b.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");this.$_b();this.isActive()&&this.ea.jc.allowEdits&&(this.afb||this.nn&&!(this.ea.r7a>this.Fhc)?this.vBc():(b.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information."),this.mdd=r.a(this.$.pa.va,this.nn?this.nn.Digest:"",this.xKi,
this.wKi,null,null)),b.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info."),this.YXe())};this.Dwf=R=>{b.ULS.sendTraceTag(537155716,0,50,`InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = ${R.data.status}, HTTP status = ${R.data.httpStatus}.`);this.uJa=null};this.a_=()=>{this.afb=!1;this.ea.CD(this.a_);this.kQa(this.qhc?P.lPd:P.Bwd)};this.Xc=(R,M)=>{b.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");
n.a(M)&&this.kQa(P.lPd)};this.Uf=()=>{b.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==this.$.workbookContext.CalcMode&&this.Nwd(0===this.$.workbookContext.CalcMode)};this.Zc=()=>{b.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");this.kQa(P.lPd);y.EwaSettings.ma(301)&&3!==this.$.workbookContext.CalcMode&&this.Nwd(0===this.$.workbookContext.CalcMode)};this.pKi=(R,M,L)=>{b.ULS.sendTraceTag(537155712,
0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");this.uJa=null;this.isActive()?R.StateId===l.a.ze?(b.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),this.vBc()):!R.Result||this.aX&&this.aX.length?this.kQa(P.Bwd):this.jAf(R,M,L):b.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};this.jAf=R=>{this.aX=R.Result;
b.ULS.sendTraceTag(537155681,0,50,`InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned ${this.aX?this.aX.length:-1} functions.`);R=!1;if(this.aX){for(const M of this.aX)M&&(this.NTe[M.NameUI.toLocaleUpperCase()]=M.FunctionIndex.toString(),M.NameUI!==M.NameDataStrings&&(this.NTe[M.NameDataStrings.toLocaleUpperCase()]=M.FunctionIndex.toString(),R=!0),this.pDh.ia(M.FunctionIndex,M.NameUI));this.raiseEvent(P.vad,Sys.EventArgs.Empty,this)}R&&b.ULS.sendTraceTag(537155680,
0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};this.xKi=R=>{if(this.isActive())if(b.ULS.shipAssertTag(537155679,0,!!this.$,"null ewaControl"),this.qhc=!1,this.Fhc=R.StateId,this.Fhc===l.a.ze)this.qhc=!0,this.vBc();else{if(R.Result){var M=this.nn;this.nn=R.Result;b.ULS.sendTraceTag(537155678,0,50,`InstantaneousSupportInformation updated, new result digest: ${this.nn.Digest}.`);R=[];if(M)R=P.XQh(M.NumberFormats,this.nn.NumberFormats);
else for(M=0;M<this.nn.NumberFormats.length;M++)this.ykc.ia(M,this.nn.NumberFormats[M].NumberFormatCategory);for(const L of R)this.ykc.ia(L,this.nn.NumberFormats[L].NumberFormatCategory);this.raiseEvent(P.jxd,new u(R),this);y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&this.raiseEvent(P.ikf)}this.kQa(P.Bwd)}};this.wKi=R=>{this.isActive()&&(10===R.data.status?b.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):
(b.ULS.sendTraceTag(21311555,0,10,`Failed to update instantaneous support information, status = ${R.data.status}, HTTP status = ${R.data.httpStatus}.`),this.qhc=!0,this.vBc()))};b.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");this.ea=N;this.$=J;this.nn=this.uJa=this.mdd=this.IGb=null;this.ykc=new W.a;this.Rtb=new W.a;this.aX=[];this.pDh=new W.a;this.NTe={};this.ea.hk(this.Xc);this.$.el(this.Zc);G.g(this.$).ha.aga(this.wsf);y.EwaSettings.ma(301)&&this.ea.Ou(this.Uf);
this.kQa(P.s8e);b.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end")}sme(N){this.addHandler(P.jxd,N)}aId(N){this.removeHandler(P.jxd,N)}tDg(N){this.addHandler(P.MYc,N)}J$i(N){this.removeHandler(P.MYc,N)}Xle(N){this.addHandler(P.vad,N)}SHd(N){this.removeHandler(P.vad,N)}VEg(N){this.addHandler(P.ikf,N)}get De(){return this.nn?this.nn.LocaleInformation:null}get Gxa(){return this.nn?this.nn.NumberFormats:[]}get xia(){this.aX&&this.aX.length||this.YXe();return this.aX}get obi(){return this.nn&&
void 0!==this.nn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.nn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.nn.InstantaneousCalcWebWorkerPrecisionSamplingRate:P.Gbh}get rbi(){return this.nn&&void 0!==this.nn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.nn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.nn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:P.Kbh}get qbi(){return this.nn&&void 0!==this.nn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&
null!==this.nn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.nn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:P.Jbh}get pbi(){return this.nn&&void 0!==this.nn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.nn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.nn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:P.Ibh}get f$e(){return this.nn?this.nn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:P.Hbh}get okd(){return null!==this.KXc?
this.KXc:this.nn?this.nn.InstantaneousCalcManualMode:!1}BMj(N){let J;if(!N)return{returnValue:!0,category:"General"};J="";if(!({category:N}=this.PAa(N,!1)).returnValue)return{returnValue:!1,category:J};J=this.a2g(N);return{returnValue:!0,category:J}}a2g(N){let J="";switch(N){case 0:J="General";break;case 1:J="Number";break;case 2:J="Currency";break;case 3:J="Accounting";break;case 4:J="Date";break;case 5:J="Time";break;case 6:J="Percentage";break;case 7:J="Fraction";break;case 8:J="Scientific";break;
case 9:J="Text";break;case 10:J="Special";break;case 11:J="Custom"}return J}PAa(N,J){let R,M=({value:R}=this.ykc.Cc(N,0)).returnValue;!M&&0<N&&this.$&&(b.ULS.sendTraceTag(537155735,0,50,`InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache ${N}`),this.TIh(N),J&&(R=this.SIh(N),M=!0),A.a(N,this.$.oG)&&(R=6));return{returnValue:M,category:R}}Xgi(N){let J=0;if(({category:J}=this.PAa(N,!0)).returnValue)return 6===J;b.ULS.sendTraceTag(537155733,
0,50,`InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index ${N}`);return!1}PBh(N){b.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.uJa=w.p(this.$.pa.va,{FilterType:0},K.b(this.jAf,N),this.Dwf,null,null,null)}cTe(){this.kQa(P.s8e)}Nwd(N){this.KXc=N}TIh(N){if(this.Rtb&&this.$){var J;if(!({value:J}=this.Rtb.Cc(N)).returnValue||J.isCompleted)b.ULS.sendTraceTag(537155728,
0,50,`Getting number format category for format index: ${N}`),(J=r.b(this.$.pa.va,N,this.PJi,null,null,null))&&this.Rtb.ia(N,J)}else b.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")}SIh(N){return 1<=N&&8>=N?1:9<=N&&12>=N?2:13===N||14===N?6:15===N?8:17===N|18===N?7:19===N?4:16===N||20<=N&&29>=N||31===N?11:30===N?9:32<=N&&35>=N?3:0}isActive(){const N=void 0===this.ea||null===this.ea,J=!N&&this.ea.hc;b.ULS.sendTraceTag(537155727,
0,50,`InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:${J} - sessionStateManager IsNullOrUndefined: ${N}`);return J}Tqj(N,J){this.ykc.ia(N,J)}dispose(){f.a.Ia(this.IGb);this.IGb=null;this.$_b();for(let N of this.Rtb){const J=N.value;J&&!J.isCompleted&&e.AFrameworkApplication.rd.wu(J.Ot)}this.Rtb=null;this.ea&&(this.ea.Hk(this.Xc),this.afb&&this.ea.CD(this.a_),this.afb=!1,this.ea.Mw(this.Uf));this.ea=null;this.$&&G.g(this.$)&&G.g(this.$).ha&&(G.g(this.$).ha.dma(this.wsf),
this.$.Cl(this.Zc));this.$=null;super.dispose()}isFeatureEnabled(N){try{switch(N){case "LocaleLongDateFormat":return y.EwaSettings.ma(196);case "GetLocaleDayNames":return y.EwaSettings.ma(197);case "CalculateTextWidthIgnoreLetterSpacing":return y.EwaSettings.ma(283);case "OfficeVSO:3657744_CalcFixForDateFormat":return y.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return y.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");
case "CalcAutocompleteExperiment":return y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case "CalcNewFunctions":return y.EwaSettings.ma(246);case "CalcContractChecks":return y.EwaSettings.ma(247);case "CalcSupportDynamicArrays":return y.EwaSettings.ma(248);case "CalcFormatCalculations":return y.EwaSettings.ma(249);case "CalcFormulaCacheAPIChanges":return y.EwaSettings.ma(250);case "CalcStrictFormulaChecking":return y.EwaSettings.ma(251);case "CalcSupportRowReference":return y.EwaSettings.ma(262);
case "CalcParserUsesPledges":return y.EwaSettings.ma(306);case "CalcWebWorker":return!0;case "CalcWebWorkerTest":return y.EwaSettings.ma(305);case "CalcLookupFunctions":return y.EwaSettings.ma(307);case "CalcLogStopWatch":return y.EwaSettings.ma(370);case "CalcPreventSpillingHack":return y.EwaSettings.ma(252);case "CalcDynamicArrayOperators":return y.EwaSettings.ma(102);case "CalcDotOperator":return y.EwaSettings.ma(577);case "CalcLetFunction":return y.EwaSettings.ma(695);default:return N.startsWith("OfficeVSO:")?
y.EwaSettings.isChangeGateEnabled(N):!1}}catch(J){return b.ULS.sendTraceTag(537155724,0,15,`InstantaneousSupportInformation.IsFeatureEnabled(${N}): feature parsing failed, returning false. Exception: ${J.toString()}.`),!1}}kQa(N){this.isActive()&&this.ea.jc.allowEdits?(f.a.Ia(this.IGb),this.IGb=null,this.IGb=x.a.instance.create(this.refresh,N,z.a.sbi)):b.ULS.sendTraceTag(537155723,0,50,`InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits ${void 0!==
this.ea&&null!==this.ea&&void 0!==this.ea.jc&&null!==this.ea.jc?this.ea.jc.allowEdits:!1}, IsEditMode ${void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode}`)}YXe(){b.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.uJa?b.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.aX&&this.aX.length||(this.uJa=w.p(this.$.pa.va,{FilterType:0},this.pKi,
this.Dwf,null,null,null)):b.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")}vBc(){this.afb||(this.afb=!0,this.ea.kE(this.a_))}$_b(){this.wu(this.mdd);this.wu(this.uJa);this.uJa=this.mdd=null}wu(N){N&&!N.isCompleted&&this.$.pa.va.beb(N.Ot)}static XQh(N,J){if(!N||!N.length)return[];if(!J||!J.length){J=Array(N.length);for(var R=0;R<N.length;++R)J[R]=N[R].IfmtIndex;return J}R=new W.a;for(const M of N)R.ia(M.IfmtIndex,
new T(M));N=new k.a;for(const M of J){let L;({value:L}=R.Cc(M.IfmtIndex)).returnValue&&L.data.FormatString===M.FormatString||N.add(M.IfmtIndex)}return N.toArray()}}P.jxd="isim0";P.MYc="isim1";P.vad="isim2";P.ikf="isim3";P.s8e=100;P.lPd=1E3;P.Bwd=3E5;P.Gbh=.001;P.Kbh=.1;P.Jbh=.2;P.Ibh=.001;P.Hbh=50;Object(t.a)(P,"InstantaneousSupportInformationManager",m.a,[438,3]);var E=a(695);class H extends d.a{constructor(N){super();this.$=N;this.Fb()}create(){if(this.$){b.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script");
var N=Object(E.a)(this.$.da,268,()=>new P(this.$.ea,this.$));this.qb(N)}}static ka(N){if(!N)throw Error.argumentNull("ewaControl");N.da.Ga(246,new H(N))}}Object(t.a)(H,"InstantaneousSupportInformationManagerFactory",d.a,[]);a.d(D,"a",function(){return F});const F=()=>{c.a.Fa(H.ka)}},1213:function(t,D,a){function c(J){if(J){var R=new v(J.IsRangeRef);R.pF=J.IsAbsoluteFirstRow;R.oF=J.IsAbsoluteFirstColumn;R.gK=J.IsAbsoluteSecondRow;R.fK=J.IsAbsoluteSecondColumn;return R}}function b(J){var R;if(J){var M=
new v(0===J.kind);J=null===(R=null===J||void 0===J?void 0:J.rangeInfo)||void 0===R?void 0:R.positionKindInfo;if(!J)return M;M.pF=0===J.firstRow;M.oF=0===J.firstColumn;M.gK=0===J.secondRow;M.fK=0===J.secondColumn;return M}}t=a(0);var d=a(220),f=a(7),e=a(15),k=a(84),l=a(5),m=a(317);class v{constructor(J){this.fK=this.gK=this.oF=this.pF=!1;this.uZ=J}}Object(t.a)(v,"MarqueeRangeData",null,[]);class n{constructor(J,R,M,L=!1){this.gUd=J;this.jMb=R;this.e6a=L;M?(this.uZ=M.uZ,this.pF=M.pF,this.oF=M.oF,this.gK=
M.gK,this.fK=M.fK):e.ULS.shipAssertTag(524039642,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(t.a)(n,"MarqueeMetadata",null,[]);var w=a(42),r=a(138),u=a(34),x=a(1),z=a(22),B=a(574),y=a(21),A=a(200),K=a(338),G=a(36),T=a(749),W=a(870);const P="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");class E{constructor(J,R){this.cK=this.odb=this.Slf=!1;this.R7=null;this.Mxa=
()=>{this.cK=!1};this.Hc=J;this.gridView=y.g(J);this.calcManager=R;this.rii=x.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.caf=x.EwaSettings.ma(684);this.c4=G.a.c4(J);this.Haa=x.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug");this.gridView.Wb.jm(this.Mxa)}get formulaAssistanceManager(){this.R7||(this.R7=this.Hc.da.za(464));return this.R7}get formulaAssistanceTelemetryManager(){this.KCa||(this.KCa=this.Hc.da.za(491));return this.KCa}nG(J,
R){this.rii&&J.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.odb||J.qF)return!1;const M=void 0===R||null===R?J.text:R;if(this.calcManager&&1<M.length&&A.f(M)){var L=this.Ria(),U=this.l_e(),X=this.Hc.workbookContext.WorkbookFileName;let fa=!1;const S=.01>Math.random()?Object(k.a)(r.a,this.Hc.Hb.xc("LoadingUIShown","ColoredReferencesManager")):null;try{var da=this.calcManager.extractReferences(M,U,X,!this.caf);if(!da)return e.ULS.sendTraceTag(524039689,0,50,
"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;U=[];X=[];const ka=[],V=[];let wa=0,ma=0;const ab=new u.a(!1);let ba="";for(const Na of da.Items)if(fa=Na.IsStructRef||fa,Na.IsBoolean||Na.IsNumber||Na.IsString){const za=Na.IsBoolean?"rgba(0, 0, 255, 1)":Na.IsNumber?"rgba(9, 134, 88, 1)":"rgba(163, 21, 21, 1)";this.iE(X,M,wa,Na.Span.Start,null);this.iE(X,M,Na.Span.Start,Na.Span.End,za);wa=Na.Span.End}else if(x.EwaSettings.ma(588)){if(Na.Range||
Na.LetName&&0<=Na.LetNumber){da=null;if(Na.Range){let la=w.D(Na.Range);da=this.IY(la,ab,1);U.push(new K.a(la,L))}else Na.LetName&&0<=Na.LetNumber&&(da=ba=this.EJh(Na.LetName,Na.LetNumber,ab,ba),ma!==ab.count&&J.colors.add(Na.Span.Start+"-"+Na.Span.End,P[(ab.count-1)%P.length]));this.iE(X,M,wa,Na.Span.Start,null);this.iE(X,M,Na.Span.Start,Na.Span.End,da);wa=Na.Span.End;ka.push(Na.Span);let za=X.length-1;V.push(new n(za,X[za].text,c(Na)));ma=ab.count}}else if(Na.Range){let za=w.D(Na.Range),la=this.IY(za,
ab,1);this.iE(X,M,wa,Na.Span.Start,null);this.iE(X,M,Na.Span.Start,Na.Span.End,la);U.push(new K.a(za,L));wa=Na.Span.End;ka.push(Na.Span);let aa=X.length-1;V.push(new n(aa,X[aa].text,c(Na)))}this.iE(X,M,wa,M.length,null);this.Suc(J,X,!!R);const Ca=J.textBox.text;if(!z.a.equals(Ca,M,!1)){e.ULS.shipAssertTag(38114182,0,!1,`ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [${Ca.length}], originalTextLength [${M.length}]`);
let Na=J.textBox.caretPosition;J.textBox.text=M;J.textBox.caretPosition=Na;return!0}this.oz(U,ab,V);x.EwaSettings.ma(588)&&0<U.length&&e.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");x.EwaSettings.ma(588)&&0<J.colors.count&&e.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.cK=!0}finally{S&&S.jAa(()=>{fa&&e.ULS.sendTraceTag(524039686,0,50,`ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in ${S.tc} ms`)})}}else return this.oz(null,
null),this.cK&&(this.cK=!1,L=J.textBox.caretPosition,J.textBox.setPlainText(M),J.textBox.caretPosition=Math.min(L,M.length),R)?!0:!1}eeb(J,R,M){if(this.odb||J.qF)return!1;const L=isNullOrUndefined(R)?J.text:R;var U=[];const X=new u.a(!1);if(1<L.length&&Object(T.b)(M)){const fa=[],S=[],ka=[];var da=0;const V=this.Ria();for(const wa of M.formulaHighlights){this.iE(fa,L,da,wa.span.start,null);switch(wa.kind){case 0:case 1:case 2:M=w.B(wa.rangeInfo.sharedRange);if(isNullOrUndefined(M)){e.ULS.sendTraceTag(521211937,
0,10,`ColoredReferencesManager.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${wa.kind.toString()},`);this.iE(fa,L,wa.span.start,wa.span.end,null);break}da=this.IY(M,X,1);this.iE(fa,L,wa.span.start,wa.span.end,da);U.push(new K.a(M,V));S.push({Start:wa.span.start,End:wa.span.end});M=fa.length-1;ka.push(new n(M,fa[M].text,b(wa)));break;case 3:this.iE(fa,L,wa.span.start,wa.span.end,null,"rgba(229, 229, 229, 1)")}da=wa.span.end}this.iE(fa,L,da,L.length);this.Suc(J,
fa,!!R);R=J.textBox.text;if(!z.a.equals(R,L,!1))return e.ULS.shipAssertTag(521211936,0,!1,`ColoredReferencesManager.UpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${R.length}], originalTextLength [${L.length}]`),R=J.textBox.caretPosition,J.textBox.text=L,J.textBox.caretPosition=R,!0;this.oz(U,X,ka);return this.cK=!0}this.oz(null,null);return this.cK&&(this.cK=!1,U=J.textBox.caretPosition,J.textBox.setPlainText(L),
J.textBox.caretPosition=Math.min(U,L.length),R)?!0:!1}cCb(J,R,M){if(!J||!R||!M)return e.ULS.shipAssertTag(524039685,0,!!J,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),e.ULS.shipAssertTag(524039684,0,!!R,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),e.ULS.shipAssertTag(524039683,0,!!M,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;const L=Object(k.a)(n,R.metadata);if(!L)return e.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),
!1;var U=L.gUd,X=L.jMb,da=this.gridView.Db.Wld(M)?M.jub(L.oF,L.pF):M.FJa(L.oF,L.pF,L.fK,L.gK);if(!da)return e.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;const fa=X.indexOf("!");-1!==fa&&(da=X.substring(0,fa+1)+da);if(!J.textBox.changeTextInExistingTextPart(U,X,da))return e.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;L.jMb=da;U=!0;for(X=1;4>=X;X++)(da=y.g(this.Hc).ob.ev(3,X,R.yT))?
(da.range=M,da.metadata=L):(e.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),U=!1);this.gridView.ob.update(!1,!1);this.gridView.lj&&(this.gridView.dc.textBox.text=J.text);this.gridView.dc.UOa(new m.a({Xxb:!0}));return U}vii(J){if(3!==J.vq)return e.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;J=Object(k.a)(n,J.metadata);return J?J.uZ&&!J.e6a:(e.ULS.shipAssertTag(524039650,
0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)}oAa(J,R){e.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(R?"suspending":"resuming")+" colored references");R&&this.cK&&(this.cK=!1,this.oz(null,null),J.textBox.uxe());this.odb=R}dispose(){this.gridView&&this.gridView.Wb&&this.gridView.Wb.Al(this.Mxa)}vKa(J){const R=this.formulaAssistanceTelemetryManager;R||this.Slf||(this.Slf=!0,e.ULS.sendTraceTag(521211935,0,50,
"ColoredReferencesManager.highlightPreviewRanges: Failed to log highlightPreviewRanges measurement, FormulaAssistanceTelemetryManager unavailable"));null===R||void 0===R?void 0:R.gO(["highlightPreviewRanges"]);this.c4?this.Q5h(J):this.P5h(J);null===R||void 0===R?void 0:R.RP(["highlightPreviewRanges"],!0)}Q5h(J){var R=this.formulaAssistanceManager.i3a(J,W.a);if(isNullOrUndefined(R))this.Haa&&this.oz(null,null);else{var M=this.Ria(),L=[],U=new u.a(!1),X=[];R=R.formulaHighlights;for(const da of R)if(R=
da.kind,0===R||2===R||1===R)R=w.B(da.rangeInfo.sharedRange),Object(T.b)(R)&&(L.push(new K.a(R,M)),this.IY(R,U,1),X.push(new n(da.span.start,J.substring(da.span.start,da.span.end),b(da),!0)));this.oz(L,U,X)}}P5h(J){const R=this.Ria();var M=this.l_e();const L=this.Hc.workbookContext.WorkbookFileName,U=[],X=new u.a(!1),da=[];if(M=this.calcManager.extractReferences(J,M,L,!this.caf)){for(const fa of M.Items)fa.Range&&(M=w.D(fa.Range),U.push(new K.a(M,R)),this.IY(M,X,1),da.push(new n(fa.Span.Start,J.substring(fa.Span.Start,
fa.Span.End),c(fa),!0)));this.oz(U,X,da)}else this.Haa&&this.oz(null,null)}IY(J,R,M){let L=R.getItem(J.toString());L||(L=P[R.count%P.length],R.add(J.toString(),L));return String.format(L,M)}EJh(J,R,M,L){J="["+J+", "+R+"]";R=M.getItem(J);R||(R=M.count%P.length,R=P[R],L===String.format(R,1)&&(M.add("skip-"+J,R),R=M.count%P.length,R=P[R]),M.add(J,R));return String.format(R,1)}iE(J,R,M,L,U=null,X=null){e.ULS.shipAssertTag(524039648,0,M<=L,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");
M<L&&(R=R.substring(M,L),J.push(Object(f.a)(new B.a,{text:R,color:U,backgroundColor:X})))}oz(J,R,M=null){J&&J.length?(e.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+J.length),J.reverse(),M.reverse(),this.gridView.ob.yv(J,[3],!0,(L,U)=>{if(L&&L.range&&U){e.ULS.shipAssertTag(524039643,0,R.lb(L.range.toString()),`ColoredReferencesManager.HighlightRanges: The range '${L.range.toString()}' doesn't exist in the range to color dictionary`);var X=
this.IY(L.range,R,.1),da=this.IY(L.range,R,1);this.Hc.frame&&this.Hc.frame.ZC&&this.Hc.frame.ZC.Raa||(U.style.background=X);U.style.borderColor=da;M&&(U.setAttribute(l.a.P4a,L.yT.toString()),L.metadata=M[L.yT])}else e.ULS.shipAssertTag(524039646,0,!!L,"ColoredReferencesManager.HighlightRanges: state is null"),e.ULS.shipAssertTag(524039645,0,!!L.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),e.ULS.shipAssertTag(524039644,0,!!U,"ColoredReferencesManager.HighlightRanges: div is null")})):
(J=this.Hc.Hb.xc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.ob.Tg([3]),this.gridView.ob.PQa(new K.a(null,this.Ria()),[3]),J.stop())}Suc(J,R,M){const L=J.textBox;L.jF=!0;var U=L.selection;const X=U.index;U=X+U.length;L.setTextFromTextParts(R);R=L.text.length;L.selectRange(Math.min(X,R),Math.min(U,R));M&&J.UOa(new m.a);L.jF=!1}Ria(){return this.Y$b().sheetId}l_e(){return this.Y$b().sheetName}Y$b(){return this.gridView.Lq&&this.gridView.Lq.LF?this.gridView.Lq.LF:this.Hc.oa}}Object(t.a)(E,
"ColoredReferencesManager",null,[690,3]);class H extends d.a{constructor(J){super();this.$=J;this.Fb()}create(){this.$.da.Za(266,J=>{J=x.EwaSettings.fl()||x.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")?this.$.da.za(281)||this.$.da.Ga(281,new E(this.$,J)):new E(this.$,J);this.qb(J)})}static ka(J){J.da.Ga(282,new H(J))}}Object(t.a)(H,"ColoredReferencesManagerFactory",d.a,[]);var F=a(10);a.d(D,"a",function(){return N});const N=()=>{F.a.Fa(H.ka)}},1261:function(t,
D,a){t=a(0);var c=a(220),b=a(801),d=a(1);class f extends c.a{constructor(l){super();this.$=l;this.Fb()}create(){this.$.da.Za(266,l=>{l=d.EwaSettings.fl()||d.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")?this.$.da.za(294)||this.$.da.Ga(294,new b.RelativeAndAbsoluteReferencesManager(l)):new b.RelativeAndAbsoluteReferencesManager(l);this.qb(l)})}static ka(l){l.da.Ga(295,new f(l))}}Object(t.a)(f,"RelativeAndAbsoluteReferencesManagerFactory",c.a,[]);var e=a(10);
a.d(D,"a",function(){return k});const k=()=>{e.a.Fa(f.ka)}},1384:function(t,D,a){a.r(D);t=a(1198);D=a(1152);var c=a(1213);a=a(1261);Type.registerNamespace("_Ewa");Object(t.a)();Object(D.a)();Object(c.a)();Object(a.a)()},786:function(t,D,a){a.d(D,"a",function(){return c});t=a(0);class c{}c.abs="Abs";c.rel="Rel";Object(t.a)(c,"PositionBaseType",null,[])},801:function(t,D,a){a.r(D);t=a(0);var c=a(7),b=a(15);class d{}Object(t.a)(d,"Reference",null,[]);class f extends d{constructor(){super();this.column=
this.row=null}}Object(t.a)(f,"CellReference",d,[]);class e{constructor(){this.end=this.start=0;this.sv=null}LJg(K,G){for(let T=0;T<this.sv.length;T++){const W=this.ZYb(K,this.sv[T]);G+=W;T<this.sv.length-1&&(G+=":")}return G}}Object(t.a)(e,"IReferenceSequence",null,[]);var k=a(24),l=a(786);class m extends e{constructor(){super();this.Qfc=!1}P$b(){const {RelativeAndAbsoluteReferencesManager:K}=a(801),G=this.sv[0];return K.Nqf(G.row.kind===l.a.abs,G.column.kind===l.a.abs)}ZYb(K,G){G=k.Range.Tc(G.row.index+
1,G.column.index+1);return this.Qfc?G.jub(1===K||3===K,1===K||2===K):G.FJa(1===K||3===K,1===K||2===K,!0,!0)}}Object(t.a)(m,"CellReferenceSequence",e,[]);class v extends d{constructor(){super();this.secondColumn=this.firstColumn=null}}Object(t.a)(v,"ColumnReference",d,[]);class n extends e{constructor(){super()}P$b(){const K=this.sv[0];return a(801).RelativeAndAbsoluteReferencesManager.epf(K.firstColumn,K.secondColumn).kind===l.a.abs?2:3}ZYb(K,G){return k.Range.wtb(G.firstColumn.index+1,G.secondColumn.index+
1).FJa(1===K||3===K,!0,1===K||3===K,!0)}}Object(t.a)(n,"ColumnReferenceSequence",e,[]);class w extends d{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(t.a)(w,"RangeReference",d,[]);class r extends e{constructor(){super()}P$b(){const {RelativeAndAbsoluteReferencesManager:K}=a(801),G=this.sv[0];return K.Nqf(G.top.kind===l.a.abs,G.left.kind===l.a.abs)}ZYb(K,G){G=new k.Range(G.top.index+1,G.left.index+1,G.bottom.index+1,G.right.index+1,!1,!1);const T=1===K||3===K;K=1===
K||2===K;return G.FJa(T,K,T,K)}}Object(t.a)(r,"RangeReferenceSequence",e,[]);class u extends d{constructor(){super();this.secondRow=this.firstRow=null}}Object(t.a)(u,"RowReference",d,[]);class x extends e{constructor(){super()}P$b(){const K=this.sv[0];return a(801).RelativeAndAbsoluteReferencesManager.epf(K.firstRow,K.secondRow).kind===l.a.abs?0:1}ZYb(K,G){return k.Range.S8b(G.firstRow.index+1,G.secondRow.index+1).FJa(!0,1===K||2===K,!0,1===K||2===K)}}Object(t.a)(x,"RowReferenceSequence",e,[]);var z=
a(975),B=a(976),y=a(200);a.d(D,"RelativeAndAbsoluteReferencesManager",function(){return A});class A{constructor(K){this.calcManager=K}r0a(K,G,T){let W,P;W=G;P=T;if(!K||!y.f(K))return{returnValue:K,mwd:W,lwd:P};var E=this.calcManager.qQe(K);if(!E)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,mwd:W,lwd:P};E=this.VVh(E,K,G,T);let H=0,F="",N=0,J=0;for(;J<
E.length;J++)if(this.DHe(E[J],G,T)){H=E[J].P$b();W=E[J].start;break}for(;J<E.length&&this.DHe(E[J],G,T);J++)F+=K.substring(N,E[J].start),F=E[J].LJg(H,F),N=E[J].end;N&&(P=F.length);F+=K.substring(N,K.length);return{returnValue:F,mwd:W,lwd:P}}VVh(K,G,T,W){const P=[];for(let N=0;N<K.length;N++){var E=K[N];if(E.kind===z.a.range)if(E=E.ref,E.type===B.a.cell){var H=E;E=Object(c.a)(new m,{start:E.span.start,end:E.span.end,sv:[Object(c.a)(new f,{column:H.col,row:H.row})],Qfc:this.calcManager.m0b(E.span.end,
G)});P.push(E)}else if(E.type===B.a.range)this.EHe(E.topLeftSpan,T,W)&&this.EHe(E.bottomRightSpan,T,W)?(H=new w,E.top.index<=E.bottom.index?(H.top=E.top,H.bottom=E.bottom):(H.bottom=E.top,H.top=E.bottom),E.left.index<=E.right.index?(H.left=E.left,H.right=E.right):(H.right=E.left,H.left=E.right),E=Object(c.a)(new r,{start:E.topLeftSpan.start,end:E.bottomRightSpan.end,sv:[H]}),P.push(E)):(H=Object(c.a)(new m,{start:E.topLeftSpan.start,end:E.topLeftSpan.end,sv:[Object(c.a)(new f,{column:E.left,row:E.top})],
Qfc:this.calcManager.m0b(E.topLeftSpan.end,G)}),E=Object(c.a)(new m,{start:E.bottomRightSpan.start,end:E.bottomRightSpan.end,sv:[Object(c.a)(new f,{column:E.right,row:E.bottom})],Qfc:this.calcManager.m0b(E.topLeftSpan.end,G)}),P.push(H),P.push(E));else if(E.type===B.a.column){H=E;for(E=Object(c.a)(new n,{start:E.span.start,end:E.span.end,sv:[Object(c.a)(new v,{firstColumn:H.startIndex,secondColumn:H.endIndex})]});E.end<G.length-1&&":"===G.charAt(E.end)&&N<K.length-1;)if(H=K[N+1].ref,H.type===B.a.column&&
H.span.start===E.end+1){var F=H;E.sv.push(Object(c.a)(new v,{firstColumn:F.startIndex,secondColumn:F.endIndex}));E.end=H.span.end;N++}else break;P.push(E)}else if(E.type===B.a.row){H=E;for(E=Object(c.a)(new x,{start:E.span.start,end:E.span.end,sv:[Object(c.a)(new u,{firstRow:H.startIndex,secondRow:H.endIndex})]});E.end<G.length-1&&":"===G.charAt(E.end)&&N<K.length-1;)if(H=K[N+1].ref,H.type===B.a.row&&H.span.start===E.end+1)F=H,E.sv.push(Object(c.a)(new u,{firstRow:F.startIndex,secondRow:F.endIndex})),
E.end=H.span.end,N++;else break;P.push(E)}}return P}DHe(K,G,T){return!(K.start>T||G>K.end)}EHe(K,G,T){return!(K.start>T||G>K.end)}static epf(K,G){return K.index<=G.index?K:G}static Nqf(K,G){return G||K?G&&K?2:!G&&K?3:0:1}}Object(t.a)(A,"RelativeAndAbsoluteReferencesManager",null,[689])},933:function(t,D,a){a.r(D);t=a(0);var c=a(15),b=a(262),d;(function(x){x[x.paren=0]="paren";x[x.lead=1]="lead";x[x.intern=2]="intern";x[x.trail=3]="trail";x[x.undefined=4]="undefined"})(d||(d={}));Object(t.b)("CurrencyFormatOption",
d);var f;(function(x){x[x.none=-1]="none";x[x.mdy=0]="mdy";x[x.dmy=1]="dmy";x[x.ymd=2]="ymd";x[x.myd=3]="myd";x[x.dym=4]="dym";x[x.ydm=5]="ydm"})(f||(f={}));Object(t.b)("DateOrderOption",f);var e=a(8);class k{constructor(x,z){({CalcHelper:x}=a(933));z&&(z.De||c.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.wrg=x.FCe(z,x.qCe(z.xia));this.xrg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}get localeInfo(){return this.xrg}get localeData(){return this.wrg}formatNumber(x){return this.localeInfo.formatNumber(x)}}
Object(t.a)(k,"LocaleHolder",null,[]);var l=a(973),m=a(54),v=a(1),n=a(22),w=a(14),r=a(199);a.d(D,"CalcHelper",function(){return u});class u{constructor(x){this.$=x;(this.pz=this.$.da.za(268))||c.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");let z;z=v.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?m.a.current.Rn(75):m.a.current.Rn(78);this.logger=new l.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",
this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.rba=new k(x,this.pz);excelOnlineCalc.config.initCalc(this.logger,this.pz?B=>this.pz.isFeatureEnabled(B):()=>!1,z);this.Vlg=excelOnlineCalc.config.calcConfig(this.rba.localeInfo)}get config(){return this.Vlg}Z$g(){if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return c.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;const x=this.$.xa.oa;
return x?x.index:(c.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.oa.index}createParser(){const x={};x.config=this.config;return excelOnlineCalc.parse.createParser(x)}createNumberFormatter(){const x=excelOnlineCalc.numfmt.createFormatGlobals(this.config,(z,B)=>excelOnlineCalc.calc.getTime(this.config,z,B,"Estimation"));return excelOnlineCalc.numfmt.createNumberFormatter(x)}i9g(x,z,B,y){if(!y)return{range:{row:z,col:B},sheet:{document:this.documentLoc,
index:x}};z=excelOnlineCalc.location.gridCell(z,B);x=excelOnlineCalc.location.sheetIndex(this.documentLoc,x);return excelOnlineCalc.location.sheetGridCell(x,z)}plh(x,z){let B;B=excelOnlineCalc.calc.getEvalResultKind(x);switch(B){case 4:return{returnValue:x?this.rba.localeInfo.trueName:this.rba.localeInfo.falseName,kind:B};case 1:return{returnValue:v.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Tyc(this.rba.formatNumber(x),z):this.rba.formatNumber(x),
kind:B};case 2:return{returnValue:v.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Tyc(x.toString(),z):x.toString(),kind:B};case 128:return{returnValue:"",kind:B};case 8:switch(x.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.rba.localeInfo.errorNames[x.type],kind:B};default:return{returnValue:u.unknownError,kind:B}}case 32:return{returnValue:v.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.Tyc(this.z9g(x,z),z):"##UNSUPPORTED: ARRAY",kind:B};default:return{returnValue:w.a.instance.ga(2212),kind:B}}}Tyc(x,z){return x.length<=z?x:x.substring(0,z-3)+"..."}z9g(x,z){let B=this.rba.localeInfo.leftBrace;for(let y=0;y<x.rows;++y){for(let A=0;A<x.cols;++A)B+=x.opers[y][A],A<x.cols-1&&(B+=this.rba.localeInfo.columnSeparator);y<x.rows-1&&(B+=this.rba.localeInfo.rowSeparator)}return this.Tyc(B,z-1)+this.rba.localeInfo.rightBrace}static FCe(x,z=null){const B=u.P2b(),y=x.De.TrueValueString,A=
x.De.FalseValueString,K=x.De.DecimalSeparator.toString(),G=x.De.ListSeparator.toString(),T=x.De.ColumnSeparator.toString(),W=x.De.RowSeparator.toString(),P=x.De.ThousandsDataArray,E=x.De.ThousandSeparator.toString(),H=x.De.Lcid,F=x.De.Country,N=x.De.DigitsNumber,J=x.De.ExpSeparatedBySpace,R=x.De.FractionSeparator.toString(),M=x.De.PercentSeparatedBySpace,L=n.a.oUg(Enum.toString(d,x.De.CurrencyFormat)),U=x.De.CurrencySymbolLead,X=x.De.CurrencySeparatedBySpace,da=x.De.CurrencySymbolString,fa=x.De.DigitsCurrency,
S=-1===x.De.DateOrder?"MDY":r.e(Enum.toString(f,x.De.DateOrder)),ka=x.De.DateSeparator.toString(),V=x.De.DateAlternativeSeparator.toString(),wa=x.De.Year4Digits,ma=x.De.Month2Digits,ab=x.De.Day2Digits,ba=x.De.LongDateFormat,Ca=x.De.TimeSeparator.toString(),Na=x.De.TimeAltSeparator,za=x.De.Hour2Digits,la=x.De.Use24HourClock,aa=x.De.AmPmSeparatedBySpace,sa=[x.De.AmString,x.De.PmString],ea=x.De.DayNameShortArray,Z=x.De.DayNameLongArray,ua=x.De.MonthNameShortArray,ya=x.De.MonthNameLongArray,ha=x.De.PictureSpecialArray,
Da=b.a.map(("\x00"+x.De.PictureSingleString).split(""),tb=>"\x00"===tb?null:tb),nb=x.De.PictureColorArray,qa=x.De.PictureDbnumArray,pa=x.De.RowLetter.toString(),Ja=x.De.ColumnLetter.toString(),$a=x.De.LeftBrace.toString(),rb=x.De.RightBrace.toString(),Pa=x.De.LeftBracket.toString(),eb=x.De.RightBracket.toString(),Ob=u.QWh(x.De);return excelOnlineCalc.calc.localeData(z,B,y,A,pa,Ja,$a,rb,Pa,eb,K,G,T,W,P,E,H,F,N,J,R,M,L,U,X,da,fa,S,ka,V,wa,ma,ab,ba,Ca,Na,za,la,aa,sa,ea,Z,ua,ya,ha,Da,nb,qa,Ob,x.De.SysDateFormatString,
x.De.SysTimeFormatString)}static qCe(x){const z=[];if(!x)return z;for(const B of x)x=null,B.IsDynamicUdf||(x=excelOnlineCalc.calc.worksheetFunctionName(B.FunctionIndexInServer,B.NameUI)),x&&z.push(x);return z}static P2b(){const x=[],z=Object.keys(e.a.errorNames);for(let B=0;B<z.length;B++){const y=excelOnlineCalc.calc.errorTypeName(B+1,z[B]);y&&x.push(y)}return x}static QWh(x){const z=Array(6);z[1]="#"+x.AllStructRefString;z[3]="#"+x.HeadersStructRefString;z[2]="#"+x.DataStructRefString;z[4]="#"+
x.TotalsStructRefString;z[5]="#"+x.ThisRowStructRefString;return z}}u.unknownError="##ERR##";Object(t.a)(u,"CalcHelper",null,[])},975:function(t,D,a){a.d(D,"a",function(){return c});t=a(0);class c{}c.yri="literal";c.operator="operator";c.func="function";c.namedRange="namedRange";c.range="range";c.ljf="letName";c.all="*";c.USd="structRefRange";Object(t.a)(c,"TraverseFormulaInterestTypes",null,[])},976:function(t,D,a){a.d(D,"a",function(){return c});t=a(0);class c{}c.cell="cell";c.range="range";c.row=
"row";c.column="col";Object(t.a)(c,"TraverseFormulaRefTypes",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.calc.js.map/29baefce8777445660913c5470576868/EwaDSEsNext.calc.js.map