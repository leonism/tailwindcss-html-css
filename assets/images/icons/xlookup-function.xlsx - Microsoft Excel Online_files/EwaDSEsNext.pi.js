'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1104:function(t,D,a){a.d(D,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1105:function(t,D,a){a.d(D,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1107:function(t,D,a){a.d(D,"a",function(){return b});var c=a(505);const b=()=>{c.a.Di(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1131:function(t,D,a){var c=a(0),b=a(7),d=a(15),f=a(220),e=a(29),k=a(27),l=a(346),m=a(171),v=a(262),n=a(350),w=a(4),r=a(1),u=a(38),x=a(8),z=a(282),B=a(14);class y extends z.a{constructor(I){super(I);this.hYg=()=>{d.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};d.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Sb=0;this.sc(1,B.a.instance.ga(2252));I=B.a.instance.ga(2250);const xa=this.IM();this.initializeAndShow(I,
this.hYg,xa)}get oc(){return"ClipboardReadPermissionAskDialog"}IM(){const I={};I.id=this.oc;const xa=B.a.instance.ga(2251);I.DialogMessage=xa;return I}}Object(c.a)(y,"ClipboardReadPermissionAskDialog",z.a,[]);var A=a(51);const K=(I,xa,Ua,vb,cb)=>{const Xb=I.Stopwatch,rc={};rc.a=cb;rc.e=Xb.id;rc.c="RearrangeRowColumn";rc.b="mouse";rc.d=I.OperationId.toString();rc.f=Ua.toString();rc.g=vb.toString();rc.h=xa.toString();rc.i=I.DragDropIsShiftKeyDown;rc.j=!0;rc.o=Xb.tc;rc.q=!1;rc.r=I.CopyPasteTargetType.toString();
rc.s=I.EncounteredDeploymentErrors;return rc};class G{constructor(I,xa){this.WDh=()=>{const Ua={};Ua.SourceItem=this.toString();return Ua};this.sessionStateId=I;this.sessionId=xa;this.toJSON=this.WDh}Jbf(I){return I?this.sessionStateId===I.sessionStateId&&this.sessionId===I.sessionId:!1}isFromCurrentSession(I){return this.sessionId===I.ya.UserSessionId}}Object(c.a)(G,"SourceItem",null,[]);class T extends G{constructor(I,xa,Ua,vb,cb){super(Ua,vb);this.activeFloatingObjectControlId=I;this.sheetName=
xa;this.type=cb}isEqual(I){return I&&Object.getType(I)===T?this.Jbf(I)&&this.activeFloatingObjectControlId===I.activeFloatingObjectControlId&&this.sheetName===I.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(T,"ArtSourceItem",G,[]);var W;(function(I){I[I.valid=0]="valid";I[I.notPairwiseDisjoint=1]="notPairwiseDisjoint";I[I.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";I[I.notValidForm=3]="notValidForm";I[I.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(W||
(W={}));Object(c.b)("CopySourceValidationOptions",W);var P=a(42);class E extends G{constructor(I,xa,Ua,vb,cb){super(vb,cb);d.ULS.shipAssertTag(537167645,0,!!xa&&0<xa.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=I;this.ranges=xa;this.sheetName=Ua}isEqual(I){return I&&Object.getType(I)===E?this.Jbf(I)&&P.Q(this.ranges,I.ranges)&&this.sheetName===I.sheetName:!1}toString(){return P.i(this.ranges,",",this.$,!1)}}Object(c.a)(E,"RangeSourceItem",G,[]);const H=I=>!!I&&Object.getType(I)===
E;class F{}F.gUj="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(F,"ExpectedErrorNames",null,[]);class N{}N.plainText="text/plain";N.html="text/html";N.png="image/png";N.shadowWorkbook="data/shadow-workbook";N.kii="metadata/is-last-copy-was-external";N.Mei="metadata/is-last-copy-was-external-XLO-source";N.DWg="metadata/chrome-extension-id";N.Xpb="copyId";N.lHg="metadata/additional-signature-data-attributes";Object(c.a)(N,"ClipboardDataFormat",null,[]);const J=I=>I.clipboardItems&&
(I=I.clipboardItems.getItem(N.kii))&&"1"===I?!0:!1,R=I=>J(I)&&!(void 0===I.clipboardItems||null===I.clipboardItems)&&!!I.clipboardItems.getItem(N.png)&&!I.clipboardItems.getItem(N.plainText),M=I=>I.clipboardItems&&(I=I.clipboardItems.getItem(N.Mei))&&"1"===I?!0:!1,L=I=>I&&(I=I.getCachedMetadata(),null===I||void 0===I?0:I.lastCopy)?I.lastCopy:null;var U=a(48),X=a(21),da=a(33);class fa{constructor(I,xa,Ua,vb){this.$=I;this.originalDestinations=xa;this.q7b=Ua;this.Gjg=vb;this.Utg=this.originalDestinations;
this.xng=this.q7b;this.lrg="PasteRecoveryUI"}get kHg(){return this.Gjg}get Bqi(){return this.lrg}get $5i(){return this.Utg}get zwh(){return this.xng}lJa(){return fa.uWi}SLh(){return this.q7b&&1===this.q7b.length?this.TLh(this.q7b[0]):null}TLh(I){var xa=X.g(this.$);const Ua=xa.hb.jj(I);var vb=xa.lg(I,Ua);xa=xa.rtl;if(!vb)return null;I=X.g(this.$).Lf(Ua);const cb=I.tn;if(!cb.Ed(vb))return null;vb=cb.Fe(vb);const Xb=vb.topLeft.y;var rc=vb.bottomRight.y;const Ec=xa?vb.bottomRight.x:vb.topLeft.x;vb=xa?
vb.topLeft.x:vb.bottomRight.x;var ed=new U.a(vb+(xa?-81:81),rc+38+6);if(cb.HGa(ed))return this.w3a(I,cb,Ua,vb,rc,xa?12:-3,66);ed=new U.a(vb+(xa?-81:81),rc);if(cb.HGa(ed))return this.w3a(I,cb,Ua,vb,rc,xa?20:3,22);ed=new U.a(vb,rc+38+6);if(cb.HGa(ed))return this.w3a(I,cb,Ua,vb,rc,-81+(xa?18:0),66);vb=new U.a(Ec+(xa?81:-81),rc);if(cb.HGa(vb))return this.w3a(I,cb,Ua,Ec,rc,-81+(xa?12:-6),22);rc=new U.a(Ec,Xb-38-6);return cb.HGa(rc)?this.w3a(I,cb,Ua,Ec,Xb,xa?15:0,16):this.w3a(I,cb,Ua,xa?cb.topLeft.x:cb.bottomRight.x,
cb.bottomRight.y,-81+(xa?15:-6),22)}w3a(I,xa,Ua,vb,cb,Xb,rc){var Ec=X.g(this.$);const ed=Ec.rtl;I=Sys.UI.DomElement.getLocation(I.domElement);vb=new Sys.UI.Point(vb+(ed?0:I.x)-xa.topLeft.x,cb+I.y-xa.topLeft.y);ed&&(Ec=Ec.view.visibleArea,vb.x=Ec.bottomRight.x-Ec.topLeft.x-vb.x,2===Ua||4===Ua)&&(vb.x+=xa.bottomRight.x);vb=da.a(this.$).Uia(vb);return new Sys.UI.Point(vb.x+Xb,vb.y+rc)}}fa.uWi=["PasteRecoveryUI"];Object(c.a)(fa,"PasteRecoveryUI",null,[536]);var S=a(77),ka=a(174);class V{}V.Zyg="ActiveSelection";
V.shadowWorkbook="ShadowWorkbook";V.Qhg="GVML";V.plainText="PlainText";V.html="Html";V.wNg="Bitmap";Object(c.a)(V,"PayloadType",null,[]);class wa{}wa.HBj="Slice4";wa.IBj="Slice5";wa.JBj="Slice6";Object(c.a)(wa,"SliceName",null,[]);class ma{}ma.JCi="NotCalled";ma.success="Success";ma.failed="Failed";Object(c.a)(ma,"SucceededPopulatingSystemClipboardOptions",null,[]);var ab=a(355);const ba=(I,xa)=>I?xa&&xa.ya?I.sessionId!==xa.ya.UserSessionId:(d.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),
!1):(d.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Ca=I=>{switch(I){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},Na=I=>{if(!I)return"null";const xa=[];for(const Ua of I.get())xa.push(`${Ua.clipboardDataFormat}(${Ua.data.length})`);xa.sort();return xa.join(",")};var za;(function(I){I[I.valid=0]="valid";I[I.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";I[I.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";
I[I.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";I[I.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";I[I.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";I[I.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";I[I.copySourceNotValid=7]="copySourceNotValid";I[I.cutNotSupportedInDiscontinuousSelection=
8]="cutNotSupportedInDiscontinuousSelection";I[I.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";I[I.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";I[I.unknown=100]="unknown"})(za||(za={}));Object(c.b)("PasteValidationOptions",za);var la=a(50),aa=a(36),sa=a(145),ea=a(37),Z=a(153),ua=a(340),ya=a(31),ha=a(313),Da=a(11),nb=a(22),qa=a(97),pa=a(125),Ja=a(111),$a=a(559),rb=a(99),Pa=a(55),eb=a(195),Ob=a(64),tb=a(338);class cc extends u.a{constructor(I,xa,Ua,vb,cb,
Xb,rc,Ec,ed=null){super();this.pasteShortcutManager=null;this.Paf=r.EwaSettings.xb();this.gwa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.g8f=null;this.t6a=!1;this.Jdf=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6004791_MergedCellOverlapTelemetry");this.wpd=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.tzd=ud=>{this.svj(ud)&&(this.Gp.Zbc(),d.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};
this.mvi=(ud,Kd)=>{d.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${ud}]. userPressedExtensionLink=${Kd}`);this.gridView.focus()};this.Zc=(ud,Kd)=>{Kd.ZM||Kd.eg||this.er("OnWorkbookOpened",!1).catch(()=>{})};this.Eh=(ud,Kd)=>{ud=L(this.uK);const Zd=this.Gp.fvb(ud);Zd&&(Kd.oa&&Kd.oa.sheetName===Zd.sheetName&&Zd.isFromCurrentSession(this.$)?this.Gp.Z6e(Zd.ranges,ud.commandParameters.commandType):this.Gp.Zbc())};this.Qlc=
(ud,Kd)=>{ud=L(this.uK);(ud=this.Gp.fvb(ud))&&Kd.item&&Kd.item.sheetName===ud.sheetName&&ud.isFromCurrentSession(this.$)&&this.er("OnItemDeleting",!1).catch(()=>{})};this.nEb=(ud,Kd)=>{this.Paf?this.g8f(ud,Kd):this.lCf()};this.aR=(ud,Kd)=>{1===Kd.Kq&&Kd.wf.operation.flags&2&&this.er("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=I;this.ug=Ua;this.gridView=X.g(I);this.Gp=cb;this.Rai=Xb;this.uK=xa;this.p2b=vb;this.getStringifiedError=ed||copyPasteInfra.getStringifiedError;this.w1f=1===Ec;
this.m$c=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");this.Bj();this.copyPasteShortcutDialogFactory=this.$.da.za(85);d.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");rc||(d.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),rc=cc.$bh);this.userHash=e.a.Xv(rc);this.qzi="CultureTag: "+B.a.instance.drb+" HASH: ";
this.uK.addMetadataChangeListener(cc.Zof,this.tzd);this.fyi=ka.a.KBb;this.sxa=this.gwa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):x.a.sxa;(this.so=r.EwaSettings.getBooleanFeatureGate(ka.a.OOa,!1))&&I.da.Za(478,ud=>{this.pasteShortcutManager=ud});this.Paf&&(this.g8f=ha.a(()=>{this.lCf()},1,this.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0))}get pasteIndicationManager(){return this.$.da.za(373)}zFg(I){this.addHandler(cc.pAd,
I)}rbj(I){this.removeHandler(cc.pAd,I)}copy(I){I.stopwatch=this.$.Hb.xc("UserAction",A.b().mj(I.ribbonCommandInfo.command)+"ClientSide");if(this.so){const Xb=la.GetServiceTaskFactory.Ta(this.$.da,478,479,0);ea.TaskExtensions.Aa(Xb,()=>{this.pasteShortcutManager=Xb.result},this.la,3)}const xa=!!L(this.uK);r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.bD&&(this.t6a=!1);this.er("Copy/before/"+l.a[I.ribbonCommandInfo.method],!1,void 0,!0,I.copyPasteTargetType).catch(()=>
{});var Ua=-1985798686===I.ribbonCommandInfo.command;if(1===this.gridView.Ke&&(Ua=this.Gp.abf(this.gridView.ha.sa.selectedRanges,Ua),0!==Ua)){const Xb=cc.Q1g(Ua);this.xya(Xb,W[Ua],!1);return Promise.reject(!1)}I.userHash=this.userHash;I.id=m.a.create().toString();let vb=this,cb=this;return this.p2b.onCopy(I).then(Xb=>{Xb.isAsyncCopy||I.stopwatch.stop();vb.pasteIndicationManager.THe();const rc=ab.d(I);d.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${rc}`);
vb.mti(Xb,xa);Xb=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===I.copyPasteTargetType:!0;!I.isFormatPainter&&vb.so&&Xb&&(vb.pasteShortcutManager?vb.pasteShortcutManager.Ejh():d.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},Xb=>{let rc=!1,Ec="none",ed=cc.arb,ud=!0,Kd=-1,Zd=cc.copyErrorName+cc.fIa,Xd=!1,Je=null;if(Xb){Je=Xb.copyContext;Kd=Xb.reason;Zd+=cc.tJa(Xb);Xb.message&&(ed=Xb.message);var Xe=cc.P1g(Xb);
if(Xe)if(3===Xe.copyErrorName)rc=!0,ed=Ec="Async Copy canceled by the user.",ud=!1;else if(ya.a.ar(Xe.ewaErrors))if(ed=cb.j$b(Xe.ewaErrors),ya.a.gh(Xe.ewaErrors,cc.operationSucceededWithAlert))Xd=rc=!0;else if(ya.a.gh(Xe.ewaErrors,cc.pasteDataLimitHit)||ya.a.gh(Xe.ewaErrors,cc.copyThrottlingError))rc=!0;13===Xb.reason?(rc=!0,ud=!1):11===Xb.reason&&(ud=!1)}Xe=Xb?cb.getStringifiedError(Xb):"null";rc?(Xe=ab.d(I),d.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${ud}, Friendly message: ${Ec}, Error Message: ${ed}, CommandParameters: ${Xe}`)):
d.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${ud}, Error Message: ${Xe}, CommandParameters: ${ab.d(I)}`);ud&&cb.er("Copy/fail/"+l.a[I.ribbonCommandInfo.method],!0,void 0,void 0,I.copyPasteTargetType).catch(()=>{});cb.lti(I,rc,ed,Zd,Kd,Xd,Je);return Promise.reject(Xb)})}paste(I){I.stopwatch=this.$.Hb.xc("UserAction",A.b().mj(I.ribbonCommandInfo.command)+"ClientSide");r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!k.a.bD&&(d.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.t6a=!1,I.clipboardPicklingApiDataFormatsToRead=[N.shadowWorkbook]);X.g(this.$).Ci&&X.g(this.$).Ci.O6(this.Sdd(I.ribbonCommandInfo.command),I.stopwatch.id);if(I.isPasteCommandFromRecoveryUI){var xa=this.$.da.za(406);var Ua=this.m$c?P.d(xa.zhc):v.a.clone(xa.zhc);xa=xa.Jqd;I.pasteRecoveryCachedClipboardItems=xa?xa[cc.iFf]:null}else Ua=this.m$c?P.d(this.gridView.ha.sa.selectedRanges):
v.a.clone(this.gridView.ha.sa.selectedRanges);I.originalDestinations=Ua;I.expandDestinations=this.NXc(I.originalDestinations,I.commandType);if(this.$Xc(I.commandType,I.expandDestinations)||this.JTg())return I.userHash=this.userHash,I.id=m.a.create().toString(),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!k.a.bD&&(I.clipboardReadPermissionPromptShown=!1,I.clipboardAsyncApiDataFormatsToRead=[N.plainText+"Async"],this.p2b.shouldShowClipboardReadPermissionDialog().then(vb=>
{vb&&(I.clipboardReadPermissionPromptShown=!0,new y(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.p2b.onPaste(I).then(vb=>this.pmc(vb,I),vb=>this.$Db(I,vb));this.$.xd(927125067,S.a.Eb,30,null);Ua=P.i(I.expandDestinations,",",this.$,!1);d.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${Ua}, CommandType: ${I.commandType}, copyPasteTargetType="${I.copyPasteTargetType}"`);
return Promise.resolve(!0)}Sdd(I){if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:4313497_PasteOptionPerfTelemetry"))switch(I){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8}return 3}JTg(){return!!X.g(this.$).ha.Oa.activeFloatingObjectControlId&&this.$.oq(null,!1,470)}pAb(){const I=L(this.uK);return I&&I.commandParameters?I.commandParameters.copyPasteTargetType:0}jii(){return!!L(this.uK)&&ba(L(this.uK),this.$)}er(I,xa,Ua=!1,vb=!1,cb=0){try{this.so&&this.pasteShortcutManager&&
this.pasteShortcutManager.T4b();let Xb=cb;const rc=this.tpi();if(!vb&&2===rc)return d.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${xa}', isExplicit = '${Ua}', isForce = '${vb}', Current CCP operation copyPasteTargetType = '${cb}', LastCopyPasteTargetType = '${rc}'`),Promise.reject(null);0===Xb&&(Xb=rc);const Ec=this.$.Hb.xc("UserAction","ClearCopyState"),ed=Ec.id;d.ULS.sendTraceTag(537167820,
0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${xa}', isExplicit = '${Ua}', isForce = '${vb}', Current CCP operation copyPasteTargetType = '${cb}', LastCopyPasteTargetType = '${rc}'`);this.Gp.Zbc();this.i3i();return this.p2b.onCancelCopy(xa).then(()=>{xa&&r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.bD&&(this.t6a=!1);Ec.stop();this.Dkf(I,ed,!0,Ua,xa,"","",Ec.tc,Xb);return Promise.resolve(!0)},ud=>{var Kd=
ud?this.getStringifiedError(ud):"null";d.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${Kd}`);Ec.stop();Kd=cc.YTg+cc.fIa;let Zd=cc.arb;ud&&(Kd+=cc.tJa(ud),ud.message&&(Zd=ud.message));this.Dkf(I,ed,!1,Ua,xa,Zd,Kd,Ec.tc,Xb);return Promise.reject(ud)})}catch(Xb){return Promise.reject(null)}}XZc(I,xa,Ua=!1,vb=!1,cb=0){return vb||!r.EwaSettings.ma(652)||this.Egh()?this.er(I,xa,Ua,vb,cb):(d.ULS.sendTraceTag(537167819,0,
50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}xya(I,xa,Ua){d.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${xa}`);const vb=new rb.a;vb.ia("reason",xa);$a.a(pa.a.discontinuousSelectionBlocking,[Ua?Ja.a.oWi:Ja.a.K2g],!0,!0,!1,!1,vb);I=ya.a.Yc(1,1,756,
I,0,371863010,"DiscontinuousSelectionBlocking");r.EwaSettings.xz()?new ua.a(this.$,I):(I=new Z.ErrorDialog(this.$,I),I.initialize(),I.xf())}tpi(){const I=L(this.uK);return I&&I.sourceItem?Object.getType(I.sourceItem)===T?2:1:0}dragDropCells(I,xa,Ua,vb,cb=!1){I.stopwatch=this.$.Hb.xc("UserAction","DragDropClientSide");this.er("DragDrop/before/"+l.a[I.ribbonCommandInfo.method],!1,void 0,void 0,I.copyPasteTargetType).catch(()=>{});const Xb=cb?2:1;let rc=0;rc=cb?4:vb?256:128;const Ec={encounteredDeploymentErrors:!1};
Ec.commandParameters=I;I.userHash=this.userHash;I.id=m.a.create().toString();return this.wpd?this.Gp.pasteRange(I.ribbonCommandInfo,P.q(xa,this.$),P.q(Ua,this.$),Xb,rc,[I.stopwatch],Ec,!1,()=>{d.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${I.copyPasteTargetType}"`);this.z7a(I,Xb,xa,Ua,Ec)},ed=>{const ud=ed?this.getStringifiedError(ed):"null";d.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${ud}, copyPasteTargetType="${I.copyPasteTargetType}"`);
this.T8a(ed,I,Xb,xa,Ua,Ec)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},ed=>Promise.reject(ed)):this.Gp.pasteRange(I.ribbonCommandInfo,P.q(xa,this.$),P.q(Ua,this.$),Xb,rc,[I.stopwatch],Ec,!1,null,null).then(()=>{d.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${I.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.z7a(I,Xb,xa,Ua,Ec);return Promise.resolve(!0)},ed=>{const ud=ed?this.getStringifiedError(ed):
"null";d.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${ud}, copyPasteTargetType="${I.copyPasteTargetType}"`);this.T8a(ed,I,Xb,xa,Ua,Ec);return Promise.reject(ed)})}bhh(I,xa,Ua,vb,cb=!1){I.stopwatch=this.$.Hb.xc("UserAction","DragDropReplaceClientSide");this.XZc("DragDropReplace/before/"+l.a[I.ribbonCommandInfo.method],!1,void 0,void 0,I.copyPasteTargetType).catch(()=>{});const Xb=cb?2:1;let rc=0;rc=cb?4:vb?256:128;const Ec={encounteredDeploymentErrors:!1};Ec.commandParameters=
I;r.EwaSettings.getBooleanFeatureGate(ka.a.A5b,!1)&&(I.isDragInsert=!1);I.userHash=this.userHash;I.id=m.a.create().toString();return this.wpd?this.Gp.pasteRange(I.ribbonCommandInfo,P.q(xa,this.$),P.q(Ua,this.$),Xb,rc,[I.stopwatch],Ec,!1,()=>{d.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${I.copyPasteTargetType}"`);this.z7a(I,Xb,xa,Ua,Ec)},ed=>{const ud=ed?this.getStringifiedError(ed):"null";d.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${ud}, copyPasteTargetType="${I.copyPasteTargetType}"`);
return this.T8a(ed,I,Xb,xa,Ua,Ec)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},ed=>Promise.reject(ed)):this.Gp.pasteRange(I.ribbonCommandInfo,P.q(xa,this.$),P.q(Ua,this.$),Xb,rc,[I.stopwatch],Ec,!1,null,null).then(()=>{d.ULS.sendTraceTag(521410073,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${I.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.z7a(I,Xb,xa,Ua,Ec);return Promise.resolve(!0)},ed=>{const ud=ed?this.getStringifiedError(ed):
"null";d.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${ud}, copyPasteTargetType="${I.copyPasteTargetType}"`);this.T8a(ed,I,Xb,xa,Ua,Ec);return Promise.reject(ed)})}ahh(I,xa,Ua,vb,cb=!1){I.stopwatch=this.$.Hb.xc("UserAction","DragDropInsertClientSide");this.XZc("DragDropInsert/before/"+l.a[I.ribbonCommandInfo.method],!1,void 0,void 0,I.copyPasteTargetType).catch(()=>{});const Xb=cb?2:1,rc=P.K(this.NXc([Ua],Xb));var Ec=this.$.ea.oa.sheetName;const ed=this.$.ea.oa.sheetName,
ud=P.v(xa,this.$);ud.SheetName=Ec;Ec=P.v(rc,this.$);Ec.SheetName=ed;vb=rc.isRow||xa.isRow||vb?1:0;const Kd={encounteredDeploymentErrors:!1};I.isDragInsert=!0;Kd.commandParameters=I;I.userHash=this.userHash;I.id=m.a.create().toString();if(this.wpd)return cb=this.Gp.$He(Kd,ud,Ec,cb,vb,I.ribbonCommandInfo,()=>{d.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${I.copyPasteTargetType}"`);this.z7a(I,Xb,xa,Ua,Kd)},Xd=>{const Je=Xd?this.getStringifiedError(Xd):
"null";d.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Je}, copyPasteTargetType="${I.copyPasteTargetType}"`);this.T8a(Xd,I,Xb,xa,Ua,Kd)}),eb.c(cb.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Xd=>Promise.reject(Xd))).So(()=>!0);cb=this.Gp.$He(Kd,ud,Ec,cb,vb,I.ribbonCommandInfo,null,null);let Zd=this;return eb.c(cb.then(()=>{d.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${I.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.z7a(I,Xb,xa,Ua,Kd);return Promise.resolve(!0)},Xd=>{const Je=Xd?Zd.getStringifiedError(Xd):"null";d.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Je}, copyPasteTargetType="${I.copyPasteTargetType}"`);Zd.T8a(Xd,I,Xb,xa,Ua,Kd);return Promise.reject(Xd)})).So(()=>!0)}Qai(I,xa){var Ua=L(this.uK);if(!Ua)return d.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Pa.Task.Ua(!1);if(!H(Ua.sourceItem))return d.ULS.sendTraceTag(537167811,
0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Pa.Task.Ua(!1);var vb=Ua.sourceItem;if(!vb)return d.ULS.shipAssertTag(537167810,0,!!vb,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Pa.Task.Ua(!1);if(!vb.isFromCurrentSession(this.$))return d.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Pa.Task.Ua(!1);if(1<vb.ranges.length)return d.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),
this.xya(2186,"InsertCopiedCutCells",!0),Pa.Task.Ua(!1);Ua=P.K(vb.ranges);var cb=this.gridView.ha.sa.Wc.clone();I=P.K(this.NXc([cb],I));const Xb=this.yif();vb=vb.sheetName;cb=this.$.ea.oa.sheetName;const rc=P.v(Ua,this.$);rc.SheetName=vb;const Ec=P.v(I,this.$);Ec.SheetName=cb;return(I.Ze||Ua.Ze?Pa.Task.Ua(0):I.isRow||Ua.isRow?Pa.Task.Ua(1):this.Rai.F2b(this.$,X.g(this.$).rtl)).So(ed=>this.Gp.executeInsertCopiedCutCellsOperation(rc,Ec,Xb,ed.result,xa)).continueWith(()=>{Xb?this.Gp.Zbc():this.er("InsertCopiedCutCells/success/"+
l.a[xa.method],!0)})}Tmd(){const I=L(this.uK),xa=this.gridView.ha.sa.xg;return!!I&&H(I.sourceItem)&&xa&&1===I.sourceItem.ranges.length}yif(){return this.zif(-911352779)}yhc(){return this.zif(-1985798686)}$Xc(I,xa){var Ua=new sa.a(this.$.xa),vb=36===I;const cb=Ua.Wd(4);I=2===this.pAb()&&Ua.Wd(1);vb=vb&&cb;Ua=!Ua.ii||!this.yhc()||!sa.a.o5b(xa,X.g(this.$));return vb||I||this.$.oq(xa,!0)&&Ua}Mec(I,xa){return this.Gp.Mec(I,xa)}dispose(){super.dispose();this.ek();this.uK.removeMetadataChangeListener(cc.Zof)}o5c(I,
xa,Ua,vb,cb,Xb){if(!this.QXg(I.commandParameters.ribbonCommandInfo.command))return I.cseStatus=2,!1;if(Xb&&xa.Ed(vb))return I.cseStatus=4,!1;if(Ua!==cb)return I.cseStatus=6,!1;if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&(vb.width%xa.width||vb.height%xa.height))return I.cseStatus=16,!1;if(r.EwaSettings.getBooleanFeatureGate(ka.a.YDe,!1)){if(Ua=xa,vb=vb.Fe(this.gridView.lh),xa=null===xa.Fe(this.gridView.lh),cb=I.commandParameters.ribbonCommandInfo.command,xa&&1804571062!==
cb&&-185374993!==cb||!vb)return I.cseStatus=7,!1}else if(Ua=xa.Fe(this.gridView.lh),vb=vb.Fe(this.gridView.lh),!Ua||!vb)return I.cseStatus=7,!1;xa=P.v(Ua,this.$);xa=this.ug.sWi(this.gridView,xa,P.v(vb,this.$),I.commandParameters.ribbonCommandInfo.command,I.commandParameters.stopwatch);1===xa&&(Xb&&(this.ug.PZc(Ua,!1),this.ug.PZc(Ua,!0)),-185374993===I.commandParameters.ribbonCommandInfo.command&&X.g(this.$).U2i(),this.pasteIndicationManager.Ehd(I.commandParameters.id),this.ttc(I.commandParameters.expandDestinations,
I.commandParameters.isPasteCommandFromRecoveryUI),this.Hxe("DoPasteClientEstimation/"+l.a[I.commandParameters.ribbonCommandInfo.method],I));I.cseStatus=xa;return 1===xa}sGf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,!1,this.mvi)}llf(I,xa,Ua,vb){I=K(I,xa,Ua,vb,this.$.ya.UserSessionId);I.k=!0;A.b().Ie(45,I,!0)}dAf(I,xa,Ua,vb,cb){var Xb=!1,rc=!1,Ec=cc.arb,ed=cc.WHe+cc.fIa;I&&(ed+=cc.tJa(I),ya.a.ar(I.ewaErrors)?(Ec=this.j$b(I.ewaErrors),ya.a.gh(I.ewaErrors,[-103190598])&&(Xb=
!0)):I.message&&(Ec=I.message));rc||(rc=this.hmd(I));xa=K(xa,Ua,vb,cb,this.$.ya.UserSessionId);xa.k=!1;xa.l=rc;xa.n=Ec;xa.p=ed;xa.q=Xb;A.b().Ie(45,xa,!0);return Promise.reject(I)}QXg(I){switch(I){case 237279923:case 808159687:return ka.a.uji;case -185374993:return!0;case 1804571062:return!0;default:return!1}}zif(I){const xa=L(this.uK);if(!xa)return!1;const Ua=xa.sourceItem;return Ua&&!Ua.isFromCurrentSession(this.$)?(d.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),
!1):xa.commandParameters.ribbonCommandInfo.command===I}Egh(){var I=L(this.uK);return I?(I=I.sourceItem)&&!I.isFromCurrentSession(this.$)?(d.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),!1):!0:!1}svj(I){return I&&I.lastCopy?ba(I.lastCopy,this.$):!0}cXe(I,xa,Ua,vb,cb){const Xb={};Xb.a=this.$.ya.UserSessionId;Xb.e=I.stopwatch.id;Xb.c=A.b().mj(I.ribbonCommandInfo.command);Xb.b=l.a[I.ribbonCommandInfo.method];
Xb.d=I.id;Xb.f=Ua.toString();Xb.g=vb.toString();Xb.h=xa.toString();Xb.o=I.stopwatch.tc;Xb.q=!1;Xb.r=I.copyPasteTargetType.toString();Xb.s=cb.encounteredDeploymentErrors;r.EwaSettings.getBooleanFeatureGate(ka.a.A5b,!1)&&(Xb.i=cb.commandParameters.dragDropIsShiftKeyDown,Xb.j=cb.commandParameters.isDragInsert);return Xb}z7a(I,xa,Ua,vb,cb){I=this.cXe(I,xa,Ua,vb,cb);I.k=!0;A.b().Ie(45,I,!0)}uti(I,xa,Ua,vb,cb,Xb,rc,Ec,ed){I=this.cXe(I,xa,Ua,vb,ed);I.k=!1;I.l=cb;I.n=Xb;I.p=rc;I.q=Ec;A.b().Ie(45,I,!0)}Dkf(I,
xa,Ua,vb,cb,Xb,rc,Ec,ed){const ud={};ud.a=this.$.ya.UserSessionId;ud.b=xa;ud.c=I;ud.f=Ua;ud.e=vb;ud.d=cb;ud.g=Xb;ud.h=rc;ud.i=Ec;ud.j=ed.toString();A.b().Ie(46,ud,!0)}mti(I,xa){I=this.zWe(I.commandParameters,I);I.l=!0;I.j=xa;A.b().Ie(43,I,!0)}lti(I,xa,Ua,vb,cb,Xb,rc){I=this.zWe(I,rc);I.l=!1;I.m=xa;I.o=Ua;I.y=vb;I.x=cb;I.z=Xb;A.b().Ie(43,I,!0);d.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${I.y},ErrorReason=${I.x},IsExpectedError=${I.m},IsSucceededWithAlert=${I.z},ErrorMessage=${I.o}`)}zWe(I,
xa){const Ua={};Ua.a=this.$.ya.UserSessionId;Ua.f=I.stopwatch.id;Ua.g=I.id;Ua.c=A.b().mj(I.ribbonCommandInfo.command);Ua.b=l.a[I.ribbonCommandInfo.method];Ua.q=I.stopwatch.tc;Ua.bd=cc.v9b();Ua.bg=I.copyPasteHandlerName;Ua.bj=void 0===I.ribbonCommandInfo.Re||null===I.ribbonCommandInfo.Re?null:n.a[I.ribbonCommandInfo.Re];Ua.bq=I.uploadToClipService;Ua.br=I.floatingObjectType;Ua.s=I.copyPasteTargetType.toString();Ua.bc=Ca(I.copyPasteTargetType);Ua.z=!1;if(xa){Ua.bk=xa.id;Ua.bl=xa.serverRequestTimeInMs;
xa.requestTelemetryData&&(Ua.bm=xa.requestTelemetryData.EcsOperationDuration,Ua.bn=xa.requestTelemetryData.EcsRequestDuration,Ua.bo=xa.requestTelemetryData.WfeRequestDuration);Ua.d=xa.sourceItem?xa.sourceItem.toString():null;Ua.e=-1;if(H(xa.sourceItem)){Ua.e=0;I=xa.sourceItem.ranges;for(const vb of I)Ua.e+=vb.TG}Ua.h=xa.isAsyncCopy;Ua.i=xa.isFromCache;Ua.k=xa.isSelectionAllowed;Ua.r=xa.plainTextPayloadSize;Ua.u=xa.htmlPayloadSize;Ua.v=xa.htmlSizeExceedsLimit;Ua.w=xa.copyTotalSizeExceedsLimit;Ua.t=
xa.shadowWorkbookPayloadSize;Ua.p=xa.clientSideCopyTime;Ua.ba=xa.encounteredDeploymentErrors;Ua.bb=xa.shadowWorkbookSizeExceedsLimit;Ua.be=xa.syncClipboardItemsKeys;Ua.bf=xa.asyncClipboardItemsKeys;Ua.bh=this.SAe(xa.succeededPopulatingSystemClipboardSync);Ua.bi=this.SAe(xa.succeededPopulatingSystemClipboardAsync)}return Ua}ttc(I,xa=!1){if(!this.gridView.$a&&!this.gridView.vi){var Ua=this.gridView.ha.sa,vb=!xa&&1===I.length&&P.Q(I,Ua.selectedRanges),cb=vb?Ua.activeCell:I[0].topLeft;I[0].contains(cb)||
(d.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${Ua.selectedRanges}, IndexOfActiveRange ${Ua.Wr}, ActiveCell ${Ua.activeCell}, calculatedDestinationRanges ${I}, keepThePreviousActiveCell ${vb}, newActiveCell ${cb}, isPasteCommandFromRecoveryUI ${xa}`),cb=I[0].topLeft);this.gridView.ha.Qw(I,0,cb,0,void 0,qa.a.P2g)}}u_e(I,xa){const Ua={};Ua.a=this.$.ya.UserSessionId;Ua.g=I.stopwatch.id;Ua.t=I.stopwatch.tc;Ua.bz=!1;xa&&(Ua.bv=xa.id,Ua.bw=xa.serverRequestTimeInMs,
Ua.n=xa.commandParameters.clipboardFormatReadTimes,Ua.o=xa.commandParameters.clipboardFormatReadStatus,Ua.p=xa.commandParameters.clipboardReadPermissionPromptShown,Ua.q=xa.commandParameters.asyncApiReadTimedOut,xa.requestTelemetryData&&(Ua.cb=xa.requestTelemetryData.EcsOperationDuration,Ua.cc=xa.requestTelemetryData.EcsRequestDuration,Ua.cd=xa.requestTelemetryData.WfeRequestDuration));Ua.x=I.copyPasteTargetType.toString();Ua.bl=Ca(I.copyPasteTargetType);Ua.br=I.copyPasteHandlerName;Ua.i=P.i(I.expandDestinations,
",",this.$,!1);Ua.h=P.i(I.originalDestinations,",",this.$,!1);Ua.e=I.id;Ua.d=I.commandType;Ua.c=A.b().mj(I.ribbonCommandInfo.command);Ua.b=l.a[I.ribbonCommandInfo.method];Ua.bf=!1;Ua.bg=!1;Ua.bp=cc.v9b();Ua.bt=void 0===I.ribbonCommandInfo.Re||null===I.ribbonCommandInfo.Re?null:n.a[I.ribbonCommandInfo.Re];Ua.cj=I.isPasteCommandFromEnterShortcut;if(Ua.ca=I.isPasteCommandFromRecoveryUI)Ua.cf=I.pasteRecoveryUndoStopwatch.id,Ua.cg=I.pasteRecoveryUndoStopwatch.tc;if(xa){if((I=xa.copyContextSnapshot)&&!xa.wasLastCopyExternal){Ua.f=
I.commandParameters.id;Ua.j=I.sourceItem.toString();Ua.k=-1;if(H(I.sourceItem)){Ua.k=0;const vb=I.sourceItem.ranges;for(const cb of vb)Ua.k+=cb.TG}Ua.bg=1===I.commandParameters.commandType}else xa.clipboardItems?Ua.f=xa.clipboardItems.getItem(N.Xpb):d.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");Ua.bz=xa.pasteRecoveryUIDisplayed;Ua.ci=xa.cseStatus}else d.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");
return Ua}Dui(I,xa,Ua,vb,cb,Xb,rc,Ec,ed){I=this.u_e(I,Ec);I.l=!1;I.m=xa;I.s=Ua;I.bc=vb;I.be=cb;I.bd=Xb;I.bf=rc;Ec?(I.y=J(Ec)||!Ec.copyContextSnapshot,I.bi=!I.y&&ba(Ec.copyContextSnapshot,this.$),I.bj=Ec.shadowWorkbookSizeExceedsLimit,I.v=Ec.shadowWorkbookPayloadSize,I.w=Ec.htmlPayloadSize,I.bq=Na(Ec.clipboardItems),I.bb=Ec.activeSelectionType,I.bs=Ec.isSameSession,I.bn=Ec.payloadOrigin,I.bo=Ec.payloadType,I.bu=Ec.externalAppSource,I.bx=Ec.indicationDisplayScheduled,I.by=Ec.pasteIndicationDisplayStatus,
I.ck=Ec.pasteDestinationHasMergedCells):I.bi=ba(ed,this.$);A.b().Ie(44,I,!0);d.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${I.be},ErrorReason=${I.bd},IsExpectedError=${I.m},IsSucceededWithAlert=${I.bf},ErrorMessage=${I.s}`)}Eui(I){const xa=this.u_e(I.commandParameters,I);xa.y=I.wasLastCopyExternal;xa.l=!0;xa.u=I.plainTextPayloadSize;xa.v=I.shadowWorkbookPayloadSize;xa.w=I.htmlPayloadSize;xa.z=I.isClipboardDataContainShadowWorkbook;xa.ba=I.isShadowWorkbookParsedSuccessfully;
xa.bb=I.activeSelectionType;xa.bc=I.pasteResult;xa.bh=I.encounteredDeploymentErrors;xa.bj=I.shadowWorkbookSizeExceedsLimit;xa.bk=M(I);xa.bq=Na(I.clipboardItems);xa.bs=I.isSameSession;xa.bn=I.payloadOrigin;xa.bo=I.payloadType;xa.bu=I.externalAppSource;xa.bx=I.indicationDisplayScheduled;xa.by=I.pasteIndicationDisplayStatus;xa.ck=I.pasteDestinationHasMergedCells;xa.bm=I.clipboardItems?I.clipboardItems.getItem(N.DWg):null;xa.bi=!I.isSameSession&&!I.wasLastCopyExternal;A.b().Ie(44,xa,!0)}Bj(){this.$.xa.Pf(this.Eh);
this.$.xa.cme(this.Qlc);this.$.userOperationManager.Fr(this.aR);this.$.el(this.Zc);X.g(this.$).Wb.Mk(this.nEb)}ek(){this.$&&this.$.xa&&(this.$.xa.Ag(this.Eh),this.$.xa.pPf(this.Qlc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.Co(this.aR);this.gridView&&this.gridView.Wb&&this.gridView.Wb.Gk(this.nEb)}$Db(I,xa){var Ua=null;let vb=!1;var cb=null;let Xb="UnknownFailure",rc=-1,Ec=cc.arb,ed=cc.pasteErrorName+cc.fIa,ud=!1;this.pasteIndicationManager.Ehd(I.id);this.Jdf&&this.pasteDestinationHasMergedCells(I.expandDestinations)&&
(xa.pasteContext.pasteDestinationHasMergedCells=!0);const Kd=L(this.uK);(I.clearStateOnFinish||I.clearSystemClipboard)&&this.er("Paste/fail/"+l.a[I.ribbonCommandInfo.method],!0,void 0,void 0,I.copyPasteTargetType).catch(()=>{});if(xa){rc=xa.reason;ed+=cc.tJa(xa);xa.message&&(Ec=xa.message);if(Ua=cc.c2g(xa))if(1===Ua.pasteErrorName)vb=!0,Xb="CopyPasteLengthTooLongPopup",Ec=cb="The pasted content is too long. Popup a dialog to the user.",d.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${cb}, copyPasteTargetType="${I.copyPasteTargetType}"`),
Ua=ya.a.Yc(1,0,26,695,0,1306609195,"CopyPasteOversizeError"),r.EwaSettings.xz()?new ua.a(this.$,Ua):(Ua=new Z.ErrorDialog(this.$,Ua),Ua.initialize(),Ua.xf());else if(7===Ua.pasteErrorName)vb=!0,Xb="No-Op",Ec=cb="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",d.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${cb}, copyPasteTargetType="${I.copyPasteTargetType}"`);else if(8===Ua.pasteErrorName)vb=!0,Xb="UseShortcutsPopup",
Ec=cb="Unable to paste content from the system clipboard. Popup dialog to the user.",d.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${cb}, copyPasteTargetType="${I.copyPasteTargetType}"`),this.sGf();else if(18===Ua.pasteErrorName){vb=!0;Xb="PasteExternalNotSupportMultipleSelectionPopup";Ec="Paste external not support multiple selection.";cb="Unknown";var Zd=2186;100!==Ua.validationFailureReason&&(cb=za[Ua.validationFailureReason],Zd=cc.LAe(Ua.validationFailureReason));this.xya(Zd,
cb,!0)}else 20===Ua.pasteErrorName||19===Ua.pasteErrorName?(vb=!0,20===Ua.pasteErrorName?(Xb="PasteAcrossSessionNotSupportMultipleSelectionPopup",Ec="Paste across session does not support multiple selection."):(Xb="PasteInSameSessionNotSupportMultipleSelectionPopup",Ec="This kind of multiple selection is not supported for same session paste."),cb="Unknown",Zd=2186,100!==Ua.validationFailureReason&&(cb=za[Ua.validationFailureReason],Zd=cc.LAe(Ua.validationFailureReason)),Ua=6===Ua.validationFailureReason,
this.$Xc(I.commandType,I.expandDestinations)&&Ua&&this.ttc(I.expandDestinations),this.xya(Zd,cb,!0)):6===Ua.pasteErrorName?(vb=!0,Xb="No-Op",Ec=cb="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",d.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${cb}, copyPasteTargetType="${I.copyPasteTargetType}"`)):17===Ua.pasteErrorName?(vb=!0,Xb="No-Op",Ec=cb="Paste text on Art is not yet a supported operation",d.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${cb}, copyPasteTargetType="${I.copyPasteTargetType}"`)):
16===Ua.pasteErrorName?(vb=!0,Xb="No-Op",Ec=cb="Paste has failed because the previous copy has failed",Ua=this.getStringifiedError(Ua),d.ULS.sendTraceTag(537167771,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${cb}, copyPasteTargetType="${I.copyPasteTargetType}", error=${Ua}`)):ya.a.ar(Ua.ewaErrors)?(ya.a.k9(Ua.ewaErrors)||ya.a.gh(Ua.ewaErrors,ya.a.Sac())?(vb=!0,Xb="CommunicationError",cb=ya.a.zc(Ua.ewaErrors),d.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ec} copyPasteTargetType="${I.copyPasteTargetType}"`)):
ya.a.gh(Ua.ewaErrors,cc.rjj)?(vb=!0,Xb="SavingWorkbookError",cb=ya.a.zc(Ua.ewaErrors),d.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ec} copyPasteTargetType="${I.copyPasteTargetType}"`)):ya.a.gh(Ua.ewaErrors,cc.operationSucceededWithAlert)&&(ud=vb=!0,Xb="OperationSucceededWithAlert",cb=ya.a.zc(Ua.ewaErrors),d.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ec} copyPasteTargetType="${I.copyPasteTargetType}"`)),vb||(Ec=this.j$b(Ua.ewaErrors),vb=this.hmd(xa))):
11===Ua.pasteErrorName&&(vb=!0,Xb="No-Op",Ec="Paste has failed because user try copy cross-session oart object");15===xa.reason&&(vb=!0,Xb="No-Op",Ec="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");nb.a.equals(ed,F.gUj,!1)&&(vb=!0,Xb="No-Op",Ec="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}vb||(Ua=xa?this.getStringifiedError(xa):"null",d.ULS.sendTraceTag(24150916,
0,10,`CopyPasteInfrastructure.OnPasteFailed: ${Ua}, copyPasteTargetType="${I.copyPasteTargetType}"`));this.Dui(I,vb,Ec,Xb,ed,rc,ud,xa.pasteContext,Kd);return Promise.reject(xa)}pmc(I,xa){var Ua;d.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${xa.copyPasteTargetType}"`);this.pasteIndicationManager.Ehd(xa.id);if(this.xWi(xa.copyPasteTargetType,I)){r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&
!k.a.bD&&I.wasLastCopyExternal&&I.payloadType===V.shadowWorkbook&&(this.t6a=!0);var vb=null;(null===(Ua=I.pastedRange)||void 0===Ua?0:Ua.Ranges)&&0<I.pastedRange.Ranges.length?vb=P.g(I.pastedRange.Ranges):I.wasLastCopyExternal||(vb=xa.expandDestinations);this.clj(I,vb);if(this.nxj(I,vb)){let cb;this.m$c?(Ua=P.d(xa.originalDestinations),cb=1028===xa.commandType?P.d(xa.expandDestinations):P.d(vb)):(Ua=v.a.clone(xa.originalDestinations),cb=1028===xa.commandType?v.a.clone(xa.expandDestinations):v.a.clone(vb));
let Xb=null;I.wasLastCopyExternal&&(xa.isKeyboardEvent||xa.isPasteCommandFromRecoveryUI)&&(Xb={[cc.iFf]:I.clipboardItems});this.Jdf&&this.pasteDestinationHasMergedCells(xa.expandDestinations)&&(I.pasteDestinationHasMergedCells=!0);I.pasteRecoveryUIDisplayed=!0;const rc=new fa(this.$,Ua,cb,Xb),Ec=la.GetServiceTaskFactory.Ta(this.$.da,406,405,0);ea.TaskExtensions.Aa(Ec,()=>{const ed=Ec.result;ed.vNg(rc);ed.yAj(xa.ribbonCommandInfo.method)},this.la,8)}!I.pasteRecoveryUIDisplayed&&vb.length&&(vb=P.K(vb),
w.AFrameworkApplication.zF("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&vb&&(Ua=Ob.d(this.$.xa.oa),vb=new tb.a(vb,Ua),this.NVd(vb,"CutAndPaste")))}this.Hxe("Paste/success/"+l.a[xa.ribbonCommandInfo.method],I);this.Eui(I);this.w1f&&(!xa.isKeyboardEvent||M(I))&&this.$.ea.Sg.get(66)&&(d.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),
this.w1f=!1,this.H3g());return Promise.resolve(!0)}nxj(I,xa){return!xa||1!==xa.length||I.commandParameters.clearSystemClipboard||I.commandParameters.clearStateOnFinish||I.commandParameters.skipClipboardAccess?!1:J(I)&&(xa=I.clipboardItems.getItem(N.plainText),I=I.clipboardItems.getItem(N.html),void 0===xa||null===xa||xa.length>this.fyi||void 0===I||null===I||I.length>this.sxa)?(d.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),
!1):!0}xWi(I,xa){return 1===I||xa.payloadType===V.plainText||r.EwaSettings.ma(161)&&xa.payloadType===V.html||r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.bD&&xa.payloadType===V.shadowWorkbook}pasteDestinationHasMergedCells(I){const xa=X.g(this.$).Ea.bF();if(!xa||!xa.length)return!1;for(const Ua of xa)if(Ua.mw(I[0]))return!0;return!1}Hxe(I,xa){let Ua;({lGa:Ua}=this.Kei(xa)).returnValue&&this.er(I,Ua,void 0,void 0,xa.commandParameters.copyPasteTargetType).catch(()=>
{})}T8a(I,xa,Ua,vb,cb,Xb){var rc=I?this.getStringifiedError(I):"null";d.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${rc}`);let Ec=rc=!1,ed=!1,ud=cc.arb,Kd=cc.WHe+cc.fIa;I&&(Kd+=cc.tJa(I),ya.a.ar(I.ewaErrors)?(ud=this.j$b(I.ewaErrors),ya.a.gh(I.ewaErrors,cc.operationSucceededWithAlert)&&(rc=!0),ya.a.gh(I.ewaErrors,cc.dragDropNonEmptyRange)&&(Ec=ed=!0)):I.message&&(ud=I.message));ed||(ed=this.hmd(I));Ec?this.gridView.ha.selectionType=-1:this.Gp.c6i(cb);this.uti(xa,
Ua,vb,cb,ed,ud,Kd,rc,Xb)}NXc(I,xa){let Ua=I;const vb=this.YPh();if(null===vb||void 0===vb?0:vb.ranges)Ua=this.Gp.XSg(xa,vb.ranges,I);return Ua}YPh(){const I=L(this.uK);return I&&H(I.sourceItem)?I.sourceItem:null}i3i(){this.raiseEvent(cc.pAd,null)}clj(I,xa){const Ua=I.commandParameters.originalDestinations;xa&&(P.Q(this.gridView.ha.sa.selectedRanges,Ua)?(this.ttc(xa),I=Da.HelperMethods.knb(xa),d.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${I}`)):
I.commandParameters.isPasteCommandFromRecoveryUI?(this.ttc(xa,!0),d.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${xa}, active cell: ${xa[0].topLeft}`)):(I=Da.HelperMethods.knb(Ua),d.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${I}`)))}Kei(I){if(I.isPlainTextPaste||
I.isHtmlPaste||R(I)||I.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,lGa:!1};var xa=I.copyContextSnapshot;if(I.commandParameters.clearStateOnFinish)return{returnValue:!0,lGa:!0};if(xa&&H(xa.sourceItem)){var Ua=xa.sourceItem;if(!Ua.isFromCurrentSession(this.$))return{returnValue:!1,lGa:!0};xa=-1985798686===xa.commandParameters.ribbonCommandInfo.command;if(!(1<Ua.ranges.length||1<I.commandParameters.expandDestinations.length)){const vb=P.K(Ua.ranges);I=P.K(I.commandParameters.expandDestinations);
const cb=this.$.ea.oa.sheetName;Ua=Ua.sheetName;if(Ua===cb&&I.equals(vb))return{returnValue:!1,lGa:!0};if(Ua===cb&&I.Fe(vb))return{returnValue:!0,lGa:!1}}return{returnValue:xa,lGa:!0}}return{returnValue:!1,lGa:!0}}lCf(){var I=L(this.uK);(I=this.Gp.fvb(I))&&I.isFromCurrentSession(this.$)&&this.er("OnStartEdit",!1).catch(()=>{})}j$b(I){I=ya.a.GMh(I,cc.fIa);return this.qzi+e.a.Xv(I).toString()}hmd(I){I=cc.tJa(I);return!!I&&nb.a.i1a(I,cc.pzi)}H3g(){const I=ya.a.Yc(1,2,332,333,k.a.fp?334:k.a.FH?335:336,
530046625,"ActivateLocalStorage"),xa=la.GetServiceTaskFactory.Ta(this.$.da,5,4,0);ea.TaskExtensions.Aa(xa,()=>{xa.result.Yf(43,I)},this.la,3)}SAe(I){return void 0===I||null===I?ma.JCi:I?ma.success:ma.failed}static c2g(I){const xa=I.innerError;return xa&&0!==xa.pasteErrorName?I.innerError:null}static P1g(I){const xa=I.innerError;return xa&&0!==xa.copyErrorName?I.innerError:null}static tJa(I){let xa="";if(!I)return cc.dFe;I.errorName&&(xa=I.errorName,I.innerError&&(xa+=cc.fIa+cc.tJa(I.innerError)));
xa||(xa=I&&I.name?I.name:cc.dFe);return xa}static v9b(){cc.KR||(aa.a.Ydf()?cc.KR=wa.JBj:aa.a.wnd()?cc.KR=wa.IBj:cc.KR=wa.HBj);return cc.KR}static LAe(I){switch(I){case 7:case 1:return 2193;case 5:return 2190;case 6:return 2189;case 8:case 3:case 2:case 4:case 9:case 10:return 2186;default:return d.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${I}`),2193}}static Q1g(I){switch(I){case 3:return 2187;case 1:return 2188;
case 2:case 4:return 2186;default:return d.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${I}`),2193}}NVd(I,xa){ea.TaskExtensions.Aa(la.GetServiceTaskFactory.Ta(this.$.da,426,427,1),Ua=>{void Ua.result.b7(I,xa);d.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}cc.Zof="EwaJsMetadataChangeListenerId";cc.pAd=
"cpiOSC";cc.$bh="cpiDID";cc.arb="Unknown";cc.dFe="UnknownError";cc.fIa="_";cc.WHe="DragAndDropError";cc.pasteErrorName="PasteError";cc.YTg="CancelError";cc.copyErrorName="CopyError";cc.pzi="MergedCellOverlap";cc.iFf="PasteRecoveryCachedClipboardItems";cc.rjj=[1352631530,1679665408];cc.operationSucceededWithAlert=[-103190598];cc.pasteDataLimitHit=[1306609195];cc.copyThrottlingError=[-386183710];cc.dragDropNonEmptyRange=[563945982];cc.KR=null;Object(c.a)(cc,"CopyPasteInfrastructure",u.a,[528,529,3]);
class Ib{constructor(){this.f_a=this.Txe=null}}Object(c.a)(Ib,"ClipboardPlatformInitializationResult",null,[]);var Mb=a(184),Oa=a(636),Aa=a(548),Ba=a(120),ob=a(5),xb=a(62);const Va=(I,xa,Ua,vb,cb,Xb,rc,Ec,ed,ud=null)=>{ed=I.Na(9,ed);ed.sourceRanges=xa;ed.destinationRanges=Ua;ed.flags=vb;return xb.g(I,"PasteRange",ed,cb,Xb,rc,Ec,64,ud)},bb=(I,xa,Ua,vb,cb,Xb,rc,Ec=null)=>{rc=I.Na(1,rc);rc.pasteHtmlParameters=xa;return xb.g(I,"PasteHtmlContent",rc,Ua,vb,cb,Xb,64,Ec)},ra=(I,xa,Ua,vb,cb,Xb,rc,Ec,ed=null)=>
{Ec=I.Na(9,Ec);Ec.destinationRange=xa;Ec.source=Ua;return xb.g(I,"PasteString",Ec,vb,cb,Xb,rc,64,ed)},Qa=(I,xa,Ua,vb,cb,Xb,rc=null,Ec=null)=>{rc=I.Na(1,rc);rc.copyParameters=xa;return xb.g(I,"Copy",rc,Ua,vb,cb,Xb,0,Ec)},qb=(I,xa,Ua,vb,cb,Xb,rc=null,Ec=null)=>{rc=I.Na(1,rc);rc.copyParameters=xa;return xb.g(I,"Cut",rc,Ua,vb,cb,Xb,0,Ec)},Wa=(I,xa,Ua,vb,cb,Xb,rc=null,Ec=null)=>{rc=I.Na(1,rc);rc.pasteParameters=xa;return xb.g(I,"Paste",rc,Ua,vb,cb,Xb,64,Ec)};class ta{constructor(I,xa,Ua){this.destinationRange=
this.sourceRange=null;this.pasteFlags=0;this.sourceRange=I;this.destinationRange=xa;this.pasteFlags=Ua}}Object(c.a)(ta,"MacroRecorderPasteRangePayload",null,[116]);class ib{constructor(I,xa){this.content=this.destinationRange=null;this.destinationRange=I;this.content=xa}getContent(){return this.content}}Object(c.a)(ib,"MacroRecorderPasteStringPayload",null,[116]);class Bb{constructor(I){this.pasteParameters=null;this.pasteParameters=I}}Object(c.a)(Bb,"MacroRecorderPastePayload",null,[116]);var Ub=
a(579),Ta=a(759),mb=a(510),Qb=a(170),Lb=a(208),Jb=a(121),Ab=a(280);const pb=(I,xa,Ua,vb,cb,Xb,rc=null)=>{rc=I.Na(41,rc);rc.insertCopiedCutCellsParameters=xa;return xb.g(I,"InsertCopiedCutCells",rc,Ua,vb,cb,Xb,4)},va=(I,xa,Ua,vb,cb,Xb,rc=null)=>{rc=I.Na(41,rc);rc.insertCopiedCutCellsParameters=xa;return xb.g(I,"InsertCopiedCutCellsV2",rc,Ua,vb,cb,Xb,0)};class db{constructor(I){this.parameters=null;this.parameters=I}getParameters(){return this.parameters}}Object(c.a)(db,"MacroRecorderRangeCopyCutCellsInsertedPayload",
null,[116]);var Ya=a(368);class gb{constructor(I,xa,Ua,vb,cb,Xb,rc,Ec,ed){this.destinationRange=I;this.Xpb=Ua;this.gFf=vb;this.Jd=cb;this.NNb=Xb;this.pasteContext=rc;this.Yob=Ec;this.hVd=ed}}Object(c.a)(gb,"PasteHtmlRequestParams",null,[]);class Ka{constructor(I,xa){this.lhc=this.pMa=null;this.vOa=ka.a.vOa;this.GBd=ka.a.GBd;this.KBb=ka.a.KBb;this.hec=r.EwaSettings.getBooleanFeatureGate(ka.a.m3b,!1);this.Umd=ka.a.Umd;this.Ikd=!1;this.gwa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",
!1);this.Hz=(Ua,vb)=>{if(2===vb.Kq)this.qv.clear(),this.pMa=null;else if(1===vb.Kq&&this.qv&&this.qv.contains(vb.wf)){Ua=Ba.a(vb.wf.operation.operationName);const cb=vb.wf.dequeueUtcTime.getTime()-vb.wf.enqueueUtcTime.getTime();d.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${Ua} returned, it took ${cb} milliseconds to complete.`);this.qv.remove(vb.wf);this.pMa=null}};this.$=I;this.gridView=xa;this.Ikd&&(this.$.userOperationManager.Fr(this.Hz),this.qv=new Mb.a)}get sxa(){return this.gwa?
r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):x.a.sxa}copy(I,xa,Ua,vb=null,cb=null){const Xb=this.$.pa.va.Qb();this.Ikd&&this.tX();var rc=(Ec,ed,ud)=>{const Kd={CopyPasteTargetType:1};Kd.SourceRanges=I;Kd.CopyOperationId=xa.id;d.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.gwa}, CopyOperationId : ${Kd.CopyOperationId}`);return this.pMa=this.gwa?Qa(this.$.pa.cw,Kd,Ab.b(Ec,
Ua),vb?Ab.a(ed,vb):ed,ud,xa.ribbonCommandInfo,Xb,cb):Qa(this.$.pa.va,Kd,Ab.b(Ec,Ua),vb?Ab.a(ed,vb):ed,ud,xa.ribbonCommandInfo,Xb,cb)};this.lhc=Xb.ClientRequestId;rc=r.EwaSettings.fc()?new Qb.a(505,0,rc,80):new mb.a(505,0,rc,16);rc=this.$.userOperationManager.Ub(rc,xa.ribbonCommandInfo);this.Ikd&&this.qv.add(rc)}hFf(I,xa,Ua,vb,cb,Xb){return new Promise((rc,Ec)=>{var ed;const ud=Xb.commandParameters.stopwatch.tc;let Kd=2;20===Xb.commandParameters.commandType&&(Kd=16);36===Xb.commandParameters.commandType&&
(Kd=32);aa.a.wnd()&&68===Xb.commandParameters.commandType&&(Kd=64);aa.a.$pd(this.$)&&1028===Xb.commandParameters.commandType&&(Kd=1024);let Zd=null;if(null===(ed=Xb.copyContextSnapshot)||void 0===ed?0:ed.commandParameters)Zd=Xb.copyContextSnapshot.commandParameters.id;Ka.lMd(this.$,I,vb,xa,Ua,null,Xd=>{Ka.rbc(Xd,Xb,rc,Ec,ud,this.$,null,null,null)},Xd=>{Xb.serverRequestTimeInMs=Xb.commandParameters.stopwatch.tc-ud;Xd=Jb.a.kf(Xd.data);Ec(new Ta.a(5,Xd))},cb,Kd,Zd,Xb.commandParameters.id)})}pasteRange(I,
xa,Ua,vb,cb,Xb,rc,Ec,ed,ud){return new Promise((Kd,Zd)=>{const Xd=rc.commandParameters.stopwatch.tc;Ka.omj(this.$,I,xa,Ua,vb|-5&cb,Je=>{Ka.rbc(Je,rc,Kd,Zd,Xd,this.$,null,ed,ud)},Je=>{rc.serverRequestTimeInMs=rc.commandParameters.stopwatch.tc-Xd;Je=Jb.a.kf(Je.data);Je=new Ta.a(5,Je);null===ud||void 0===ud?void 0:ud(Je);Zd(Je)},Xb,Ec)})}t0i(I,xa,Ua,vb,cb,Xb,rc){return(new Promise((Ec,ed)=>{if(xa)if(xa.length>this.sxa){var ud=rc.clipboardItems.getItem(N.plainText);let Kd=-1;void 0!==ud&&null!==ud&&(Kd=
ud.length);ka.a.Vbf&&xa.length<this.GBd&&xa.length>this.vOa&&(this.lGf(xa),this.HK=new gb(I,xa,Ua,vb,cb,Xb,rc,0,this.Rnc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.WBd()));d.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${xa.length}, MaxHtmlImportLength: ${this.sxa}, PlainTextLength: ${Kd}`);ed(new Ta.a(1))}else ud=(Kd,Zd,Xd)=>{this.$.sy();const Je=rc.commandParameters.stopwatch.tc;Kd=Ab.b(Kd,
df=>{Ka.rbc(df,rc,Ec,ed,Je,this.$,xa,null,null)});Zd=Ab.a(Zd,df=>{rc.serverRequestTimeInMs=rc.commandParameters.stopwatch.tc-Je;df=Jb.a.kf(df.data);ed(new Ta.a(3,df))});const Xe=this.$.pa.va.Qb(),Ke=P.v(I,this.$),Qe={};Qe.SourceHtml=xa;Qe.DestinationRanges=Ke?P.s(Ke):null;Qe.CopyOperationId=Ua;Qe.PasteId=vb;d.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.gwa}. PasteId : ${Qe.PasteId}`);return this.gwa?bb(this.$.pa.cw,Qe,Kd,Zd,Xd,null,
Xe,Xb):bb(this.$.pa.va,Qe,Kd,Zd,Xd,null,Xe,Xb)},ud=r.EwaSettings.fc()?new Qb.a(204,0,ud,65):new mb.a(204,0,ud,1),this.$.userOperationManager.Ub(ud,cb);else Ec("")})).then(()=>{ka.a.Vbf&&xa.length>this.vOa&&(this.lGf(xa),this.HK=new gb(I,xa,Ua,vb,cb,Xb,rc,0,this.Rnc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.WBd()))})}lGf(I){const xa=this.$.Hb.xc("Task","pasteHtmlChunkOperation"),Ua=Math.floor(I.length/this.vOa)+1;this.Rnc=Array(Ua);let vb=0;for(;vb<Ua;)this.Rnc[vb]=I.substring(vb*
this.vOa,(vb+1)*this.vOa),vb++;d.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${xa.tc}`)}WBd(){const I=this.Rnc[this.HK.Yob],xa=this.$.Hb.xc("Task","pasteHtmlServerCall");this.qWi(this.HK.destinationRange,I,this.HK.Xpb,this.HK.gFf,this.HK.Jd,this.HK.NNb,this.HK.pasteContext,this.HK.Yob,this.HK.hVd);this.HK.Yob++;d.ULS.sendTraceTag(523257953,0,15,`CopyPasteUtils.performChunkedPasteHtml server call time: ${xa.tc},
       pasteid:${this.HK.gFf},
       chunkIndex:${this.HK.Yob},
       totalChunks:${this.HK.hVd}`);this.HK.Yob<this.HK.hVd&&window.requestIdleCallback(()=>this.WBd())}qWi(I,xa,Ua,vb,cb,Xb,rc,Ec,ed){var ud=(Kd,Zd,Xd)=>{const Je=rc.commandParameters.stopwatch.tc;Kd=Ab.b(Kd);Zd=Ab.a(Zd,()=>{rc.serverRequestTimeInMs=rc.commandParameters.stopwatch.tc-Je});const Xe=this.$.pa.va.Qb();var Ke=P.v(I,this.$);Ke={SourceHtml:xa,DestinationRanges:Ke?P.s(Ke):null,CopyOperationId:Ua,PasteId:`${vb}_chunk_${Ec}`,ChunkIndex:Ec,TotalChunks:ed};d.ULS.sendTraceTag(523257952,0,50,
`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.gwa}. PasteId : ${Ke.PasteId}`);return bb(this.$.pa.cw,Ke,Kd,Zd,Xd,null,Xe,Xb)};ud=r.EwaSettings.fc()?new Qb.a(204,0,ud,65):new mb.a(204,0,ud,1);this.$.userOperationManager.Ub(ud,cb)}u0i(I,xa,Ua,vb,cb){return new Promise((Xb,rc)=>{d.ULS.sendTraceTag(537167754,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${cb.id}`);xa&&(xa=nb.a.trimEnd(xa,"\n","\r"));d.ULS.sendTraceTag(537167753,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${cb.id}`);if(xa)if(xa.length>this.KBb)d.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",xa.length,this.KBb),rc(new Ta.a(1));else{let ed,ud;const Kd=P.v(I,this.$);d.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${cb.id}`);
var Ec=!this.$.ea.isNamedObjectViewMode&&!xa.includes("\n")&&!xa.includes("\t");d.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${cb.id}. treatAsLink=${Ec}`);Ec=Ec&&nb.a.xdf(xa);d.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${cb.id}. treatAsLink=${Ec}`);const Zd=this.$.pa.va.Qb();if(Ec){ud=526;d.ULS.sendTraceTag(537167749,0,
50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${cb.id}`);const Xd=Lb.a.n$c(xa);d.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${cb.id}`);const Je=P.s(Kd);Ec=(Xe,Ke,Qe)=>{const df=cb.commandParameters.stopwatch.tc;Xe=Ab.b(Xe,Ne=>{d.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${cb.id}`);
cb.requestTelemetryData=Ne.RequestTelemetryData;cb.serverRequestTimeInMs=cb.commandParameters.stopwatch.tc-df;Ne.Errors&&0<Ne.Errors.length?rc(new Ta.a(2,Ne.Errors)):Xb(xa)});Ke=Ab.a(Ke,Ne=>{cb.serverRequestTimeInMs=cb.commandParameters.stopwatch.tc-df;Ne=Jb.a.kf(Ne.data);rc(new Ta.a(2,Ne))});this.$.sy();d.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${cb.id}`);return xb.b(this.$.pa.va,Je,xa,Xd,!1,!1,63,Xe,Ke,Qe,
I,Zd,vb)};ed=()=>new Ub.a(Je,xa,Xd)}else ud=180,Ec=(Xd,Je,Xe)=>{this.$.sy();const Ke=cb.commandParameters.stopwatch.tc;Xd=Ab.b(Xd,Qe=>{d.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${cb.id}`);Ka.rbc(Qe,cb,Xb,rc,Ke,this.$,xa,null,null)});Je=Ab.a(Je,Qe=>{cb.serverRequestTimeInMs=cb.commandParameters.stopwatch.tc-Ke;Qe=Jb.a.kf(Qe.data);rc(new Ta.a(4,Qe))});d.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${cb.id}`);
return ra(this.$.pa.va,Kd,xa,Xd,Je,Xe,null,Zd,vb)},ed=()=>new ib(Kd,xa);d.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserNonBlockingWebMethodOperation. pasteContext.Id=${cb.id}`);Ec=r.EwaSettings.fc()?new Qb.a(ud,0,Ec,65,ed):new mb.a(ud,0,Ec,1,ed);d.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${cb.id}`);this.$.userOperationManager.Ub(Ec,Ua)}else Xb("")})}Z6e(I,xa){xa=[1===
xa?4:5];this.gridView.ob.yv(tb.a.Y6(Ob.d(this.$.oa),I),xa,!0);this.gridView.ob.Bn(xa);this.gridView.ob.update(!0)}Zbc(){const I=[4,5];this.gridView.ob.Tg(I,!1,!1);this.gridView.ob.wi(null,I,!1);1===this.gridView.ha.Ke&&this.gridView.Bn(!1,!1);this.gridView.ob.update(!1,!1)}XSg(I,xa,Ua){const vb=[];for(const cb of Ua)vb.push(this.$Sg(I,xa,cb));return vb}tX(){if(this.qv)for(let I of this.qv)if(this.$&&this.$.userOperationManager){if(I.operation){const xa=Ba.a(I.operation.operationName);d.ULS.sendTraceTag(526758675,
0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${xa}.`)}this.WTg();this.$.userOperationManager.Zsa(I)}}WTg(){if(this.pMa){const I=this.pMa.Ot;d.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${I}`);Jb.a.wu(I);!r.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.lhc&&xb.h(this.$.pa.va,this.lhc,null,null,null);this.lhc=this.pMa=null}}$Sg(I,xa,Ua){d.ULS.shipAssertTag(537167713,0,!!xa,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");
d.ULS.shipAssertTag(537167712,0,0<xa.length,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let vb=0,cb=0;var Xb=new Set;const rc=new Set;for(const Ec of xa){xa=`${Ec.left}_${Ec.right}`;const ed=`${Ec.top}_${Ec.bottom}`;rc.has(xa)||(rc.add(xa),cb+=Ec.width);Xb.has(ed)||(Xb.add(ed),vb+=Ec.height)}if(36===I)return Ua.isSingle?Ka.cQe(cb,vb,Ua):Ua.clone();516===I&&(I=vb,vb=cb,cb=I);I=!(Ua.width%cb)&&!(Ua.height%vb);Xb=Ua.xZ&&!(Ua.height%vb);Ua.x4&&!(Ua.width%cb)||
Xb?Ua=Ka.cQe(cb,vb,Ua):I?Ua=Ua.clone():(Ua=Ua.clone(),Ua.bottom=Math.min(x.a.mh,Ua.top+vb-1),Ua.right=Math.min(x.a.Ch,Ua.left+cb-1));return Ua}wKg(I,xa,Ua,vb,cb,Xb,rc,Ec,ed,ud,Kd){if(!vb||!vb.length)return 1;if(1<vb.length){if(!this.hec&&Xb)return 3;if(ud)return 0;if(Ec)return 9;if(ed)return 8;if(Kd)return 2;if(1<xa.length)return 4;const Zd=xa[0];if(!rc&&!v.a.all(vb,Xd=>Xd.isSingle||!(Xd.width%Zd.width)&&!(Xd.height%Zd.height)))return 5;if((!this.hec||!Xb)&&nb.a.equals(I,Ua,!0))for(const Xd of cb)if(Xd.Ed(Zd)&&
!Xd.equals(Zd))return 6}else if(xa&&0<xa.length){if(0!==this.abf(xa,ed))return 7;if(1<xa.length){if(!this.hec&&Xb)return 3;if((!this.hec||!Xb)&&nb.a.equals(I,Ua,!0))for(const Zd of xa)if(I=cb[0],Zd.Ed(I)&&!Zd.equals(I))return 6}}return 0}abf(I,xa){if(!I||1>=I.length)return 0;if(xa)return 2;if(!P.S(I))return 1;xa=new Oa.a(Aa.a.Rk());for(const Ua of I)for(const vb of I){const cb=Ua.top===vb.top&&Ua.bottom===vb.bottom,Xb=Ua.left===vb.left&&Ua.right===vb.right,rc=Math.max(Ua.left,vb.left)<Math.min(Ua.right,
vb.right);if(Math.max(Ua.top,vb.top)<Math.min(Ua.bottom,vb.bottom)&&!cb||rc&&!Xb)return 3;xa.add(`${Ua.top}-${Ua.bottom}-${vb.left}-${vb.right}`);xa.add(`${vb.top}-${vb.bottom}-${Ua.left}-${Ua.right}`)}for(const Ua of I)xa.remove(`${Ua.top}-${Ua.bottom}-${Ua.left}-${Ua.right}`);return 0<xa.count?3:0}c6i(I){const xa=this.gridView.ha;xa.updateSelection(I,I.topLeft,0);xa.selectionType=-1}fvb(I){if(null===I||void 0===I?0:I.sourceItem){if(!H(I.sourceItem))return null;if((I=I.sourceItem)&&P.cb(I.ranges,
!0))return I}return null}Mec(I,xa){d.ULS.shipAssertTag(537167711,0,!!I,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return xa&&ob.a.cG in xa||I.tabName?!1:1===I.method}static omj(I,xa,Ua,vb,cb,Xb,rc,Ec,ed){const ud=I.pa.va.Qb(ed?{MZ:!0,bZ:1}:{MZ:!1,bZ:0});ed=(Zd,Xd,Je)=>{I.sy();return Va(I.pa.va,Ua,vb,cb,Ab.b(Zd,Xb),Ab.a(Xd,rc),Je,null,ud,Ec)};const Kd=()=>new ta(Ua,vb,cb);ed=r.EwaSettings.fc()?new Qb.a(506,0,ed,65,Kd):new mb.a(506,0,ed,1,Kd);I.userOperationManager.Ub(ed,
xa)}static rbc(I,xa,Ua,vb,cb,Xb,rc=null,Ec,ed){d.ULS.sendTraceTag(537167710,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${xa.id}`);xa.requestTelemetryData=I.RequestTelemetryData;xa.serverRequestTimeInMs=xa.commandParameters.stopwatch.tc-cb;ya.a.rg(I.Errors)?ya.a.lga(I.Errors)?(xa&&(xa.encounteredDeploymentErrors=!0),I=ya.a.zc(I.Errors),d.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${I}`)):
(I=new Ta.a(5,I.Errors),null===ed||void 0===ed?void 0:ed(I),vb(I)):I.Result?(vb=!!I&&!!I.RequestTelemetryData,X.g(Xb).Ci.Cka(xa.commandParameters.stopwatch.id,I.StateId,vb?I.RequestTelemetryData.EcsOperationDuration:0,vb?I.RequestTelemetryData.EcsRequestDuration:0,vb?I.RequestTelemetryData.WfeRequestDuration:0),xa.pastedRange=I.Result.SheetMultiRange,d.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${xa.id}`),
null===Ec||void 0===Ec?void 0:Ec(),Ua(!0)):(d.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${xa.id}`),Ua(rc||!0))}static lMd(I,xa,Ua,vb,cb,Xb,rc,Ec,ed,ud,Kd,Zd){const Xd=I.pa.va.Qb(),Je=Ka.K7g(Ua,vb,cb,ud,Kd,Zd);Ua=(Xe,Ke,Qe)=>{I.sy();return Wa(I.pa.va,Je,Ab.b(Xe,rc),Ab.a(Ke,Ec),Qe,Xb,Xd,ed)};vb=()=>new Bb(Je);Ua=r.EwaSettings.fc()?new Qb.a(503,0,Ua,65,vb):new mb.a(503,0,Ua,1,vb);I.userOperationManager.Ub(Ua,
xa)}static K7g(I,xa,Ua,vb,cb,Xb){const rc={};rc.ShadowWorkbookBase64=I.shadowWorkbookBase64;rc.SourceRanges={};rc.SourceRanges.Ranges=Array(1);rc.SourceRanges.Ranges[0]={};rc.SourceRanges.Ranges[0].FirstRow=I.rangeRowStart;rc.SourceRanges.Ranges[0].LastRow=I.rangeRowEnd;rc.SourceRanges.Ranges[0].FirstColumn=I.rangeColumnStart;rc.SourceRanges.Ranges[0].LastColumn=I.rangeColumnEnd;r.EwaSettings.getBooleanFeatureGate(ka.a.m3b,!1)?Ua?rc.DestinationRanges=P.u(Ua.SheetName,Ua.NamedObjectName,P.g(Ua.Ranges)):
(d.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),rc.DestinationRanges=null):rc.DestinationRanges=xa?P.s(xa):null;rc.CopyPasteTargetType=1;rc.PasteType=vb;rc.CopyOperationId=cb;rc.PasteId=Xb;rc.SourceClientPath=I.sourceClientPath;rc.SourceSheetName=I.sourceSheetName;rc.SourceWorkbookName=I.sourceWorkbookName;if(!I.originalSourceRangesCountExceedsLimit&&I.originalSourceRanges&&0<I.originalSourceRanges.length&&1024===vb){rc.OriginalSourceMultiRange=
{};xa=Array(I.originalSourceRanges.length);for(Ua=0;Ua<xa.length;++Ua)xa[Ua]={},xa[Ua].FirstRow=I.originalSourceRanges[Ua][0],xa[Ua].FirstColumn=I.originalSourceRanges[Ua][1],xa[Ua].LastRow=I.originalSourceRanges[Ua][2],xa[Ua].LastColumn=I.originalSourceRanges[Ua][3];rc.OriginalSourceMultiRange.Ranges=xa}return rc}static cQe(I,xa,Ua){Ua=Ua.clone();Ua.height<xa&&(Ua.bottom=Math.min(x.a.mh,Ua.top+xa-1));Ua.width<I&&(Ua.right=Math.min(x.a.Ch,Ua.left+I-1));return Ua}executeInsertCopiedCutCellsOperation(I,
xa,Ua,vb,cb,Xb=null,rc=null,Ec=!1){const ed={};ed.InsertDirection=vb;ed.SourceRange=I;ed.DestRange=xa;ed.CopyCutOperation=Ua?0:1;const ud=this.$.pa.va,Kd=this.$.pa.va.Qb(),Zd=()=>new db(ed);return Ya.a(this.$.userOperationManager,(Xd,Je,Xe)=>this.Umd&&Ec?va(ud,ed,Xb?Ab.b(Xd,Xb):Xd,rc?Ab.a(Je,rc):Je,Xe,Kd):pb(ud,ed,Xb?Ab.b(Xd,Xb):Xd,rc?Ab.a(Je,rc):Je,Xe,null),Xd=>new Qb.a(104,0,Xd,void 0,Zd),cb)}$He(I,xa,Ua,vb,cb,Xb,rc,Ec){return new Promise((ed,ud)=>{this.executeInsertCopiedCutCellsOperation(xa,Ua,
vb,cb,Xb,Kd=>{I.requestTelemetryData=Kd.RequestTelemetryData;if(Kd.Errors&&0<Kd.Errors.length){const Zd=new Ta.a(21,Kd.Errors);null===Ec||void 0===Ec?void 0:Ec(Zd);ud(new Ta.a(21,Kd.Errors))}else null===rc||void 0===rc?void 0:rc(),ed(!0)},Kd=>{Kd=Jb.a.kf(Kd.data);Kd=new Ta.a(21,Kd);null===Ec||void 0===Ec?void 0:Ec(Kd);ud(Kd)},!0)})}}Object(c.a)(Ka,"CopyPasteUtils",null,[527]);var ub=a(486),ac;(function(I){I[I.range=0]="range";I[I.art=1]="art"})(ac||(ac={}));Object(c.b)("SourceItemType",ac);var Ra=
a(24),na=a(90);class lb{constructor(I){this.U5f={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.vLb={};this.Q5f={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};
this.vVc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.T5f={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.yKd=
{["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.S5f={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};this.zja={};this.R5f={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.p2a={};this.V5f={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,
["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,
["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.yr={};this.$=I;this.zja.notDefined="InputManager.InputMethod.NotDefined";this.zja.unknown="InputManager.InputMethod.Unknown";this.zja.keyboard="InputManager.InputMethod.Keyboard";this.zja.mouse="InputManager.InputMethod.Mouse";this.zja.touch="InputManager.InputMethod.Touch";this.zja.crossSlide="InputManager.InputMethod.CrossSlide";this.p2a.none="FrameMode.None";
this.p2a.reading="FrameMode.Reading";this.p2a.edit="FrameMode.Edit";this.yr.unknown="UILocation.Unknown";this.yr.upperRibbon="UILocation.UpperRibbon";this.yr.ribbon="UILocation.Ribbon";this.yr.QAT="UILocation.QAT";this.yr.jewel="UILocation.Jewel";this.yr.navigationPane="UILocation.NavigationPane";this.yr.keyboardShortcut="UILocation.KeyboardShortcut";this.yr.statusBar="UILocation.StatusBar";this.yr.dialog="UILocation.Dialog";this.yr.floatie="UILocation.Floatie";this.yr.notificationBar="UILocation.NotificationBar";
this.yr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.yr.taskPane="UILocation.TaskPane";this.yr.heroDock="UILocation.HeroDock";this.yr.singleLineRibbon="UILocation.SingleLineRibbon";this.yr.multilineRibbon="UILocation.MultilineRibbon";this.yr.overflow="UILocation.Overflow";this.yr.tellMe="UILocation.TellMe";this.yr.farPeripheralControls="UILocation.FarPeripheralControls";this.yr.header="UILocation.Header";this.yr.fileMenu="UILocation.FileMenu";this.yr.contextMenu="UILocation.ContextMenu";
this.yr.dialogMenu="UILocation.DialogMenu";this.yr.toolbar="UILocation.Toolbar";this.yr.canvas="UILocation.Canvas";this.vLb.range="SourceItemType.Range";this.vLb.art="SourceItemType.Art"}serializeSourceItem(I){const xa={};if(I&&Object.getType(I)===E)xa.sheetName=I.sheetName,xa.topArray=v.a.map(I.ranges,Ua=>Ua.top),xa.leftArray=v.a.map(I.ranges,Ua=>Ua.left),xa.bottomArray=v.a.map(I.ranges,Ua=>Ua.bottom),xa.rightArray=v.a.map(I.ranges,Ua=>Ua.right),xa.sessionStateId=I.sessionStateId,xa.sessionId=I.sessionId,
xa.sourceItemType=this.JWf(0);else if(I&&Object.getType(I)===T)xa.activeFloatingObjectControlId=I.activeFloatingObjectControlId,xa.sheetName=I.sheetName,xa.sessionStateId=I.sessionStateId,xa.sessionId=I.sessionId,xa.floatingObjectType=this.Qmj(I.type),xa.sourceItemType=this.JWf(1);else return d.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;return JSON.stringify(xa)}serializeCommandParameters(I){if(!I)return d.ULS.shipAssertTag(537167704,
0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const xa={};xa.id=I.id;xa.commandType=I.commandType;xa.copyPasteTargetType=I.copyPasteTargetType;I.ribbonCommandInfo&&(xa.ribbonCommandName=this.Zmj(I.ribbonCommandInfo.command),xa.inputMethodName=this.Tmj(I.ribbonCommandInfo.method),xa.frameModeName=this.Rmj(I.ribbonCommandInfo.mode),xa.uiLocationName=this.cnj(I.ribbonCommandInfo.Re),xa.tabName=I.ribbonCommandInfo.tabName);return JSON.stringify(xa)}deserializeSourceItem(I){if(!I)return null;
try{const xa=JSON.parse(I);if(!xa)return d.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let Ua=null;switch(this.cdh(xa.sourceItemType)){case 0:Ua=new E(this.$,this.$ch(xa),xa.sheetName,xa.sessionStateId,xa.sessionId);break;case 1:Ua=new T(xa.activeFloatingObjectControlId,xa.sheetName,xa.sessionStateId,xa.sessionId,this.Xch(xa.floatingObjectType))}return Ua}catch(xa){return d.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${I?
I.length:0}, errror: ${xa}`),null}}deserializeCommandParameters(I){if(!I)return null;try{const xa=JSON.parse(I);if(!xa)return d.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;const Ua=ab.a();Ua.id=xa.id;Ua.ribbonCommandInfo=this.bdh(xa);Ua.commandType=xa.commandType;Ua.copyPasteTargetType=xa.copyPasteTargetType;return Ua}catch(xa){return d.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${I?
I.length:0}, errror: ${xa}`),null}}$ch(I){const xa=[];d.ULS.shipAssertTag(537167699,0,!!I.topArray&&0<I.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${I.topArray?"empty":"null"}.`);d.ULS.shipAssertTag(537167698,0,!!I.leftArray&&0<I.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${I.leftArray?"empty":"null"}.`);d.ULS.shipAssertTag(537167697,0,!!I.bottomArray&&0<I.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${I.bottomArray?
"empty":"null"}.`);d.ULS.shipAssertTag(537167696,0,!!I.rightArray&&0<I.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${I.rightArray?"empty":"null"}.`);if(!(I.topArray&&I.leftArray&&I.bottomArray&&I.rightArray))return xa;d.ULS.shipAssertTag(537167695,0,I.topArray.length===I.bottomArray.length&&I.topArray.length===I.leftArray.length&&I.topArray.length===I.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${I.topArray.length}), BottomArray(${I.bottomArray.length}), LeftArray(${I.leftArray.length}), RightArray(${I.rightArray.length}) should be the same.`);
const Ua=Math.min(I.topArray.length,I.bottomArray.length,I.leftArray.length,I.rightArray.length);for(let vb=0;vb<Ua;vb++)xa.push(new Ra.Range(I.topArray[vb],I.leftArray[vb],I.bottomArray[vb],I.rightArray[vb],!1,!1));return xa}bdh(I){return new na.a(this.adh(I.ribbonCommandName),this.Zch(I.inputMethodName),this.Ych(I.frameModeName),this.edh(I.uiLocationName),I.tabName)}Zmj(I){return void 0!==I&&null!==I&&I.toString()in this.yKd?this.yKd[I.toString()]:(d.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${I}`),
this.yKd["-911352779"])}adh(I){return I&&I in this.T5f?this.T5f[I]:(d.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${I}`),-911352779)}Tmj(I){return void 0!==I&&null!==I&&l.a[I]in this.zja?this.zja[l.a[I]]:(d.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${I}`),this.zja.unknown)}Zch(I){return I&&I in
this.S5f?this.S5f[I]:(d.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${I}`),0)}Rmj(I){return void 0!==I&&null!==I&&ub.a[I]in this.p2a?this.p2a[ub.a[I]]:(d.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${I}`),this.p2a.edit)}Ych(I){return I&&I in this.R5f?this.R5f[I]:(d.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${I}`),
2)}JWf(I){return void 0!==I&&null!==I&&ac[I]in this.vLb?this.vLb[ac[I]]:(d.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${I}`),this.vLb.range)}cdh(I){return I&&I in this.U5f?this.U5f[I]:(d.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${I}`),0)}Qmj(I){return void 0!==I&&null!==I&&I.toString()in this.vVc?this.vVc[I.toString()]:(d.ULS.shipAssertTag(537167686,0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${I}`),
this.vVc["99"])}Xch(I){return I&&I in this.Q5f?this.Q5f[I]:(d.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${I}`),99)}cnj(I){return void 0!==I&&null!==I&&n.a[I]in this.yr?this.yr[n.a[I]]:(d.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${I}`),this.yr.ribbon)}edh(I){return I&&I in this.V5f?this.V5f[I]:(d.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${I}`),
2)}}Object(c.a)(lb,"EnvironmentSerializationHelper",null,[]);class jb{}jb.cUf="SameSession";jb.ZDe="CrossSession";jb.hjf="LegacyCrossSession";jb.external="External";Object(c.a)(jb,"PayloadOrigin",null,[]);const Yb=I=>I?I.shadowWorkbookSizeExceedsLimit&&void 0!==I.shadowWorkbookBlockedSize&&null!==I.shadowWorkbookBlockedSize?I.shadowWorkbookBlockedSize:I.shadowWorkbookBase64?I.shadowWorkbookBase64.length:0:0,Gb=I=>I.shadowWorkbookSizeExceedsLimit?!0:Yb(I)>x.a.jjc;class wb{constructor(I,xa){this._name=
xa;this.$=I;this.Om=B.a.instance;this.Gp=new Ka(I,X.g(I))}get name(){return this._name}get yVc(){return this.Om.Xa(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}XMj(I){let xa;xa=null;try{const Ua=I.getItem(N.shadowWorkbook);if(!Ua)return{returnValue:!1,V_:xa};xa=JSON.parse(Ua);return{returnValue:this.xni(xa),V_:xa}}catch(Ua){return d.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+
Ua),{returnValue:!1,V_:xa}}}xni(I){return!!I&&(!!I.shadowWorkbookBase64||I.shadowWorkbookSizeExceedsLimit)&&void 0!==I.rangeRowStart&&void 0!==I.rangeRowEnd&&void 0!==I.rangeColumnStart&&void 0!==I.rangeColumnEnd}Pnc(I){I.wasLastCopyExternal=!0;if(r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.bD&&516!==I.commandParameters.commandType&&1028!==I.commandParameters.commandType){var xa=null;if(({V_:xa}=this.XMj(I.clipboardItems)).returnValue)return I.isShadowWorkbookParsedSuccessfully=
!0,this.pWi(I,xa)}if(516!==I.commandParameters.commandType&&36!==I.commandParameters.commandType){if(r.EwaSettings.ma(161)&&20!==I.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.mec)&&(xa=I.clipboardItems.getItem(N.html),void 0!==xa&&null!==xa&&xa&&xa.trim()!==this.yVc&&(xa.startsWith("<")||k.a.Tf&&xa.startsWith("\n<")))){const Ua=I.clipboardItems.getItem(N.Xpb);return this.nWi(I,xa,void 0===Ua?null:Ua)}return this.cFf(I)}return Promise.reject(new Ta.a(6))}pWi(I,
xa){d.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");I.pasteResult="SystemClipboardShadowWorkbookPaste";I.payloadType=V.shadowWorkbook;I.payloadOrigin=jb.external;I.shadowWorkbookPayloadSize=Yb(xa);I.shadowWorkbookSizeExceedsLimit=Gb(xa);let Ua=null,vb=null;const cb=I.commandParameters.originalDestinations;r.EwaSettings.getBooleanFeatureGate(ka.a.m3b,!1)?Ua=P.r(cb,this.$):vb=P.v(P.K(cb),this.$);xa.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
(I.originalSourceRangesCountExceedsLimit=xa.originalSourceRangesCountExceedsLimit);if(I.shadowWorkbookSizeExceedsLimit)return d.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${I.shadowWorkbookPayloadSize}) is over the limit(${x.a.jjc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${xa.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new Ta.a(1));d.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${I.commandParameters.id}`);
return this.Gp.hFf(I.commandParameters.ribbonCommandInfo,vb,Ua,xa,[I.commandParameters.stopwatch],I)}cFf(I){var xa=I.clipboardItems.getItem(N.plainText);if(void 0!==xa&&null!==xa&&xa.trim()===this.yVc)return Promise.reject(new Ta.a(7));void 0!==xa&&null!==xa&&(I.plainTextPayloadSize=xa.length);I.isPlainTextPaste=!0;I.pasteResult="SystemClipboardPaste";I.payloadOrigin=M(I)?jb.hjf:jb.external;I.payloadType=V.plainText;d.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${I.id}, PasteOperationId=${I.commandParameters.id}`);
xa=this.Gp.u0i(P.K(I.commandParameters.originalDestinations),xa,I.commandParameters.ribbonCommandInfo,[I.commandParameters.stopwatch],I);d.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${I.id}`);return xa}nWi(I,xa,Ua){I.htmlPayloadSize=xa.length;I.isHtmlPaste=!0;I.pasteResult="SystemClipboardHtmlPaste";I.payloadType=V.html;I.payloadOrigin=M(I)?jb.hjf:jb.external;d.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${I.commandParameters.id}`);
return this.Gp.t0i(P.K(I.commandParameters.originalDestinations),xa,Ua,I.commandParameters.id,I.commandParameters.ribbonCommandInfo,[I.commandParameters.stopwatch],I)}xDe(I){const xa={};I&&(xa.shadowWorkbookBase64=I.ShadowWorkbookBase64,xa.shadowWorkbookSizeExceedsLimit=I.ShadowWorkbookSizeExceedsLimit,xa.originalSourceRangesCountExceedsLimit=I.OriginalSourceRangesCountExceedsLimit,xa.originalSourceRangesCount=I.OriginalSourceRangesCount,xa.shadowWorkbookBlockedSize=I.ShadowWorkbookBlockedSize);return xa}qeg(I,
xa){const Ua=J(I),vb=32===(I.commandParameters.commandType&32),cb=1024===(I.commandParameters.commandType&1024);let Xb=!1,rc=null,Ec=null,ed=!1;if(!Ua){Xb=-1985798686===I.commandParameters.ribbonCommandInfo.command;var ud=I.copyContextSnapshot;if(xa)ed=!ud.sourceItem.isFromCurrentSession(this.$);else if(ud=this.Gp.fvb(ud))rc=ud.ranges,Ec=ud.sheetName,ed=!I.isSameSession}return this.Gp.wKg(Ec,rc,this.$.oa.sheetName,I.commandParameters.originalDestinations,I.commandParameters.expandDestinations,ed,
vb,cb,Xb,xa,Ua)}}Object(c.a)(wb,"BaseCopyPasteHandler",null,[511,512,513]);class dc{constructor(I){this.clipboardItems=this.key=null;this.N9=I}Xua(I){return this.key&&this.key.isEqual(I)?this.createClipboardItems(this.clipboardItems):null}setValue(I,xa){this.key=I;this.clipboardItems=this.createClipboardItems(xa)}createClipboardItems(I){const xa=this.N9.create();var Ua=I.getItem(N.plainText);Ua&&xa.setItem(N.plainText,Ua);(Ua=I.getItem(N.shadowWorkbook))&&xa.setItem(N.shadowWorkbook,Ua);(I=I.getItem(N.html))&&
xa.setItem(N.html,I);return xa}}Object(c.a)(dc,"CopyCache",null,[]);var Jc=a(74);class Qc extends wb{constructor(I,xa,Ua,vb,cb=null){super(I,vb);this.O2g=xa;this.N9=Ua;this.n1c=cb||new dc(this.N9);this.gridView=X.g(I);this.ha=this.gridView.ha;this.clipboardRangeFactory=I.da.za(169)}getSourceItem(){const I=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?P.d(this.gridView.ha.sa.selectedRanges):v.a.clone(this.gridView.ha.sa.selectedRanges);return new E(this.$,I,this.$.ea.oa.sheetName,
this.$.ea.Le,this.$.ya.UserSessionId)}beforeSerialize(I){I.isSelectionAllowed=!1;I.isAsyncCopy=!1;I.isFromCache=!1;I.encounteredDeploymentErrors=!1;I.plainTextPayloadSize=0;I.shadowWorkbookPayloadSize=0;I.htmlPayloadSize=0;I.clientSideCopyTime=0;const xa=new sa.a(this.$.xa),Ua=I.sourceItem;I.isSelectionAllowed=v.a.all(Ua.ranges,vb=>this.isSelectionAllowed(xa,vb));I.isSelectionAllowed&&this.Gp.Z6e(Ua.ranges,I.commandParameters.commandType)}KLa(I){return this.gridView.Ea.iZ()&&X.i(this.gridView,I)}LWi(I,
xa,Ua,vb){let cb=!1,Xb=1===xa.commandParameters.commandType,rc=vb[0].TG;1===Ua.ranges.length&&1===vb.length?r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&Xb&&1!==rc&&rc!==Ua.ranges[0].TG?I.cseStatus=17:cb=this.O2g.o5c(I,P.K(Ua.ranges),Ua.sheetName,P.K(I.commandParameters.expandDestinations),this.$.ea.oa.sheetName,Xb):I.cseStatus=5;cb&&X.g(this.$).Ci.a0(I.commandParameters.stopwatch.id,Jc.BasicTelemetryCalculator.uQ);return this.vWi(I,Ua,P.u(this.$.oa.sheetName,null,
vb),xa.commandParameters.commandType,cb)}isSelectionAllowed(I,xa){return I.mzb(xa,this.gridView)}vWi(I,xa,Ua,vb,cb){xa=P.u(xa.sheetName,null,xa.ranges);I.pasteResult="SameSessionPaste";I.payloadOrigin=jb.cUf;I.payloadType=V.Zyg;d.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${I.commandParameters.id}`);return this.Gp.pasteRange(I.commandParameters.ribbonCommandInfo,xa,Ua,vb,I.commandParameters.commandType,[I.commandParameters.stopwatch],
I,cb,null,null)}}Object(c.a)(Qc,"BaseRangeCopyPasteHandler",wb,[]);var fd=a(34);class Wc{constructor(I){this.XT=new fd.a(!0);this.$=I}onDeferredPasteStarted(I){this.XT.lb(I.id)||this.XT.add(I.id,!0);if(0<this.XT.count){const xa=la.GetServiceTaskFactory.Ta(this.$.da,5,4,0);ea.TaskExtensions.Aa(xa,()=>{xa.result.Yf(28,null)},this.$.la,3)}}onDeferredPasteCompleted(I){const xa=0<this.XT.count;this.XT.lb(I.id)&&this.XT.remove(I.id);if(xa&&!this.XT.count){const Ua=la.GetServiceTaskFactory.Ta(this.$.da,
5,4,0);ea.TaskExtensions.Aa(Ua,()=>{Ua.result.removeEntry(28)},this.$.la,3)}}}Object(c.a)(Wc,"DeferredPasteTracker",null,[]);var Rb;(function(I){I[I.none=0]="none";I[I.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";I[I.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";I[I.asyncCopyCanceled=3]="asyncCopyCanceled";I[I.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Rb||(Rb={}));Object(c.b)("CopyErrorType",Rb);var Sb=a(919),mc=a(1106);class ec extends Sb.a{constructor(I,
xa=null){super(Rb[I]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=I;this.ewaErrors=xa;if(null===xa||void 0===xa?0:xa.length)this.innerError=new mc.a(xa,null)}}Object(c.a)(ec,"CopyInnerError",Sb.a,[]);class Rc extends Qc{constructor(I,xa,Ua,vb=null){super(I,xa,Ua,"AcrossSessionRangeCopyPasteHandler",vb);this.XT=new Wc(I)}serialize(I){const xa=I.sourceItem,Ua={};let vb=this.n1c.Xua(xa);if(vb)Ua.synchronousResult=vb,I.isFromCache=!0,I.clientSideCopyTime=I.commandParameters.stopwatch.tc;
else{let Xb=null;var cb=P.F(xa.ranges);if(!aa.a.Rcf()&&this.KLa(cb)){d.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");cb=this.clipboardRangeFactory.create(cb);try{Xb=cb.toString(),vb=this.N9.create(),vb.setItem(N.plainText,Xb),this.n1c.setValue(xa,vb),Ua.synchronousResult=vb,I.clientSideCopyTime=I.commandParameters.stopwatch.tc}finally{cb&&cb.dispose()}}else I.isAsyncCopy=!0,Ua.synchronousResult=this.N9.create(),
Ua.synchronousResult.setItem(N.plainText,this.yVc);Ua.asynchronousResult=this.Rbd(I,xa,Xb)}I.syncClipboardItemsKeys=Na(Ua.synchronousResult);return Ua}shouldWaitForCopyToComplete(I){if(!I||!I.copyContextSnapshot)return d.ULS.sendTraceTag(537167907,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;d.ULS.shipAssertTag(537167906,0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");
if(I.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return d.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),!1;d.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(I){this.XT.onDeferredPasteStarted(I)}onDeferredPasteCompleted(I){this.XT.onDeferredPasteCompleted(I)}deserialize(I){I.isClipboardDataContainShadowWorkbook=
!(void 0===I.clipboardItems.getItem(N.shadowWorkbook)||null===I.clipboardItems.getItem(N.shadowWorkbook));if(X.g(this.$).ha.Ke&326)return J(I)&&(I.wasLastCopyExternal=!0),Promise.reject(new Ta.a(17));var xa=this.qeg(I,!1);if(0!==xa)return Promise.reject(new Ta.a(J(I)?18:I.isSameSession?19:20,void 0,void 0,void 0,xa));var Ua=I.copyContextSnapshot,vb=this.Gp.fvb(Ua);if(J(I))return this.Pnc(I);xa=I.commandParameters.originalDestinations;if(vb&&I.isSameSession)return this.LWi(I,Ua,vb,xa);if(516!==I.commandParameters.commandType){if(({V_:Ua}=
this.WMj(I.clipboardItems)).returnValue){I.isShadowWorkbookParsedSuccessfully=!0;let cb=vb=null;r.EwaSettings.getBooleanFeatureGate(ka.a.m3b,!1)?vb=P.r(xa,this.$):cb=P.v(P.K(xa),this.$);return this.lWi(I,cb,vb,Ua)}if(I.isClipboardInaccessible)return Promise.reject(new Ta.a(8));if(36!==I.commandParameters.commandType)return this.cFf(I)}return Promise.reject(new Ta.a(6))}beforePaste(I){this.$.da.za(373).Mjj(I);I.indicationDisplayScheduled=!0}oMj(I){let xa;if(!(I&&I.SourceRanges&&I.SourceRanges.Ranges&&
I.SourceRanges.Ranges.length&&(I.OriginalSourceRangesCountExceedsLimit||I.OriginalSourceMultiRange&&I.OriginalSourceMultiRange.Ranges&&I.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,V_:null};var Ua=I.SourceRanges.Ranges[0];if(!I.ShadowWorkbookBase64&&!I.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,V_:null};xa=this.xDe(I);xa.rangeRowStart=Ua.FirstRow;xa.rangeRowEnd=Ua.LastRow;xa.rangeColumnStart=Ua.FirstColumn;xa.rangeColumnEnd=Ua.LastColumn;xa.sourceClientPath=I.SourceClientPath;
xa.sourceSheetName=I.SourceSheetName;xa.sourceWorkbookName=I.SourceWorkbookName;if(!I.OriginalSourceRangesCountExceedsLimit)for(I=I.OriginalSourceMultiRange.Ranges,xa.originalSourceRanges=Array(I.length),Ua=0;Ua<I.length;++Ua)xa.originalSourceRanges[Ua]=[I[Ua].FirstRow,I[Ua].FirstColumn,I[Ua].LastRow,I[Ua].LastColumn];return{returnValue:!0,V_:xa}}WMj(I){let xa;xa=null;I=I.getItem(N.shadowWorkbook);if(!I)return{returnValue:!1,V_:xa};xa=JSON.parse(I);return{returnValue:this.wni(xa),V_:xa}}wni(I){return!!I&&
(!!I.shadowWorkbookBase64||I.shadowWorkbookSizeExceedsLimit)&&void 0!==I.rangeRowStart&&void 0!==I.rangeRowEnd&&void 0!==I.rangeColumnStart&&void 0!==I.rangeColumnEnd}lWi(I,xa,Ua,vb){d.ULS.shipAssertTag(537167903,0,!!vb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");w.AFrameworkApplication.dN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");I.pasteResult="CrossSessionPaste";I.payloadOrigin=jb.ZDe;I.payloadType=
V.shadowWorkbook;I.shadowWorkbookPayloadSize=Yb(vb);I.shadowWorkbookSizeExceedsLimit=Gb(vb);vb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(I.originalSourceRangesCountExceedsLimit=vb.originalSourceRangesCountExceedsLimit);if(I.shadowWorkbookSizeExceedsLimit)return d.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${I.shadowWorkbookPayloadSize}) is over the limit(${x.a.jjc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${vb.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new Ta.a(1));if(1028===I.commandParameters.commandType&&I.originalSourceRangesCountExceedsLimit)return d.ULS.sendTraceTag(572617859,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${vb.originalSourceRangesCount}) is over the limit(${x.a.gyi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${vb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new Ta.a(1));d.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${I.commandParameters.id}`);
return this.Gp.hFf(I.commandParameters.ribbonCommandInfo,xa,Ua,vb,[I.commandParameters.stopwatch],I)}Rbd(I,xa,Ua){d.ULS.shipAssertTag(537167901,0,!!I,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const vb=I.commandParameters.stopwatch.tc;return new Promise((cb,Xb)=>{d.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${I.id}`);const rc=P.u(xa.sheetName,
null,xa.ranges);this.Gp.copy(rc,I.commandParameters,Ec=>{I.requestTelemetryData=Ec.RequestTelemetryData;I.serverRequestTimeInMs=I.commandParameters.stopwatch.tc-vb;if(ya.a.rg(Ec.Errors))if(ya.a.lga(Ec.Errors))I.encounteredDeploymentErrors=!0,Ec=ya.a.zc(Ec.Errors),d.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Ec}. copy Id: ${I.id}`);else{var ed=ya.a.zc(Ec.Errors);
d.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${ed}. copy Id: ${I.id}`);Xb(new ec(2,Ec.Errors))}else if(d.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${I.id}`),I.markForCancellation)Xb(new ec(3,Ec.Errors));else{Ec=Ec.Result;var ud=Ec.PlainTextResult;void 0!==Ua&&null!==Ua&&(ud=Ua);void 0!==ud&&null!==ud&&(I.plainTextPayloadSize=
ud.length);ed=this.N9.create();if(({V_:Kd}=this.oMj(Ec)).returnValue){I.shadowWorkbookPayloadSize=Yb(Kd);I.shadowWorkbookSizeExceedsLimit=Gb(Kd);I.originalSourceRangesCountExceedsLimit=Ec.OriginalSourceRangesCountExceedsLimit;var Kd=JSON.stringify(Kd);ed.setItem(N.shadowWorkbook,Kd)}ed.setItem(N.plainText,ud);aa.a.Rcf()&&(ud=Ec.HtmlResult,I.htmlSizeExceedsLimit=Ec.HtmlSizeExceedsLimit,void 0!==ud&&null!==ud&&(I.htmlPayloadSize=ud.length),ed.setItem(N.html,ud));I.copyTotalSizeExceedsLimit=Ec.CopyTotalSizeExceedsLimit;
ed.setItem(N.Xpb,I.commandParameters.id);this.n1c.setValue(xa,ed);I.asyncClipboardItemsKeys=Na(ed);cb(ed)}},Ec=>{I.serverRequestTimeInMs=I.commandParameters.stopwatch.tc-vb;Ec=Jb.a.kf(Ec.data);const ed=ya.a.zc(Ec);d.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${ed}. copy Id: ${I.id}`);Xb(new ec(2,Ec))},[I.commandParameters.stopwatch])})}}Object(c.a)(Rc,"AcrossSessionRangeCopyPasteHandler",Qc,[]);class Mc{constructor(I,
xa,Ua,vb,cb,Xb=null,rc=null){this.floatingObjectId=I;this.commandParameters=xa;this.wt=Ua;this.jah=vb;this.G$=Xb;this.NNb=rc;this.E2g=cb}}Object(c.a)(Mc,"CopyArtRequest",null,[]);class bc{constructor(I,xa,Ua,vb,cb,Xb,rc,Ec,ed){this.promise=null;this.ribbonCommandInfo=I;this.destination=xa;this.RFe=Ua;this.NNb=cb;this.V_=Xb;this.item=rc;this.pasteContext=Ec;this.XMa=Ua||xa.FirstRow+"_"+xa.FirstColumn;this.ldf=!0;this.Qxe=ed}}Object(c.a)(bc,"PasteArtRequest",null,[]);class ic{constructor(I,xa){this.XHb=
new rb.a;this.IYa=I;this.$=xa;this.T0i=Ua=>Promise.resolve(Ua);this.$Db=Ua=>Promise.reject(Ua)}R2h(I){if(this.vji(I.XMa)){d.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${I.XMa}`);const xa=this.XHb.na(I.XMa);this.XHb.ia(I.XMa,I);const Ua=xa.promise;xa.ldf=!1;return this.akh(I,Ua)}this.XHb.ia(I.XMa,I);return this.tqi(I)}vji(I){return this.XHb.lb(I)}tqi(I){return new Promise((xa,Ua)=>{I.promise=this.IYa.bFf(I).then(vb=>
{xa(null);return this.pmc(I,vb)},vb=>{Ua(null);return this.$Db(vb)})})}akh(I,xa){return new Promise((Ua,vb)=>{I.promise=xa.then(cb=>{this.dSj(I,cb);return this.IYa.bFf(I).then(Xb=>{Ua(null);return this.pmc(I,Xb)},Xb=>{vb(null);return this.$Db(Xb)})},cb=>this.$Db(cb))})}pmc(I,xa){I.ldf&&(this.mXg(I.XMa),this.QLd(I,xa));return this.T0i(xa)}mXg(I){this.XHb.remove(I)}QLd(I,xa){const Ua=this.MVh();I.XMa===Ua&&this.IYa.QLd(I.destination,xa,I.item.type)}MVh(){var I=X.g(this.$).ha.Oa.activeFloatingObjectControlId;
I||(I=P.v(X.g(this.$).ha.sa.activeCell,this.$),I=I.FirstRow+"_"+I.FirstColumn);return I}dSj(I,xa){I.destination=null;I.RFe=xa}}Object(c.a)(ic,"PasteArtRequestManager",null,[]);var Yc=a(198),md=a(122),id=a(104);class xd extends wb{constructor(I,xa,Ua,vb,cb=null){super(I,"ArtCopyPasteHandler");this.iYg="XLO";this.jYg="3";this.XT=new Wc(I);this.N9=xa;this.IYa=Ua;this.ha=X.g(I).ha;this.m1c=cb||new dc(this.N9);this.mWi=new ic(Ua,I);this.mnb=vb}getSourceItem(){d.ULS.shipAssertTag(537167896,0,!!this.ha.Oa.activeFloatingObjectControlId,
"Expecting a floating object to be currently selected for copy");d.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Oa.activeFloatingObjectControlId}]`);return new T(this.ha.Oa.activeFloatingObjectControlId,this.$.ea.oa.sheetName,this.$.ea.Le,this.$.ya.UserSessionId,this.ha.Oa.$b.floatingObject.type)}beforeSerialize(I){I&&I.commandParameters?(I?(I.isAsyncCopy=!1,I.isSelectionAllowed=!1,I.isFromCache=!1,I.plainTextPayloadSize=
0,I.shadowWorkbookPayloadSize=0,I.htmlPayloadSize=0,I.htmlSizeExceedsLimit=!1,I.clientSideCopyTime=0,I.encounteredDeploymentErrors=!1,I.shadowWorkbookSizeExceedsLimit=!1,I.originalSourceRangesCountExceedsLimit=!1,I.copyTotalSizeExceedsLimit=!1):d.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),I.commandParameters.copyPasteTargetType=2):d.ULS.sendTraceTag(537167894,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(I){const xa=
I.sourceItem,Ua={};if(!xa)return d.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),Ua;if(!this.lmi())return d.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),Ua;d.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${xa.activeFloatingObjectControlId}]`);this.QCd();let vb=this.m1c.Xua(xa);if(vb)Ua.synchronousResult=
vb,I.isFromCache=!0,I.isAsyncCopy=!1,I.clientSideCopyTime=I.commandParameters.stopwatch.tc,1===I.commandParameters.commandType&&this.$.xd(2045211913,I.commandParameters.ribbonCommandInfo.method,I.commandParameters.ribbonCommandInfo.Re,null);else{I.isFromCache=!1;I.isAsyncCopy=!0;vb=this.N9.create();if(I.commandParameters.uploadToClipService){const cb={};cb["data-clipservice-ccpid"]=I.commandParameters.id;cb["data-pkey"]=I.commandParameters.pKey;cb["data-clipservice-type"]=I.commandParameters.clipServiceDataType;
cb["data-clipservice-count"]=I.commandParameters.objectCount.toString();cb["data-clipservice-dc"]=I.commandParameters.clipServiceDataCenter;cb["data-clipservice-client"]=this.iYg;cb["data-TimeStamp"]=(new Date).toUTCString();cb["data-clipservice-version"]=this.jYg;vb.setItem(N.lHg,JSON.stringify(cb))}Ua.synchronousResult=this.IAg(vb);Ua.asynchronousResult=this.Rbd(I,xa,vb)}I.syncClipboardItemsKeys=Na(Ua.synchronousResult);return Ua}IAg(I){d.ULS.shipAssertTag(537167891,0,!!this.ha.Oa.$b,"Expecting a floating object to be currently selected for copy");
I||(I=this.N9.create());const xa=this.ha.Oa.$b.Dtb();xa&&I.setItem(N.html,`<img src='${xa}'>`);return I}QCd(){const I=this.ha.Oa.$b;this.mnb.QCd(md.a.kpb(I.floatingObject),md.a.lYg(I.Zt))}shouldWaitForCopyToComplete(){d.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(I){this.XT.onDeferredPasteStarted(I)}onDeferredPasteCompleted(I){this.XT.onDeferredPasteCompleted(I)}deserialize(I){var xa=J(I),Ua=null;let vb=null;var cb=
!1;if(!xa){Ua=I.copyContextSnapshot;vb=Ua.sourceItem;if(!vb)return Promise.reject(new Ta.a(10));cb=vb.isFromCurrentSession(this.$)}var Xb=this.qeg(I,!0);if(0!==Xb)return Promise.reject(new Ta.a(xa?18:cb?19:20,void 0,void 0,void 0,Xb));if(xa)return this.Pnc(I);if(!cb&&!xd.pfi(vb))return I=`User attempted to paste art of type [${vb.type}] between sessions.`,d.ULS.sendTraceTag(537167889,0,50,I),Promise.reject(new Ta.a(11,void 0,void 0,I));if(Ua.isAsyncSerializeFailed)return Promise.reject(new Ta.a(16,
void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let rc;try{const Ec=I.clipboardItems.getItem(N.shadowWorkbook);rc=JSON.parse(Ec)}catch(Ec){return I=copyPasteInfra.getStringifiedError(Ec),d.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${I}`),Promise.reject(new Ta.a(12,void 0,Ec))}rc.floatingObjectId!==vb.activeFloatingObjectControlId?d.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${vb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${rc.floatingObjectId}]`):
d.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${vb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${rc.floatingObjectId}]`);if(!rc||!rc.shadowWorkbookBase64)return Promise.reject(new Ta.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!rc}`));I.isShadowWorkbookParsedSuccessfully=!0;I.shadowWorkbookPayloadSize=Yb(rc);I.shadowWorkbookSizeExceedsLimit=Gb(rc);I.payloadOrigin=cb?jb.cUf:
jb.ZDe;I.payloadType=V.Qhg;if(Gb(rc))return I=`Shadow workbook size [${I.shadowWorkbookPayloadSize}] is over the limit [${x.a.jjc}]. ShadowWorkbookSizeExceedsLimit: ${rc.shadowWorkbookSizeExceedsLimit}`,d.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${I}`),Promise.reject(new Ta.a(1,void 0,void 0,I));Ua=xa=null;X.g(this.$).ha.Ke&326?Ua=X.g(this.$).ha.Oa.activeFloatingObjectControlId:xa=this.$.oa&&this.$.oa.activeCell?P.v(this.$.oa.activeCell,this.$):P.v(P.K(I.commandParameters.originalDestinations),
this.$);cb=null;if(this.mnb.Y0f(vb))try{cb=this.mnb.o5c()}catch(Ec){Xb=copyPasteInfra.getStringifiedError(Ec),d.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Xb}`)}return this.mWi.R2h(new bc(I.commandParameters.ribbonCommandInfo,xa,Ua,I.commandParameters.commandType,[I.commandParameters.stopwatch],rc,vb,I,cb))}Pnc(I){I.wasLastCopyExternal=!0;if(I.clipboardItems.getItem("image/png")){const xa=I.commandParameters.stopwatch.tc;
I.payloadType=V.wNg;return eb.b(this.$.xd(1403967063,I.commandParameters.ribbonCommandInfo.method,I.commandParameters.ribbonCommandInfo.Re,{["dataUrl"]:I.clipboardItems.getItem("image/png")})).then(Ua=>{I.serverRequestTimeInMs=I.commandParameters.stopwatch.tc-xa;return Ua?Promise.resolve(null):Promise.reject(new Ta.a(15))},()=>{I.serverRequestTimeInMs=I.commandParameters.stopwatch.tc-xa;return Promise.reject(new Ta.a(15))})}d.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.Pnc(I)}lmi(){const I=X.g(this.$).ha;return I.Oa.activeFloatingObjectControlId&&I.Oa.$b&&I.Oa.$b.floatingObject?I.Oa.$b.floatingObject.iTd():!1}Rbd(I,xa,Ua){return new Promise((vb,cb)=>{const Xb=I.commandParameters.stopwatch.tc;d.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.IYa.G2g(new Mc(xa.activeFloatingObjectControlId,I.commandParameters,rc=>{I.requestTelemetryData=rc.RequestTelemetryData;I.serverRequestTimeInMs=
I.commandParameters.stopwatch.tc-Xb;if(ya.a.rg(rc.Errors))if(ya.a.lga(rc.Errors))I.encounteredDeploymentErrors=!0,rc=ya.a.zc(rc.Errors),d.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${rc}`);else{var Ec=ya.a.zc(rc.Errors);d.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ec}`);cb(new ec(4,rc.Errors))}else if(d.ULS.sendTraceTag(537167883,
0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${xa.activeFloatingObjectControlId}].`),I.markForCancellation)cb(new ec(3,rc.Errors));else{if(ya.a.ar(rc.Errors)){var ed=ya.a.zc(rc.Errors);d.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${ed}`)}if(ed=rc.Result){ed=this.xDe(ed);ed.floatingObjectId=xa.activeFloatingObjectControlId;I.shadowWorkbookPayloadSize=Yb(ed);I.shadowWorkbookSizeExceedsLimit=
Gb(ed);try{Ec=JSON.stringify(ed)}catch(ud){cb(new Ta.a(14,void 0,ud,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${I.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${ed.floatingObjectId}]`));return}d.ULS.shipAssertTag(537167881,0,!!Ua,"Expecting syncClipboardItems to be defined");Ua.setItem(N.shadowWorkbook,Ec);1===I.commandParameters.commandType&&(this.CZi(xa.type,xa.activeFloatingObjectControlId,rc.StateId),this.deleteFloatingObject(xa.activeFloatingObjectControlId,
xa.type));this.m1c.setValue(xa,Ua);I.asyncClipboardItemsKeys=Na(Ua);vb(Ua)}else d.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${xa.activeFloatingObjectControlId}`),vb(this.m1c.Xua(xa))}},I.commandParameters.commandType,xa.type,rc=>{I.serverRequestTimeInMs=I.commandParameters.stopwatch.tc-Xb;rc=Jb.a.kf(rc.data);1===I.commandParameters.commandType&&this.IYa.VNj(xa.type,xa.activeFloatingObjectControlId);const Ec=ya.a.zc(rc);
d.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ec}`);cb(new ec(4,rc))},[I.commandParameters.stopwatch]))})}deleteFloatingObject(I,xa){I=Yc.a.fz(xa,I);if(I=id.a(this.$).sq(I))id.a(this.$).deleteFloatingObject(I,14,!0),X.g(this.$).ha.Oa.UA=null}CZi(I,xa,Ua){const vb=this.$.da.za(277);if(vb){let Xb=null;I=Yc.a.fz(I,xa);I=id.a(this.$).sq(I);if(null===I||void 0===I?0:I.Pi)Xb=I.Pi.block;if(Xb){var cb=I.floatingObject.Lg();vb.jXb(()=>
!Xb.Bi.lb(cb),Ua,"CutArt")}}}static pfi(I){return 1===I.type||5===I.type}}Object(c.a)(xd,"ArtCopyPasteHandler",wb,[]);var Lc=a(58);class Pb extends Bb{constructor(I,xa,Ua,vb){super(I);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=xa;this.top=Ua;this.left=vb}}Object(c.a)(Pb,"MacroRecorderPasteArtPayload",Bb,[]);class Gc{constructor(I,xa){this.$=I;this.mnb=xa}g8h(I,xa,Ua,vb,cb,Xb=null,rc=null){const Ec=this.$.pa.va.Qb();let ed=null;const ud={CopyPasteTargetType:2};ud.FloatingObjectId=
I;ud.CopyOperationId=Ua.id;Ua.floatingObjectType=xa;ud.UploadToClipService=Ua.uploadToClipService;ud.PKey=Ua.pKey;ud.ClipServiceDataCenter=Ua.clipServiceDataCenter;let Kd=0;2===cb?(cb=505,Kd=16,ed=(Zd,Xd,Je)=>Qa(this.$.pa.va,ud,Ab.b(Zd,vb),Xb?Ab.a(Xd,Xb):Xd,Je,Ua.ribbonCommandInfo,Ec,rc)):(cb=179,ed=(Zd,Xd,Je)=>{this.dgh(xa,I);this.$.sy();return qb(this.$.pa.va,ud,Ab.b(Zd,vb),Xb?Ab.a(Xd,Xb):Xd,Je,Ua.ribbonCommandInfo,Ec,rc)});r.EwaSettings.fc()?this.$.userOperationManager.Ub(new Qb.a(cb,0,ed,Kd|64),
Ua.ribbonCommandInfo):this.$.userOperationManager.Ub(new mb.a(cb,0,ed,Kd),Ua.ribbonCommandInfo)}dgh(I,xa){var Ua=Yc.a.fz(I,xa);(Ua=id.a(this.$).sq(Ua))?(X.g(this.$).ha.Oa.$G(Ua),Ua.isVisible=!1):d.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${I}, FloatingObjectId: ${xa}`)}VNj(I,xa){I=Yc.a.fz(I,xa);if(I=id.a(this.$).sq(I))I.isVisible=!0}G2g(I){this.g8h(I.floatingObjectId,I.E2g,I.commandParameters,I.wt,I.jah,I.G$,I.NNb)}H8h(I,
xa,Ua,vb,cb,Xb,rc,Ec=null,ed=!0){return new Promise((ud,Kd)=>{const Zd=Xb.commandParameters.stopwatch.tc;this.lMd(I,cb,xa,Ua,Xd=>{Xb.requestTelemetryData=Xd.RequestTelemetryData;Xb.serverRequestTimeInMs=Xb.commandParameters.stopwatch.tc-Zd;if(ya.a.lga(Xd.Errors))Xb&&(Xb.encounteredDeploymentErrors=!0),Xd=ya.a.zc(Xd.Errors),d.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Xd}`);else if(ya.a.rg(Xd.Errors)){var Je=
ya.a.zc(Xd.Errors);d.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${Je}`);Kd(new Ta.a(9,Xd.Errors))}else Xd.Result?(Je=Xd.Result,d.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.RZi(rc,Je.FloatingObjectId,Xd.StateId),ud(Gc.Xid(Je.FloatingObjectId))):(d.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),Kd(new Ta.a(9,Xd.Errors)))},Xd=>{Xb.serverRequestTimeInMs=
Xb.commandParameters.stopwatch.tc-Zd;Xd=Jb.a.kf(Xd.data);d.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${ya.a.zc(Xd)}`);Kd(new Ta.a(9,Xd))},vb,Ec,ed)})}RZi(I,xa,Ua){const vb=this.$.da.za(277);if(vb){const cb=Yc.a.fz(I,Gc.Xid(xa));vb.jXb(()=>!!id.a(this.$).sq(cb),Ua,"PasteArt")}}uWd(I,xa){xa&&this.mnb.uWd(I,Yc.a.fz(I.type,xa))}bFf(I){return this.H8h(I.ribbonCommandInfo,I.destination,I.RFe,I.NNb,I.V_,I.pasteContext,I.item.type,I.Qxe,I.item.isFromCurrentSession(this.$)).then(xa=>
xa,xa=>{this.uWd(I.item,I.Qxe);return Promise.reject(xa)})}QLd(I,xa,Ua){I||(I=P.v(X.g(this.$).ha.sa.activeCell,this.$));X.g(this.$).Xfc(P.D(I),1)?id.a(this.$).zma(Ua,xa,!0):X.g(this.$).ha.Oa.Wra(I,xa,Ua).continueWith(vb=>{vb.result?d.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${xa}]`):d.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${xa}]`)})}lMd(I,
xa,Ua,vb,cb,Xb,rc,Ec,ed=!0){const ud=this.$.pa.va.Qb(),Kd={};Kd.ShadowWorkbookBase64=xa.shadowWorkbookBase64;Kd.FloatingObjectId=vb;Kd.DestinationRanges=Ua?P.s(Ua):null;Kd.CopyPasteTargetType=2;Kd.ClientEstimationFloatingObjectId=Ec;Ua=(Zd,Xd,Je)=>{Ec||this.$.sy();return Wa(this.$.pa.va,Kd,Ab.b(Zd,cb),Ab.a(Xd,Xb),Je,null,ud,rc)};vb=()=>{if(ed){let Zd;Zd=Lc.a.Uh(Lc.a.Ac(Kd));Zd.FloatingObjectId=xa.floatingObjectId;Kd.DestinationRanges||(Zd.DestinationRanges=P.p(this.$.xa.oa.sheetName,"",0,0,0,0));
return new Pb(Zd,ed,0,0)}return new Pb(Kd,ed,0,0)};Ua=r.EwaSettings.fc()?new Qb.a(503,0,Ua,void 0,vb):new mb.a(503,0,Ua,void 0,vb);Ua.flags=r.EwaSettings.fc()?65:1;this.$.userOperationManager.Ub(Ua,I)}static Xid(I){return`${I.length+2}.{${I.toUpperCase()}}`}}Object(c.a)(Gc,"ArtCopyPasteUtils",null,[505]);var Nb=a(214);class yc{constructor(I){this.k1c=this.tsa=null;this.V9a=15;this.$=I}QCd(I,xa){this.tsa=I;this.k1c=xa}o5c(){if(!this.tsa||!this.k1c)return d.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const I=md.a.kpb(new Yc.a(this.tsa));I.Id=Gc.Xid(m.a.create().toString());I.Version=-1;I.Name="";I.IsClientEstimation=!0;var xa=this.V9h(I);if(!xa)return null;const Ua=new Yc.a(I);xa.block.Bi.add(Ua);Ua.bIb();const vb=id.a(this.$);vb.D2b(Ua,xa);xa=vb.sq(Yc.a.DOh(I));!xa||xa.floatingObject.vLa||xa.floatingObject.QLa||xa.JQa(this.k1c);vb.zma(I.Type,I.Id,!0);return I.Id}Y0f(I){return r.EwaSettings.ma(222)&&I.isFromCurrentSession(this.$)&&!X.g(this.$).rtl&&!X.g(this.$).hb.Ti}uWd(I,xa){this.Y0f(I)&&
(I=id.a(this.$).sq(xa))&&(d.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${xa}] of type [${I.floatingObject.type}]`),id.a(this.$).deleteFloatingObject(I,15,!0),I.Pi&&I.pab(I.Pi,!1))}V9h(I){if(!I)return d.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(X.g(this.$).ha.Oa.activeFloatingObjectControlId){var xa=
X.g(this.$).ha.Oa.UA.floatingObject;I.OriginDeltaX=xa.offsetX+this.V9a;I.OriginDeltaY=xa.offsetY+this.V9a;I.AbsoluteLeft+=this.V9a;I.AbsoluteTop+=this.V9a;I.AbsoluteRight+=this.V9a;I.AbsoluteBottom+=this.V9a;I.ZOrder=xa.Dy+1;return X.g(this.$).ha.Oa.UA.Pi}if(!this.$.oa||!this.$.oa.activeCell)return d.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var Ua=this.$.oa.activeCell;
xa=X.g(this.$).x0(Ua);if(!xa)return d.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${Ua.toString()} is null.`),null;const vb=Da.HelperMethods.Sub(xa.domElement,xa.rj.domElement);Ua=xa.gridView.lg(Ua,2);if(!vb||!Ua)return d.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!vb}. cellPositionRelativeToGridOrigin is null: ${!Ua} .`),null;I.OriginDeltaX=
Ua.topLeft.x-vb.x;I.OriginDeltaY=Ua.topLeft.y-vb.y;I.AbsoluteLeft=Ua.topLeft.x;I.AbsoluteTop=Ua.topLeft.y;I.AbsoluteRight=I.AbsoluteLeft+Math.abs(this.tsa.AbsoluteRight-this.tsa.AbsoluteLeft);I.AbsoluteBottom=I.AbsoluteTop+Math.abs(this.tsa.AbsoluteBottom-this.tsa.AbsoluteTop);I.ZOrder=this.tsa.ZOrder+100;return new Nb.a(xa.gridView.Ea.tl(xa.hashCode),xa.hashCode)}}Object(c.a)(yc,"ArtPasteClientEstimation",null,[504]);class Tc{create(){const I=window.clipboardPlatform;return I?I.createClipboardItems():
null}}Object(c.a)(Tc,"ClipboardItemsFactory",null,[503]);class gd{}gd.undefined="Undefined";Object(c.a)(gd,"CCPTelemetryConsts",null,[]);class Ad{}Ad.cells="Cells";Ad.floatingObject="FloatingObject";Ad.unknown="Unknown";Object(c.a)(Ad,"ActiveSelection",null,[]);class Od{}Od.pfh="DisplayNotInvoked";Od.g5c="Displayed";Od.a_i="PrerequisitesNotReady";Object(c.a)(Od,"PasteIndicationDisplayStatus",null,[]);var Pd=a(109);class Md{constructor(I){this.pDc=this.CNc=null;this.$=I}get XEd(){if(!this.CNc){const I=
this.$.da.za(254,!0);I&&(this.CNc=new Rc(this.$,I,new Tc))}return this.CNc}get uVc(){if(!this.pDc&&this.$.da.za(254,!0)){const I=new yc(this.$);this.pDc=new xd(this.$,new Tc,new Gc(this.$,I),I)}return this.pDc}getCopyFlowHandler(I){const xa=this.yKh(X.g(this.$).Ke);I.commandParameters.copyPasteHandlerName=xa.name;return xa}getPasteFlowHandler(I){var xa=I.copyContextSnapshot;xa=R(I)?this.uVc:J(I)?this.XEd:(null===xa||void 0===xa?0:xa.sourceItem)&&Object.getType(xa.sourceItem)===T?this.uVc:this.XEd;
I.commandParameters.copyPasteHandlerName=xa.name;return xa}initializePasteContext(I){if(I&&(I.isSameSession=!1,I.isShadowWorkbookParsedSuccessfully=!1,I.pasteResult=gd.undefined,I.payloadOrigin=gd.undefined,I.payloadType=gd.undefined,I.encounteredDeploymentErrors=!1,I.shadowWorkbookSizeExceedsLimit=!1,I.originalSourceRangesCountExceedsLimit=!1,I.activeSelectionType=this.kGh(),I.indicationDisplayScheduled=!1,I.pasteDestinationHasMergedCells=!1,I.pasteIndicationDisplayStatus=Od.pfh,I.copyContextSnapshot)){var xa=
I.copyContextSnapshot;const rc=H(xa.sourceItem);var Ua=xa.sourceItem;var vb=!!Ua&&Object.getType(Ua)===T;Ua=0;var cb=!1;rc?(cb=xa.sourceItem,I.isSameSession=cb.isFromCurrentSession(this.$),Ua=1,cb=this.wji(cb,I)):vb&&(I.isSameSession=xa.sourceItem.isFromCurrentSession(this.$),Ua=2);if(I.copyContextSnapshot.commandParameters){const Ec=-1985798686===xa.commandParameters.ribbonCommandInfo.command;vb=I.commandParameters;var Xb=this.$;xa?Xb&&Xb.ya?xa=xa.sessionId===Xb.ya.UserSessionId:(d.ULS.shipAssertTag(537166211,
0,!1,"ewaControl shouldn't be null"),xa=!1):(d.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),xa=!1);vb.clearSystemClipboard=xa&&Ec&&rc&&!cb;I.commandParameters.copyPasteTargetType=Ua}}}getSessionId(){return this.$.ya.UserSessionId}wji(I,xa){const Ua=Pd.b(I.ranges,vb=>vb.Ze)&&Pd.b(xa.commandParameters.originalDestinations,vb=>1!==vb.top);return Pd.b(I.ranges,vb=>vb.isRow)&&Pd.b(xa.commandParameters.originalDestinations,vb=>1!==vb.left)||Ua}yKh(I){switch(I){case 1:return this.XEd;
case 64:case 4:case 2:case 256:return this.uVc;default:throw Error.invalidOperation("Unsupported selection");}}kGh(){return X.g(this.$).ha.Ke&470?Ad.floatingObject:1===X.g(this.$).ha.Ke?Ad.cells:Ad.unknown}getDialogResponse(){}}Object(c.a)(Md,"ExcelCopyPasteApplicationHost",null,[479]);var ge=a(156);class pe extends z.a{constructor(I,xa){super(I);this.Vo=null;this.Sai=(Ua,vb)=>{1===Ua?(Ua=pe.Aeh[vb[pe.zeh]],d.ULS.sendTraceTag(537167683,0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===
Ua?"Horizontal":"Vertical"}`),this.Vo.setResult(Ua)):(d.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.Vo.rs())};this.wg(xa)}get oc(){return"InsertCopiedCutCellsDialog"}wg(I){this.Vo=new ge.a;const xa=B.a.instance.ga(16);I=this.IM(I);this.initializeAndShow(xa,this.Sai,I)}IM(I){return{[pe.Uu]:this.oc,[pe.Zki]:I}}}pe.zeh="direction";pe.Zki="isRtl";pe.Aeh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(pe,"InsertCopiedCutCellsDialog",
z.a,[]);class Qd{F2b(I,xa){return(new pe(I,xa)).Vo.task}}Object(c.a)(Qd,"InsertCopiedCutCellsDialogFactory",null,[478]);var he=a(86),ue=a(47),je=a(45);class Ge{constructor(I){this.E3b="";this.v1=this.Ss=null;this.Eoc=!1;this.A6e=(xa=null,Ua=null)=>{this.hide(xa,Ua)};this.gridView=X.g(I);this.gridView.ha.LG(this.A6e)}THe(){this.Eoc||(d.ULS.sendTraceTag(537167680,0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.kz(I=>{I.T$(0).then(()=>{this.Eoc=!0})}))}Mjj(I){var xa=
I.commandParameters.id;d.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${xa}, cancelCtx is null = ${!this.Ss}, PrerequisitesDownloaded = ${this.Eoc}`);this.THe();this.E3b=xa;xa=!this.Iqf();if(!this.Ss||xa)this.eve(),this.Ss=ue.a.instance.create(()=>{this.ofh(I)},void 0===I.timeoutToShowSpinnerInMs||null===I.timeoutToShowSpinnerInMs?100:I.timeoutToShowSpinnerInMs,je.a.rWi);this.v1=I.commandParameters.originalDestinations}ofh(I){this.Eoc?(this.display(I.commandParameters.originalDestinations),
I.pasteIndicationDisplayStatus=Od.g5c):(d.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),I.pasteIndicationDisplayStatus=Od.a_i)}display(I){d.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");this.gridView.ob.yv(tb.a.Y6(Ob.d(this.gridView.$.oa),I),Ge.Qnc,!0);this.gridView.ob.Bn(Ge.Qnc)}Ehd(I){d.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${I}, currentPasteCommandId = ${this.E3b}`);
I&&nb.a.equals(I,this.E3b,!1)&&this.hide()}hide(I=null){this.v1&&I&&this.Iqf()&&d.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");this.E3b="";this.eve();this.v1=null;this.gridView.ob.Tg(Ge.Qnc);this.gridView.ob.wi(null,Ge.Qnc)}Iqf(){return P.Q(this.gridView.ha.sa.selectedRanges,this.v1)}eve(){this.Ss&&(he.a.Ia(this.Ss),this.Ss=null)}dispose(){this.hide();this.gridView.ha.RF(this.A6e)}}
Ge.Qnc=[30];Object(c.a)(Ge,"PasteIndicationManager",null,[477,3]);var Ce=a(973),pc=a(54),Uc=a(695);class hd extends f.a{constructor(I){super();this.$=I;this.Om=B.a.instance;this.Fb()}create(){const I=pc.a.KQ([73,74],4,this.ib,void 0,void 0,void 0,hd.Dma),xa=la.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.ib);ea.TaskExtensions.Aa(ea.TaskExtensions.Xd([xa,I],this.la),()=>{const Ua=new Ce.a;let vb=null;this.e0g(Ua).then(cb=>{vb=cb.Txe;const Xb=copyPasteInfra.createCopyPasteInfra(vb,new Md(this.$),
Ua,this.$);d.ULS.shipAssertTag(537167762,0,!!this.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");d.ULS.shipAssertTag(537167761,0,!!this.$.ya&&!!this.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");const rc=vb.getMetadataManager();var Ec=Object(Uc.b)(this.$.da,254,()=>new cc(this.$,rc,xa.result,Xb,new Ka(this.$,X.g(this.$)),new Qd,this.$.ya.DocumentHostInfo.UserId,
vb.getInitializationError()));this.qb(Ec);if(cb.f_a){Ec=cc.v9b();const ed=JSON.stringify(cb.f_a.dataClipboardCapabilities),ud=cb.f_a.clipboardStrategiesToInitialize[0].clipboardStrategyType===cb.f_a.dataClipboardStrategyType,Kd=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();d.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${Ec}, StrategyType=${cb.f_a.dataClipboardStrategyType}, StrategyCapabilities=${ed}, IsBestStrategyTypeInitialized=${ud}, InfraLoadTimeMS=${Kd}`)}else d.ULS.shipAssertTag(537167760,
0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},cb=>{const Xb=cc.v9b();cb=cb?copyPasteInfra.getStringifiedError(cb):"null";d.ULS.shipAssertTag(38847436,0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Xb} error: ${cb}`)})},this.la,3)}dispose(){super.dispose()}e0g(I){let xa=null;var Ua=window.clipboardPlatform;
Ua&&(xa=Ua.getClipboardPlatformEnvironment());if(!xa)return d.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),Promise.reject(null);Ua=this.$.ya;const vb=[Ua.OfficeOnlineChromeExtensionId,Ua.ChromeClipboardAccessExtensionId],cb=this.Om.Xa(5);var Xb=this.$.me.get(57);let rc=!Xb&&this.$.me.get(5);const Ec=this.$.ea.jc;Ec&&(Ec.inWebPart||Ec.inViewerFromWebPart||Ec.isDivSyndicated)&&
(rc=!1);Xb=this.wJh(rc,!Xb);d.ULS.shipAssertTag(537167758,0,!!Ua.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return xa.init(this.$,I,vb,Ua.SharedClipboardHostingApp,Ua.SharedClipboardHostingApps,Ua.SharedClipboardHostingEnvironments,Ua.SharedClipboardOverrideOrigin,Ua.SharedClipboardSchemaVersion,Ua.SharedClipboardExpirationInMinutes,Ua.ClipboardPromiseTimeoutInMinutes,cb,Ua.MachineCluster,new lb(this.$),
Xb,Ua.DocumentHostInfo.UserId,Ua.ClipboardTtlInMS,r.EwaSettings.ma(310),Ua.UserSessionId).then(ed=>Object(b.a)(new Ib,{Txe:xa,f_a:ed}),ed=>Promise.reject(ed))}wJh(I,xa){const Ua=[];I&&xa&&Ua.push(this.I9g());xa&&(Ua.push(this.R2c(7)),Ua.push(this.R2c(0)));I&&Ua.push(this.ECe());Ua.push({clipboardStrategyType:4});const vb=Ua?Ua.join(","):"[]";d.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${I}, isSystemClipboardAllowed=${xa}, result = ${vb}`);
return Ua}ECe(){const I=this.$.ya,xa={clipboardStrategyType:5};xa.sessionId=I.UserSessionId;xa.useSharedClipboardIframe=!0;xa.sharedClipboardHostingApp=I.SharedClipboardHostingApp;xa.sharedClipboardHostingApps=I.SharedClipboardHostingApps;xa.sharedClipboardHostingEnvironments=I.SharedClipboardHostingEnvironments;xa.sharedClipboardOverrideOrigin=I.SharedClipboardOverrideOrigin;xa.sharedClipboardSchemaVersion=I.SharedClipboardSchemaVersion;xa.sharedClipboardExpirationInMinutes=I.SharedClipboardExpirationInMinutes;
xa.wacCluster=I.MachineCluster;return xa}I9g(){const I={clipboardStrategyType:6};I.localStorageStrategyParameters=this.ECe();I.systemClipboardStrategyParameters=this.R2c(0);return I}R2c(I){const xa={};xa.clipboardStrategyType=I;xa.skipFilesIfPlainTextExists=!0;return xa}static ka(I){I.da.Ga(373,new Ge(I));I.da.Ga(hd.Dma,new hd(I))}}hd.Dma=255;Object(c.a)(hd,"CopyPasteInfrastructureFactory",f.a,[]);var yd=a(10);a.d(D,"a",function(){return wd});const wd=()=>{yd.a.Fa(I=>{hd.ka(I)})}},1147:function(t,
D,a){t=a(0);var c=a(15),b=a(680),d=a(548),f=a(83),e=a(84),k;(function(Ca){Ca[Ca.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";Ca[Ca.cloudPolicySettings=1]="cloudPolicySettings";Ca[Ca.alternateAuthToken=2]="alternateAuthToken"})(k||(k={}));Object(t.b)("ApplicationFeatureHelperRequestType",k);class l{constructor(){this.message=null;this.ycc=0}}Object(t.a)(l,"HttpRequstToPromiseRejectData",null,[]);var m=a(98),v=a(236);class n{constructor(Ca,Na){this.nb=Ca;this.Xg=Na}g2c(Ca,Na,
za,la=null,aa=null,sa=null,ea=null,Z=null){const ua=k[za],ya=ua+"RequestFailure";m.Health.instance.recordKpiUsage(ya,0,"jpittsdirects",null);return new Promise((ha,Da)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",ua);const nb=null!=ea?ea:this.nb.nd("ApplicationFeatureHelperRequestQueueTimeout",15E3),qa=null!=Z?Z:this.nb.nd("ApplicationFeatureHelperRequestSentTimeout",3E4);this.Xg.O8(Ca,1,null,this.OOh(za,la),sa,!1,1,pa=>
{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",ua);try{if(void 0===pa||null===pa||void 0===pa.data||null===pa.data||void 0===pa.data.Td||null===pa.data.Td){m.Health.instance.recordKpiFailure(ya,"Invalid RequestSucceededEventArgs",!1,!0,null);let $a=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",ua);Da(this.gvb($a,pa))}else if(pa.data.httpStatus!==
v.a.DO){m.Health.instance.recordKpiFailure(ya,"HttpStatusCode_"+pa.data.httpStatus.toString(),!1,!0,null);let $a=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",pa.data.httpStatus,ua);Da(this.gvb($a,pa))}else{void 0!==aa&&null!==aa&&void 0!==pa.data.responseHeaders&&null!==pa.data.responseHeaders&&aa(pa.data.responseHeaders);var Ja=Na(pa.data.Td);if(Ja)c.ULS.sendTraceTag(50622690,
3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",ua),ha(Ja);else{m.Health.instance.recordKpiFailure(ya,"Parse Failure",!1,!0,null);let $a=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",ua);Da(this.gvb($a,pa))}}}catch($a){m.Health.instance.recordKpiFailure(ya,"Unexpected Failure",!1,!0,null),Ja=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",
$a,ua),Da(this.gvb(Ja,pa))}},pa=>{let Ja;pa.data?(m.Health.instance.recordKpiFailure(ya,"HttpStatusCode_"+pa.data.httpStatus.toString(),!1,!0,null),Ja=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",pa.data.httpStatus,pa.data.Td||"No Data",ua)):(m.Health.instance.recordKpiFailure(ya,"Invalid RequestFailedEventArgs",!1,!0,null),Ja=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",
ua));Da(this.gvb(Ja,pa))},null,void 0,void 0,nb,qa)})}gvb(Ca,Na){const za=new l;za.message=Ca;za.ycc=Na&&Na.data?Na.data.httpStatus:-1;return za}OOh(Ca,Na){const za={};za["x-UserDataSignature"]=this.nb.Va("UserDataSignature");za["x-LicensingIsEnabled"]=this.nb.qa("LicensingIsEnabled").toString();za["x-CacheIsEnabled"]=this.nb.qa("LicensingRedisIsEnabled").toString();za["x-OcpsIsEnabled"]=this.nb.qa("OcpsIsEnabled").toString();za["x-LicensingAADIdIsEnabled"]=this.nb.qa("LicensingAadIdIsEnabled").toString();
0===Ca&&(za["x-LicenseCheckOnTenantEnabled"]=this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksLicenseCheck",!1).toString(),za["x-SupportUserConsentDependentFeatures"]="true",za["x-AFHUserConsentGroupValue"]="0",za["x-UseShellServiceForUserConsentGroup"]="true",za["x-SMBUserLicensingEnabled"]="true");if(Na)for(let la of Na.keys)za[la]=Na.na(la);return za}}Object(t.a)(n,"HttpRequestToPromiseUtility",null,[]);var w=a(4),r;(function(Ca){Ca[Ca.loki=0]="loki";Ca[Ca.augloopACLP=1]="augloopACLP"})(r||
(r={}));Object(t.b)("AlternateAuthSupportApp",r);var u=a(728),x=a(41);class z{constructor(){this.Token=null;this.ExpirationTime=0}}Object(t.a)(z,"WacAlternateAuthToken",null,[]);class B{constructor(Ca,Na){this.WJj=3E5;if(void 0===Ca||null===Ca||void 0===Na||null===Na)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.nb=Ca;this.ZOb=new b.a(d.a.Rk());this.Shb=new n(Ca,Na);void 0!==u.a.htd&&null!==u.a.htd&&void 0!==u.a.Fic&&null!==u.a.Fic&&0<u.a.Fic&&(Ca=new z,Ca.Token=u.a.htd,
Ca.ExpirationTime=u.a.Fic,this.ZOb.ia("loki",Ca))}XGh(){let Ca=null;this.ZOb.lb(r[0])&&(Ca=this.ZOb.na(r[0]));return void 0===Ca||null===Ca||this.Cpd(Ca)?this.Kxh():Promise.resolve(Ca.Token)}Cpd(Ca){return Ca.ExpirationTime-Date.now()<this.WJj}Kxh(){const Ca=new b.a(d.a.Rk());Ca.ia("X-AlternateAuthApp",r[0]);return this.Shb.g2c(this.zua("/afhs/AlternateAuthHelperHandler.ashx"),Object(f.a)(this,this.BVi,"parseAlternateAuthTokenResponse"),2,Ca).then(Na=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",
r[0]);this.ZOb.ia(r[0],Na);return Na.Token},Na=>{Na=Object(e.a)(l,Na);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",Na.message,Na.ycc);return null})}BVi(Ca){let Na=null;({Vt:Na}=x.d(Ca));c.ULS.sendTraceTag(545821457,3004,Na?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",Ca);return Na}zua(Ca){return String.format("{0}{1}?{2}",this.nb.Va("WebServiceBase"),Ca,w.AFrameworkApplication.gj)}}Object(t.a)(B,
"AlternateAuthHelper",null,[217]);var y=a(451);class A{constructor(Ca,Na,za){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=Ca;this.isEnabled=Na;this.tierName=za}}Object(t.a)(A,"FeatureStateChangeArgs",null,[]);var K=a(134),G=a(251),T=a(27),W=a(112),P=a(171),E;(function(Ca){Ca[Ca.Enabled=0]="Enabled";Ca[Ca.Disabled=1]="Disabled"})(E||(E={}));Object(t.b)("FeatureState",E);var H=a(82),F=a(25),N=a(185);class J{constructor(Ca,Na,za=null,la=null,aa=null){this.Ota=this.nUb=this.xde=
this.Kpa=this.qVb=null;this.Shb=new n(Ca,Na);this.nb=Ca;this.qrg=Ca.nd("LicensingMaxRetryAttempts",0);this.zJc=Ca.qa("IsO365ConsumerHost");this.yJc=Ca.qa("IsO365CommercialHost");this.ZRb=Ca.qa("PremiumUpsellIsEnabled");this.f2d=za;this.Ghe=la;this.La=aa;this.Jpa=Ca.qa("LicensingIsEnabled");this.DDa=Ca.qa("OcpsIsEnabled")&&this.yJc;this.ZQc=Ca.qa("ShowPrivacyDialog")&&!!la;this.l7d=Ca.qa("IsAnonymousUser");this.h9c=new Promise(sa=>{sa(!1)});this.NAa=new Promise(sa=>{sa(!0)});this.Nta=new b.a(d.a.Rk());
this.bWb=!0;this.P9d=this.lQh();this.Dnd()&&!this.l7d?(void 0!==w.AFrameworkApplication.ta&&null!==w.AFrameworkApplication.ta&&(this.qVb=w.AFrameworkApplication.ta.LD,void 0!==this.qVb&&null!==this.qVb&&(this.Kpa=this.qVb.Ng("WebServiceCall","ApplicationFeatureHelperService"))),this.Ota=this.cWd()):this.Ota=new Promise(sa=>{sa({})});this.Ota.catch(sa=>{c.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(sa))});this.bWb&&(this.ZRb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(sa=>{this.ZRb=this.nb.qa("PremiumUpsellIsEnabled")&&
sa;return null}))}lQh(){const Ca=this.nb.lo("AllLicensedFeatures")?this.nb.lw("AllLicensedFeatures"):[],Na=new y.a;for(let za=0;za<Ca.length;za++)Na.add(Ca[za]);return Na}Dnd(){return this.yJc||this.zJc}cWd(Ca=0,Na=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",Na);const za=K.a.Kr();za&&(za.set("retryAttempt",Ca.toString()),za.set("forceRefresh",Na.toString()),za.set("isO365ConsumerHost",this.zJc.toString()),za.set("isO365CommercialHost",
this.yJc.toString()),za.set("isFreemiumUpsellEnabled",this.ZRb.toString()));m.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",za);m.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",za);void 0!==this.Kpa&&null!==this.Kpa&&this.Kpa.start();let la=null;Na&&(la=new b.a(d.a.Rk()),la.ia("x-LicensingForceRefresh","true"));this.xde=new Date;return(this.Jpa?this.Shb.g2c(this.zua("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,
this.EVi,"parseApplicationFeatureHelperResponse"),0,la,Object(f.a)(this,this.X_i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(aa=>{const sa=Object.assign(new N.a,{durationMs:this.m5f()});sa.extendedProperties=za;sa.extendedProperties&&aa&&(sa.extendedProperties.set("featureCount",W.a.count(aa).toString()),sa.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in aa).toString()),sa.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in
aa).toString()),this.nUb&&sa.extendedProperties.set("fromCache",(this.nUb<this.xde).toString()));m.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",sa);return aa},aa=>{const sa=Object.assign(new N.a,{durationMs:this.m5f()}),ea=Object(e.a)(l,aa);if(!ea)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",
!1,!0,sa),new Promise((Z,ua)=>{ua(aa)});sa.extendedProperties=za;sa.extendedProperties&&sa.extendedProperties.set("status",ea.ycc.toString());m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","RequestFailed",!1,!0,sa);return 408===ea.ycc&&++Ca<=this.qrg?this.cWd(Ca):new Promise((Z,ua)=>{ua(ea)})})}EVi(Ca){(Ca=x.b(Ca))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",Ca)):c.ULS.sendTraceTag(50436171,
3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return Ca.Features}zua(Ca){var Na=String.format("{0}{1}",this.nb.Va("WebServiceBase"),Ca);this.nb.lo("ApplicationFeatureHelperHttpCachingEnabled")&&this.nb.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(Ca=J.D$b(this.nb))&&0<Ca.length&&(this.bWb&&(Ca+="ucbf"),Na=new G.QueryStringBuilder(Na),Na.Oi("afhskey",Ca),Na=Na.toString());return Na}isFeatureEnabled(Ca,Na){if(!this.DDa&&!this.ZQc&&
!this.Jpa)return this.NAa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",Ca);if("ConnectedServices"===Ca){var za=this.DDa?this.f2d.RJ("ControllerConnectedServicesEnabled"):this.NAa;const sa=this.ZQc?this.Ghe.getSettings().then(ea=>2!==ea.Tt,()=>Na):this.NAa;return za.then(ea=>ea?sa:this.h9c)}za=null;za=this.DDa?this.f2d.isFeatureEnabled(Ca):this.NAa;let la=null;la=this.Jpa?this.xgi(Ca,Na):this.NAa;let aa=null;aa=this.ZQc?
this.Ghe.isFeatureEnabled(Ca):this.NAa;return za.then(sa=>sa?aa.then(ea=>ea?la:this.h9c):this.h9c).then(sa=>{this.Nkf(Ca,sa,!0);return sa},()=>{this.Nkf(Ca,Na,!1);return Na})}Nkf(Ca,Na,za){c.ULS.sendTraceTag(526713106,3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",Ca,Na,za)}getFeatureTier(Ca,Na){if(!this.Jpa)return new Promise(za=>{za(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",Ca);return this.Ota.then(za=>this.Dac(Ca,
za,Na),()=>Na)}isFreemiumUpsellEnabled(){return this.ZRb&&this.zJc&&!this.l7d}launchUpsellExperience(Ca,Na=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",Ca));var za=K.a.Kr();za&&(za.set("experienceId",Ca),Na&&za.set("campaignId",Na));m.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",za);if(za=H.a.instance.uh("Common.IInProductMessagingUIManager")){const la=Object(f.a)(this,
this.d1h,"handleDimeTaskComplete");za.Yif(Ca,la,Na)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.ae(F.a.Q8b,2,{["experience"]:Ca})}Yla(Ca,Na){if(!this.Jpa)return null;if(!Ca||!Na)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const za=P.a.create().toString();this.Nta.lb(Ca)||
this.Nta.ia(Ca,new b.a(d.a.Rk()));this.Nta.na(Ca).add(za,Na);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",za,Ca));return za}dHd(Ca,Na){this.Jpa&&(Ca&&this.Nta.lb(Ca)?Na&&P.a.isValid(Na)?this.Nta.na(Ca).lb(Na)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",Na,Ca)),this.Nta.na(Ca).remove(Na)):
c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",Na,Ca)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",Na,Ca)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",Ca)))}Dac(Ca,Na,za){return this.bWb?
Ca in Na?Na[Ca].LicenseTier:za:Ca in Na?this.bWi(Na[Ca],za):za}bWi(Ca,Na){switch(Ca.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return Na}}d1h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.Ota.then(Ca=>{this.xMf(Ca)}).catch(()=>{this.xMf({})})}xMf(Ca){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const Na=this.cWd(0,!0);Na.then(za=>{this.Ota=
Na;W.a.count(za)>W.a.count(Ca)?m.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let la of this.Nta.keys)if(la in za){const aa=this.Dac(la,za,0);la in Ca?this.Dac(la,Ca,0)!==aa&&this.Qwd(la,!0,aa):this.Qwd(la,!0,aa)}else la in Ca&&this.Qwd(la,!1,this.Dac(la,Ca,0))}).catch(za=>{m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,
3004,10,JSON.stringify(za))})}Qwd(Ca,Na,za){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",Ca,Na,za);Na=new A(Ca,Na,za);za=this.Nta.na(Ca);for(let la of za)try{la.value(Na)}catch(aa){c.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",Ca,la.key,aa.message))}}Wd(Ca,
Na){if(this.Jpa){const za=this.P9d.contains(Ca);let la=!0,aa="",sa=!1;return this.Ota.then(ea=>{Ca in ea?(ea=ea[Ca],aa=E[ea.FeatureState],la=1!==ea.FeatureState):la=!za;this.Wkf(Ca,za,aa,sa,Na,la);return la},()=>{sa=!0;za&&(la=Na);this.Wkf(Ca,za,aa,sa,Na,la);return la})}return this.NAa}Wkf(Ca,Na,za,la,aa,sa){c.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",Ca,Na,la,za,aa,sa)}xgi(Ca,Na){if(this.bWb)return this.Wd(Ca,
Na);if(this.Jpa){if(this.P9d.contains(Ca))return this.Ota.then(za=>Ca in za,()=>Na);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",Ca)}return this.NAa}X_i(Ca){try{Ca&&"Date"in Ca&&(this.nUb=new Date(Ca.Date),c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.nUb.toString()))}catch(Na){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",
Na)}}m5f(){if(void 0!==this.Kpa&&null!==this.Kpa){const Ca=this.Kpa.tc;this.Kpa.stop();return Ca}return null}static D$b(Ca){try{if(T.a.gGj){const Na=Ca.Va("UserDataSignature").split(".");if(1<Na.length){const za=window.self.atob(Na[1]),la=JSON.parse(za).LocalStorageKey;if(void 0!==la&&null!==la&&0<la.length)return la}}}catch(Na){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",Na.toString())}return null}}Object(t.a)(J,"ApplicationFeatureHelper",null,[218]);var R=a(184);
class M{constructor(Ca,Na){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=Ca.PolicySettings;Ca=new Date;Ca.setMinutes(Ca.getMinutes()+Na);this.ExpirationTime=Ca.getTime()}}Object(t.a)(M,"CloudPolicySettingsCacheData",null,[]);var L=a(812),U=a(371),X=a(225);class da{static u3f(){return w.AFrameworkApplication.fa.qa("SideCarIsEnabled")?da.ftc&&da.Pld?new Promise(Ca=>{Ca(!0)}):new Promise((Ca,Na)=>{da.ftc=X.a.create(w.AFrameworkApplication.fa.Va("SideCarUrl"));U.a.Kha(da.ftc);da.ftc.T8((za,
la)=>{(da.Pld=la.succeeded)?Ca(la.succeeded):Na(la.succeeded)})}):new Promise(Ca=>{Ca(!1)})}}da.Pld=!1;da.ftc=null;Object(t.a)(da,"SideCarLoader",null,[]);class fa{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(t.a)(fa,"CloudPolicySettingsData",null,[]);class S{constructor(Ca,Na){this.rEc=0;this.f1b=null;this.Shb=new n(Ca,Na);this.nb=Ca;Na=Ca.Va("HostAuthType");this.DDa=Ca.qa("OcpsIsEnabled")&&Ca.qa("IsO365CommercialHost")&&!(void 0===Na||null===Na)&&"aad"===
Na.toLowerCase();this.Tae=x.b(Ca.Va("OcpsDefaultSettings")||"{}");this.Gib=this.D$b();Na=this.nb.lo("ServicesControlsMicrosoftControllerServicesList")?this.nb.lw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.$Pb=new y.a;for(let za=0;za<Na.length;za++)this.$Pb.add(Na[za]);this.DDa&&!Ca.qa("IsAnonymousUser")&&Ca.qa("SideCarIsEnabled")?this.f1b=this.NMj():this.f1b=this.Lna(this.DDa,this.zua("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.FVi,"parseCloudPolicySettingsResponse"));
this.f1b.then(()=>null).catch(za=>{c.ULS.sendTraceTag(50622685,3004,10,JSON.stringify(za))})}RJ(Ca,Na=!0){if(!this.DDa){const sa=this;return new Promise(ea=>{ea(sa.Rub(Ca))})}let za=this,la=this;const aa=this.f1b.then(sa=>{try{let ea=null;sa.PolicySettings&&"unknown"in sa.PolicySettings&&(ea=sa.PolicySettings.unknown);if(ea){if(Ca in ea&&void 0!==ea[Ca]&&null!==ea[Ca])return new Promise(ua=>{ua("0"!==ea[Ca])});const Z=Ca.toLowerCase();if(Z in ea&&void 0!==ea[Z]&&null!==ea[Z])return new Promise(ua=>
{ua("0"!==ea[Z])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+Ca+" not found, using default");return new Promise(ua=>{ua(za.Rub(Ca))})}return new Promise(Z=>{Z(za.Rub(Ca))})}catch(ea){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+Ca+" policy value. Error Message: {0}",ea.message),za.handleError(ea.toString(),Na,za.Rub(Ca))}},sa=>la.handleError(sa,Na,la.Rub(Ca)));aa.then(sa=>{c.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",
Ca,sa);return null});return aa}isFeatureEnabled(Ca,Na=!0){if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.zgi(Ca,Na);let za=new Promise(aa=>{aa(!0)}),la="";this.$Pb.contains(Ca)&&(la="ControllerConnectedServicesEnabled",za=this.RJ(la,Na));za.then(aa=>{c.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",Ca,aa,la);return null});return za}zgi(Ca,
Na=!0){let za=new Promise(aa=>{aa(!0)}),la="";"mso_sendASmile"===Ca?la="Enabled":"Survey"===Ca||"FloodgateSurvey"===Ca?la="SurveyEnabled":this.$Pb.contains(Ca)&&(la="ControllerConnectedServicesEnabled");""!==la&&(za=this.RJ(la,Na));za.then(aa=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",Ca,aa,la);return null});return za}handleError(Ca,Na,za){return Na?new Promise(la=>{la(za)}):new Promise((la,aa)=>{aa(Ca)})}Lna(Ca,
Na,za){if(!Ca)return Promise.resolve(new fa);let la=!1,aa=null;m.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let sa=this.E1c("GetCloudPolicySettings");return(new Promise((ea,Z)=>{if(void 0!==this.Gib&&null!==this.Gib&&0<this.Gib.length){const ua=this.wMj();if(void 0!==ua&&null!==ua){la=!0;ea(ua);return}}this.Shb.g2c(Na,za,1,null,Object(f.a)(this,this.a0i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],this.nb.nd("CloudPolicySettingsRequestQueueTimeout",
15E3),this.nb.nd("CloudPolicySettingsRequestSentTimeout",3E4)).then(ua=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.mNj(ua);ea(ua);return ua},ua=>{Z(ua);return null})})).then(ea=>{({stopwatch:sa,returnValue:aa}=this.gxc(sa));var Z=K.a.Kr();Z&&Z.set("FromCache",la.toString());Z=Object.assign(new N.a,{durationMs:aa,extendedProperties:Z});m.Health.instance.recordKpiSuccess("GetCloudPolicySettings",Z);return ea})}NMj(){return da.u3f().then(()=>{c.ULS.sendTraceTag(593282845,
3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}zua(Ca){return String.format("{0}{1}",this.nb.Va("WebServiceBase"),Ca)}FVi(Ca){let Na=null;({Vt:Na}=x.d(Ca));c.ULS.sendTraceTag(50622687,3004,Na?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",Ca);return Na}a0i(Ca){try{if(void 0!==Ca&&null!==Ca&&"CheckIn-Interval"in Ca){const Na=parseInt(Ca["CheckIn-Interval"]);
void 0!==Na&&null!==Na&&0<Na&&(this.rEc=Na)}}catch(Na){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",Na)}}Rub(Ca){return Ca in this.Tae?"0"!==this.Tae[Ca]:!0}wMj(){try{const Ca=L.a.instance.getItem(this.Gib);if(void 0===Ca||null===Ca)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",
Ca);const Na=JSON.parse(Ca);if(void 0===Na||null===Na)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===Na.ExpirationTime||null===Na.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(Na.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),
null;const za=new fa;za.PolicySettings=Na.PolicySettings;za.ControllerConnectedServicesFeatureNames=new R.a;this.nb.lo("ServicesControlsMicrosoftControllerServicesList")&&this.nb.lw("ServicesControlsMicrosoftControllerServicesList");for(let la of this.$Pb)za.ControllerConnectedServicesFeatureNames.add(la);c.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return za}catch(Ca){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",
Ca.toString()),null}}mNj(Ca){try{if(void 0===Ca||null===Ca||void 0===Ca.PolicySettings||null===Ca.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.rEc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{const Na=new M(Ca,this.rEc),za=JSON.stringify(Na);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",za);L.a.instance.setItem(this.Gib,
za);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(Na){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",Na.toString())}}D$b(){const Ca=J.D$b(this.nb);return Ca&&0<Ca.length?"OCPS"+Ca:null}E1c(Ca){const Na=H.a.instance.uh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==Na&&null!==Na?Na.xc("WebServiceCall",Ca):null}gxc(Ca){if(void 0!==Ca&&null!==Ca){const Na=Ca.tc;Ca.stop();return{returnValue:Na,
stopwatch:null}}return{returnValue:null,stopwatch:Ca}}}Object(t.a)(S,"CloudPolicySettingsHelper",null,[215]);class ka{constructor(){this.NHe=this.Pdg=this.Tt=0;this.OHe=this.Qdg=this.NGa="";this.JPc=this.Yda=2}clone(){const Ca=new ka;Ca.Tt=this.Tt;Ca.Pdg=this.Pdg;Ca.NHe=this.NHe;Ca.NGa=this.NGa;Ca.Qdg=this.Qdg;Ca.OHe=this.OHe;Ca.Yda=this.Yda;Ca.JPc=this.src;return Ca}get src(){return this.JPc}serialize(Ca=null){const Na={};if(!Ca||Ca.contains(ka.BNa))Na[ka.BNa]=this.Tt;if(!Ca||Ca.contains(ka.SCb))Na[ka.SCb]=
this.NGa;if(!Ca||Ca.contains(ka.TCb))Na[ka.TCb]=this.Yda;return JSON.stringify(Na)}static create(Ca,Na=null){const za=new ka;za.JPc=Ca;void 0!==Na&&null!==Na&&(ka.BNa in Na&&(za.Tt=Na[ka.BNa]),ka.SCb in Na&&(za.NGa=Na[ka.SCb]),ka.TCb in Na&&(za.Yda=Na[ka.TCb]));return za}static deserialize(Ca,Na){try{const za=JSON.parse(Ca);if(void 0!==za&&null!==za)return ka.create(Na,za);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",Ca);throw Error.argument("settingsData");
}catch(za){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",za.toString()),za;}}}ka.BNa="CCS";ka.SCb="CCSTime";ka.TCb="OfficePrivacyRoamedNoticeShown";Object(t.a)(ka,"UserPrivacySettings",null,[]);var V=a(128);class wa{constructor(Ca,Na){if(void 0===Ca||null===Ca||void 0===Na||null===Na)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.nb=Ca;this.Xg=Na;this.$Oc=this.ke=null}zua(Ca){var Na=String.format("{0}RoamingServiceHandler.ashx?action=",
this.nb.appSettings.RoamingServiceHandlerWebServiceBase||"");Na=new Sys.StringBuilder(Na);Na.append(Ca);Na.append("&");Na.append(w.AFrameworkApplication.gj);return Na.toString()}executeRequest(Ca,Na,za,la=null){return this.Xg.emb(Ca,Na,la,null,za,"33",!1,null,6E4)}saveSettings(Ca){return new Promise((Na,za)=>{try{if(void 0===this.ke||null===this.ke||void 0===Ca||null===Ca)c.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),za("Can't determine setting changes to save");
else{var la=this.ke.Tt!==Ca.Tt;if(2===this.ke.src&&la)this.ejj(Ca),Na(!0);else{var aa=this.$mj(Ca);if(void 0===aa||null===aa||!aa.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),za("No changes to save");else if(1===this.ke.src)Na(this.K$f(aa));else if(0===this.ke.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",aa);const sa=this.executeRequest(this.zua("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",
aa);sa.continueWith(()=>{if(sa.Bh||sa.Sf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),Na(!1);else{var ea=sa.result;void 0!==ea.Ig&&null!==ea.Ig&&void 0!==ea.Ig.data&&null!==ea.Ig.data&&ea.Ig.data.httpStatus===v.a.DO?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),Na(!0)):(c.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),Na(!1))}})}}}}catch(sa){c.ULS.sendTraceTag(50860930,
3004,10,"SaveUserPrivacySettings: Exception = {0}",sa.toString()),Na(!1)}})}$mj(Ca){if(void 0===this.ke||null===this.ke||void 0===Ca||null===Ca)throw Error.invalidOperation("User Privacy settings have not been initialized");const Na=new R.a;0===Ca.src?(this.ke.Tt!==Ca.Tt&&(Na.add(ka.BNa),Na.add(ka.SCb)),this.ke.Yda!==Ca.Yda&&Na.add(ka.TCb)):1===Ca.src&&this.ke.Tt!==Ca.Tt&&Na.add(ka.BNa);return Na.count?Ca.serialize(Na):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),
null)}getSettings(){if(!this.$Oc){const Ca=this;this.$Oc=new Promise(Na=>{try{Ca.ke?Na(Ca.ke.clone()):Ca.FMj().then(za=>{Ca.ke=za;Na(Ca.ke.clone());return null},()=>{Ca.DMj().then(za=>{Ca.ke=za;Na(Ca.ke.clone());return null},()=>{Ca.EMj().then(za=>{Ca.ke=za;Na(Ca.ke.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");Ca.ke=new ka;Na(Ca.ke.clone());return null});return null});return null})}catch(za){c.ULS.sendTraceTag(50860932,
3004,10,"UserPrivacySettings GetSettings: Exception = {0}",za.toString()),Ca.ke=new ka,Na(Ca.ke.clone())}})}return this.$Oc}FMj(){return new Promise((Ca,Na)=>{try{const la=-1!==window.location.href.indexOf("&wd_pn=2");if(this.nb.qa("PrivacyDialogShouldCheckRoaming")||la){var za=this.executeRequest(this.zua("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");za.continueWith(()=>{try{if(za.Bh||za.Sf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");
else{const aa=za.result;if(aa&&aa.Ig&&aa.Ig.data)if(aa.Ig.data.httpStatus!==v.a.DO)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",aa.Ig.data.httpStatus);else{if(aa.Ig.data.Td){Ca(wa.parse(aa.Ig.data.Td,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",aa.Ig.data.Td);return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");Na("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(aa){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",aa.toString()),Na("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),Na("Roaming should not be used")}catch(la){c.ULS.sendTraceTag(50860939,
3004,10,"TryGetSettingsFromRoaming Exception = {0}",la.toString()),Na("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}DMj(){return new Promise((Ca,Na)=>{try{const za=V.a.get("WacUPToggleState");let la=null;void 0!==za&&null!==za&&0<za.length&&(la=decodeURIComponent(za));if(void 0!==la&&null!==la&&0<la.length){const aa=wa.parse(la,1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",aa.toString());Ca(aa)}else{const aa=ka.create(1),
sa=new R.a;sa.add(ka.BNa);const ea=aa.serialize(sa);this.K$f(ea)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",ea),Ca(aa)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",ea),Na("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(za){c.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",
za.toString()),Na("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}EMj(){return new Promise(Ca=>{try{var Na=-1!==window.location.href.indexOf("&wdccsoff=1");let za=ka.create(2);Na?(za.Tt=2,w.AFrameworkApplication.wGe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",za.toString())):(za.Tt=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",za.toString()));Ca(za)}catch(za){c.ULS.sendTraceTag(50967431,
3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",za.toString()),Na=ka.create(2),Na.Tt=1,Ca(Na)}})}ejj(Ca){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===Ca.Tt?w.AFrameworkApplication.wGe():w.AFrameworkApplication.zjh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",Ca)}K$f(Ca){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",Ca);const Na=
this.nb.Va("PrivacyCookieDomain")||"";if(!Na||!Na.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",Ca);return V.a.lOd("WacUPToggleState",Ca,V.a.fV,"/",Na)}catch(Na){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",Na.toString()),!1}}isFeatureEnabled(Ca){return this.getSettings().then(Na=>{const za=this.nb.lo("ServicesControlsMicrosoftControllerServicesList")?
this.nb.lw("ServicesControlsMicrosoftControllerServicesList"):[],la=new y.a;for(let aa=0;aa<za.length;aa++)la.add(za[aa]);return la.contains(Ca)?2!==Na.Tt:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",Ca);return!0})}static parse(Ca,Na){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",Ca,Na),ka.deserialize(Ca,Na)}catch(za){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",za.toString()),
za;}}}Object(t.a)(wa,"UserPrivacySettingsHelper",null,[216]);var ma=a(246);class ab{constructor(){this.gb=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}ai(Ca){this.gb=Ca;this.gb.register(215,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").uc().Gc(()=>new S(w.AFrameworkApplication.fa,w.AFrameworkApplication.rd));this.gb.register(216,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").uc().Gc(()=>new wa(w.AFrameworkApplication.fa,
w.AFrameworkApplication.rd));this.gb.register(217,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").uc().Gc(()=>new B(w.AFrameworkApplication.fa,w.AFrameworkApplication.rd));this.gb.register(218,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").uc().Gc(()=>new J(w.AFrameworkApplication.fa,w.AFrameworkApplication.rd,this.gb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.gb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
w.AFrameworkApplication.wb))}init(){w.AFrameworkApplication.fa.hv(()=>{const Ca=this.gb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");w.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(Ca.isFeatureEnabled("LicensingTestFeature",!1).then(Na=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",Na,w.AFrameworkApplication.fa.Va("IsAnonymousUser"));return null}),Ca.getFeatureTier("LicensingTestFeature",
0).then(Na=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",Na,w.AFrameworkApplication.fa.Va("IsAnonymousUser"));return null}));this.gb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.CHj()})}dispose(){}CHj(){try{w.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&da.u3f().then(Ca=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
Ca);return Ca})}catch(Ca){}}static main(){ma.a.instance.Ii(new ab)}}Object(t.a)(ab,"ApplicationFeatureHelperPackage",null,[4,5]);a.d(D,"a",function(){return ba});const ba=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");ab.main()}},1150:function(t,D,a){var c=a(10);t=a(0);var b=a(220),d=a(15),f=a(1350),e=a(632),k=a(544),l=a(27),m=a(86),v=a(29),n=a(156),w=a(8),r=a(58),u=a(153),x=a(340),z=a(47),B=a(45),y=a(31),A=a(1),K=a(22),G=a(14),T=a(104),W=a(84),
P=a(83),E=a(144),H=a(4),F=a(13),N=a(94),J=a(44),R=a(1069);class M extends E.a{constructor(Ob,tb=!0){super(!1,!1,M.zu);this.iWa=null;this.Y4d=!1;this.Vm=[];this.Hj=null;this.VVb=Ob;this.Zug=tb;this.Mv=this.uge=!1;this.Lfa=null;this.DGc=!1;this.ag=this.deh;this.Ae="InsertFileDialog";this.sc(1,this.sWb);M.zu?(this.iWa={["id"]:this.Ae,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(P.a)(this,this.NSi,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(P.a)(this,this.BJi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(P.a)(this,this.kdc,"insertDialogHandler"),this.iWa),this.AQb=!0):(this.showDialog(this.titleText,Object(P.a)(this,this.kdc,"insertDialogHandler")),tb&&this.k_f(),(Ob=this.zU(1))&&this.Vm.push(Ob),(Ob=this.zU(0))&&this.Vm.push(Ob),this.qcg(),this.AQb=!1)}get KTj(){return this.VVb}validate(){this.Hj.WE||d.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Hj.WE.value?
!0:(M.Wz(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}BJi(Ob){this.Zug&&(this.Hj=this.j_f(Ob,this.VVb))}NSi(){this.Hj&&this.Hj.WE&&(this.Y4d||(this.Hj.R7i(Object(P.a)(this,this.Gyd,"onFileChosen")),this.Y4d=!0),this.Hj.WQe())}Gyd(Ob){this.iWa.uploadStatusLabel=Ob;this.WSa(this.titleText,Object(P.a)(this,this.kdc,"insertDialogHandler"),this.iWa)}kdc(Ob){1===Ob&&this.isEnabled()?M.zu&&this.Hj.WE&&!this.Hj.WE.value?(this.iWa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.WSa(this.titleText,
Object(P.a)(this,this.kdc,"insertDialogHandler"),this.iWa)):(this.xwb(),this.VVb.finalizeUpload(this.Hj,Object(P.a)(this,this.dispose,"dispose"))):0===Ob&&this.hide()}k_f(){this.DGc=!1;this.Hj=this.j_f(document.getElementById("uploadFrameContainer"),this.VVb);H.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.Lfa=Object(P.a)(this,this.xAd,"onUploadFrameLoad"),J.a.addHandler(this.Hj.iFrame,"load",this.Lfa));this.Hj.WE||d.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.pIf()}xAd(){this.pIf()}pIf(){if(this.Hj&&!this.DGc){var Ob=this.Hj.WE;Ob&&(J.a.addHandler(Ob,F.a.Mb,Object(P.a)(this,this.onKeyDown,"onKeyDown")),Ob=[Ob],this.Vm=Ob.concat.apply(Ob,this.Vm),this.qcg(),this.DGc=!0)}}dispose(){if(this.Hj&&!M.zu){const Ob=this.Hj.WE;Ob&&J.a.removeHandler(Ob,F.a.Mb,Object(P.a)(this,this.onKeyDown,"onKeyDown"));this.Lfa&&J.a.removeHandler(this.Hj.iFrame,"load",this.Lfa)}this.Hj=null;super.dispose()}qcg(){if(0<this.Vm.length){const Ob=new R.a(this.Vm),tb=N.FocusManager.instance().eQ();
tb&&(this.Vm[0].focus(),tb.$e=Ob,tb.KZ=!0)}}onKeyDown(Ob){4!==N.FocusManager.instance().rIf(Ob)&&Ob.preventDefault()}static get zu(){return H.AFrameworkApplication.ta.Pa.nv&&H.AFrameworkApplication.ta.Pa.Ref}static Wz(Ob){const tb=document.getElementById("errorText");tb.innerText=Ob;tb.style.display="inline-block"}}Object(t.a)(M,"InsertFileDialog",E.a,[]);class L{static get ag(){return E.a.Yo(L.Ak,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}L.Ak="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(t.a)(L,"InsertImageDialogHtml",null,[]);class U extends M{constructor(Ob,tb=!0){super(Ob,tb)}get sWb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get deh(){return L.ag}validate(){this.Hj.WE||d.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const Ob=Object(W.a)(f.a,this.KTj),tb=Ob.oeg(this.Hj.WE.value);return 0!==tb?(M.Wz(Ob.pXe(tb)),!1):!0}}Object(t.a)(U,"InsertImageDialog",M,[]);var X=a(549);const da=
(Ob,tb,cc)=>{if(Ob){var Ib=0;do{try{Ob();break}catch(Mb){if(d.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",Ib,cc,Mb.message,Mb.stack),Ib>=tb)break}Ib++}while(1)}};var fa=a(107),S=a(88),ka=a(41),V=a(251),wa=a(199),ma=a(80),ab=a(457),ba=a(171);class Ca{constructor(Ob,tb,cc,Ib,Mb,Oa,Aa,Ba,ob=!0,xb=null,Va=!1){this.bRe="FileUpload.ashx";this.ao=null;this._initialized=!1;this.Gg=this.mhb=this.CGc=this.Lfa=this.ZQb=this.Vq=this.Es=
null;this.zm=!1;this.SD=this.$Qb=this.VQc=null;this._parent=Ob;this.Jpg=tb;this.pug=cc;this.D5d=Mb;this.XOc=Aa;this.O_d=Ba;this.J1d=xb;this.UQc=!1;this.kqg=Ib.qa("CanaryRenewalForFileUploadIsEnabled");this.Cdg=!1;(this.$pa=Va)||this.B3g(Oa);ob&&this.F9e()}get ySf(){return this.pug}get sessionId(){return this.XOc}get iFrame(){return this.ao}get WE(){return this.Vq}get n8a(){return H.AFrameworkApplication.fa?H.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get XQe(){return H.AFrameworkApplication.fa?
H.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get pii(){return this.$pa?!1:wa.b(this.ao.contentWindow.location.pathname,this.bRe,0)}get qIg(){return!l.a.Nja&&H.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}F9e(){this.SD=ba.a.create().toString();this.$pa?this.L6c():this.kpe()}B3g(Ob){this.ao=document.createElement("iframe");this.ao.className=Ob;this.ao.id=Ob;this.D5d&&(this.ao.style.visibility="visible",this.ao.style.height="30px",this.ao.setAttribute("frameborder",
"0"));this.Lfa=Object(P.a)(this,this.xAd,"onUploadFrameLoad");J.a.addHandler(this.ao,"load",this.Lfa)}m5b(Ob=null){H.AFrameworkApplication.ta.Coc();if(!this.Vq)return d.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";J.a.addHandler(this.Vq,"change",()=>{this.eyh(Ob)});da(Object(P.a)(this,this.WQe,"fileInputClick"),1,"DoFileOpenDialog");return this.Vq.value}eyh(Ob){Ob&&Ob(this.Vq.value)}fyh(){this.ZQb&&(this.ZQb.innerText=this.GYe())}R7i(Ob){J.a.addHandler(this.Vq,"change",()=>{Ob(this.GYe())})}GYe(){let Ob=
null;if(this.Vq.value){const tb=this.Vq.value,cc=tb.lastIndexOf("\\");0<cc&&(Ob=tb.substring(cc+1,tb.length))}return Ob?Ob:""}WQe(){try{d.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.Vq.click()}catch(Ob){throw d.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",Ob.message),Ob;}}uFj(){this.uli()?this.f6f():(this.SXd(),this.Es.submit())}uli(){return(this.kqg||this.$pa)&&!(void 0===window.self.FormData||null===window.self.FormData)}BWf(Ob){if(Ob){const tb=
this.pBe();this.Gg=new XMLHttpRequest;this.Gg.open("POST",tb);this.Gg.setRequestHeader("X-CorrelationId",this.SD);this.Jti(Ob);this.Gg.onreadystatechange=Object(P.a)(this,this.Yna,"uploadResponseReceived");this.Gg.send(Ob)}}Jti(Ob){if(!l.a.Nja&&Ob.get){var tb=Ob.get("ImageId");Ob=window.self.navigator;tb={["CorrelationId"]:this.SD,["Canary"]:H.AFrameworkApplication.canary,["ImageNodeId"]:tb};Ob&&(Ob=Ob.connection?Ob.connection:Ob.mozConnection?Ob.mozConnection:Ob.webkitConnection?Ob.webkitConnection:
null)&&(tb.effectiveType=Ob.effectiveType,tb.downlink=Ob.downlink,tb.type=Ob.type,tb.rtt=Ob.rtt);d.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",tb)}}f6f(){try{this.SXd();d.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const Ob=new (Type.parse("FormData"))(this.Es);this.BWf(Ob)}catch(Ob){d.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Ob.message),this.x9a(null)}}e6f(Ob){try{if(this.SXd(),
d.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.TUj(Ob)){this.$Qb=Ob;this.Es.contains(this.Vq)&&this.Es.removeChild(this.Vq);var tb=new (Type.parse("FormData"))(this.Es);tb.append("applicationfileInput",Ob.blob,Ob.filename);this.BWf(tb)}else this.x9a(null)}catch(cc){d.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+cc.message),this.x9a(null)}}TUj(Ob){return Ob&&void 0!==Ob.blob&&null!==Ob.blob&&
void 0!==Ob.filename&&null!==Ob.filename&&""!==Ob.filename?void 0===window.self.FormData||null===window.self.FormData?(d.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(Ob=Ob?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Ob.blob||null===Ob.blob,void 0===Ob.filename||null===Ob.filename||""===Ob.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",d.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
Ob)),!1)}Yna(){if(4===this.Gg.readyState)if(200===this.Gg.status){d.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.SD);const Ob=this.Gg.getResponseHeader("X-NewKey"),tb=this.sei(this.Gg);let cc=!1;if(void 0!==Ob&&null!==Ob&&tb&&(cc=this.KUj(Ob),!this.UQc&&cc)){d.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.SD);this.UQc=!0;void 0!==this.$Qb&&
null!==this.$Qb?this.e6f(this.$Qb):this.f6f();return}d.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.UQc,tb,!(void 0===Ob||null===Ob),cc,this.SD);this.x9a(this.Gg.responseText)}else d.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Gg.status,this.Gg.responseText?!1:!0,this.SD),this.x9a(null)}sei(Ob){try{const tb=
ka.a(Ob.responseText).Responses;if(void 0!==tb&&null!==tb&&1===tb.length){const cc=tb[0];if(void 0!==cc&&null!==cc&&2===cc.length&&28===cc[1].StatusCode)return!0}}catch(tb){}return!1}KUj(Ob){ab.a.ubg(Ob);return H.AFrameworkApplication.canary!==Ob?!1:!0}SXd(){this.VQc||(this.VQc=new Date)}dispose(){this.zm||(this.$pa?this._parent.removeChild(this.Es):(this._parent.removeChild(this.ao),J.a.removeHandler(this.ao,"load",this.Lfa),this.Lfa=null),this.CGc&&(J.a.removeHandler(this.Vq,"change",this.CGc),
this.CGc=null),this.XQe&&(this.mhb&&(J.a.removeHandler(this.Vq,"change",this.mhb),this.mhb=null),this.ZQb=null),this.Vq=this.Es=this._parent=this.ao=null,this.zm=!0,this.VQc=null,d.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}e6g(Ob){if(this.Es){var tb;(tb=this.Es.querySelector("input[name=__REQUESTDIGEST]"))?tb.value=Ob:(tb=this.k2c(),tb.type="hidden",tb.id="__REQUESTDIGEST",tb.name="__REQUESTDIGEST",tb.value=Ob,this.Es.appendChild(tb))}}k2c(){return this.$pa?
document.createElement("input"):this.ao.contentWindow.document.createElement("input")}xAd(){try{if(!this.ao.contentWindow.document.body)return}catch(tb){this.x3h();return}if(!(this._initialized||this.n8a&&l.a.vF))this.L6c();else if(!this.n8a||!l.a.vF||this.pii){let tb;tb=l.a.iu?this.ao.contentWindow.document.body.innerText:this.Cdg?this.ao.contentWindow.document.body.firstChild.innerText:this.ao.contentWindow.document.body.firstChild.innerHTML;var Ob=this.ao.contentWindow.document.body.innerText.toLowerCase();
const cc=0<=Ob.indexOf("responses")||0<=Ob.indexOf("wopisrc");Ob=0<=Ob.indexOf("http error");!cc&&Ob&&d.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.ao.contentWindow.document.body.innerText);this.x9a(tb)}}L6c(){if(!this._initialized){var Ob=this.ga("uploadForm");const tb=this.ga("fileInput"),cc=this.pBe();this.K5g();this.Es.id=Ob;this.Es.method="post";this.Es.encoding="multipart/form-data";this.Es.action=cc;this.Vq.type="file";this.O_d&&(this.Vq.accept=
this.O_d,this.J1d&&(this.Vq.capture=this.J1d));this.Vq.id=tb;this.Vq.name=tb;this.qIg&&(this.Vq.multiple=!0);!this.XQe||l.a.iu||l.a.FH||(this.mhb=Object(P.a)(this,this.fyh,"fileInputChangedHandleAccessibility"),J.a.addHandler(this.Vq,"change",this.mhb),this.ZQb=S.a.gpe(this.Es,this.Vq,"InputFileDescription"));this.D5d&&(this.$pa||(Ob=this.ao.contentWindow.document.body,Ob.style.margin="0",Ob.style.overflow="hidden"),Ob=H.AFrameworkApplication.ta,this.Vq.style.fontFamily=Ob.o0,this.Vq.style.fontSize=
Ob.jzc,this.Vq.style.margin="0");(Ob=document.getElementById("__REQUESTDIGEST"))&&this.e6g(Ob.value);this.Es.appendChild(this.Vq);this._initialized=!0;this.Jpg(this)}}K5g(){if(this.$pa)this.Es=document.createElement("form"),this._parent.appendChild(this.Es),this.Vq=document.createElement("input");else{this.Es=this.ao.contentWindow.document.createElement("form");const Ob=this.ao.contentWindow.document;Ob.body.appendChild(this.Es);this.Vq=Ob.createElement("input")}}kpe(){this._parent.appendChild(this.ao);
this.n8a&&l.a.vF&&this.L6c()}pBe(){var Ob=new V.QueryStringBuilder(this.bRe);H.AFrameworkApplication.zXa(Ob);this.Qnj(Ob);Ob=Ob.toString();if(l.a.Tf||l.a.vF||l.a.FH)Ob=ma.a.GUe(Ob);return Ob}Tje(){const Ob=new fa.a(2,1,0,Object(P.a)(this,this.delayedDispose,"delayedDispose"),4);H.AFrameworkApplication.Ji.Hg(Ob)}}Object(t.a)(Ca,"UploadFrame",null,[3]);var Na=a(42),za=a(121),la=a(21);class aa extends Ca{constructor(Ob,tb,cc,Ib,Mb,Oa,Aa=!1){super(Ob,tb,cc,Ib,Mb,"UploadFrame",Oa.ea.sessionId,"image/*",
!1,null,Aa);this.$=Oa;this.Cdg=!0;A.EwaSettings.isChangeGateEnabled("OfficeVSO:5329840_InsertPictureOpenFileBrowserDirectly")?this.F9e():this.kpe()}ga(Ob){return Ob}Qnj(Ob){d.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");za.a.QUc(Ob,this.$.ya);Ob.N8(w.a.sessionId,this.sessionId);var tb=la.g(this.$).ha;tb=Na.o(tb.sa.l3,this.$);Ob.N8(w.a.p1i,this.$.xa.oa.name);Ob.N8(w.a.o1i,tb.FirstRow.toString());Ob.N8(w.a.n1i,tb.FirstColumn.toString())}x3h(){this.ySf("ServerUploadError")}x9a(Ob){this.ySf(Ob)}static vgi(Ob){return!Ob||
K.a.equals(Ob,"ServerUploadError",!1)}}Object(t.a)(aa,"UploadFrameWrapper",Ca,[]);class sa extends U{constructor(Ob,tb,cc){super(Ob,!1);this.mU=null;this.nAa=!1;this.plc=()=>{this.dXd("");this.xzc();return!1};this.$=tb;this.GAc=Ob;this.sQ=X.a.instance;this.fa=cc;this.k_f();this.Pjd();this.$.rb.$x=!0}j_f(Ob,tb){return new aa(Ob,Object(P.a)(tb,tb.wEb,"onUploadFrameInitialized"),Object(P.a)(tb,tb.Yna,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.xzc();this.sQ=this.GAc=null;super.dispose()}hide(){super.hide();
this.$.rb.$x=!1}validate(){var Ob=this.GAc.zYd(this.Hj.WE.value,this.GAc.p$f(this.Hj));return 0!==Ob?(Ob=this.GAc.ncd(Ob).Description,this.dXd(Ob),this.YSd(),!1):!0}isEnabled(){return!0}dXd(Ob){this.mU.innerHTML=Ob}Pjd(){this.mU=document.getElementById("errorText");this.mU.style.display="inline-block";this.nAa=!1;this.dXd("");this.CHa.style.maxWidth=this.CHa.currentStyle.minWidth}YSd(){this.sQ.ra(F.a.click,this.Hj.WE,this.plc);this.sQ.ra(F.a.Mb,this.Hj.WE,this.plc);this.nAa=!0}xzc(){this.nAa&&(this.sQ.Ba(F.a.click,
this.Hj.WE,this.plc),this.sQ.Ba(F.a.Mb,this.Hj.WE,this.plc),this.nAa=!1)}}Object(t.a)(sa,"InsertImageDialogWrapper",U,[]);var ea=a(51),Z=a(55);class ua extends f.a{constructor(Ob,tb,cc,Ib,Mb=!0){super(null,tb,cc);this.F$=this.wt=null;this.G6a=!1;this.dCd=null;this.Yna=Oa=>{this.qZd.stop();this.xZb.cancel();if(aa.vgi(Oa))this.zyc?this.U3e(4):(Oa=new e.a(0,2,null,null,!1,null,null,null),Oa.status=8,this.EVd(new k.a(Oa),null,"InsertPictureWebMethod")),d.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.zyc}`);
else{const Aa=ua.XUj(Oa);0!==Aa?(d.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Oa}`),this.U3e(Aa)):this.l3h(Oa)}this.$mc();this.dispose()};this.YIi=Oa=>{this.jBa(Oa,this.Hj)&&this.finalizeUpload(this.Hj,null)};this.wEb=Oa=>{d.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Hj=Oa;if(!this.I0a){if(this.aYd){if(this.Pue()||this.n8a&&l.a.vF){Oa.m5b(this.YIi);return}const Aa=Oa.m5b(null);if(!this.jBa(Aa,Oa))return}this.finalizeUpload(Oa,null)}};this.jSi=()=>{this.zyc=
!0};this.jb=Ob;this.qZd=Ob.Hb.Ng("WebServiceCall","InsertPictureOperation");this.xZb=z.a.instance.create(this.jSi,1E5,B.a.UMg,!1);this.zyc=!1;this.gjc=this.$.ya.InsertPictureMaxFileSizeBytes;Ib&&(this.G6a="TestOnly"in Ib);Mb&&this.showDialog()}get $(){return this.jb}get Yxi(){return this.gjc/1024/1024}dispose(){m.a.Ia(this.xZb);this.Hj&&this.Hj.Tje();this.Hj=this.xZb=this.jb=null}O4i(Ob){if(!this.$)return d.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),Z.Task.Ua(!0);
if(!this.$.Taa)return Z.Task.Ua(!0);const tb=new n.a,cc=new FileReader;Ob=Ob.WE.files[0];const Ib=()=>{tb.Uw(!0)};cc.onload=()=>{this.dCd=cc.result;tb.Uw(!0)};cc.onerror=Ib;cc.onabort=Ib;cc.readAsDataURL(Ob);return tb.task}p$f(Ob){let tb=-1;Ob=Ob.WE;(null===Ob||void 0===Ob?0:Ob.files)&&0<Ob.files.length&&(tb=Ob.files[0].size);return tb}zYd(Ob,tb){let cc=ua.y2g(f.a.jBa(Ob));0===cc?-1!==tb&&(d.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${tb}, maxAllowedSize: ${this.gjc}, remainingWorkbookSize: ${this.$.ea.Eif}`),
tb>this.gjc?cc=3:tb>this.$.ea.Eif&&(cc=7)):6===cc&&this.Lvi(Ob);d.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${cc}`);return cc}jBa(Ob,tb){Ob=this.zYd(Ob,this.p$f(tb));return 0!==Ob?(this.I0a||1===Ob||this.MQd(Ob),!1):!0}K9f(Ob){Ob.uFj()}ncd(Ob){let tb=0,cc=1,Ib=-1100324317,Mb="InsertPictureUnknownError",Oa=null;switch(Ob){case 1:tb=1750;cc=0;Ib=940870981;Mb="InsertPictureNoFileSelected";break;case 3:cc=0;Ib=1250467391;Mb="InsertPicturePictureTooBig";Oa=String.format(G.a.instance.mb(180),
this.Yxi.toLocaleString());break;case 6:tb=1754;cc=0;Ib=1380041209;Mb="InsertPictureUnsupportedFormat";break;case 7:tb=1751;cc=0;Ib=-903115058;Mb="InsertPictureExceedWorkbookSize";break;case 4:tb=1752;cc=0;Ib=1218352119;Mb="InsertPictureUploadTimeout";break;case 5:tb=1753,cc=0,Ib=1979899005,Mb="InsertPictureServiceNonDeterministicError"}Ob=ua.Yc(tb,cc,Ib,Mb);Oa&&(Ob.Description=Oa);return Ob}showDialog(){this.Pue()?(this.I0a=!1,this.Hj=new aa(this.$.domElement,this.wEb,this.Yna,this.fa,!1,this.$,
!0)):(d.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.G6a&&(l.a.lv||l.a.vF&&72>l.a.Xwe)?(this.I0a=!1,this.Hj=new aa(this.$.domElement,this.wEb,this.Yna,this.fa,!1,this.$)):(this.I0a=!0,this.Hj=(new sa(this,this.$,this.fa)).Hj))}l3h(Ob){let tb={};try{if(tb=r.a.Uh(Ob),ea.b().FA(this.qZd.id,tb.ServerCorrelationId,"actions","ServerActions"),!y.a.rg(tb.Errors)&&tb.Result){this.$.ea.zW(tb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const cc=tb.Result;T.a(this.$).zma(1,
cc);const Ib=this.$.da.za(277);Ib&&Ib.JSc(this.$,1,tb.Result,tb,"InsertPicture");d.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(cc){d.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${Ob?Ob.length:-1}, errror: ${cc}`)}this.Yyc(tb,null,"InsertPictureWebMethod")}U3e(Ob){Ob=this.ncd(Ob);const tb={};tb.Errors=[Ob];this.Yyc(tb,null,"InsertPictureWebMethod")}Yyc(Ob,tb,cc){this.wt(Ob,
tb,cc)}EVd(Ob,tb,cc){this.F$(Ob,tb,cc)}MQd(Ob){Ob=this.ncd(Ob);A.EwaSettings.xz()?new x.a(this.$,Ob):(new u.ErrorDialog(this.$,Ob)).xf()}Lvi(Ob){const tb=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;Ob=v.a.ll(Ob);for(let cc=0;cc<tb.length;++cc)if(Ob.endsWith(tb[cc])){d.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${tb[cc]}`);break}}static XUj(Ob){return!Ob||K.a.equals(Ob,w.a.insertPictureUnknownError,!0)?2:K.a.equals(Ob,w.a.insertPictureNoFileSelectedError,!0)?
1:K.a.equals(Ob,w.a.bbi,!0)?3:K.a.equals(Ob,w.a.cbi,!0)?5:0}static Yc(Ob,tb,cc,Ib){return y.a.Yc(1,0,0,Ob,tb,cc,Ib)}static y2g(Ob){switch(Ob){case 1:return 1;case 2:return 6}return 0}Pue(){return A.EwaSettings.isChangeGateEnabled("OfficeVSO:5329840_InsertPictureOpenFileBrowserDirectly")&&!this.G6a&&void 0!==window.self.FormData&&null!==window.self.FormData?!0:!1}}Object(t.a)(ua,"BasePictureUploaderWrapper",f.a,[3]);class ya extends ua{constructor(Ob,tb,cc,Ib,Mb,Oa=!0){super(Ob,tb,cc,Ib,!1);this.kyh=
Mb;this.O7b=Ob.Hb.Ng("LoadResource","FileReaderUploaderLoadResource");Oa&&this.showDialog()}dzj(){this.gjc=28E5;this.MQd(3)}J9c(Ob){d.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const tb=new FileReader;Ob=Ob.WE.files;if(0==Ob.length)d.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var cc=Ob[0];tb.onload=()=>{this.O7b.stop();this.kyh.ERi(tb.result,this);d.ULS.sendTraceTag(526399109,0,
50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${cc.type}, Size:${cc.size.toString()}`)};tb.onerror=()=>{this.O7b.stop();d.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${cc.type}, Size:${cc.size.toString()}`)};tb.onabort=()=>{this.O7b.stop();d.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${cc.type}, Size:${cc.size.toString()}`)};this.O7b.start();tb.readAsDataURL(cc)}}finalizeUpload(Ob,
tb){this.J9c(Ob,tb)}}Object(t.a)(ya,"FileReaderUploaderWrapper",ua,[500]);var ha=a(510),Da=a(368),nb=a(170);class qa{constructor(Ob,tb){this.dataUri=this.sheetName=null;this.sheetName=Ob;this.dataUri=tb}getSheetName(){return this.sheetName}}Object(t.a)(qa,"MacroRecorderPictureInsertedPayload",null,[116]);class pa extends ua{constructor(Ob,tb,cc,Ib,Mb,Oa=!0){super(Ob,cc,Ib,Mb,!1);this.Jd=tb;Oa&&this.showDialog()}J9c(Ob,tb){super.finalizeUpload(Ob,tb);Da.a(this.$.userOperationManager,(cc,Ib)=>{this.wt=
cc;this.F$=Ib;this.qZd.start();this.xZb.Qq();this.zyc=!1;this.K9f(Ob);return this.O4i(Ob)},cc=>{var Ib={};this.$.Wj(Ib);const Mb=Ib.SheetName;Ib=()=>new qa(Mb,this.dCd?this.dCd:"");cc=A.EwaSettings.fc()?new nb.a(510,0,cc,72,Ib):new ha.a(510,0,cc,8,Ib);cc.Pma(()=>!0);cc.Jd=this.Jd;return cc},this.Jd)}finalizeUpload(Ob,tb){this.J9c(Ob,tb)}}Object(t.a)(pa,"PictureUploaderWrapper",ua,[]);class Ja{constructor(Ob,tb){this.filename=Ob;this.blob=tb}}Object(t.a)(Ja,"UploadBlobParameters",null,[]);class $a extends pa{constructor(Ob,
tb,cc,Ib,Mb,Oa,Aa){super(Ob,tb,cc,Ib,Mb,!1);this.aYd=!1;this.g0=Aa;this.Gcc=$a.hEh(Oa);Ob=this.zYd(this.Gcc.name,this.Gcc.size);0!==Ob?(this.MQd(Ob),this.g0.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Hj=new aa(this.$.domElement,this.wEb,this.Yna,Ib,!1,this.$)}EVd(Ob,tb,cc){super.EVd(Ob,tb,cc);this.g0.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}Yyc(Ob,tb,cc){super.Yyc(Ob,tb,cc);y.a.rg(Ob.Errors)?
this.g0.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${y.a.zc(Ob.Errors)}`)):this.g0.setResult(!0)}K9f(Ob){const tb=new Ja(this.Gcc.name,this.Gcc);Ob.e6f(tb)}static hEh(Ob){var tb=Ob.split(",");Ob=tb[0].includes("base64")?window.self.atob(tb[1]):window.self.decodeURI(tb[1]);tb=tb[0].split(":")[1].split(";")[0];const cc=new Uint8Array(Ob.length);for(let Ib=0;Ib<Ob.length;Ib++)cc[Ib]=Ob.charCodeAt(Ib);Ob=new Blob([cc],{type:tb});
Ob.name="Image.png";return Ob}}Object(t.a)($a,"DataUrlUploaderWrapper",pa,[]);class rb{constructor(){}J$h(Ob,tb,cc,Ib,Mb){new pa(Ob,tb,cc,Ib,Mb,!0)}G9h(Ob,tb,cc,Ib,Mb,Oa){new $a(Ob,null,tb,cc,Ib,Mb,Oa)}S9h(Ob,tb,cc,Ib,Mb){new ya(Ob,tb,cc,Ib,Mb,!0)}}Object(t.a)(rb,"UploaderCreator",null,[460]);class Pa extends b.a{constructor(Ob){super();this.$=Ob;this.Fb()}static ka(Ob){Ob.da.Ga(485,new Pa(Ob))}create(){var Ob;this.qb(null!==(Ob=this.$.da.za(484))&&void 0!==Ob?Ob:this.$.da.Ga(484,new rb))}}Object(t.a)(Pa,
"UploaderCreatorFactory",b.a,[]);a.d(D,"a",function(){return eb});const eb=()=>{c.a.Fa(Ob=>{Pa.ka(Ob)})}},1182:function(t,D,a){var c=a(10);t=a(0);var b=a(690),d=a(156),f=a(103),e=a(4),k=a(181),l=a(15),m=a(1350),v=a(29),n=a(98),w=a(82),r=a(551),u=a(171),x=a(42),z=a(368),B=a(170),y=a(247),A=a(31),K=a(281),G=a(11),T=a(14),W=a(280),P=a(104),E=a(21),H=a(144),F=a(88),N=a(94),J=a(163),R=a(178),M=a(96),L=a(153),U=a(340),X=a(1),da=a(1230),fa=a(80);class S extends da.a{constructor(Z,ua){super(Z,fa.a.gaa(ua))}aqc(Z,
ua){this.isEnabled()&&this.QEa(this.targetOrigin)&&(this.fo(Z),this.Vl(Z,ua))}}Object(t.a)(S,"InsertMediaCrossDocumentMessenger",da.a,[516,391,3]);var ka=a(7);class V{}Object(t.a)(V,"OnlineMediaSearchResult",null,[]);var wa=a(310);class ma extends H.a{constructor(Z,ua,ya,ha,Da,nb){super();this.Zec=!1;this.DMa=this.gR=this.Eva=null;this.XFi=()=>{this.Mta(this.lZa)};this.Cqd=qa=>{qa.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==qa.target.id||qa.shiftKey?"KeepFocusStartDiv"===qa.target.id&&qa.shiftKey&&
(qa.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(qa.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};this.XMi=()=>{this.Rmb&&(this.Rmb.launchUpsellExperience("stockimages"),l.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Il=nb;this.$=Z;this.S9e=ua;this.Rmb=ya;this.Aza=[];this.Gof=ha;this.eeh=Da;this.foe=this.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;this.ag=this.t6g()}Dzj(Z){this.Zec=!1;this.showDialog(this.Il,
null);this.Eva=document.getElementById(this.ei("InsertMediaFrame"));if(!this.Eva)throw this.Mta(this.lZa),Error.invalidOperation("Couldn't get InsertMediaIframe.");var ua=document.getElementById(this.ei("WACDialogPanel"));ua&&ua.setAttribute(F.a.Kd,F.a.DYa);ua=document.createElement("div");ua.id="KeepFocusStartDiv";ua.tabIndex=0;ua.className="keep-focus-start";this.Eva.parentNode.insertBefore(ua,this.Eva.parentNode.firstChild);ua=document.createElement("div");ua.id="KeepFocusDiv";ua.tabIndex=0;ua.className=
"keep-focus";this.Eva.parentNode.appendChild(ua);$addHandler(this.CHa,"keydown",this.Cqd);this.Eva.src=this.S9e;this.Eva.frameBorder="0";ua=document.getElementById(this.ei("WACDialogButtonPanel"));if(!ua)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");ua.className="display-none";ua=document.getElementById(this.ei("WACDialogTitleText"));if(!ua)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");ua.className="display-none";2===this.Gof&&(document.getElementById(this.ei("WACDialogTitlePanel")).className=
"display-none",document.getElementById(this.ei("WACDialogBodyPanel")).className="padding-zero");N.FocusManager.instance().eQ().scope.bN=!0;this.gR=new S(this.Eva.contentWindow,this.S9e);this.gR.aqc(J.a.OAg,ya=>{this.QEi(ya,Z.Yna)});this.gR.aqc(J.a.insert,()=>{this.kMi(Z.Yna)});this.gR.aqc(J.a.hYc,this.XFi);2===this.Gof&&0===this.eeh&&(this.gR.aqc(J.a.jqi,this.XMi),this.DMa=this.Rmb.Yla("MsoPremiumStockImages",ya=>{l.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");
ya.isEnabled?this.gR.Fj(J.a.ETj,{["LicenseTier"]:ya.toString()}):l.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.Aza=null;this.Rmb&&this.DMa&&this.Rmb.dHd("MsoPremiumStockImages",this.DMa);this.gR&&(this.gR.dispose(),this.gR=null);super.dispose()}hide(){super.hide();M.a.wuc(this.$)}get m3(){return R.a.I4b+"/InsertMediaDialog"}get RX(){return!1}QEi(Z,ua){Z=Z&&Z.Values?(Z=Z.Values)?Object(ka.a)(new V,{Action:Z.action||"",
Caption:Z.caption||"",ContentType:Z.contentType||"",FileExtension:Z.extension||"",PageUrl:Z.pageUrl||"",SourceUrl:Z.sourceUrl||"",ThumbnailUrl:Z.thumbnailUrl||"",LicenseUrl:Z.licenseUrl||"",LicenseDisplayName:Z.licenseDisplayName||"",Height:Z.height||0,Width:Z.width||0}):null:null;Z&&(this.Aza.push(Z),this.Zec&&(l.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),ua(this.Aza),this.Zec=!1,this.Mta(this.lZa)))}kMi(Z){this.Aza&&0<this.Aza.length?this.Aza.length<=
this.foe?(Z(this.Aza),this.Mta(this.lZa)):(this.Wz(),l.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.Aza.length=0):this.Zec=!0}t6g(){const Z=document.createElement("div");Z.id="InsertMediaDialog";Z.className=X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const ua=document.createElement("div");ua.id="InsertMediaPanel";ua.className=X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",
!0)?"insert-media-panel":"insert-media-panel-old";const ya=document.createElement("iframe");ya.id="InsertMediaFrame";ya.className="insert-media-frame";Z.appendChild(ua);ua.appendChild(ya);return wa.b(Z)}Wz(){const Z=A.a.Yc(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");Z.Description=String.format(T.a.instance.mb(205),this.foe.toLocaleString());X.EwaSettings.xz()?new U.a(this.$,Z):(new L.ErrorDialog(this.$,Z)).xf()}}Object(t.a)(ma,"InsertMediaDialog",H.a,[]);var ab=a(455),ba=a(375);class Ca extends m.a{constructor(Z,
ua,ya,ha,Da,nb){super(null,ya,ha);this.emf=0;this.Yna=qa=>{if(qa){var pa=Array(qa.length);for(var Ja=0;Ja<qa.length;Ja++){const Pa=qa[Ja];pa[Ja]={};pa[Ja].SourceUrl=Pa.SourceUrl;v.a.jwa(Pa.LicenseUrl)&&v.a.jwa(Pa.PageUrl)&&(pa[Ja].LicenseUrl=Pa.LicenseUrl,pa[Ja].LicenseDisplayName=Pa.LicenseDisplayName,pa[Ja].PageUrl=Pa.PageUrl);pa[Ja].AltText=-2053056795===this.Jd.command?Pa.Caption:""}var $a=-2009825598===this.Jd.command?"bing":"M365";Ja=E.g(this.$);var rb=x.o(Ja.ha.sa.activeCell,this.$);z.a(this.$.userOperationManager,
(Pa,eb,Ob)=>y.r(this.$.pa.va,rb,pa,$a,W.b(Pa,this.IOi),W.a(eb,this.HOi),Ob,null),Pa=>new B.a(595,0,Pa),this.Jd);G.HelperMethods.rZ?(Ja=new Map,Ja.set("MediaProvider",$a),Ja.set("ImagesCount",qa.length.toString()),Ja.set("TimeTakenToOpenDialog",this.emf.toString()),n.Health.instance.recordKpiUsage(ba.a.Zai,1,ab.a.G7f,Ja)):l.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.$mc()}else l.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};
this.IOi=qa=>{K.a(qa)?l.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${A.a.zc(qa.Errors)}`):(l.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),qa.Result?P.a(this.$).zma(1,qa.Result):l.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.HOi=()=>{l.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};
this.$=Z;this.Jd=ua;this.g0=nb;this.Poe=w.a.instance.Vb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let Z=null;Z=this.$.Hb.xc("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Jd.command){case -2009825598:this.Oyj();break;case -2053056795:this.Poe.execute(ua=>{ua.isFeatureEnabled("MsoPremiumStockImages",!1).catch(ya=>l.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${ya}`)).then(ya=>
{this.Pyj(ya);return null})})}Z.stop();this.emf=Z.tc}Oyj(){let Z=this.$.ya.BingPictureEndpoint;const ua=r.a.mH(e.AFrameworkApplication.lcid),ya=u.a.create();Z?(Z=0<Z.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(Z,1,1):String.format(Z,1,e.AFrameworkApplication.lcid,ua?ua.name:"en-us",e.AFrameworkApplication.buildVersion,ya.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.F2b(Z,1,-1,T.a.instance.ga(1756))):(l.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),
this.g0.setException(Error.create("Failed to access the Bing service endpoint")))}Pyj(Z){var ua=this.$.ya.M365PictureEndpoint,ya=u.a.create();if(ua){var ha=this.$.ya.DocumentHostInfo.UserId;ha=ha?v.a.Xv(ha).toString():"0";var Da=this.Poe.instance.isFreemiumUpsellEnabled();Z=Z?1:Da?0:-1;ya=ya.toString();Da=r.a.mH(e.AFrameworkApplication.lcid).name;ua=String.format(ua,e.AFrameworkApplication.lcid,Da,e.AFrameworkApplication.buildVersion,ya,1,ha,Z,1);this.F2b(ua,2,Z,T.a.instance.ga(1755))}else l.ULS.sendTraceTag(537155803,
0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.g0.setException(Error.create("Failed to access the M365 service endpoint"))}F2b(Z,ua,ya,ha){try{(new ma(this.$,Z,w.a.instance.uh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),ua,ya,ha)).Dzj(this),this.g0.setResult(!0)}catch(Da){l.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${Da}] [MediaProvider : ${ua}] [DialogLicenseTier : ${ya}]`),
this.g0.setException(Da)}}}Object(t.a)(Ca,"OnlinePictureUploaderWrapper",m.a,[3]);var Na=a(55);class za{constructor(Z,ua){this.$=Z;this.uploaderCreator=ua}executeCommand(Z,ua,ya){Z=ua.command;switch(Z){case 1403967063:if(ya&&"dataUrl"in ya)return ua=new d.a,this.uploaderCreator&&this.uploaderCreator.G9h(this.$,f.a.instance,e.AFrameworkApplication.fa,ya,ya.dataUrl,ua),ua.task;this.uploaderCreator&&this.uploaderCreator.J$h(this.$,ua,f.a.instance,e.AFrameworkApplication.fa,ya);return Na.Task.Ua(!0);
case -2053056795:case -2009825598:return Z=new d.a,new Ca(this.$,ua,f.a.instance,e.AFrameworkApplication.fa,ya,Z),Z.task;default:return k.a(Z)}}Ec(Z,ua){if(Z=this.$.isEditMode)switch(ua.command){case 1403967063:Z=!0;break;case -2053056795:Z=!0;break;case -2009825598:Z=!0;break;default:Z=!1}return Z}Vc(){return!1}Qc(){return!1}}Object(t.a)(za,"PictureCommandHandler",null,[188]);var la=a(37),aa=a(50);class sa extends b.a{constructor(Z){super(Z)}Dd(){la.TaskExtensions.Aa(aa.GetServiceTaskFactory.Ta(this.$.da,
484,485,1),Z=>{this.ld([new za(this.$,Z.result)])},this.$.la,3)}static ka(Z){b.a.Rd(90,new sa(Z))}}Object(t.a)(sa,"PictureCommandHandlerFactory",b.a,[]);a.d(D,"a",function(){return ea});const ea=()=>{c.a.Fa(Z=>{sa.ka(Z)})}},1206:function(t,D,a){var c=a(10);t=a(0);var b=a(220),d=a(15),f=a(505),e=a(38),k=a(4),l=a(62);class m{}m.Fcd="GetFontPreviewData";Object(t.a)(m,"FontWebServiceMethods",null,[]);const v=(y,A,K,G,T=null)=>{const W=m.Fcd;T=y.Na(5,T);T.locale=k.AFrameworkApplication.uiCulture;return l.g(y,
W,T,A,K,G,null,644)};var n=a(11),w=a(1);const r={xlyellow:"xlyellow"};class u extends e.a{constructor(y,A){super();this.$=y;this.Yu=A;this.$ta={};this.PR={};this.tqe=!1;this.styles=null;this.vJi=(K,G,T)=>{d.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${T} has succeeded.`);this.GZi(K);this.tqe=!0;this.x2i()};this.wJi=(K,G,T)=>{d.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors for ${T}.`)};
this.yej=()=>{this.Hm&&this.Fcd(this.vJi,this.wJi)};this.Hm=w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.yej()}GZi(y){if(this.pni(y)){var A=n.HelperMethods.Cba(()=>{const K=y.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${K.PreviewUrl}') format('truetype')}`;const G=K.FontFacePropertiesList;K.FontNameList.forEach((T,W)=>{this.$ta[T]=G[W].Codepoint;this.styles=this.pJg(this.styles,G[W].FontFamily,
`https://fs.microsoft.com/fs/${K.CatalogVersion}/rawguids/${G[W].FontGuid}`,G[W].FontWeight);this.PR[T]=G[W].LocalizedFontName});f.a.Di(this.styles)});10<A&&d.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${A}`)}}pni(y){if(!y.Result)return d.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),!1;y=y.Result;return y?y.PreviewUrl?y.FontFacePropertiesList?y.FontNameList?
0===y.FontFacePropertiesList.length||y.FontFacePropertiesList.length!==y.FontNameList.length?(d.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(d.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(d.ULS.sendTraceTag(520710155,1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),
!1):(d.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(d.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}pJg(y,A,K,G){return y+`@font-face{font-family:"${A}";src:url('${K}');font-weight:${G};}`}Fcd(y,A){return v(this.Yu,y,A,null,this.Yu.Qb())}x2i(){this.Iec&&this.raiseEvent(u.ZSe)}get Exc(){return this.PR}get KBh(){return this.$ta}get Iec(){return this.tqe}isFontSupported(y){return this.Hm&&
this.PR&&(!!this.PR[y]||!!r[y.replace(/\s/g,"").toLowerCase()])}xme(y){this.addHandler(u.ZSe,y)}}u.ZSe="fsmFD";Object(t.a)(u,"FontServiceManager",e.a,[433]);var x=a(695);class z extends b.a{constructor(y){super();this.$=y;this.Fb()}static ka(y){y.da.Ga(505,new z(y))}create(){this.qb(Object(x.b)(this.$.da,504,()=>new u(this.$,this.$.pa.Yu)))}}Object(t.a)(z,"FontServiceManagerFactory",b.a,[]);a.d(D,"a",function(){return B});const B=()=>{c.a.Fa(y=>{z.ka(y)})}},1243:function(t,D,a){t=a(0);var c=a(108),
b=a(220),d=a(15),f=a(13),e=a(38),k=a(174),l=a(90),m=a(1),v=a(21),n=a(5);class w extends e.a{constructor(B,y,A){super();this.statusBarManager=null;this.DGe=()=>{this.T4b()};this.Ieh=()=>{this.T4b()};this.CGe=K=>{10===K&&this.T4b()};this.onKeyDown=K=>13===K.Ca.keyCode?(K=new l.a(237279923,1,2,6,null),this.$.Ka.Lb(K,{[n.a.skipClipboardAccess]:!0,[n.a.vKe]:!0}),!0):!1;this.$=B;this.Eq=y;this.vm=A;this.X6c=!1;(this.x1f=m.EwaSettings.getBooleanFeatureGate(k.a.OOa,!1))&&this.$.da.Za(29,K=>{this.statusBarManager=
K;K.hJ(this)})}dispose(){this.ek();this.vm=this.Eq=this.$=null;this.statusBarManager&&(this.statusBarManager.PF(this),this.statusBarManager=null)}mn(){return this.x1f}Pr(B,y){if("QueryPasteShortcutEnabledLabel"!==B&&!w.EEj.includes(B))return!1;const A=this.so();"QueryPasteShortcutEnabledLabel"===B?(y.Visible=A,d.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${A} for commandId ${B}`)):(y.Visible=!A,d.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!A} for commandId ${B}`));
return!0}Ejh(){this.Bj();this.raiseEvent("pasteShortcutStatusChanged")}T4b(){this.ek();this.raiseEvent("pasteShortcutStatusChanged")}so(){return this.X6c}nq(B){this.addHandler("pasteShortcutStatusChanged",B)}Nq(B){this.removeHandler("pasteShortcutStatusChanged",B)}Bj(){if(!this.so()){this.X6c=!0;v.g(this.$).Qi.Mk(this.DGe);this.vm.ka("blur",this.Ieh);const B=this.$.da.za(65);B&&B.n2&&B.n2.registerForCommentEvents(this.CGe);this.Eq.pt(f.a.Mb,this.$.aw,this.onKeyDown,!0)}}ek(){if(this.so()){this.X6c=
!1;v.g(this.$).Qi.Gk(this.DGe);this.vm.detach("blur");const B=this.$.da.za(65);B&&B.n2&&B.n2.unregisterForCommentEvents(this.CGe);this.Eq.At(f.a.Mb,this.$.aw,this.onKeyDown,!0)}}}w.EEj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(t.a)(w,"PasteShortcutManager",e.a,[473,184,185,3]);var r=a(127);class u extends b.a{constructor(B){super();this.$=B;this.Fb()}create(){const B=this.$;this.qb(B.da.za(478)||this.$.da.Ga(478,new w(B,c.KeyInputManager.instance,r.a.instance.XG())))}static ka(B){B.da.Ga(479,
new u(B))}}Object(t.a)(u,"PasteShortcutManagerFactory",b.a,[]);var x=a(10);a.d(D,"a",function(){return z});const z=()=>{x.a.Fa(B=>{u.ka(B)})}},1244:function(t,D,a){var c=a(10);t=a(0);var b=a(108),d=a(220),f=a(127),e=a(7),k=a(15),l=a(4),m=a(1388),v=a(13),n=a(5),w=a(1033),r=a(47),u=a(28),x=a(21),z=a(1),B=a(42),y=a(64),A=a(338),K=a(37),G=a(50);class T{constructor(E,H,F,N){this.recoveryUI=null;this.Txa=()=>{this.Maa()&&(this.grid.Dab(this.Txa),this.L9f())};this.L9f=()=>{if(x.g(this.$).Db.q4(this.pasteRange))k.ULS.sendTraceTag(526758983,
306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a table. Table hand raise is not triggered.");else if(x.g(this.$).Db.o4(this.pasteRange))k.ULS.sendTraceTag(526758982,306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a pivot table. Table hand raise is not triggered.");else{var J=y.d(this.$.xa.oa);J=new A.a(this.pasteRange,J);this.NVd(J)}};this.Gcg=()=>{this.recoveryUI&&(this.dZd=u.a.Wa.je.m,this.hide(),r.a.instance.create(()=>{this.lSj()},
250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.RGe=J=>{10===J&&this.JHa()};this.$eh=()=>{if(this.recoveryUI){const J=document.getElementById("PasteRecoveryUI");J&&n.a.jk===J.getAttribute(n.a.HX)&&J.click();this.documentHidden=!0;this.JHa()}};this.SGe=()=>{this.JHa()};this.TGe=()=>{this.JHa()};this.onKeyUp=J=>{if(this.recoveryUI){if(this.FZ)return!1;if(17===J.Ca.keyCode&&this.r7b){J=document.getElementById("PasteRecoveryUI");if(!J)return k.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),
!1;const R=J.getAttribute(n.a.HX)||"";if(n.a.cr===R)return J.click(),!0}}return!1};this.onKeyDown=J=>{if(this.recoveryUI){this.r7b=!1;this.FZ=J.ctrlKey;J=J.Ca.keyCode;if(27===J)return this.JHa(),z.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&(J=this.$.da.za(254))&&J.er("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===J)return this.r7b=!0}return!1};this.XQ=(J,R)=>{this.aAb=J=R.Jd;-1027730316!==J.command&&-1059615499!==J.command?this.JHa():(R=
R.properties)&&R.launcherId!==this.bQh()&&this.JHa()};this.$=E;this.zpc=H;this.Eq=F;this.vm=N;this.zhc=this.aAb=this.Jqd=null;this.FZ=this.r7b=this.Y4b=this.$bc=!1;this.dZd=0;this.documentHidden=!1;this.grid=x.g(this.$);this.pasteRange=null;z.EwaSettings.fl()||this.$.da.Ga(406,this)}dispose(){this.Dag();this.Jag();this.zhc=this.Jqd=this.recoveryUI=this.vm=this.Eq=this.zpc=this.$=null;this.dZd=0}vNg(E){this.recoveryUI=E;this.Jqd=E.kHg;this.zhc=E.$5i}JHa(){this.recoveryUI&&(this.pasteRange=B.K(this.recoveryUI.zwh),
this.sCj(),this.hide(),this.Dag(),this.recoveryUI=null)}sCj(){const E=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];l.AFrameworkApplication.zF("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&(k.ULS.sendTraceTag(523622037,
0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.aAb&&E.includes(this.aAb.command)?(k.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${w.a[this.aAb.command]}`),this.aAb=null):this.documentHidden?(k.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.Maa()?this.L9f():
(k.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state."),this.grid.PXa(this.Txa)))}Maa(){return this.grid.Ea.lK(4,this.$.oa)}vki(){return!!this.recoveryUI&&this.zpc.Jgi}yAj(E){this.recoveryUI?this.show(E):k.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}bQh(){return this.recoveryUI?this.recoveryUI.Bqi:null}show(E){const H=this.recoveryUI.SLh();H?(this.zpc.showFloatie(Object(e.a)(new m.a,{x:H.x,y:H.y}),
this.recoveryUI.lJa(),E),this.Bj()):k.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.vki()&&this.zpc.MC();this.Jag()}Bj(){if(!this.Y4b){var E=x.g(this.$);E.view.Ns(this.Gcg);E.Qi.Mk(this.SGe);this.vm.ka("blur",this.$eh);this.$.Ka.WEa(this.XQ);this.$.xa.Pf(this.TGe);(E=this.$.da.za(65))&&E.n2&&E.n2.registerForCommentEvents(this.RGe);this.Y4b=!0}this.$bc||(this.Eq.pt(v.a.Mb,this.$.domElement,this.onKeyDown,!0),this.Eq.pt(v.a.Gd,this.$.domElement,this.onKeyUp,
!0),this.$bc=!0)}Dag(){if(this.Y4b){var E=x.g(this.$);E.view.Oq(this.Gcg);E.Qi.Gk(this.SGe);this.vm.detach("blur");this.$.Ka.dza(this.XQ);this.$.xa.Ag(this.TGe);(E=this.$.da.za(65))&&E.n2&&E.n2.unregisterForCommentEvents(this.RGe);this.Y4b=!1}}Jag(){this.$bc&&(this.Eq.At(v.a.Mb,this.$.domElement,this.onKeyDown,!0),this.Eq.At(v.a.Gd,this.$.domElement,this.onKeyUp,!0),this.$bc=this.FZ=this.r7b=!1)}lSj(){this.recoveryUI&&250<=u.a.Wa.je.m-this.dZd&&this.show(-1)}NVd(E){K.TaskExtensions.Aa(G.GetServiceTaskFactory.Ta(this.$.da,
426,427,1),H=>{void H.result.b7(E,"Paste");k.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Object(t.a)(T,"RecoveryUIController",null,[238,3]);class W extends d.a{constructor(E){super();this.$=E;this.Fb()}create(){if(z.EwaSettings.fl())this.ZBi();else{const E=this.$;E.kz(H=>{H.Scc().then(F=>{this.qb(this.$.da.za(406)||new T(E,F,b.KeyInputManager.instance,f.a.instance.XG()))})})}}ZBi(){const E=
this.$;let H=this.$.da.za(406);H?this.qb(H):E.kz(F=>{F.Scc().then(N=>{H=new T(E,N,b.KeyInputManager.instance,f.a.instance.XG());this.$.da.Ga(406,H);this.qb(H)})})}static ka(E){E.da.Ga(405,new W(E))}}Object(t.a)(W,"RecoveryUIControllerFactory",d.a,[]);a.d(D,"a",function(){return P});const P=()=>{c.a.Fa(E=>{W.ka(E)})}},1350:function(t,D,a){t=a(0);var c=a(15),b=a(83);a(107);var d=a(27);class f{constructor(w,r,u){this.Hj=this.wAd=null;this.YDa=this.qqa=0;this.aRb=null;this.mS=w;this.ee=r;this.nb=u;this.I0a=
!1;this.aYd=!0;this.qfj();this.n8a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.mS}get fa(){return this.nb}get retryCount(){return this.qqa}get sKd(){return this.YDa}wEb(w){this.Hj=w;if(!this.I0a){if(this.aYd){if(this.n8a&&d.a.vF){this.aRb=w.m5b(Object(b.a)(this,this.Gyd,"onFileChosen"));return}this.aRb=w.m5b(null);if(!this.jBa(this.aRb,w))return}this.finalizeUpload(w,null)}}Gyd(w){if(this.jBa(w,this.Hj)){if(d.a.vF||d.a.Tf)this.aRb=w;this.finalizeUpload(this.Hj,null)}}$mc(){this.wAd&&
this.wAd()}qfj(){this.qqa=0;this.YDa=this.fa.nd("Box4UploadRetryDelayStart",200);this.Hj&&(this.Hj.dispose(),this.Hj=null)}}Object(t.a)(f,"FileUploader",null,[]);var e=a(4),k=a(315),l=a(779),m=a(133),v=a(29);a.d(D,"a",function(){return n});class n extends f{constructor(w,r,u){super(w,r,u);this.ETb=this.Lqa=null}get iO(){return e.AFrameworkApplication.ta.LD}pXe(w){switch(w){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}oeg(w){return n.jBa(w,
this.xZh())}xZh(){return n.Khe}jBa(w,r=null){w=this.oeg(w);return 0!==w?(r&&r.Tje(),2===w&&this.nj(0,this.pXe(w)),!1):!0}finalizeUpload(w,r){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.wAd=r;this.Lzj();k.a.mark(5576);this.ETb=this.iO.xc("LoadResource","PictureUploadTime")}nj(w,r){const u=new m.StandardDialog;u.Sb=0;u.Wz(w,CommonUIStrings.l_ImageUploadFailedTitle,r,null)}$mc(){c.ULS.sendTraceTag(36783361,322,50,"PictureUploader.OnUploadComplete");super.$mc();this.ETb&&
(this.ETb.stop(),this.ETb=null);this.uYg()}Lzj(){this.Lqa=(new l.a).create();this.Lqa.message=CommonUIStrings.l_ImageUploadWait;this.Lqa.Sb=5;this.Lqa.it=!1;this.Lqa.cAa(null,null,null)}uYg(){this.Lqa&&(this.Lqa.close(),this.Lqa=null)}static C4h(w,r){w=v.a.ll(w);for(let u=0;u<r.length;++u)if(w.endsWith(r[u]))return!0;return!1}static jBa(w,r=null){r||(r=n.Khe);return w?n.C4h(w,r)?0:2:1}}n.Khe=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");Object(t.a)(n,"PictureUploader",f,[])},1422:function(t,D,
a){a.r(D);var c=a(1147),b=a(0),d=a(15),f=a(4),e=a(119),k=a(394);class l extends k.a{constructor(cb){super(cb)}get u2b(){return!1}createElement(){const cb=document.createElement("link");cb.setAttribute("rel","stylesheet");cb.setAttribute("type","text/css");cb.setAttribute("href",this.rt);return cb}e2c(){return null}lqc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.Qz.rt)}}Object(b.a)(l,"CssResource",k.a,[]);var m=a(371),v=a(225),n=a(29),w=a(55);class r{constructor(){this.KTb=
this.fRb=null}Lri(){this.fRb||(d.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.fRb=w.Task.WAA(r.Qri(),r.Iri()),this.fRb.continueWith(cb=>{d.ULS.sendTraceTag(21030599,324,10,"{0}",n.a.ocd(cb.exception))},5));return this.fRb}Nri(){if(!this.KTb)try{d.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.KTb=w.Task.WAA(r.E6c(v.a.create(f.AFrameworkApplication.fa.Va("DimeUrl"),null,null))),this.KTb.continueWith(cb=>{d.ULS.sendTraceTag(39978391,
324,10,"{0}",n.a.ocd(cb.exception))},5)}catch(cb){d.ULS.sendTraceTag(594874951,324,10,"{0}",n.a.ocd(cb))}return this.KTb}static Qri(){var cb=r.Fac("inproductmessaging.js");cb=v.a.create(cb,null,null);return r.E6c(cb)}static Iri(){var cb=r.Fac("inproductmessaging.css");cb=new l(cb);return r.E6c(cb)}static Fac(cb){return e.a.z1b(String.format("ipm/{0}",cb))}static E6c(cb){m.a.Kha(cb);return cb.y7a}}Object(b.a)(r,"DependencyDownloader",null,[485]);class u{}u.QUi="inProductMessagingOverlayDiv";u.CXi=
"PlayButtonImage";u.pdj="ReplayButtonImage";Object(b.a)(u,"Constants",null,[]);class x{constructor(){this.Afe=this.Z$d=this.N0d=!0;this.qdj=this.DXi=null;this.YAi=!1;this.locale=null;this.aag={}}get Kre(){return this.N0d}set Kre(cb){this.N0d=cb}get tpf(){return this.Z$d}set tpf(cb){this.Z$d=cb}get v2f(){return this.Afe}set v2f(cb){(this.Afe=cb)&&this.nrj()}nrj(){this.jle(u.CXi,this.DXi);this.jle(u.pdj,this.qdj)}jle(cb,Xb){Xb&&(this.aag[cb]=Xb)}}Object(b.a)(x,"FirstRunExperienceUISettings",null,[486]);
class z{constructor(){this.completed=this.V8i=!1}}Object(b.a)(z,"FirstRunExperienceViewData",null,[484]);var B=a(83),y=a(175),A=a(106),K=a(25);class G{constructor(cb,Xb,rc){this.La=cb;this.We=Xb;this.IRb=rc}Fg(){this.La.Je(K.a.xAh,A.a.frame,Object(B.a)(this,this.vAh,"firstRunExperienceHandler"),64);this.La.Ob(K.a.iSe,A.a.frame,Object(B.a)(this,this.t7h,"inProductMessagingTabHandler"));this.La.Ob(K.a.hSe,A.a.frame,Object(B.a)(this,this.s7h,"inProductMessagingShiftTabHandler"));this.La.Ob(K.a.veh,A.a.frame,
Object(B.a)(this,this.weh,"dimeLaunchHandler"));this.La.Ob(K.a.QQf,A.a.frame,y.ActionManager.kg);this.La.Ob(K.a.Ndj,A.a.frame,y.ActionManager.kg);this.La.Ob(K.a.Odj,A.a.frame,y.ActionManager.kg);this.We&&this.We.updateCommandUI()}vAh(cb,Xb,rc,Ec,ed){2===rc&&this.IRb.hqi(ed);return 32}weh(cb,Xb,rc,Ec,ed){2===rc&&this.IRb.eqi(ed);return 32}t7h(cb,Xb,rc){return 2===rc?this.IRb.qvd():32}s7h(cb,Xb,rc){return 2===rc?this.IRb.ovd():32}}Object(b.a)(G,"InProductMessagingActor",null,[]);var T=a(84);class W{constructor(){this.uNf=
this.pSf=this.s7f=this.Ohc=this.instance=null}}Object(b.a)(W,"DimeExperienceUISettings",null,[]);var P=a(160),E=a(461);class H{constructor(cb,Xb,rc,Ec,ed){this.P8b=!1;this.nrb=null;this.La=cb;this.sEa=Xb;this.kUb=rc;this.C0=Ec;this.hDc=ed}h$h(cb){P.b("getHeaderApi")?cb.isFeatureEnabled("MsoPremiumBadge",!0).then(Xb=>{const rc=cb.isFreemiumUpsellEnabled();rc&&(appChrome.getHeaderApi().then(Ec=>{Ec.updatePremiumStatus(Xb,rc);return null}),cb.Yla("MsoPremiumBadge",Ec=>{appChrome.getHeaderApi().then(ed=>
{ed.updatePremiumStatus(Ec.isEnabled,rc);return null})}));return null}):d.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}hqi(cb){this.kUb.Lri().continueWith(()=>{this.sEa.YAj(cb)})}eqi(cb){let Xb="gopremium",rc=null,Ec=()=>{};cb?(cb.experience&&""!==Object(T.a)(String,cb.experience)&&(Xb=Object(T.a)(String,cb.experience)),cb.onTaskComplete&&(Ec=cb.onTaskComplete),cb.campaignId&&""!==Object(T.a)(String,cb.campaignId)&&(rc=Object(T.a)(String,cb.campaignId))):d.ULS.sendTraceTag(51675402,
324,50,"Experience not given, using default experience");this.Yif(Xb,Ec,rc)}Yif(cb,Xb,rc=null){if(this.P8b&&this.nrb){const Ec={};Ec.experience=cb||"gopremium";Ec.campaignId=rc||E.b(this.C0,this.hDc,Object(T.a)(String,Ec.experience),!0);this.La.processAction(K.a.QQf,2);d.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+Ec.experience);try{const ed=Object.assign(new W,{instance:this.nrb,Ohc:Ec,s7f:Xb||(()=>{}),pSf:ud=>{d.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+ud.status)},
uNf:()=>{d.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.P8b=!1;this.nrb=null}});this.sEa.nzj(ed)}catch(ed){d.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+ed.message),this.P8b=!1,this.nrb=null,this.La.ae(K.a.Q8b,2,{["experience"]:Ec.experience})}}else d.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.La.ae(K.a.Q8b,2,{["experience"]:cb})}Mjf(){this.kUb.Nri().continueWith(()=>{try{var cb=n.a.ll(f.AFrameworkApplication.uiCulture);const Ec=E.c(this.C0);
if(Ec){var Xb={};Xb.partnerId=Ec;Xb.language=cb;Xb.sessionId=f.AFrameworkApplication.userSessionId;Xb.authHint=f.AFrameworkApplication.fa.Va("UserPrincipalName");var rc=f.AFrameworkApplication.fa.Va("Puid")||"";""!==rc&&(cb={},cb.puid=rc,Xb.userInfo=cb);this.nrb=new Dime(Xb);this.P8b=!0;d.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else d.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(Ec){d.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+Ec.message)}},
3)}qvd(){return this.sEa.qvd()}ovd(){return this.sEa.ovd()}}Object(b.a)(H,"InProductMessagingUIManager",null,[483]);class F{constructor(){this.ahe=0;this.HVa=Array(5);this.HVa[0]=10;this.HVa[1]=15;this.HVa[2]=50;this.HVa[3]=100;this.HVa[4]=200}Init(cb){this.ahe=cb}SendTrace(cb,Xb){d.ULS.sendTraceTag(34182235,this.ahe,this.HVa[cb],"{0}",Xb)}}Object(b.a)(F,"DefaultNetworkingManager",null,[502]);var N=a(259),J=a(311),R=a(94);class M{constructor(cb){this.Yb=cb}YAj(cb){cb&&(InProductMessaging.Networking.NetworkingMgr=
new F,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(cb.v2f,cb.tpf,cb.Kre,cb.YAi,cb.locale,Object(B.a)(this,this.eIi,"onDismissFirstRunExperience"),cb.aag),this.OQa(u.QUi,!0))}nzj(cb){if(cb&&cb.instance&&cb.Ohc){let Xb=document.getElementById("wacDimeContainer");Xb||(Xb=document.createElement("div"),Xb.id="wacDimeContainer",document.body.appendChild(Xb));f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&this.OQa("wacDimeContainer",!1);cb.Ohc.parentElementId=
"wacDimeContainer";cb.instance.launch(cb.Ohc,cb.s7f).then(rc=>{this.cHb();document.body.removeChild(Xb);cb.pSf(rc)}).catch(rc=>{this.cHb();document.body.removeChild(Xb);cb.uNf(rc)})}else throw Error.argument("DimeExperienceUISettings");}OQa(cb,Xb){if(this.Yb&&cb&&(cb=document.getElementById(cb),this.Z9h(cb),cb=this.Yb.JM("InProductMessagingFocusId"))){const rc=this.Yb.pi;rc&&"InProductMessagingFocusId"===rc.name||this.Yb.iR("InProductMessagingFocusId",!1);Xb&&this.BLf(cb.scope)}}Z9h(cb){var Xb=this.Yb.ti("InProductMessagingFocusId");
Xb.parent=N.AFrame.hT;const rc=new J.DOMFocusListing(()=>cb);rc.oab=!1;rc.ho(3);rc.ho(2);rc.ho(4);Xb=this.Yb.Ira(()=>cb,Xb,rc);Xb.VGb();Xb.KZ=!0;Xb.EGa=!0}BLf(cb){cb.tk(R.FocusManager.instance().m1);cb.tk(R.FocusManager.instance().n1);cb.bindAction(R.FocusManager.instance().m1,K.a.iSe);cb.bindAction(R.FocusManager.instance().n1,K.a.hSe)}cHb(){this.Yb&&(this.Yb.gca("InProductMessagingFocusId"),this.Yb.uPa("InProductMessagingFocusId"))}eIi(cb,Xb){this.cHb();cb=Object.assign(new z,{completed:cb,V8i:Xb});
f.AFrameworkApplication.wb.ae(K.a.uAh,2,cb)}qvd(){const cb=document.activeElement,Xb=this.Yb.eQ();return cb&&Xb&&Xb.$e&&cb===Xb.$e.uw?(Xb.$e.Dl(cb),Xb.xxa()?32:8):4}ovd(){const cb=document.activeElement,Xb=this.Yb.eQ();return cb&&Xb&&Xb.$e&&cb===Xb.$e.firstElement?(Xb.$e.Dl(cb),Xb.rNa()?32:8):4}}Object(b.a)(M,"InProductMessagingUIWrapper",null,[480]);var L=a(136),U=a(246),X=a(27);class da{constructor(){this.gb=null}get name(){return"Common.App.InProductMessaging"}ai(cb){cb.register(r,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").uc().Gc(()=>
new r);cb.register(M,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").uc().Gc(()=>new M(R.FocusManager.instance()));cb.register(H,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").uc().Gc(()=>new H(f.AFrameworkApplication.wb,cb.resolve("Common.IInProductMessagingUIWrapper"),cb.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.ta.Pa.xj,f.AFrameworkApplication.ta.Pa.l5));
cb.register(G,"Common.App.InProductMessaging.InProductMessagingActor").uc().Gc(()=>new G(f.AFrameworkApplication.wb,f.AFrameworkApplication.ta,cb.resolve("Common.IInProductMessagingUIManager")));cb.register(x,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").uc().Gc(()=>new x);cb.register(z,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").uc().Gc(()=>new z);this.gb=cb}init(){this.gb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Fg();
f.AFrameworkApplication.fa.hv(()=>{f.AFrameworkApplication.ta.Pa.Zr&&L.a.get_instance().pk(15,()=>{this.gb.Vb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(cb=>{this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").h$h(cb)})});f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&E.a()&&!X.a.Nja&&1!==f.AFrameworkApplication.ta.Pa.xj&&this.gb.Vb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(cb=>{cb.isFeatureEnabled("MsoPremiumBadge",
!0).then(Xb=>{!Xb&&cb.isFreemiumUpsellEnabled()&&this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Mjf();return null})})})}dispose(){}static main(){U.a.instance.Ii(new da)}}Object(b.a)(da,"InProductMessagingPackage",null,[4,5]);var fa=a(184),S=a(41);class ka{constructor(cb,Xb,rc,Ec=null,ed=null){this.Pv=cb;this.Ghb=Xb;this.Chb=rc;this.tce=Ec;this.Kjb=ed}j7b(cb){const Xb=new Sys.StringBuilder(this.Pv.tIb);Xb.append("RoamingServiceHandler.ashx?action=");Xb.append("getFirstRunExperienceSettings");
Xb.append("&");Xb.append(this.led(cb));Xb.append("&");Xb.append(f.AFrameworkApplication.gj);f.AFrameworkApplication.rd.hm(Xb.toString(),1,null,null,!0,2,Object(B.a)(this,this.Via,"getRequestSuccessCallback"),Object(B.a)(this,this.r3,"getRequestFailureCallback"),null)}K1a(cb){var Xb=new Sys.StringBuilder(this.Pv.tIb);Xb.append("RoamingServiceHandler.ashx?action=");Xb.append("saveFirstRunExperienceSettings");Xb.append("&");Xb.append(f.AFrameworkApplication.gj);Xb=Xb.toString();cb=S.c(cb);f.AFrameworkApplication.rd.hm(Xb,
2,cb,null,!0,4,Object(B.a)(this,this.bZi,"postRequestSuccessCallback"),Object(B.a)(this,this.yV,"postRequestFailureCallback"),null)}Via(cb){let Xb=!1,rc=null;try{if(0<cb.data.Td.length){const Ec=Object(T.a)(Object,S.a(cb.data.Td)),ed=Ec?Ec[this.Pv.LUc]:null;ed&&(rc=Object(T.a)(Object,S.a(ed.toString())))}Xb=!0}catch(Ec){this.r3(null)}Xb&&this.Ghb&&this.Ghb(cb.data,rc)}r3(cb){this.Chb&&this.Chb(cb?cb.data:null)}bZi(cb){this.tce&&this.tce(cb?cb.data:null)}yV(cb){this.Kjb&&this.Kjb(cb?cb.data:null)}led(cb){const Xb=
new Sys.StringBuilder("requestedsettings=");for(let rc=0;rc<cb.count;rc++)Xb.append(cb.na(rc)),rc<cb.count-1&&Xb.append(";");return Xb.toString()}}Object(b.a)(ka,"FirstRunExperienceRequestHandler",null,[]);var V=a(228),wa=a(82);class ma{constructor(){this.thb=this.gRb=this.Pv=null}GQd(cb){cb?(this.Pv=cb,this.Dii()&&(d.ULS.sendTraceTag(51675532,306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),cb=new fa.a,cb.add(this.Pv.LUc),this.gRb=new ka(this.Pv,Object(B.a)(this,
this.Via,"getRequestSuccessCallback"),Object(B.a)(this,this.r3,"getRequestFailureCallback"),null,Object(B.a)(this,this.yV,"postRequestFailureCallback")),this.gRb.j7b(cb)),(this.Pv.G6a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.HQd()):d.ULS.sendTraceTag(51675531,306,10,"Invalid launcherSettings")}Dii(){try{if(this.Pv.G6a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",
!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.Pv.Bfi||this.Pv.I6a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const cb=f.AFrameworkApplication.fa.Va("FlightId");return-1!==(cb?cb.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(cb){d.ULS.sendTraceTag(576582624,306,10,"Error checking setting {0}",cb?cb.toString():null)}return!1}tUf(cb){const Xb={},rc={};rc.FREDisplayedDate=(new Date).toUTCString();rc.VersionDisplayed=cb;rc.RemindMeLater=
!1;Xb[this.Pv.LUc]=S.c(rc);d.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.gRb&&this.gRb.K1a(Xb)}Via(cb,Xb){cb=cb?+cb.p2-+cb.nF:-1;cb>this.Pv.kTf?d.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",cb,this.Pv.kTf):Xb?this.byj(Xb)?(d.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",
this.Pv.gpf),this.HQd()):(this.b5c(!1),d.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(d.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.HQd())}r3(cb){this.b5c(!1);d.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",cb?cb.httpStatus:-1)}yV(cb){d.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",
cb?cb.httpStatus:-1)}HQd(){this.b5c(!0);var cb=wa.a.instance.uh("Common.ISystemInitiatedFeedback");cb?this.i2f(cb):(d.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",!0)&&((cb=wa.a.instance.Vb("Common.ISystemInitiatedFeedback"))?cb.execute(Xb=>{this.i2f(Xb)}):d.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}i2f(cb){if(cb){var Xb=
this.Pv.IAh;Xb&&(f.AFrameworkApplication.axa(Xb),f.AFrameworkApplication.zF(Xb));d.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Xb);cb.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.thb=Object(B.a)(this,this.cJi,"onFirstRunExperienceCampaignEvent"),window.addEventListener("FGWebSurfaceEvent",this.thb,!0),window.addEventListener("FRELaunchedEvent",this.thb,!0)):(d.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),
this.tUf(this.Pv.currentVersion))}else d.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}cJi(cb){if(cb){var Xb=cb.detail;cb=cb.type;var rc=this.Pv&&this.Pv.campaignId?this.Pv.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===cb||rc&&Xb&&Xb.id&&-1!==Xb.id.indexOf(rc))Xb.success&&(d.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.tUf(this.Pv.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",
this.thb,!0),window.removeEventListener("FRELaunchedEvent",this.thb,!0))}}byj(cb){if("RemindMeLater"in cb&&"FREDisplayedDate"in cb){if("true"===cb.RemindMeLater.toString()&&(+new Date-+new Date(cb.FREDisplayedDate.toString()))/36E5>this.Pv.gpf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&"VersionDisplayed"in cb&&cb.VersionDisplayed<this.Pv.currentVersion)return d.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),
!0;return!1}b5c(cb){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&V.a.dispatch("FREDecisionEvent",{["show"]:cb})}}Object(b.a)(ma,"FirstRunExperienceLauncher",null,[451]);class ab{constructor(){this.gb=null}get name(){return"Common.App.FirstRunExperienceLauncher"}ai(cb){this.gb=cb;this.gb.register(451,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").uc().Gc(()=>new ma)}init(){}dispose(){}static main(){U.a.instance.Ii(new ab)}}
Object(b.a)(ab,"FirstRunExperienceLauncherPackage",null,[4,5]);var ba=a(1104),Ca=a(1105),Na=a(1131),za=a(1243),la=a(10),aa=a(220);class sa{constructor(cb){this.$=cb}get LUc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get Bfi(){return this.isEnabled()&&this.$.ma(336)}get I6a(){return this.isEnabled()&&this.$.ma(338)}get G6a(){return this.$.ma(337)}get IAh(){return null}get gpf(){return 24}get kTf(){return 4E3}get tIb(){return this.$.ya.WebServiceBase||
""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const cb=f.AFrameworkApplication.Rb?Object(T.a)(String,f.AFrameworkApplication.Rb.AudienceGroup):"";return"Unknown"!==cb&&"Automation"!==cb}}Object(b.a)(sa,"FirstRunExperienceLauncherSettings",null,[531]);class ea{constructor(cb,Xb){this.jSe=cb;this.wAh=Xb}GQd(){this.jSe&&this.jSe.GQd(this.wAh)}}Object(b.a)(ea,"FirstRunExperienceManager",null,[470]);var Z=a(695);class ua extends aa.a{constructor(cb){super();
this.$=cb;this.Fb()}create(){const cb=Object(Z.a)(this.$.da,311,()=>this.E5g());this.qb(cb)}E5g(){var cb=new sa(this.$);cb=new ea(wa.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),cb);cb.GQd();return cb}static ka(cb){cb.da.Ga(312,new ua(cb))}}Object(b.a)(ua,"FirstRunExperienceManagerFactory",aa.a,[]);var ya=a(59);class ha extends aa.a{constructor(cb){super();this.gjd=null;this.$=cb;this.Fb()}create(){const cb=Object(Z.a)(this.$.da,361,()=>this.q6g());this.qb(cb)}q6g(){this.gjd=
wa.a.instance.uh("Common.IInProductMessagingUIManager");ya.a.tg.Zr?L.a.get_instance().pk(16,()=>{this.I9e()}):this.I9e();return this.gjd}I9e(){wa.a.instance.Vb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(cb=>{cb.isFeatureEnabled("MsoPremiumBadge",!0).then(Xb=>{!Xb&&cb.isFreemiumUpsellEnabled()&&this.gjd.Mjf();return null})})}static ka(cb){cb.da.Ga(362,new ha(cb))}}Object(b.a)(ha,"InProductMessagingManagerFactory",aa.a,[]);var Da=a(1182),nb=a(1107),qa=a(47),pa=a(412),Ja=
a(78),$a=a(1),rb=a(524),Pa=a(21),eb=a(571);class Ob extends rb.a{constructor(cb){super(1);this.Tea=!1;this.Htf=()=>{this.refresh()};this.Itf=()=>{this.refresh()};this.gridView=Pa.g(cb);this.gridView.Wb.Mk(this.Itf);this.gridView.Wb.jm(this.Htf);this.refresh()}get XH(){return this.xjc(this.Tea)}qOd(cb){this.Tea!==cb&&(this.Tea=cb,this.iGb())}get name(){return eb.a.cellEdit}dispose(){this.gridView.Wb.Gk(this.Itf);this.gridView.Wb.Al(this.Htf);this.gridView=null;super.dispose()}iGb(){this.TEd(this.Tea)}refresh(){this.qOd(!this.gridView.$a)}}
Object(b.a)(Ob,"CellEditSafeStatePublisher",rb.a,[]);var tb=a(38),cc=a(109);class Ib{constructor(cb,Xb){this.handler=null;this.publisher=cb;this.XH=Xb}}Object(b.a)(Ib,"SafeStatePublisherState",null,[]);var Mb=a(606);const Oa=cb=>cb?`${cb.Current} / ${cb.Pending} @${cb.SuspensionStartTimestamp}`:null,Aa=(cb,Xb)=>cb||Xb?cb&&Xb?cb.Current===Xb.Current&&cb.Pending===Xb.Pending&&cb.SuspensionStartTimestamp===Xb.SuspensionStartTimestamp:!1:!0,Ba=cb=>(null===cb||void 0===cb?void 0:cb.SuspensionStartTimestamp)&&
cb.Pending>cb.Current;class ob extends tb.a{constructor(cb,Xb){super();this.Gif=null;this.g7a=!1;this.NDb=(rc,Ec)=>{3===Ec.Uof&&this.g7a&&d.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.g7a=!0;this.O$a()};this.eQa=new fa.a;this.txa=cb;this.Fla=Xb;this.Txb=$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.j6a=$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",
!1);this.Txb&&(this.Fla.TXa(this.Xxa.bind(this)),this.j6a?this.txa.ome(this.NDb):this.txa.aFg(this.tyf.bind(this)))}get XOj(){return cc.f(cc.c(this.eQa.toArray(),cb=>0!=cb.XH),cb=>cb.publisher.name)}cYb(cb){this.addHandler(ob.dQa,cb)}grc(cb){this.removeHandler(ob.dQa,cb)}Zya(cb,Xb){const rc=new Ib(cb,Xb);this.eQa.add(rc);Xb=(Ec,ed)=>{rc.XH=ed.XH;this.O$a()};cb.cYb(Xb);rc.handler=Xb;this.O$a()}KWd(cb){let Xb=null;for(let rc of this.eQa)if(rc.publisher===cb){this.$ag(rc);Xb=rc;break}Xb&&(this.eQa.remove(Xb),
this.O$a())}dispose(){for(let cb of this.eQa)this.$ag(cb);this.eQa.clear();this.Txb&&(this.Fla.Fab(this.Xxa.bind(this)),this.j6a?this.txa.APf(this.NDb):this.txa.bbj(this.tyf.bind(this)));super.dispose()}p9b(){let cb=Mc.p9b(this.eQa.toArray().map(Xb=>Xb.XH));return this.g7a&&1===cb?2:cb}$ag(cb){cb.publisher.grc(cb.handler)}O$a(){const cb=this.p9b();cb!==this.Gif&&(this.raiseEvent(ob.dQa,new Mb.a(cb)),this.Gif=cb)}tyf(){this.g7a&&d.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");
this.g7a=!0;this.O$a()}Xxa(cb,Xb){cb=Xb.a5;(Xb=!Ba(cb))||(Xb=this.ypi,Xb=(null===cb||void 0===cb?void 0:cb.SuspensionStartTimestamp)!==(null===Xb||void 0===Xb?void 0:Xb.SuspensionStartTimestamp));Xb&&(this.g7a=!1);this.ypi=cb;this.O$a()}}ob.dQa="SSC";Object(b.a)(ob,"ClientStateMonitor",tb.a,[]);var xb=a(6),Va=a(68);class bb extends rb.a{constructor(cb,Xb=null){super(1);this.Tea=!1;this.qN=()=>{this.refresh()};this.Luf=()=>{this.refresh()};this.$=cb;this.B6d=Xb||Va.a(cb).cQ(xb.a.idle);Va.a(cb).pTc(this.Luf);
this.D4a.nq(this.qN);this.refresh()}get XH(){return this.xjc(this.Tea)}qOd(cb){cb!==this.Tea&&(this.Tea=cb,this.iGb())}get name(){return eb.a.D4a}get D4a(){return this.B6d}dispose(){Va.a(this.$).Lqc(this.Luf);this.D4a.Nq(this.qN);this.B6d=null;super.dispose()}iGb(){this.TEd(this.Tea)}refresh(){this.qOd(1===this.D4a.au||Va.a(this.$).oi===this.D4a)}}Object(b.a)(bb,"IdleActivitySafeStatePublisher",rb.a,[]);var ra=a(312),Qa=a(3),qb=a(22);class Wa extends Ja.a{constructor(){super()}Qc(){return!1}executeCommand(){return w.Task.Ua(!0)}Ec(cb,
Xb){return 1905775613===Xb.command}Vc(){return!1}}Object(b.a)(Wa,"ToggleMergeSuspensionSafeState",Ja.a,[188]);class ta extends tb.a{constructor(cb,Xb){super();this.statusBarManager=null;this.pwd=!1;this.Xxa=(rc,Ec)=>{rc=`${Ec.a5.Current===Ec.a5.Pending?"\u26ad":"\u26ae"}${Ec.a5.Current}`;qb.a.equals(this.ekc,rc,!1)||(this.ekc=rc,this.Dz())};this.YNa=(rc,Ec)=>{rc=0==Ec.XH;this.pwd!==rc&&(this.pwd=rc,this.Dz())};this.mergeSuspensionManager=Xb;this.mergeSuspensionManager.Fla.TXa(this.Xxa);this.ekc="";
ra.a.I8(1905775613,Qa.a.yc,0,1);this.Ka=cb.Ka;this.zMb=new Wa;cb.da.Za(29,rc=>{this.mergeSuspensionManager&&(this.statusBarManager=rc,rc.hJ(this),this.mergeSuspensionManager.Uga.cYb(this.YNa))});this.Ka.J8(this.zMb)}nq(cb){this.addHandler(ta.Wud,cb)}Nq(cb){this.removeHandler(ta.Wud,cb)}Dz(){this.raiseEvent(ta.Wud)}mn(cb){return cb===ta.w1i&&!!this.mergeSuspensionManager}Pr(cb,Xb){if(!this.mn(cb))return!1;this.mergeSuspensionManager&&(Xb.LabelText=this.ekc,Xb.On=this.pwd);return!0}dispose(){this.zMb&&
(this.Ka.rab(this.zMb),this.zMb.dispose(),this.zMb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.Fla.Fab(this.Xxa),this.mergeSuspensionManager.Uga.grc(this.YNa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.PF(this),this.statusBarManager=null);this.ekc=null;super.dispose()}}ta.Wud="MSMSC";ta.w1i="QueryMergeSuspensionStatus";Object(b.a)(ta,"MergeSuspensionIndicatorManager",tb.a,[184,185,3]);var ib=a(7),Bb=a(873);class Ub extends Sys.EventArgs{constructor(cb){super();
this.owa=cb}}Object(b.a)(Ub,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Ta{}Object(b.a)(Ta,"SuspensionState",null,[]);class mb extends Ta{constructor(cb){super();this.doe=!1;this.doe=cb}}Object(b.a)(mb,"ReadyForPendingMergeState",Ta,[]);const Qb=new Ta,Lb=new Ta,Jb=new mb(!1),Ab=new mb(!0);var pb=a(874);class va extends pb.a{constructor(cb,Xb,rc){super(cb);this.rIg=Xb;this.ABj=rc}}Object(b.a)(va,"ReadyForPendingMergesUpdatedEventArgs",pb.a,[]);class db extends tb.a{constructor(cb,
Xb,rc){super();this.Xxa=(Ec,ed)=>{Ec=this.getState();const ud=this.QZ;this.QZ=ed.a5;ed=this.getState();this.Fui(Ec,ed,ud);this.raiseEvent(db.Rud);this.VRe(Ec,ed)};this.YNa=(Ec,ed)=>{Ec=this.getState();this.XH=ed.XH;ed=this.getState();this.VRe(Ec,ed)};this.NDb=(Ec,ed)=>{this.j6a&&4===ed.Uof&&(d.ULS.sendTraceTag(520480203,0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",Oa(this.QZ),Oa(ed.QZ)),this.WJf(this.getState(),
!0))};this.Txb=$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.j6a=$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.Uga=cb;this.Uga.cYb(this.YNa);this.Fla=Xb;this.Fla.TXa(this.Xxa);this.j6a&&(this.txa=rc,this.txa.ome(this.NDb));this.QZ=Object(ib.a)(new Bb.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.XH=this.w8h()}w8h(){return Object(pa.a)(ob,this.Uga)?Object(T.a)(ob,this.Uga).p9b():
1}hYb(cb){this.addHandler(db.OUd,cb)}mrc(cb){this.removeHandler(db.OUd,cb)}QFg(cb){this.addHandler(db.CFd,cb)}Fbj(cb){this.removeHandler(db.CFd,cb)}$Eg(cb){this.addHandler(db.Rud,cb)}abj(cb){this.removeHandler(db.Rud,cb)}j3i(){this.REd(this.getState()===Lb)}dispose(){this.Uga.grc(this.YNa);this.Uga=null;this.Fla.Fab(this.Xxa);this.Fla=null;this.j6a&&(this.txa.APf(this.NDb),this.txa=null);super.dispose()}Bdd(){return Object(ib.a)(new Bb.a,{Current:this.QZ.Current,Pending:this.QZ.Pending,SuspensionStartTimestamp:this.QZ.SuspensionStartTimestamp})}getState(){return Ba(this.QZ)?
0==this.XH?Ab:this.Txb&&1==this.XH?Jb:Lb:Qb}VRe(cb,Xb){cb!==Xb&&(Xb===Lb?this.REd(!0):cb===Lb&&this.REd(!1));this.WJf(Xb)}WJf(cb,Xb=!1){cb instanceof mb&&this.raiseEvent(db.CFd,new va(this.QZ,cb.doe||!this.Txb,Xb))}Fui(cb,Xb,rc){cb===Qb&&Xb!==Qb?(cb=Xb===Lb,Xb=Xb===Jb,d.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Xb} publisher: ${Xb||cb?this.Uga.XOj.join(","):""} counter: ${Oa(this.QZ)} isBlockingAllMerges: ${cb}`)):
cb!==Qb&&Xb===Qb&&d.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${Oa(rc)}`)}REd(cb){this.raiseEvent(db.OUd,new Ub(cb))}}db.OUd="TPMBBC";db.CFd="RFPMU";db.Rud="MCC";Object(b.a)(db,"MergeSuspensionStateHandler",tb.a,[]);class Ya extends tb.a{constructor(cb){super();this.$0=null;this.uhc=0;this.rBa=(Xb,rc)=>{var Ec;if(null===(Ec=null===rc||void 0===rc?void 0:rc.$c)||void 0===Ec?0:Ec.MergeCount)qb.a.equals(rc.$c.SessionId,this.$.ea.sessionId,
!1)?this.Wxa(rc.$c.MergeCount,Ya.Krb):d.ULS.sendTraceTag(579737049,0,50,`Stale merge counter (${rc.$c.MergeCount.Current}/${rc.$c.MergeCount.Pending})`)};this.QBb=(Xb,rc)=>{(null===rc||void 0===rc?0:rc.a5)&&this.Wxa(rc.a5,Ya.tZd)};this.$tc=()=>{this.dSf();this.OJf(this.$0,Ya.hfj)};this.V8a=(Xb,rc)=>{rc.Cpb&&this.$0.SuspensionStartTimestamp&&d.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${Oa(this.$0)}`)};this.dSf();this.$=cb;this.$.ea.hk(this.$tc);this.$.ea.ZL(this.$tc);
Pa.g(this.$).Wb.jm(this.V8a);$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||this.$.pa.Gr(this.rBa);this.$.da.Za(292,Xb=>{Xb.TXa(this.QBb);d.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}TXa(cb){this.addHandler("MCU",cb)}Fab(cb){this.removeHandler("MCU",cb)}get QZ(){return this.$0}Wxa(cb,Xb=""){const rc=this.$0.Current<cb.Current||this.$0.Pending<cb.Pending;if(cb.SuspensionStartTimestamp&&this.uhc!==cb.SuspensionStartTimestamp){if(this.uhc>
cb.SuspensionStartTimestamp){rc&&d.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Xb}. S: ${Ya.PBb(cb)}, C: ${Ya.PBb(this.$0)}`);return}rc||d.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${Ya.PBb(cb)}, C: ${Ya.PBb(this.$0)}`)}else if(!rc)return;this.$0=cb;this.OJf(cb,Xb)}dispose(){this.$.ea.Hk(this.$tc);this.$.ea.oR(this.$tc);
Pa.g(this.$).Wb.Al(this.V8a);$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||this.$.pa.qt(this.rBa);const cb=this.$.da.za(292);cb&&cb.Fab(this.QBb);super.dispose()}OJf(cb,Xb=""){Ba(cb)&&cb.SuspensionStartTimestamp>this.uhc&&(d.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${Oa(cb)}, Origin: ${Xb}`),this.uhc=cb.SuspensionStartTimestamp);this.raiseEvent("MCU",new pb.a(cb))}dSf(){d.ULS.sendTraceTag(588276808,
0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${Ya.PBb(this.$0)}`);this.$0=Object(ib.a)(new Bb.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static PBb(cb){return cb?`(${cb.Current}/${cb.Pending} @${cb.SuspensionStartTimestamp})`:"null"}}Ya.tZd="PMM.RTC";Ya.Krb="PMM.EwaResult";Ya.hfj="PMM.resetMergeCounter";Object(b.a)(Ya,"PendingMergeMonitor",tb.a,[]);class gb{}Object(b.a)(gb,"ClientRevisions",null,[]);var Ka=a(45),ub=a(62);const ac=(cb,Xb,rc,Ec,ed,ud,Kd,Zd=null)=>{Zd=cb.Na(1,
Zd);Zd.viewportState=Xb;Zd.allowViewAdjustment=rc;return ub.g(cb,"DoPendingMerge",Zd,Ec,ed,ud,Kd,0)},Ra=(cb,Xb,rc,Ec,ed,ud,Kd,Zd=null)=>{Zd=cb.Na(1,Zd);Zd.viewportState=Xb;Zd.allowViewAdjustment=rc;return ub.g(cb,"DoPendingMergeNew",Zd,Ec,ed,ud,Kd,0)},na=(cb,Xb,rc,Ec,ed,ud,Kd=null)=>{Kd=cb.Na(1,Kd);Kd.suspensionStartTimestamp=Xb;return ub.g(cb,"KeepBlockingPendingMerges",Kd,rc,Ec,ed,ud,0)};class lb extends tb.a{constructor(cb,Xb,rc,Ec){super();this.LHa=null;this.Pzb=0;this.Qzb=this.W6a=null;this.cAf=
(ed,ud)=>{this.LHa.SLg(ud.a5,ud.rIg,ud.ABj)};this.sEb=(ed,ud)=>{ud.owa?this.QDj():this.jxc()};this.syf=()=>{this.Pzb=0};this.rWf=()=>{const ed=this.b5.Bdd();na(this.va,null!=ed.SuspensionStartTimestamp?ed.SuspensionStartTimestamp:0,null,()=>{this.IMi(ed)},null,null,this.va.Qb())};this.sBa=(ed,ud)=>{if(ud){ud.Imb.MergeCount=this.b5.Bdd();let Kd;({min:ed,max:Kd}=Pa.g(this.$).Fzi());$a.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?ud.Imb.ClientRevisions=Object(ib.a)(new gb,
{Min:ed,Max:Kd,MaxFromBlockCache:Pa.g(this.$).Ea.sof}):ud.Imb.ClientRevisions=Object(ib.a)(new gb,{Min:ed,Max:Kd})}};this.$=cb;this.LYa=rc;this.b5=Xb;this.b5.QFg(this.cAf);this.b5.hYb(this.sEb);this.b5.$Eg(this.syf);this.$.pa.ega(this.sBa);this.va=this.$.pa.va;this.Vrc=this.$.ya.MergeSuspensionRequestThrottlingTimeInMs;this.Roi=this.$.ya.KeepBlockingPendingMergesRequestIntervalMs;this.LHa=Ec;d.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.pa.hma(this.sBa);this.jxc();
this.b5.Fbj(this.cAf);this.b5.mrc(this.sEb);this.b5.abj(this.syf);this.b5=null;super.dispose()}QDj(){this.jxc();if(this.qGe()){const cb=this.b5.Bdd();d.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${Oa(cb)} fail count: ${this.Pzb}`)}else this.Qzb=this.LYa.create(this.rWf,this.Vrc,Ka.a.Qzb),this.W6a=this.LYa.HE(this.rWf,this.Roi,Ka.a.W6a)}jxc(){this.W6a&&(this.Qzb.cancel(),
this.W6a.cancel(),this.W6a=this.Qzb=null)}IMi(cb){let Xb;Xb=" fail count: "+this.Pzb;this.Pzb++;this.qGe()&&this.jxc();d.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${Oa(cb)}${Xb}`)}qGe(){return this.Pzb>lb.oyi}}lb.oyi=5;Object(b.a)(lb,"RequestController",tb.a,[]);var jb=a(156),Yb=a(193),Gb=a(28),wb=a(280);class dc extends Sys.EventArgs{constructor(cb,Xb){super();this.Uof=cb;this.QZ=Xb}}Object(b.a)(dc,"MergeDidntOccurEventArgs",Sys.EventArgs,
[]);class Jc extends tb.a{constructor(cb,Xb,rc=null,Ec=null,ed=null){super();this.oAb=null;this.EAd=0;this.documentVisibilityObserver=null;this.Zhf=!1;this.va=cb;this.Vrc=Xb.ya.MergeSuspensionRequestThrottlingTimeInMs;const ud=Xb.ya.GetRangeContentPrefetchDelayForMergeInMs;this.sy=()=>{Xb.bVf(ud)};this.yh=rc||Gb.a.Wa;this.pYd=0;this.nL=Ec;this.Bza=ed;this.xdg=$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6248201_useDoPendingMergeSuccessCallback");this.gTg=$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6237816_CallDoPendingMergeRequest");
Xb.da.Za(291,Kd=>{this.documentVisibilityObserver=Kd})}get WKa(){return 0<this.EAd}aFg(cb){this.addHandler(Jc.Xud,cb)}bbj(cb){this.removeHandler(Jc.Xud,cb)}ome(cb){this.addHandler(Jc.Sud,cb)}APf(cb){this.removeHandler(Jc.Sud,cb)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.Ei}SLg(cb,Xb,rc=!1){this.LKb(cb,Xb,rc)?(new jb.a).setResult(!0):(Xb=this.JWi(cb,Xb),this.oAb=cb,this.EAd++,Xb.continueWith(()=>{this.iIi()},0,Yb.a.none,this.nL))}JWi(cb,Xb){this.pYd=
this.yh.l7;this.Zhf=Xb;d.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${cb.Current} / ${cb.Pending} @${cb.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Xb}`);this.isDocumentHidden||this.sy();return this.Tlj(Xb,cb)}LKb(cb,Xb,rc=!1){return!this.Bza||Xb||this.Bza.ami()?!this.oAb||cb.SuspensionStartTimestamp>this.oAb.SuspensionStartTimestamp?(this.WKa&&d.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${cb.Current} / ${cb.Pending} @${cb.SuspensionStartTimestamp}`),
!1):this.WKa?!0:rc?!1:this.xdg?(cb=Aa(cb,this.oAb),rc=this.yh.l7-this.pYd<this.Vrc,Xb=this.Zhf===Xb,cb&&rc&&Xb):Aa(cb,this.oAb)&&this.yh.l7-this.pYd<this.Vrc:(d.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0)}Tlj(cb,Xb){const rc=this.va.Qb(),Ec=()=>{d.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Xb.Current} / ${Xb.Pending} @${Xb.SuspensionStartTimestamp}`)};
return this.Bza?this.Bza.pij(this.VLh(cb,Ec,rc)):this.Cue(null,!0,void 0,Ec,rc)}VLh(cb,Xb,rc){return(Ec,ed,ud)=>{let Kd=void 0;this.xdg&&(d.ULS.shipAssertTag(523317955,0,null!=Ec||cb,"!allowSelectionAdjustment requires a non-null initialViewportState."),Kd=this.jIi.bind(this));ed&&(Kd=wb.b.call(null,Zd=>{const Xd=Zd.Result;let Je=null===Xd||void 0===Xd?void 0:Xd.AdjustedViewportState;3===(null===Xd||void 0===Xd?void 0:Xd.MergeResultState)&&(Je=void 0);ed(Je,Zd.StateId)},Kd));ud&&(Xb=wb.a.call(null,
ud,Xb));return this.Cue(Ec,cb,Kd,Xb,rc)}}Cue(cb,Xb,rc,Ec,ed){return this.gTg?ac(this.va,cb,Xb,rc,Ec,null,null,ed):Ra(this.va,cb,Xb,rc,Ec,null,null,ed)}jIi(cb){var Xb=cb.Result;void 0!=Xb&&(Xb=Xb.MergeResultState,$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1)&&2!==Xb?this.L2i(Xb,cb.Result.a5):3===Xb&&(d.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.M2i()))}M2i(){this.raiseEvent(Jc.Xud,new Sys.EventArgs)}L2i(cb,
Xb){this.raiseEvent(Jc.Sud,new dc(cb,Xb))}iIi(){this.EAd--}}Jc.Xud="MWA";Jc.Sud="MDO";Object(b.a)(Jc,"DoPendingMergeSender",tb.a,[497,498]);class Qc{constructor(cb=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.q7h=cb}get reportName(){return this.q7h?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(Qc,
"SelectionAdjustSessionEndsReport",null,[510]);var fd=a(42),Wc=a(97);class Rb{constructor(cb,Xb,rc,Ec,ed,ud){this.TI=void 0;this.jb=cb;this.tG=Xb;this.w8=rc;this.TUb=Ec;this.CCc=ed;$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6592063_GetIndexOfActiveRangeFromInitialSelection_V2")&&(this.TI=ud);this.RLc=$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SelectionAdjustMultiRangeSupport",!1)}get activeCell(){return this.tG}get selectedRanges(){return this.w8}get Wr(){let cb=!1;if(null===
this.TI||void 0===this.TI)cb=!0;else if(this.TI>=this.selectedRanges.length||!this.selectedRanges[this.TI].contains(this.activeCell))d.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.TI}, selectedRangesLength: ${this.selectedRanges.length}`),cb=!0;cb&&(this.TI=this.QSg());return this.TI}get activeRange(){return 0>this.Wr?this.activeCell:this.selectedRanges[this.Wr]}get sheetName(){return this.TUb}get activeItemName(){return this.CCc}get JTa(){return 1===
this.selectedRanges.length}Yeg(cb){let Xb;this.RLc?Xb=this.selectedRanges.map(rc=>this.l$f(rc,this.CCc)):this.JTa&&(Xb=[this.l$f(this.selectedRanges[0],this.CCc)]);for(let rc of Xb)if(rc)for(let Ec of rc)if(Ec.Ck&&Ec.se.Revision<cb)return!1;return!0}zJj(){var cb;if(this.JTa||this.RLc){var Xb={SheetName:this.sheetName,ActiveCell:null===(cb=this.activeCell)||void 0===cb?void 0:cb.toString(),SelectedRange:this.selectedRanges[0].toString(),TopLeft:void 0,SelectedRanges:void 0};this.RLc&&(Xb.SelectedRange=
void 0,Xb.SelectedRanges=fd.r(this.selectedRanges,this.jb));return Xb}}toString(){var cb,Xb;return`active cell: ${null!==(Xb=null===(cb=this.activeCell)||void 0===cb?void 0:cb.toString())&&void 0!==Xb?Xb:"null"} selection: ${cc.f(this.selectedRanges,rc=>{var Ec;return null!==(Ec=null===rc||void 0===rc?void 0:rc.toString())&&void 0!==Ec?Ec:"null"}).join(",")}`}equals(cb){return cb?this.activeCell.equals(cb.activeCell)&&fd.Q(this.selectedRanges,cb.selectedRanges)&&this.sheetName===cb.sheetName:!1}QSg(){for(let [cb,
Xb]of this.selectedRanges.entries())if(null===Xb||void 0===Xb?0:Xb.contains(this.activeCell))return cb;return-1}l$f(cb,Xb){var rc;const Ec=Pa.g(this.jb).Ea.L2a(cb,Xb);Ec||d.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(rc=null===cb||void 0===cb?void 0:cb.toString())&&void 0!==rc?rc:"null"} ; activeItemNameIsDefined: ${!!Xb}`);return Ec}}Object(b.a)(Rb,"SelectionState",null,[]);var Sb=a(201),mc;(function(cb){cb[cb.none=0]="none";cb[cb.waitingForAdjusted=
1]="waitingForAdjusted";cb[cb.invalid=2]="invalid";cb[cb.nonContinuous=3]="nonContinuous";cb[cb.noAdjustRequired=4]="noAdjustRequired";cb[cb.noAdjustRequiredWithDivergence=5]="noAdjustRequiredWithDivergence";cb[cb.divergenceOnResponse=6]="divergenceOnResponse";cb[cb.waitingForViewport=7]="waitingForViewport";cb[cb.adjusted=8]="adjusted";cb[cb.divergenceOnViewportReady=9]="divergenceOnViewportReady";cb[cb.differentSheetAdjust=10]="differentSheetAdjust";cb[cb.editBoxDivergence=11]="editBoxDivergence";
cb[cb.exception=12]="exception"})(mc||(mc={}));Object(b.b)("SelectionAdjustState",mc);var ec=a(734);class Rc{constructor(cb){this.exc=0;this.Ny=this.Ux=null;this.m0d=new Qc;this.n0d=new Qc(!0);this.dD=0;this.HHj=!1;this.ipf=1E4;this.Zc=()=>{this.uDe()};this.Hi=()=>{this.NVc(!0,!1)};this.M8a=()=>{this.NVc(!1,!1)};this.$=cb;this.gridView=Pa.g(this.$);this.gridView.Ea.ox(this.Hi);this.gridView.Ea.Ms(this.M8a);this.gridView.Ea.wle(this.M8a);this.gridView.Ea.bga(this.M8a);$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&
this.$.el(this.Zc);this.jej=$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ReportSelections",!1);this.uDe();this.hCb=$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SelectionAdjustMultiRangeSupport",!1)}pij(cb){let Xb=null,rc=null,Ec=()=>{this.SEi()};this.daf()?(this.cM.parallel++,d.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.Ny}`)):(Xb=(ed,ud)=>{this.TEi(ed,
ud)},rc=this.srj());return null===cb||void 0===cb?void 0:cb(rc,Xb,Ec)}ami(){return!this.daf()&&this.Y$().JTa}srj(){var cb;d.ULS.shipAssertTag(525135961,0,0===this.dD,"SelectionAdjustManager.setPreRequestState: unexpected state");this.Ny&&(this.cM.errors++,d.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.Ny.toString()}`));this.Ny=null;this.Ux=this.Y$();let Xb=null;const rc=null===(cb=this.Ux)||void 0===cb?void 0:cb.zJj();
rc&&(Xb={ActiveSheetName:this.Ux.sheetName,SheetViewportStateChanges:[rc]});this.dD=1;return Xb}SEi(){d.ULS.shipAssertTag(525135960,0,1===this.dD,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.cM.errors++;this.dD=2;this.er()}TEi(cb,Xb){try{d.ULS.shipAssertTag(525135959,0,1===this.dD,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.exc=Xb,Xb=2,this.Ux?cb?(this.Ny=this.Suj(cb))?(Xb=7,this.hCb||this.Ux.JTa)?this.Ux.equals(this.Ny)?this.Ux.equals(this.Y$())?
(this.cM.adjustedDidntChange++,Xb=4):(this.cM.adjustedDidntChangeWithDivergence++,Xb=5):this.Ux.sheetName!=this.Ny.sheetName?(this.cM.differentSheetAdjust++,Xb=10):this.Ux.equals(this.Y$())||(this.cM.divergenceOnResponse++,Xb=6,this.LQf()):(this.cM.nonContinuous++,Xb=3):this.cM.errors++:(this.cM.errors++,d.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.Ux.toString()}`)):(this.cM.errors++,d.ULS.sendTraceTag(537155413,
0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===cb||void 0===cb?void 0:cb.ActiveCell}, SelectedRange: ${null===cb||void 0===cb?void 0:cb.SelectedRange}`)),this.dD=Xb}catch(rc){this.dD=12,d.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${rc}`)}finally{7!=this.dD?this.er():this.NVc(!1,!0)}}dispose(){this.gridView.Ea.uv(this.Hi);this.gridView.Ea.Mq(this.M8a);
this.gridView.Ea.NOf(this.M8a);this.gridView.Ea.wab(this.M8a);$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&this.$.Cl(this.Zc)}daf(){return 1===this.dD||7===this.dD}Suj(cb){let Xb;if(!({range:Xb}=fd.Z(cb.ActiveCell,this.$.xa)).returnValue)return d.ULS.sendTraceTag(537155411,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${cb.ActiveCell}`),null;let rc=[];if(this.hCb){var Ec=this.$.oa;const ed=!!Ec&&
2===Ec.bG;if(cb.SelectedRanges)rc=fd.g(cb.SelectedRanges.Ranges);else if(!ed)return d.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!Ec}`),null}else{if(!({range:Ec}=fd.Z(cb.SelectedRange,this.$.xa)).returnValue)return d.ULS.sendTraceTag(537155410,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract selected range ${cb.SelectedRange}`),null;rc.push(Ec)}return new Rb(this.$,Xb,
rc,cb.SheetName,this.Ux.activeItemName,this.Ux.Wr)}Y$(){const cb=this.$.oa;if((null===cb||void 0===cb?0:cb.activeCell)&&cb.selectedRanges&&cb.sheetName)return new Rb(this.$,cb.activeCell,cb.selectedRanges,cb.sheetName,this.$.activeItemName,cb.Wr);d.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!cb}, activeCell null: ${!(null===cb||void 0===cb?0:cb.activeCell)}, selectedRanges null: ${!(null===cb||void 0===cb?0:cb.selectedRanges)}, sheetName null: ${!(null===
cb||void 0===cb?0:cb.sheetName)}`);return null}uDe(){this.$.da.Za(276,()=>{const cb=Sb.a(this.$);cb.BX(this.m0d);cb.BX(this.n0d)})}NVc(cb,Xb){var rc;if(this.qki(cb))if(8===this.dD)d.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Xb&&d.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{if(d.ULS.shipAssertTag(525135956,0,7===this.dD,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),
this.Ux.equals(this.Y$()))if(null===(rc=this.gridView)||void 0===rc?0:rc.$a)this.cM.editBoxDivergence++,this.dD=11;else{cb=0;if(this.hCb&&(cb=this.Ny.Wr,-1==cb)){this.cM.errors++;d.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange");return}this.cM.adjusted++;this.dD=8;$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6413876_AdjustSelectionWithoutCallingGoto")?this.gridView.ha.Qw(this.Ny.selectedRanges,cb,this.Ny.activeCell,0,void 0,Wc.a.cWf):this.gridView.HU(this.Ny.selectedRanges,
cb,this.Ny.sheetName,null,this.Ny.activeCell,null,null,0,Wc.a.cWf)}else this.cM.divergenceOnViewportReady++,this.LQf(),this.dD=9}catch(Ec){this.dD=12,d.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${Ec}`)}finally{this.er()}}}qki(cb){if(!this.Ny)return!1;if(!this.Ux)return d.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.Ny.toString()}`),
!1;if(Pa.g(this.$).Ea.sof<this.exc)return!1;if(cb||this.HHj)(this.hCb||this.Ux.JTa)&&d.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.Ux.JTa&&!this.hCb||!this.Ux.Yeg(this.exc)||!this.Ny.Yeg(this.exc))return!1;return!0}er(){var cb,Xb,rc,Ec;this.jej&&2!=this.dD&&d.ULS.sendTraceTag(526792898,0,50,`SelectionAdjustManager.clearState: initial: ${null!==(Xb=null===(cb=this.Ux)||void 0===cb?void 0:
cb.toString())&&void 0!==Xb?Xb:"null"}, adjusted: ${null!==(Ec=null===(rc=this.Ny)||void 0===rc?void 0:rc.toString())&&void 0!==Ec?Ec:"null"}, state: ${mc[this.dD]}, hidden: ${ec.a.kB(this.ipf)}`);this.Ux=this.Ny=null;this.dD=0}LQf(){const cb=this.Y$();d.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.Ux.toString()} current: ${cb?cb.toString():""} adjusted: ${this.Ny.toString()} sheetSameBetweenInitialAndAdjusted: ${this.Ux.sheetName===this.Ny.sheetName} sheetSameBetweenInitialAndCurrent: ${this.Ux.sheetName===
(cb?cb.sheetName:null)}`)}get cM(){return ec.a.kB(this.ipf)?this.n0d:this.m0d}}Object(b.a)(Rc,"SelectionAdjustManager",null,[499,3]);class Mc extends Ja.a{constructor(cb,Xb,rc=null){super();this.$Ba=this.Pcc=this.E4a=this.PZa=null;d.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=cb;this.aWa=new Ya(cb);$a.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SelectionAdjust",!1)&&(this.Bza=new Rc(this.$));this.LHa=new Jc(this.$.pa.va,this.$,void 0,void 0,this.Bza);
this.R8h(cb,rc);this.$ea=new db(this.$Ba,this.aWa,this.LHa);this.pJd=new lb(cb,this.$ea,Xb,this.LHa);$a.EwaSettings.ma(254)&&(this.Pcc=new ta(cb,this));d.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}hYb(cb){this.$ea.hYb(cb)}mrc(cb){this.$ea&&this.$ea.mrc(cb)}get Uga(){return this.$Ba}get Fla(){return this.aWa}get b5(){return this.$ea}Zya(cb,Xb){this.$Ba.Zya(cb,Xb)}KWd(cb){this.$Ba.KWd(cb)}Wxa(cb,Xb=""){this.aWa.Wxa(cb,Xb)}dispose(){this.Pcc&&(this.Pcc.dispose(),this.Pcc=null);
this.Bza&&this.Bza.dispose();this.LHa.dispose();this.pJd&&(this.pJd.dispose(),this.pJd=null);this.$ea&&(this.$ea.dispose(),this.$ea=null);this.aWa.dispose();this.aWa=null;this.$Ba.dispose();this.$Ba=null;this.PZa&&(this.PZa.dispose(),this.PZa=null);this.E4a&&(this.E4a.dispose(),this.E4a=null);this.$=null;super.dispose()}iGb(){this.$ea.j3i()}static p9b(cb){let Xb=0;for(let rc of cb){if(2==rc)return 2;1==rc&&(Xb=1)}return Xb}R8h(cb,Xb){this.$Ba=new ob(this.LHa,this.aWa);Xb?Object(pa.a)(bb,Xb)?this.Zya(Xb,
Object(T.a)(bb,Xb).XH):Object(pa.a)(Ob,Xb)?this.Zya(Xb,Object(T.a)(Ob,Xb).XH):this.Zya(Xb,0):(this.PZa=new Ob(cb),this.E4a=new bb(cb),this.Zya(this.PZa,this.PZa.XH),this.Zya(this.E4a,this.E4a.XH))}}Object(b.a)(Mc,"MergeSuspensionManager",Ja.a,[463,3]);class bc extends aa.a{constructor(cb){super();this.Hc=cb;this.Fb()}create(){d.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.qb(this.Hc.da.za(343)||this.Hc.da.Ga(343,new Mc(this.Hc,qa.a.instance)))}static ka(cb){d.ULS.sendTraceTag(537155418,
0,50,"MergeSuspensionFactory.Attach");cb.da.Ga(344,new bc(cb))}}Object(b.a)(bc,"MergeSuspensionFactory",aa.a,[]);var ic=a(50),Yc=a(37),md=a(86),id=a(98),xd=a(58),Lc=a(14);class Pb{}Pb.zri=3;Pb.connected=0;Object(b.a)(Pb,"ConnectionStateConstants",null,[]);var Gc=a(110),Nb=a(118),yc=a(43);class Tc{constructor(cb,Xb,rc){var Ec;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=
0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.rtf=(ed,ud)=>{this.blockedOperationsCount++;ed=`${ud.componentName}_${ud.actionName}_${ud.details})`;this.blockedActions[ed]=this.blockedActions[ed]?this.blockedActions[ed]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.zAd=ed=>{this.durationUntilUserInactive=
Gc.getElapsedSeconds(this.startTime,Gb.a.Wa.Nb);ed.wId(this.zAd)};this.q5=()=>{this.hasTabbedOut=!0};this.Tba=(ed,ud)=>{ud.WEf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=Nb.a(Gb.a.Wa,this.startTime),this.toastRaiser=ud.toastRaiser,this.isToastShown=!0)};this.startTime=cb;this.durationUntilToastShownMs=0;this.blockedActions={};this.isToastShown=rc;if(null===(Ec=Xb.ea)||void 0===Ec?0:Ec.hf)this.wasUserActiveOnPIStart=Xb.ea.hf.$r;this.Bj(Xb);this.isDialogShown=0<Xb.rb.dR;cb=Xb.da.za(183);
this.isTaskPaneShown=!!cb&&cb.isVisible&&!cb.isCollapsed;this.isTaskPaneCollapsed=!!cb&&cb.isVisible&&cb.isCollapsed}gYf(){this.durationMs=Nb.a(Gb.a.Wa,this.startTime)}Kzd(cb){var Xb;this.gYf();yc.a(cb).erc(this.rtf);yc.a(cb).Vf.frc(this.Tba);cb.da.Za(291,rc=>{rc.yab(this.q5)});if(null===(Xb=cb.ea)||void 0===Xb?0:Xb.hf)cb.ea.hf.wId(this.zAd),this.wasUserActiveOnPIEnd=cb.ea.hf.$r}Bj(cb){yc.a(cb).YXb(this.rtf);this.isToastShown?this.toastRaiser="Immediate":yc.a(cb).Vf.JTc(this.Tba);cb.da.Za(291,Xb=>
{this.hasTabbedOut=Xb.Ei;Xb.LXa(this.q5)});this.wasUserActiveOnPIStart&&cb.ea.hf.bne(this.zAd)}}Object(b.a)(Tc,"PartialInteractivityData",null,[]);var gd=a(1108);class Ad extends Tc{constructor(cb,Xb,rc,Ec,ed,ud){super(cb,Xb,Ec);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];
this.triggeringRequest=null;this.type=4;this.swappedOffline=rc;this.disconnectionSource=Enum.toString(gd.a,ed);this.triggeringRequest=ud}gHi(cb,Xb){this.swappedByOffline=Xb;this.Kzd(cb)}lpj(cb){this.errorDataDuringConnectivityIssuesMode=cb}z5i(cb){10>this.failedRequests.length&&(cb=cb+"_"+Gc.getElapsedSeconds(this.startTime,Gb.a.Wa.Nb).toString(),this.failedRequests.push(cb))}}Object(b.a)(Ad,"ConnectivityIssuesData",Tc,[]);var Od=a(158),Pd=a(125),Md=a(111);class ge{}ge.Fhh="DuringWork";ge.connectivityIssues=
"ConnectivityIssues";ge.offline="Offline";Object(b.a)(ge,"UnavailabilityTypes",null,[]);var pe=a(51);class Qd{constructor(cb){this.ohc=this.data=null;this.e9c=0;this.fAe=null;this.Buf=(Xb,rc)=>{rc.UL?(this.data=new Ad(Gb.a.Wa.Nb,this.$,5===rc.una,0!==rc.una,this.$.Rf.disconnectionSource,this.fAe),this.ohc=this.$.Rf.Oif,this.e9c=1,this.$.pa.Rf.SGg(this.Un),Od.a(this.$).qTc(this.rUf)):(this.data.gHi(this.$,5===rc.una),this.$.pa.Rf.WPf(this.Un),this.data.lastFailedRequestToOnlineTimeGapSec=Gc.getElapsedSeconds(this.ohc,
Gb.a.Wa.Nb),$a.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?pe.b().sJb(557682689,0,50,ge.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",xd.a.Ac(this.data)):d.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${xd.a.Ac(this.data)}`),this.data&&this.data.isToastShown&&
id.Health.instance.recordQosError(Pd.a.OXg,[Md.a.Xhc],!0,!1,!1,!1,null),Od.a(this.$).QHd(this.rUf),this.data=null)};this.rUf=(Xb,rc)=>{this.data.lpj(rc.lU)};this.Un=(Xb,rc)=>{this.data.z5i(rc.context.methodName);Xb=Gb.a.Wa.Nb;rc=Gc.getElapsedSeconds(this.ohc,Xb);this.ohc=Xb;rc>this.data.longestDurationBetweenFailedRequestsSec&&(this.data.longestDurationBetweenFailedRequestsSec=rc);this.e9c++;this.data.averageDurationBetweenFailedRequestsSec=this.DSg(rc)};this.yuf=(Xb,rc)=>{this.fAe=rc.TLj};this.$=
cb;yc.a(this.$).Vf.Fle(this.Buf);this.$.Rf.Ele(this.yuf)}dispose(){this.$&&(yc.a(this.$).Vf.XOf(this.Buf),this.$.Rf&&this.$.Rf.WOf(this.yuf));this.data&&this.$.pa.Rf.WPf(this.Un);this.$=null}DSg(cb){const Xb=this.e9c-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Xb-1)+cb)/Xb}}Object(b.a)(Qd,"ConnectivityIssuesTelemetryManager",null,[3]);var he=a(843),ue=a(127),je=a(782);class Ge{constructor(cb){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=
[];this.sessionID=cb}get count(){return this._count}get PT(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}pQj(){this.PT&&this.PT.gYf()}sBg(cb){this.allOfflinePartialInteractivitiesDataInSession.push(cb);this._count++}}Object(b.a)(Ge,"OfflinePartialInteractivitiesDataForLog",null,[]);class Ce extends Tc{constructor(cb,Xb,rc){super(cb,Xb,rc);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=
-1;this.type=5}Nsj(cb){this.timeFromLastOffline=cb}mpj(cb){this._errorDataDuringOfflineMode=cb}}Object(b.a)(Ce,"OfflinePartialInteractivityData",Tc,[]);class pc{constructor(cb,Xb){this.CNa=this.PT=null;this.BDd=-1;this.gtb=null;this.Iif=w.Task.delay(0);this.m9a=(rc,Ec)=>{Ec.UL?this.nOi(Ec.una):this.oOi()};this.Tba=(rc,Ec)=>{5===Ec.WEf&&this.d2a()};this.sUf=(rc,Ec)=>{this.PT.mpj(Ec.lU)};this.d2a=()=>{this.CNa.pQj();this.kjj(pc.DBd,Sys.Serialization.JavaScriptSerializer.serialize(this.CNa))};this.$dj=
rc=>{if(rc=rc.result)this.pfg=!0,d.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${rc}`)};this.s9i=()=>{this.pfg&&(this.$?Yc.TaskExtensions.Aa(this.indexedDB.x4c(pc.DBd),()=>{d.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.la):d.ULS.sendTraceTag(537155203,0,10,
"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.HNa=()=>{if(this.CNa&&0<this.CNa.count){const rc=Sys.Serialization.JavaScriptSerializer.serialize(this.CNa);d.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${rc}`)}};this.$=cb;this.indexedDB=Xb;this.pfg=!1;this.indexedDB.If()&&(this.indexedDB.initialize(pc.rjd,pc.sjd),this.xdj(),this.CNa=
new Ge(this.$.ya.UserSessionId),yc.a(this.$).Vf.BTc(this.m9a));this.vm=ue.a.instance.XG();this.vm.ka("beforeunload",this.HNa)}dispose(){this.$&&yc.a(this.$)&&yc.a(this.$).Vf.bId(this.m9a);md.a.Ia(this.gtb);this.$=this.gtb=null}nOi(cb){this.PT=new Ce(Gb.a.Wa.Nb,this.$,0!==cb);this.PT.Nsj(-1!==this.BDd?window.performance.now()-this.BDd:-1);this.CNa.sBg(this.PT);yc.a(this.$).Vf.JTc(this.Tba);this.d2a();this.gtb=qa.a.instance.HE(this.d2a,pc.dBh,Ka.a.d2a);Od.a(this.$).qTc(this.sUf)}oOi(){this.PT.Kzd(this.$);
this.d2a();md.a.Ia(this.gtb);this.gtb=null;this.BDd=window.performance.now();yc.a(this.$).Vf.frc(this.Tba);Od.a(this.$).QHd(this.sUf);this.Cdj()}kjj(cb,Xb){this.$?this.Iif=Yc.TaskExtensions.Aa(this.Iif,()=>{this.indexedDB.wbb(new je.a(cb,Xb))},this.$.la):d.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}xdj(){const cb=this.$.la;Yc.TaskExtensions.Aa(Yc.TaskExtensions.Aa(this.indexedDB.j3a(pc.DBd),this.$dj,
cb),this.s9i,cb)}Cdj(){if(this.PT){const cb=Sys.Serialization.JavaScriptSerializer.serialize(this.PT);$a.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?pe.b().sJb(560791645,0,50,ge.offline,this.PT.durationMs,"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",cb):d.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${cb}`)}this.PT&&
this.PT.isToastShown&&id.Health.instance.recordQosError(Pd.a.iUj,[Md.a.Xhc],!0,!1,!1,!1,null)}}pc.rjd="NetworkAvailability";pc.sjd="NetworkAvailabilityData";pc.DBd="partialInteractivityData";pc.dBh=3E3;Object(b.a)(pc,"OfflineModeTelemetryManager",null,[3]);class Uc{constructor(cb,Xb){this.Jka=this.UBi=this.msf=null;this.$=cb;$a.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&X.a.Tf||(this.msf=new pc(cb,Xb));!$a.EwaSettings.ma(555)||$a.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&
X.a.Tf||(this.Jka=new he.NetworkConnectionHealthChecker(this.$));this.A0g=new Qd(this.$)}dispose(){md.a.Ia(this.msf);md.a.Ia(this.UBi);md.a.Ia(this.Jka);md.a.Ia(this.A0g);this.$=null}}Object(b.a)(Uc,"NetworkConnectionTelemetryManager",null,[3]);class hd extends Tc{constructor(cb,Xb,rc,Ec){super(cb,Xb,rc);this.wasInteruptedByOfflineMode=!1;this.type=Ec;this.wasInteruptedByOfflineMode=!1}m9a(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(hd,"SilentReopenData",Tc,[]);class yd{constructor(cb){this.N6=
null;this.$Bf=(Xb,rc)=>{this.XBf(rc,3)};this.myf=(Xb,rc)=>{this.XBf(rc,2)};this.$=cb;this.Vf=yc.a(this.$).Vf;this.Vf.lme(this.myf);this.Vf.uGg(this.$Bf)}dispose(){this.Vf.yPf(this.myf);this.Vf.fcj(this.$Bf);this.N6=this.Vf=this.$=null}XBf(cb,Xb){cb.UL?this.N6=new hd(Gb.a.Wa.Nb,this.$,0!==cb.una,Xb):(5===cb.una&&(this.N6.wasInteruptedByOfflineMode=!0),3!==cb.una&&2!==cb.una||d.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),
this.N6.Kzd(this.$),2===Xb?$a.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?pe.b().tJb(571289604,0,50,ge.offline,this.N6.durationMs,this.N6):d.ULS.sendTraceTag(571289604,0,50,xd.a.Ac(this.N6)):$a.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?pe.b().tJb(542782150,0,50,ge.Fhh,this.N6.durationMs,this.N6):d.ULS.sendTraceTag(542782150,0,50,xd.a.Ac(this.N6)),this.N6=null)}}Object(b.a)(yd,"SilentReopenPartialInteractivityTelemetryManager",
null,[3]);class wd extends tb.a{constructor(cb,Xb,rc=!0){super();this.Z_=this.R1b=this.DNa=this.ena=this.ERa=null;this.wqf=0;this.hqc=this.lab=this.mab=!1;this.xqf=this.documentVisibilityObserver=null;this.wpa=!1;this.ijd=this.V6=0;this.Xyb=!1;this.D3f=0;this.GPd=!1;this.l0=null;this.Wyf=()=>{d.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.Gjc(1,!1)};this.bla=()=>{this.Jja||this.mBb?window.setTimeout(()=>{this.NUd()},this.wqf):this.NUd();this.documentVisibilityObserver.zab(this.bla);
this.Xyb=!1};this.Jf=()=>{d.ULS.sendTraceTag(537155218,0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.mBb}, IsInDuringWorkSilentReopenMode:${this.Gic&&!this.wpa}`);this.mBb&&this.Iie();this.Gic&&!this.wpa&&this.Fie();Pa.g(this.$).dc.Al(this.Jf);this.mab=this.lab=!1};this.Xyf=()=>{d.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.Gjc(1,!0);this.lab&&!this.mab&&Pa.g(this.$).dc.Al(this.Jf);this.lab=
!1};this.cOa=(Ec,ed)=>{this.ijd=this.V6;this.V6=ed.uyc};this.ZBf=()=>{this.$&&(this.hqc||(Va.a(this.$).cQ(xb.a.jOa).bEg(this.gzf),this.$.el(this.Zc),this.hqc=!0),this.wpa=this.Qdi(),this.Gjc(2,!1))};this.gzf=()=>{var Ec=Va.a(this.$).oi;const ed=Ec.jKg();Ec=cc.f(Ec.Cs.fd.errors,ud=>ud.MessageIdName);d.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${ed}, IsB2W:${this.wpa}, Errors: ${xd.a.Ac(Ec)}`);ed&&(this.ERa?(this.wpa=
!1,this.PEe(),this.uzc()):this.ena&&(this.QEe(),this.uzc()))};this.Zc=()=>{this.$?(d.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.wpa=!1,this.Z_&&this.Z_.zq&&(md.a.Ia(this.Z_),this.Z_=null),this.l0&&this.l0.zq&&(md.a.Ia(this.l0),this.l0=null),this.Gjc(2,!0),this.uzc()):d.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.zuf=()=>{this.upf(!0)};this.Auf=()=>{this.upf(!1)};
this.LUb=Pb.zri;this.z0c=Pb.connected;this.$=cb;this.Rf=cb.pa.Rf;rc&&(this.xqf=new Uc(cb,Xb));this.$.da.Za(291,Ec=>{this.documentVisibilityObserver=Ec});this.wqf=this.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs;this.Rf.gFg(this.Wyf);this.Rf.SXb(this.Xyf);this.Rf.Ele(this.zuf);this.Rf.IDg(this.Auf);new yd(this.$,this);this.Xlf=this.$.ya.LongInactivityTimePeriodSeconds;this.$.ea.UTc(this.ZBf);this.$.ea.hf.dra(this.cOa);this.D3f=this.$.ya.SilentReopenDuringWorkDelayMs}get Rfi(){return this.wpa}get mBb(){return!(this.LUb&
1)}get Gic(){return!(this.LUb&2)}get Jja(){return!!(this.z0c&2)}dispose(){this.Rf&&(this.Rf.gbj(this.Wyf),this.Rf.Xqc(this.Xyf),this.Rf.WOf(this.zuf),this.Rf.W$i(this.Auf));this.Xyb&&this.documentVisibilityObserver&&(this.documentVisibilityObserver.zab(this.bla),this.Xyb=!1);this.$&&(this.hqc&&this.uzc(),this.$.ea&&(this.$.ea.PPf(this.ZBf),this.$.ea.hf&&this.$.ea.hf.zPa(this.cOa)));this.l0&&(this.l0.dispose(),this.l0=null);md.a.Ia(this.xqf);this.$=null;super.dispose()}Nxi(){this.GPd=!0}Fie(){this.ena||
(this.ena=yc.a(this.$).Vf.oXa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}Qdi(){if(this.GPd)return this.GPd=!1,!0;const cb=this.V6>this.Xlf||this.ijd>this.Xlf&&10>this.V6;d.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.V6}, Time gap between last two activities: ${this.ijd}. return value:${cb}`);return cb}lej(){this.l0=qa.a.instance.create(()=>{id.Health.instance.recordQosError(Pd.a.kCj,
[Md.a.Xhc],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}Uyg(){this.ena||this.Z_?d.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):this.Z_=qa.a.instance.create(()=>{this.$?this.ena?d.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):
Pa.g(this.$).$a?(this.lab||(Pa.g(this.$).dc.jm(this.Jf),d.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),this.mab=!0,d.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.Fie():d.ULS.sendTraceTag(537155222,
0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.D3f,Ka.a.jBj,void 0,!0)}upf(cb){this.z0c=this.hue(2,cb,!0);this.Bne()}Gjc(cb,Xb){this.LUb=this.hue(cb,Xb,!1);this.Bne()}hue(cb,Xb,rc){rc=rc?this.z0c:this.LUb;return Xb?rc|cb:rc&~cb}NUd(){const cb=!!this.DNa,Xb=!!this.ERa,rc=!!this.ena,Ec=!!this.R1b;this.mBb&&!cb?this.Tyg():!this.mBb&&cb&&this.hbh();!this.Gic||Xb||rc?this.Gic||(Xb?this.PEe():(rc||this.Z_&&this.Z_.zq)&&this.QEe()):this.wpa?this.Ryg():
this.Z_||this.Uyg();this.Jja&&!Ec?this.S8f(!0):!this.Jja&&Ec&&this.S8f(!1)}Tyg(){this.$?this.DNa?d.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):Pa.g(this.$).$a?(this.mab||(Pa.g(this.$).dc.jm(this.Jf),d.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),
this.lab=!0,d.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.Iie():d.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}Iie(){this.DNa||(this.DNa=yc.a(this.$).Vf.oXa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}hbh(){this.DNa&&(md.a.Ia(this.DNa),this.DNa=
null)}PEe(){this.ERa&&(md.a.Ia(this.ERa),this.ERa=null);this.l0&&this.l0.zq&&this.l0.cancel();this.l0=null}QEe(){this.ena&&(md.a.Ia(this.ena),this.ena=null);this.Z_&&(md.a.Ia(this.Z_),this.Z_=null);this.mab&&!this.lab&&Pa.g(this.$).dc.Al(this.Jf);this.mab=!1}Ryg(){this.ERa||(this.ERa=yc.a(this.$).Vf.oXa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",void 0,Lc.a.instance.ga(2184)));this.lej()}S8f(cb){cb?(this.R1b=yc.a(this.$).Vf.oXa(4,"NetworkConnectionStateManager.ConnectivityIssues"),
this.x1i()):(md.a.Ia(this.R1b),this.R1b=null)}x1i(){if(this.$&&this.$.pa){const cb=this.$.pa.va.Qb();ub.J(this.$.pa.va,null,null,null,cb)}}uzc(){Va.a(this.$).cQ(xb.a.jOa).Nq(this.gzf);this.$.Cl(this.Zc);this.hqc=!1}Bne(){this.documentVisibilityObserver||d.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");this.documentVisibilityObserver&&this.documentVisibilityObserver.Ei?this.Xyb||
(this.documentVisibilityObserver.mmb(this.bla),this.Xyb=!0,d.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.NUd()}}Object(b.a)(wd,"NetworkConnectionStateManager",tb.a,[465,3]);class I extends aa.a{constructor(cb){super();this.$=cb;this.Fb()}create(){Yc.TaskExtensions.Aa(ic.GetServiceTaskFactory.Ta(this.$.da,395,396,this.ib),cb=>{let Xb;Xb=$a.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")?
Object(Z.c)(this.$.da,400,()=>new wd(this.$,cb.result)):this.$.da.za(400)||new wd(this.$,cb.result);this.qb(Xb)},this.$.la,3)}static ka(cb){cb.da.Ga(401,new I(cb))}}Object(b.a)(I,"NetworkConnectionStateManagerFactory",aa.a,[]);var xa=a(1244),Ua=a(1150),vb=a(1206);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(c.a)();Object(ba.a)();Object(Ca.a)();Object(Na.a)();Object(za.a)();Object(Da.a)();Object(nb.a)();Object(vb.a)();Type.registerNamespace("Common.App.InProductMessaging");
da.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");ab.main();(()=>{la.a.Fa(()=>{la.a.Fa(ua.ka)})})();(()=>{la.a.Fa(()=>{la.a.Fa(ha.ka)})})();la.a.Fa(bc.ka);la.a.Fa(I.ka);Object(xa.a)();Object(Ua.a)()},843:function(t,D,a){a.r(D);t=a(0);var c=a(7),b=a(15),d=a(316),f=a(31),e=a(11),k=a(309);class l{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(t.a)(l,"ConnectionErrorLogInfo",null,[]);class m{}m.Bgg="b-ring_Apc_Trans";m.Ngg="cdn_static_resource_ewa_image";
Object(t.a)(m,"ResourceHosts",null,[]);var v=a(58),n=a(251);class w{constructor(y,A){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=y;this.caller=A;this.reset()}reset(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(t.a)(w,"NetworkTestResult",
null,[]);var r=a(575);class u{constructor(y,A,K,G,T){this.url="";this.O4a=!1;this.X6=-1;this.testIteration=0;this.baseUrl=K;this.ruf=G;this.t7e=A;this.result=new w(A,T)}runTest(){try{if(this.O4a)return b.ULS.sendTraceTag(537155206,0,50,`NetworkTestReq.RunTest: a test for the host ${this.t7e} is already mid way, not starting a new one.`),!1;this.reset();this.O4a=!0;this.result.startTimeMs=Date.now();const y=new n.QueryStringBuilder(this.baseUrl);y.N8("tid",this.result.startTimeMs.toString());this.url=
y.toString();this.Klj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(y){return this.Usb("Exeption: "+y.message),!1}}reset(){this.url="";this.result.reset();this.O4a=!1;this.X6=-1}clearTimeout(){-1!==this.X6&&(window.clearTimeout(this.X6),this.X6=-1)}Klj(){try{const y=new XMLHttpRequest;y.onreadystatechange=()=>{4===y.readyState&&(200===y.status?this.bAh():this.Usb(`Error when downloading resource. status code: ${y.status}, status text: ${y.statusText}`,y.status.toString()))};
y.onerror=()=>{this.Usb(`Client error when attempting to download resource. status code: ${y.status}, response: ${y.statusText}`)};this.X6=window.setTimeout(()=>{this.X6=-1;this.Usb("Request timeout")},1E4);y.open("GET",this.url,!0);y.send(null)}catch(y){this.Usb("Exeption: "+y.message)}}bAh(){this.O4a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=r.a(this.url),this.result.isSuccess=!0,this.C1b())}Usb(y,A=null){this.O4a&&
(this.clearTimeout(),this.result.errorMessage=y,this.result.isSuccess=!1,this.result.errorStatusCode=A,this.C1b())}C1b(){this.O4a=!1;this.ruf&&this.ruf(this.result,this.t7e)}}Object(t.a)(u,"NetworkTestReq",null,[]);class x{static WEh(y,A,K=null){x.bkc||(x.bkc=Array.isArray(v.a.Uh(A.ya.NetworkMeasurementUrlList))?v.a.Uh(A.ya.NetworkMeasurementUrlList):null);const G=[];for(let T=0;T<x.bkc.length;T++){const W=x.bkc[T];let P=W.key;P||(P=W.Key);if(K&&!K.includes(P))continue;let E=W.value;E||(E=W.Value);
P&&E&&G.push(new u(A,P,E,y,"OnNetworkDownImmediatePing"))}return G}}x.bkc=null;Object(t.a)(x,"NetworkConnectionHelpers",null,[]);class z{constructor(y){this.lid=[m.Ngg,m.Bgg];this.Xm=(A,K)=>{this.QN[K]=A;this.q4h()&&this.eej("OnNetworkDownImmediatePing"===A.caller)};this.Jka=y;this.$=y.$;this.QN={}}Tpi(){const y=x.WEh(this.Xm,this.$,this.lid);for(const A of y)A.runTest()}q4h(){for(const y of this.lid)if(void 0===this.QN[y]||null===this.QN[y])return!1;return!0}eej(y){const A=this.$.Rf.tZ;y&&this.iFj(A);
for(var K of this.lid)this.QN[K]=Sys.Serialization.JavaScriptSerializer.serialize(this.QN[K]);y=Date.now();K=this.Jka.mfd(a(843).NetworkConnectionHealthChecker.rCb).returnValue;const G=this.Jka.mfd(a(843).NetworkConnectionHealthChecker.wJb).returnValue;this.QN.isOfflineMode=A;this.QN.networkDownBBAge=-1===K?K:y-K;this.QN.transientServerCommunicationFailuresBBAge=-1===G?G:y-G;this.Jka.businessBar?(this.QN.isNetworkDownBBShown=this.Jka.businessBar.yE(56).toString(),this.QN.isServerErrorBBShown=this.Jka.businessBar.yE(21).toString()):
(this.QN.isNetworkDownBBShown="unknown",this.QN.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.QN)}`)}iFj(y){const {NetworkConnectionHealthChecker:A}=a(843),K={};for(const G of Object.keys(this.QN)){const T=this.QN[G];K[T.testName]=T.isSuccess}K.isOfflineMode=y;this.Jka.PSd(A.y0c,Sys.Serialization.JavaScriptSerializer.serialize(K))}}Object(t.a)(z,"ConnectionHealthTestsRunner",
null,[]);a.d(D,"NetworkConnectionHealthChecker",function(){return B});class B{constructor(y){this.businessBar=this.e7a=null;this.IFi=(A,K)=>{K.g5c?this.KFi(K):this.JFi(K)};this.ki=(A,K)=>{A=K.context.methodName;this.e7a&&A===this.e7a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.e7a}" has now succeeded. Querying local storage for BB showings.`),this.C7a(B.wJb,!0),this.e7a=null);this.ilf(!1);this.P1b=!1};this.Un=(A,K)=>{f.a.gh(K.errors,
[-1387426400])&&!this.P1b&&(this.P1b=!0,this.V0f()&&window.performance.mark(B.lsf),(new z(this)).Tpi())};this.yg=()=>{this.ilf(!0);this.C7a(B.rCb,!1);this.C7a(B.wJb,!1)};this.UDb=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.C7a(B.rCb,!0)};this.$=y;this.pa=this.$.pa;this.localStorage=new k.a;this.P1b=!1;this.$.ea.ql(this.yg);this.pa.Rf.SXb(this.UDb);this.pa.Gr(this.ki);this.$.da.Za(5,
A=>{this.businessBar=A;A.nDg(this.IFi)});this.pa.My(this.Un)}dispose(){this.$&&(this.$.ea&&this.$.ea.xn(this.yg),this.pa&&(this.pa.Rf.Xqc(this.UDb),this.pa.Oz(this.Un),this.pa.qt(this.ki)))}KFi(y){const A={};A.Timestamp=Date.now().toString();switch(y.PFa){case 21:this.e7a=y.data.FailedMethod;A.FailedMethod=this.e7a;this.PSd(B.wJb,JSON.stringify(A));break;case 56:this.PSd(B.rCb,JSON.stringify(A))}}JFi(y){switch(y.PFa){case 21:this.C7a(B.wJb,!0);break;case 56:this.C7a(B.rCb,!0)}}PSd(y,A){try{this.localStorage.If()&&
this.localStorage.setItem(y,A)}catch(K){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${K.message||"Unknown"}`)}}mfd(y){if(this.localStorage.If()&&(y=this.localStorage.Eub(y))&&"null"!==y){var A=JSON.parse(y);y=parseInt(A.Timestamp,10);A=Sys.Serialization.JavaScriptSerializer.serialize(A);return{returnValue:y,rawData:A}}return{returnValue:-1,rawData:null}}ilf(y){if(this.localStorage.If()){const A=this.localStorage.Eub(B.y0c);
if(A&&"null"!==A){let K=-1;this.P1b&&(K=this.gMh(B.lsf,B.xEi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(A)}, Period offline: ${K}, New session: ${y}`);this.localStorage.removeItem(B.y0c)}}}gMh(y,A){if(!this.V0f())return-1;window.performance.measure(A,y);y=window.performance.getEntriesByName(A);return y.length&&y[y.length-1]?y[y.length-1].duration:(b.ULS.sendTraceTag(537155228,
0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${A} returned no measures.`),-1)}C7a(y,A){try{let K;const G=({rawData:K}=this.mfd(y)).returnValue;if(-1!==G){const T=Object(c.a)(new l,{timeElapsed:Date.now()-G,scenario:y,isNewSession:!A,rawData:K});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(T)}`)}this.localStorage.removeItem(y)}catch(K){b.ULS.sendTraceTag(537155226,0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${K.message||
"Unknown"}`)}}V0f(){return e.HelperMethods.VWc&&d.a.$nb}}B.rCb="NetworkDownBBShown";B.wJb="ServerCommunicationFailureBBShown";B.y0c="ConnectionHealthPingRsults";B.lsf="offMoStMa";B.xEi="offMoDuMea";Object(t.a)(B,"NetworkConnectionHealthChecker",null,[3])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/2872bbd8a95a0c46f4ceb467b18d744a/EwaDSEsNext.pi.js.map